webpackJsonp([10,79,225,232,237,244,256,257,265,307,310,330,332],{2671:function(e,i){(function(e){var i,t={get:function(e){return n[i].get.apply(this,[e])},set:function(e,t){var a=parseInt(e),r=parseInt(t),s;if("undefined"===typeof e)a=0;else if(e<0)a=this.val().length+a;if("undefined"===typeof t)s=this.val().length;else if(t>=0)s=a+r;else s=this.val().length+r;n[i].set.apply(this,[a,s]);return this},setcursor:function(e){return this.textrange("set",e,0)},replace:function(e){n[i].replace.apply(this,[String(e)]);return this},insert:function(e){return this.textrange("replace",e)}},n={xul:{get:function(e){var i={position:this[0].selectionStart,start:this[0].selectionStart,end:this[0].selectionEnd,length:this[0].selectionEnd-this[0].selectionStart,text:this.val().substring(this[0].selectionStart,this[0].selectionEnd)};return"undefined"===typeof e?i:i[e]},set:function(e,i){this[0].selectionStart=e;this[0].selectionEnd=i},replace:function(e){var i=this[0].selectionStart;var t=this[0].selectionEnd;var n=this.val();this.val(n.substring(0,i)+e+n.substring(t,n.length));this[0].selectionStart=i;this[0].selectionEnd=i+e.length}},msie:{get:function(e){var i=document.selection.createRange();if("undefined"===typeof i)return{position:0,start:0,end:this[0].val().length,length:this[0].val().length,text:this.val()};var t=this[0].createTextRange();var n=t.duplicate();t.moveToBookmark(i.getBookmark());n.setEndPoint("EndToStart",t);var a={position:n.text.length,start:n.text.length,end:n.text.length+i.text.length,length:i.text.length,text:i.text};return"undefined"===typeof e?a:a[e]},set:function(e,i){var t=this[0].createTextRange();if("undefined"===typeof t)return this;if("undefined"!==typeof e){t.moveStart("character",e);t.collapse()}if("undefined"!==typeof i)t.moveEnd("character",i-e);t.select()},replace:function(e){document.selection.createRange().text=e}}};e.fn.textrange=function(n){if("undefined"===typeof this[0])return this;if("undefined"===typeof i)i="selectionStart"in this[0]?"xul":document.selection?"msie":"unknown";if("unknown"===i)return this;if(document.activeElement!==this[0])this[0].focus();if("undefined"===typeof n||"string"!==typeof n)return t.get.apply(this);else if("function"===typeof t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));else e.error("Method "+n+" does not exist in jQuery.textrange")}})(jQuery)},2672:function(e,i){(function(e){"use strict";var i="underlay";var t=/^[^:]+:([^:+]+)?$/i;var n=/webkit/i.test(navigator.userAgent);e.widget("TS.highlighter",{options:{placeholder_class:"ghost_text",global_modifier_highlight_class:"modifier",global_modifier_incomplete_highlight_class:"incomplete",global_keyword_highlightClass:"keyword",modifiers:[]},_ghost_text:"",_ghost_prev_char:"",_$ghost_text:null,_ghost_text_changed_sig:null,_create:function(){if(!this.element.is('input[type="text"]'))throw this.widgetName+": Element is not a text input.";this._renderUI();this._on({keydown:this._onInputKey,keyup:this._onInputKey,change:this._onInputChange,scroll:this._onScroll,focus:this._onFocus,blur:this._onBlur,mouseenter:this._onMouseEnter,mouseleave:this._onMouseLeave});if(null===a)l(this.element.parent());this._$ghost_text=e("<span>").addClass(this.options.placeholder_class);this._ghost_text_changed_sig=new signals.Signal;this._ghost_text_changed_sig.add(this._onNewGhostText,this);if(this.element.val().trim())this._updateUnderlay()},_destroy:function(){s(this._scroll_raf);e(window).unbind("resize.highlighter_resize");TS.client.flexpane_display_switched_sig.remove(this._updateSizing);this.element.off(".highlighter_transition")},_renderUI:function(){var t=this.widgetName+"_";this._$underlay=e('<div class="'+t+i+'"/>');this._$wrapper=this.element.parent();this._$wrapper.append(this._$underlay);this.element.addClass("search_input_highlighted");this._updateSizing();e(window).bind("resize.highlighter_resize",TS.utility.debounce(e.proxy(this._updateSizing,this),500));TS.client.flexpane_display_switched_sig.add(this._updateSizing,this);var n=this;this._$underlay.closest(".flex_header").on("transitionend.highlighter_transition webkitTransitionEnd.highlighter_transition MozTransitionEnd.highlighter_transition",function(e){n._updateSizing()})},_onInputKey:function(){this.element.trigger("change")},_onInputChange:function(){r(e.proxy(this._updateUnderlay,this))},_onScroll:function(){r(e.proxy(function(){this._$underlay.scrollLeft(this.element.scrollLeft())},this))},_onFocus:function(){this._has_focus=true;this._updateSizing();if(n)this._syncScrollLeft()},_onBlur:function(){this._has_focus=false;this._updateSizing()},_onMouseEnter:function(){this._mouse_over=true;if(n)this._syncScrollLeft()},_onMouseLeave:function(){this._mouse_over=false},_replaceAll:function(e,i,t){if(i instanceof RegExp)return e.replace(i,t);return e.replace(new RegExp(i,"gi"),t)},highlightStr:function(e,i){var t=e.split(" ");t.forEach(function(e,n){if(this._mightBeModifier(e)){var a=e.indexOf(":");var r=e.slice(0,a+1);var s=e.slice(a+1);var l;this.options.modifiers.some(function(a){var d=a.modifier;var c;var _;if(r.toLowerCase()===d){var u=this.options.global_modifier_highlight_class;var m=this.options.global_modifier_incomplete_highlight_class;if(a.modifierHighlightClass)u=u+" "+a.modifierHighlightClass;l="";if(i)l+='<wbr/><span class="no_wrap">';if(s)a.keyword_testers.some(function(e){if(e(s)){var i=this.options.global_keyword_highlightClass;if(a.keyword_highlight_class)i=i+" "+a.keyword_highlight_class;_='<span class="'+i+'">'+o(s)+"</span>";return true}return false},this);if(_)c='<span class="'+u+'">'+o(r)+"</span>";else c='<span class="'+u+" "+m+'">'+o(r)+"</span>";l+=c;if(_)l+=_;else l+=o(s);if(i)l+="</span>";t[n]=l;return true}else{t[n]=o(e);return false}},this)}else t[n]=o(e)},this);return t.join(" ")},_updateUnderlay:function(){var e=this.element.val();var i;if(this._prevVal===e)return;i=this.highlightStr(e);i=this._replaceAll(i,"\n","<br/>");i=this._replaceAll(i,"  ","  ");this._$underlay.html(i);if(this._ghost_text)if(this._prevVal&&e.length>this._prevVal.length&&e.charAt(e.length-1)===this._ghost_text.charAt(0))this.setGhostText(this._ghost_text.substring(1));else if(this._prevVal&&this._ghost_prev_char&&e.length&&e.length===this._prevVal.length-1&&this._ghost_prev_char===this._prevVal.charAt(this._prevVal.length-1))this.setGhostText(this._ghost_prev_char+this._ghost_text);else this.setGhostText("");this._$ghost_text.appendTo(this._$underlay);this._prevVal=e;if(a||TS.model.is_safari_desktop){this._$underlay.scrollLeft(1e4);var t=this._$underlay.scrollLeft();if(0!==t){this._$underlay.scrollLeft(0);this._$underlay.addClass("hide_highlights")}else this._$underlay.removeClass("hide_highlights")}},_mightBeModifier:function(e){return t.test(e)},_syncScrollLeft:function(){var i=e.proxy(function(){var e=window.devicePixelRatio;var t=Math.floor(e)>1?2:1;var n=e/t;var a=this.element.scrollLeft()*n;if(a!==this._prev_left){this._$underlay.scrollLeft(a);this._prev_left=this._$underlay.scrollLeft()}if(this._has_focus||this._mouse_over)this._scroll_raf=r(i)},this);s(this._scroll_raf);this._prev_left=null;this._scroll_raf=r(i)},_updateSizing:function(e){var i=this.element.parent().outerWidth();this._$underlay.width(i);this._$underlay.css("margin-left","-"+i+"px")},_onNewGhostText:function(){if(this._ghost_text)this._$ghost_text.text(this._ghost_text);else this._$ghost_text.html("&nbsp;&nbsp;")},setGhostText:function(e,i){this._ghost_text=e;this._ghost_prev_char=i;this._ghost_text_changed_sig.dispatch(e)}});var a=null;var r=function(){var e=["ms","moz","webkit","o"];var i=window.requestAnimationFrame;var t;for(t=0;t<e.length&&!i;t++)i=window[e[t]+"RequestAnimationFrame"];if(!i){var n=0;return function(e){var i=Date.now();var t=Math.max(0,16-(i-n));var a=window.setTimeout(function(){e(i+t)},t);n=i+t;return a}}return function(e){return i.call(window,e)}}();var s=function(){var e=["ms","moz","webkit","o"];var i=window.cancelAnimationFrame;var t;for(t=0;t<e.length&&!i;t++)i=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];if(!i)return function(e){clearTimeout(e)};return function(e){i.call(window,e)}}();var o=function(e){if(!e)return"";return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var l=function(i){if(/webkit/i.test(navigator.userAgent))return;if(/msie/i.test(navigator.userAgent))return;var t=/Firefox\/(\d+)\b/.exec(navigator.userAgent);if(t&&2===t.length)if(parseInt(t[1],10)>=31)return;var n=e('<input type="text">');n.val("MMMMMMMMMMMMMMMMMMMMMMMMMM");n.css({position:"absolute",top:"0",right:"9999px"});n.width(50);n.appendTo(i);n.focus().setCursorPosition(1e4);setTimeout(function(){n.focus().setCursorPosition(1e4);a=0===n.scrollLeft();n.remove()},500)}})(jQuery)},2673:function(e,i){(function(e){"use strict";var i={history:"history",modifier:"modifier",user:"user",group:"group",channel:"channel",conversation:"conversation",time_range:"time-range",date:"date",has:"has"};var t=5;var n=t;var a=t;var r=t;var s=t;var o=t;var l=100;var d="data-replacement";var c="data-matching-keyword";var u=null;var m="modifiers";var f="history";var h="profiles";var g="li";var p="ol";var S="autocomplete_calendar";var T="calendar_visible";var v="Y-m-d";var b=null;var w=534;var y=0;var A=/\{(.+)\}/i;var k=/^[^:]+:([^:]+)?$/i;e.widget("TS.autocomplete",{options:{hidden_class:"hidden deleted",selected_class:"selected",append_to:"body",disabled:false,data:null},_$popover:null,_$menu:null,_$menu_items:null,_$calendar:null,_$ac_menu:null,_$scrollable:null,_menu_index:null,_calendar_modifier:"",_render_data:{},_last_query:null,_recalc_height:true,_open_menu_on_focus:true,_hide_timer:null,_mouse_in_menu:false,_input_has_focus:false,_block_menu:false,_texty_block_menu:false,_caret_position:null,_current_history_query:null,_current_history_items:[],_search_promises:[],_search_pending:false,_query_suggestion_cache:{update_date:null,suggestion_list:[]},_create:function(){this.options.selected_class="highlighted";u=this.options.selected_class;b=TS.i18n.t("in:","search_menu")();this._renderUI();var i={keydown:this._onTextInputKeydown.bind(this),keyup:this._onTextInputKeyup.bind(this),mousedown:this._onTextInputMouseDown.bind(this),mouseup:this._onTextInputMouseUp.bind(this),focus:this._onTextInputFocus.bind(this),blur:this._onTextInputBlur.bind(this),cut:this._onTextInput.bind(this),paste:this._onTextInput.bind(this),input:this._onTextInput.bind(this),"on-enter":this._handleEnterKey.bind(this),"on-escape":this._handleEscKey.bind(this),"on-tab":this._handleTabKey.bind(this)};if(this.options.registerInputEvents)this.options.registerInputEvents(i);this._on(this._$menu,{"click li":this._onMenuClick,"click .delete_history_item_target_area":this._onClickDeleteHistoryItem,"click .footer_tip_action":this._onClickFooterTipAction,mouseenter:this._onMouseEnter,mouseleave:this._onMouseLeave,mousedown:this._onMouseDownMenu});this.options.data=this.options.data||window.DATA;e(window).bind("resize.recalc_autocomplete_height",e.proxy(function(){this._recalc_height=true},this));if(TS.search.autocomplete.unifiedAutocompleteIsEnabled()&&(!this._query_suggestion_cache.update_date||new Date-this._query_suggestion_cache.update_date>36e5))TS.api.call("search.autocomplete.data",{query:""}).then(function(e){this._query_suggestion_cache.suggestion_list=e.data.query_suggestion_list.map(function(e){return e.toString().replace("_"," ")});this._query_suggestion_cache.last_update_time=new Date}.bind(this))},_destroy:function(){e(window).unbind("resize.recalc_autocomplete_height")},_show:function(){this._$popover.removeClass(this.options.hidden_class);if(this._recalc_height){this._recalc_height=false;var i=e(window).height();var t=this._$menu.offset().top;var n=i-t-25;var a=Math.min(n,w);this._$menu.css("max-height",a)}e(window).unbind("mousedown.close_autocomplete").bind("mousedown.close_autocomplete",e.proxy(this._onMouseDownOutsideAutocomplete,this));TS.ui.utility.updateClosestMonkeyScroller(this._$scrollable)},show:function(){this._show()},_hide:function(){e(g,this._$menu).removeClass(this.options.selected_class);this._$popover.addClass(this.options.hidden_class);this._mouse_in_menu=false;this._$menu_items=null;e("#search_autocomplete_popover .results").remove();this._resetMenuIndex();e(window).unbind("mousedown.close_autocomplete");TS.kb_nav.end()},hide:function(){this._hide()},_requestHide:function(){this._cancelHide();this._hide_timer=setTimeout(e.proxy(this._hide,this),0)},_cancelHide:function(){clearTimeout(this._hide_timer)},_resetMenuIndex:function(){this._menu_index=null},_renderUI:function(){this._$popover=e("<div/>").addClass("popover_menu popover_search_menu").attr("id","search_autocomplete_popover");this._$popover.append('<span class="arrow"></span><span class="arrow_shadow"></span>');if(this._$menu)this._$menu.empty();this._$ac_menu=e('<div id="autocomplete_menu" class="content"/>').appendTo(this._$popover);this._$scrollable=e('<div class="autocomplete_menu_scrollable"/>').appendTo(this._$ac_menu);this._$menu=e("<div/>").appendTo(this._$scrollable);this._initCalendar();this._hide();this._$scrollable.append(this._$menu);e(this.options.append_to).append(this._$popover);if(!TS.environment.supports_custom_scrollbar)this._$scrollable.monkeyScroll();this._$ac_menu.addClass("search_menu")},_syncUI:function(){TS.kb_nav.end();if(this._render_data.header)this._$popover.addClass("showing_header");else this._$popover.removeClass("showing_header");this._render_data.conversations_html=new Handlebars.SafeString(this._conversationsHTML());this._render_data.show_ja_modifier_subtitle=TS.boot_data.feature_show_ja_modifier_subtitle&&"ja-JP"==TS.i18n.locale();if(this._render_data.query&&TS.search.autocomplete.unifiedAutocompleteIsEnabled())this._$menu.html(TS.templates.search_menu_unified_autocomplete(this._render_data));else this._$menu.html(TS.templates.search_menu(this._render_data));this._$menu_items=e(g,this._$menu);if(this._render_data.show_calendar){this._$calendar.removeClass(this.options.hidden_class);this._$ac_menu.addClass(T);this._$calendar.find(".pmu-selected").removeClass("pmu-selected")}else{this._$calendar.addClass(this.options.hidden_class);this._$ac_menu.removeClass(T)}if(this._render_data.footer&&this._render_data.footer.tips)this._$popover.attr("data-qa","search_modifier_tips");else this._$popover.removeAttr("data-qa");this._resetMenuIndex();this._$scrollable.data("disable-scroll",!!this._render_data.show_calendar);TS.ui.utility.updateClosestMonkeyScroller(this._$scrollable);TS.kb_nav.start(this._$menu.find(".results"),"li",".search_menu",{allowTabHighlightWhenEmptyInput:false,onMoveHighlight:_.bind(function(){this._highlightModifierAndKeywordInSearchField()},this)});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);if(TS.search.autocomplete.unifiedAutocompleteIsEnabled())TS.kb_nav.highlightFirstItem(true)},_conversationsHTML:function(){this._combineChannelsAndGroups();var e=this._render_data;var i,t,n;i=TS.templates.search_menu_channels(e);t=TS.templates.search_menu_dms(e);n=TS.templates.search_menu_groups(e);var a=[];var r=[];if(e.channels&&e.channels.length)a.push(i);else r.push(i);if(e.dms&&e.dms.length)a.push(t);else r.push(t);if(e.groups&&e.groups.length)a.push(n);else r.push(n);return a.join("")+r.join("")},_combineChannelsAndGroups:function(){var i=[];if(e.isArray(this._render_data.channels))i=this._render_data.channels;if(e.isArray(this._render_data.groups))i=i.concat(this._render_data.groups);var t=[];if(e.isArray(this._render_data.channels_archived))t=this._render_data.channels_archived;if(e.isArray(this._render_data.groups_archived))t=t.concat(this._render_data.groups_archived);i.sort(function(e,i){return i._score-e._score});t.sort(function(e,i){return i._score-e._score});this._render_data.channels=i;this._render_data.channels_archived=t;if(t.length>0&&0===i.length)this._render_data.channels=true;delete this._render_data.groups;delete this._render_data.groups_archived},_initCalendar:function(){if(this._$calendar)this._$calendar.pickmeup("destroy").remove();this._$calendar=e("<div/>").addClass(S).addClass(this.options.hidden_class).prependTo(this._$ac_menu);this._$calendar.pickmeup({flat:true,first_day:window.moment.localeData().firstDayOfWeek()||0,format:v,change:e.proxy(this._onCalendarChange,this),max:Date.now(),title_format:"ja-JP"===TS.i18n.locale()?"Y年B":"B Y",locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()}})},_setCalendarModifier:function(e){this._calendar_modifier=e},_onTextInputMouseDown:function(i){if(this._input_has_focus){if(this._hideMenuIfTextSelected())return;setTimeout(e.proxy(function(){this._saveCaretPosition();this._showAutocompleteSuggestions()},this),0)}},_onTextInputMouseUp:function(){this._saveCaretPosition();this._hideMenuIfTextSelected()},_onMenuClick:function(i){var t=e(i.target).closest(g);if(!t.length)return this._hide();try{var n=t.parent().attr("class").replace(" ","_");var a=t.parent().children().length;var r=t.index();TS.clog.track("SEARCH_AUTOCOMPLETE_ACCEPT",{request_id:TS.search.last_request_id,accept_module_name:n,accept_module_length:a,accept_item_offset:r,search_session_id:TS.search.getSearchSessionId(),client_request_id:TS.search.getQuerySessionId()})}catch(e){TS.warn(e)}if(t.data("isNavigational")){this._navigateToModel(t.data("id"));return}var s=t.attr(d);var o=t.data("isReplacementFull");if(this._isProfileItemElement(t)){TS.search.skip_next_search=true;this._handleProfileItem(t);return}if(this._isRevealHiddenElement(t)){this._revealHiddenItems(t);return}if(this._shouldAppendSpaceToItem(t))if(s.length)s+=" ";this._open_menu_on_focus=false;this._texty_block_menu=this._shouldUseTextyAutocomplete(s);if(this._isHistoryItemElement(t)||o)this._replaceEntireInput(s);else this._replaceCurrentWord(s);if(this._texty_block_menu)TS.utility.contenteditable.insertTextAtCursor(TS.search.input,"@");this._cancelDelayedSearch();if(this._isModifierItemElement(t)){if(this._isModifierItemElementWithoutKeyword(t)){this._showKeywordAutocompleteMenu();this._texty_block_menu=false;return}else if(this.options.data.triggerSearch)this.options.data.triggerSearch()}else if(this.options.data.triggerSearch)this.options.data.triggerSearch();this._texty_block_menu=false;this._block_menu=true;this._hide()},_onClickDeleteHistoryItem:function(i){i.stopPropagation();var t=e(i.target).closest("li");var n=t.attr(d);if(this.options.data.deleteHistoryItem)this.options.data.deleteHistoryItem(n);this._current_history_items=this._current_history_items.filter(function(e){return e.text!==n});this._render_data.history=this._current_history_items;this._syncUI()},_onClickFooterTipAction:function(i){var t=e(i.target).closest(".footer_tip_action");var n=t.data("replacement");if(!n)return;this._replaceCurrentWord(n);this._showAutocompleteSuggestions()},_onMouseDownOutsideAutocomplete:function(i){if(!e.contains(this.element[0],i.target)&&!e.contains(this._$popover[0],i.target)&&this.element[0]!==i.target&&this._$popover[0]!==i.target)this._hide()},_onMouseDownMenu:function(e){e.preventDefault()},_onMouseEnter:function(){this._mouse_in_menu=true},_onMouseLeave:function(){this._mouse_in_menu=false},preventMenuOnNextFocus:function(){this._open_menu_on_focus=false},_onTextInputFocus:function(){this._block_menu=false;this._cancelHide();setTimeout(e.proxy(function(){this._input_has_focus=true;this._saveCaretPosition();if(this._open_menu_on_focus)this._showAutocompleteSuggestions(true);this._open_menu_on_focus=true},this),0)},_onTextInputBlur:function(){this._input_has_focus=false;if(!this._mouse_in_menu)this._requestHide()},_onCalendarChange:function(e){var i=this._calendar_modifier+e+" ";this._open_menu_on_focus=false;this._replaceCurrentWord(i);if(this.options.data.triggerSearch)this.options.data.triggerSearch();this._hide()},_onTextInputKeydown:function(i){y=i.which;if(i.keyCode===C.enter){var t=e(i.target).closest(g);if(this._isRevealHiddenElement(t)){this._revealHiddenItems(t);return}this._handleEnterKey();return}this._block_menu=false;if(!this._menuShowing())return;if(i.keyCode===C.escape){i.preventDefault();this._handleEscKey();return}if(i.keyCode===C.tab){this._handleTabKey();return}if(i.keyCode===C.right&&TS.utility.contenteditable.getLength(this.element)===this._getCaretPosition()&&!TS.kb_nav.getHighlightedItem())setTimeout(_.bind(function(){TS.kb_nav.highlightFirstItem();this._highlightModifierAndKeywordInSearchField()},this),0)},_handleTabKey:function(){if(this._menuShowing()&&1===this._$menu_items.length)this._selectFirstItem()},_onTextInput:function(e){if(9==y)return;this._saveCaretPosition();this._last_query=TS.utility.contenteditable.value(this.element);if(this._prevent_next_input_event){this._prevent_next_input_event=false;return}this._showAutocompleteSuggestions()},_onTextInputKeyup:function(e){if(e.keyCode===C.escape)return;if(this._block_menu)return;if(this._hideMenuIfTextSelected())return},_selectFirstItem:function(){setTimeout(_.bind(function(){this._highlightModifierAndKeywordInSearchField();this._selectItem()},this),0)},_handleEnterKey:function(){this._cancelCurrentHistoryQuery();this._block_menu=true;if(this._menuShowing()){var i=e.Event("keydown",{target:e("."+this.options.selected_class,this._$menu)});this._onMenuClick(i)}},_handleEscKey:function(){if(this._menuShowing())this._hide()},_selectItem:function(){var i=e("."+this.options.selected_class,this._$menu);if(this._menuShowing())if(i.length>0){if(this._isProfileItemElement(i)){TS.search.skip_next_search=true;this._handleProfileItem(i);return}if(this._isRevealHiddenElement(i)){this._revealHiddenItems(i);return}if(this._shouldAppendSpaceToItem(i)){var t=TS.utility.contenteditable.value(this.element);var n=this._getCaretPosition();t=t.substring(0,n)+" "+t.substring(n);TS.utility.contenteditable.value(this.element,t);TS.utility.contenteditable.cursorPosition(this.element,n+1)}if(this._modifierAutocompleteShowing()||this._isModifierItemElementWithoutKeyword(i)){this._showKeywordAutocompleteMenu();return}if(this.options.data.triggerSearch)this.options.data.triggerSearch();this._hide()}else this._hide()},_handleBackspaceKey:function(e){var i=this._getCurrentModifyingStrDetails();if(i){var t=TS.utility.contenteditable.value(this.element);var n=null;if(i.caret_in_keyword&&this._keywordIsValid(i.keyword.keyword,i.modifier.modifier))n=i.keyword;else if(!i.caret_in_keyword&&this._modifierIsValid(i.modifier.modifier))n=i.modifier;if(n){var a=this._replaceRange(t,n.start,n.start+n.length,"");TS.utility.contenteditable.value(this.element,a);e.preventDefault();this.element.setCursorPosition(n.start)}}},_modifierIsValid:function(e){return!!e&&this.options.data.modifiers_by_name[e]},_keywordIsValid:function(e,i){var t=this.options.data.modifiers_by_name[i];if(!t)return false;for(var n=0;n<t.keyword_testers.length;n++)if(t.keyword_testers[n](e))return true;return false},_showAutocompleteSuggestions:function(e){if(this._texty_block_menu)return;if(TS.search.view.isLoading())return;var i=TS.utility.contenteditable.value(this.element);this._cancelDelayedSearch();if(!i)this._initCalendar();if(i&&this._hasNonWhiteSpace(i)||TS.search.autocomplete.unifiedAutocompleteIsEnabled()){var t=this._getWordAtCaretPosition();var n=this._getCurrentWordUpToCaret();if(n&&this._startsWith(n,"+"))this._showModifierAutocompleteMenu(n);else if(n&&k.test(t)){var a=this._getCurrentModifyingStrDetails();var r=a.modifier.modifier;if(a.caret_in_keyword||a.caret_is_modifier_adjacent)this._showKeywordAutocompleteMenu();else this._showModifierAutocompleteMenu(r)}else this._getResultsForQueryObj({current_word_up_to_caret:n,current_word:t,query:i}).then(function(e){if(TS.search.view.isLoading())return;this._render_data=e;this._$popover.addClass("showing_query_header");this._render_data.header={query:TS.format.texty.convertContentsStringToDisplayString(i)};this._render_data.show_modifier=true;if(this._resultSetIsEmpty(this._render_data))this._hide();else{this._syncUI();this._show()}}.bind(this));if(!this._search_pending)if(this._resultSetIsEmpty(this._render_data))this._hide();else{this._syncUI();this._show()}}else if(this._menuShowing()||e){this._$popover.removeClass("showing_query_header");if(!TS.search.autocomplete.unifiedAutocompleteIsEnabled()){this._render_data={modifier_groups:true,header:true};this._syncUI();this._show()}}},_showKeywordAutocompleteMenu:function(){if(this._texty_block_menu)return;var e=this._getCurrentModifyingStrDetails();var i=this.options.data.modifiers_by_name[e.modifier.modifier];if(!e)throw this.widgetName+": Lawdy how did you get here?";var t=e.keyword.keyword;if(this._startsWith(t,"+")){this._showSpecialKeywordsAutocompleteMenu(t,e);return}if(!i)return;switch(i.modifier){case"from:":this._showUserAutocompleteMenu(t);break;case"to:":this._showConversationAutocompleteMenu(t,TS.i18n.t("to:","search_menu")());break;case"in:":this._showConversationAutocompleteMenu(t,TS.i18n.t("in:","search_menu")());break;case"during:":case"on:":this._showDateAutocompleteMenu(t,e.modifier.modifier);this._setCalendarModifier(e.modifier.modifier);break;case"after:":case"before:":this._showDateAutocompleteMenu(t,e.modifier.modifier);this._setCalendarModifier(e.modifier.modifier);break;case"has:":this._showHasAutocompleteMenu(t);break;default:this._render_data={footer:true};this._syncUI()}},_showSpecialKeywordsAutocompleteMenu:function(i,t){var n=this.options.data.modifiers_by_name[t.modifier.modifier];var a=i.substring(1);var r;var s=n.keywords.filter(function(e){if(e===a)r=e;return"+"===i||this._startsWith(e,a)},this);if(r){this._replaceCurrentWord(t.modifier.modifier+r);this._showAutocompleteSuggestions();return}this._render_data={};this._render_data.modifiers=s.map(function(i){return e.extend({},n,{matching_keyword:i})});return},_showConversationAutocompleteMenu:function(e,t){if(!e){this._render_data={menu_type:i.conversation,conversation_modifier:t,special:this.options.data.conversationsStarred(),special_section_header:TS.i18n.t("Starred","search_menu")(),channels:this.options.data.channelsOpen(),dms:this.options.data.usersOpen(),groups:this.options.data.groupsOpen()};this._syncUI()}else{var n=false;var a=[];var r={menu_type:i.conversation,conversation_modifier:t};a.push(this._getUsersForQuery(e,null,n).then(function(e){r.dms=e}));a.push(this._getUsersForQuery(e,null,n,true).then(function(e){r.dms_deleted=e}));a.push(this._getChannelsForQuery(e,null).then(function(e){r.channels=e}));a.push(this._getChannelsForQuery(e,null,true).then(function(e){r.channels_archived=e}));a.push(this._getGroupsForQuery(e,null).then(function(e){r.groups=e}));a.push(this._getGroupsForQuery(e,null,true).then(function(e){r.groups_archived=e}));var s=Promise.all(a);s.then(function(){if(0===r.dms.length&&r.dms_deleted.length>0)r.dms=true;if(0===r.channels.length&&r.channels_archived.length>0)r.channels=true;if(0===r.groups.length&&r.groups_archived.length>0)r.groups=true;this._render_data=r;this._search_pending=false;if(this._resultSetIsEmpty(this._render_data))this._hide();else{this._syncUI();this._show()}}.bind(this));this._search_promises.push(s);this._search_pending=true}},_showDateAutocompleteMenu:function(t,n){var a=t.length>0&&/^\D/.test(t);var r=this.options.data.modifiers_by_name[n];var s;if(a){this._render_data={show_calendar:false};s=r.keywords.filter(function(e){return this._startsWith(e,t)},this);this._render_data.modifiers=s.map(function(i){return e.extend({},r,{matching_keyword:i})})}else this._render_data={menu_type:i.date,show_calendar:true,footer:{calendar_tip:true}};this._syncUI()},_showUserAutocompleteMenu:function(t){if(this._texty_block_menu)return;this._render_data={menu_type:i.user};if(!t||1===t.length&&"@"===t.charAt(0)){this._render_data.conversation_modifier=TS.i18n.t("from:","search_menu")();this._render_data.special=this.options.data.usersStarred().concat(this.options.data.usersOpen());this._render_data.special_section_header=TS.i18n.t("Starred and recent","search_menu")();var n=this.options.data.modifiers_by_name["from:"];this._render_data.modifiers=n.keywords.map(function(i){return e.extend({},n,{matching_keyword:i})});this._syncUI()}else{var a=[];var r={menu_type:i.user};a.push(this._getUsersForQuery(t,null).then(function(e){r.users=e}));a.push(this._getUsersForQuery(t,null,false,true).then(function(e){r.users_deleted=e}));var s=Promise.all(a);s.then(function(){if(0===r.users.length&&r.users_deleted.length>0)r.users=true;this._render_data=r;this._search_pending=false;if(this._resultSetIsEmpty(this._render_data))this._hide();else{this._syncUI();this._show()}}.bind(this));this._search_promises.push(s);this._search_pending=true}},_showHasAutocompleteMenu:function(t){this._render_data={menu_type:i.has,has:[]};this.options.data.modifiers_by_name["has:"].keywords.forEach(e.proxy(function(e){if(""===t||this._startsWith(e,t))if(TS.boot_data.feature_show_ja_modifier_subtitle&&"ja-JP"==TS.i18n.locale()){var i={star:"スター",pin:"ピン",link:"リンク",reaction:"リアクション"};this._render_data.has.push({name:e,jpn_subtitle:i[e]})}else this._render_data.has.push({name:e})},this));this._syncUI()},_showModifierAutocompleteMenu:function(e){var t=this.options.data.modifiers_by_name;if(e&&this._startsWith(e,"+")){e=e.substring(1);if(t[e]){this._replaceCurrentWord(e);this._showAutocompleteSuggestions();return}}if(!e){this._$popover.removeClass("showing_query_header");this._render_data={modifier_groups:true,header:true}}else this._render_data={modifiers:this._getModifiersForQuery(e,true),menu_type:i.modifier};this._syncUI()},_getCurrentModifyingStrDetails:function(){var e=this._getCaretPosition();var i=this._getWordRangeAtCaretPosition(e);if(!i||0===i.length)return null;var t=this._getWordAtCaretPosition();var n=t.indexOf(":");var a=TS.utility.contenteditable.displayValue(this.element).indexOf(":",i.start);var r=t.slice(0,n+1);return{modifier:{start:i.start,length:n+1,modifier:r},keyword:{start:i.start+n+1,length:t.length-r.length,keyword:t.slice(n+1)},caret_in_keyword:e>a+1,caret_is_modifier_adjacent:e===a+1}},_highlightModifierAndKeywordInSearchField:function(){var e=TS.kb_nav.getHighlightedItem();if(!e||!e.length)return;var i=e.attr(d);var t=e.data("isReplacementFull");if(i){this._prevent_next_input_event=true;if(t)this._replaceEntireInput(i);else this._replaceCurrentWord(i)}},_navigateToModel:function(e){TS.client.displayModelObById(e,{});TS.search.autocomplete.clearInput();this._hide();TS.search.skip_next_search=true;TS.search.querySessionEnd()},_handleProfileItem:function(e){var i=e.data("member-id");var t=e.data("bot-id");TS.search.autocomplete.clearInput();if(t)this.options.data.openBotProfile(t);else this.options.data.openProfile(i);this._hide()},_revealHiddenItems:function(e){var i=e.nextAll("."+this.options.hidden_class.split(" ").join(", ."));e.addClass(this.options.hidden_class);i.removeClass(this.options.hidden_class)},_deduplicateModifiers:function(e){var i=[];var t=[];e.forEach(function(e){if(-1===t.indexOf(e.modifier)){i.push(e);t.push(e.modifier)}});return i},_getUsersForQuery:function(e,i,t,n){return TS.searcher.search(e,{members:{include_slackbot:true,include_self:!t,include_deleted:true},limit:i,sort:{allow_empty_query:true}}).then(function(e){var i=_.map(e,"model_ob");if(n)i=_.filter(i,"deleted");else i=_.filter(i,function(e){return!e.deleted});return i})},_getModifiersForQuery:function(i,t){var n=[];this.options.data.modifiers.forEach(function(t){if(this._startsWith(t.modifier,i)||this._startsWith(t.name,i))n.push(e.extend({},t))},this);this.options.data.modifiers.forEach(function(a){if(!t){a.keywords.forEach(function(t){if(this._startsWith(t,i))n.push(e.extend({},a,{matching_keyword:t}))},this);if(a.dynamic_keywords&&a.dynamic_keywords.length>0)a.dynamic_keywords.forEach(function(t){if(t(i))n.push(e.extend({},a,{matching_keyword:i}))})}},this);n=this._deduplicateModifiers(n);return n},_getChannelsForQuery:function(e,i,t){return TS.searcher.search(e,{channels:{include_archived:true,exclude_mpims:true},limit:i,sort:{allow_empty_query:true}}).then(function(e){var i=_.map(e,function(e){var i=e.model_ob;i._score=e.score;return i});if(t)i=_.filter(i,"is_archived");else i=_.filter(i,function(e){return!e.is_archived});return i})},_getGroupsForQuery:function(e,i,t){return TS.searcher.search(e,{groups:true,limit:i,sort:{allow_empty_query:true}}).then(function(e){var i=_.map(e,function(e){var i=e.model_ob;i._score=e.score;return i});if(t)i=_.filter(i,"is_archived");else i=_.filter(i,function(e){return!e.is_archived});return i})},_getMPIMsForQuery:function(e,i){return TS.searcher.search(e,{mpims:true,all_mpims:true,limit:i,sort:{allow_empty_query:true}}).then(function(e){var i=_.map(e,function(e){var i=e.model_ob;i._score=e.score;return i});i=_.filter(i,function(e){return!e.is_archived});return i})},_getHistoryForQuery:function(i){if(i===this._current_history_query)return this._current_history_items;this._current_history_query=i;this._current_history_items=[];this.options.data.history(i,e.proxy(this._historyFetched,this));return this._current_history_items},_getResultsForQueryObj:function(e){if(TS.search.autocomplete.unifiedAutocompleteIsEnabled())return this._getUnifiedResultsForQueryObj(e);var i={conversation_modifier:b,query:d};var t=false;var s=false;if(!e)return i;var l=[];if(e.current_word_up_to_caret){var d=e.current_word_up_to_caret.toLowerCase();s="#"===d;t="@"===d;i.modifiers=this._getModifiersForQuery(d);l.push(this._getUsersForQuery(d,t?null:n).then(function(e){i.users=e}));l.push(this._getChannelsForQuery(d,s?null:a).then(function(e){i.channels=e}));l.push(this._getGroupsForQuery(d,r).then(function(e){i.groups=e}))}if(!t)l.push(this._getUsersForQuery(e.query,o).then(function(e){i.profiles=e;TS.presence_manager.queryMemberPresence(_.map(e,"id"));return null}));if(!t&&!s)i.history=this._getHistoryForQuery(e.query);var c=Promise.all(l).then(function(){this._search_pending=false;return i}.bind(this));this._search_promises.push(c);this._search_pending=true;return c},_getUnifiedResultsForQueryObj:function(e){var i={conversation_modifier:b,query:e.query,unified:[],history:null};if(!e)return i;var t=[];var s=function(e,i){var t=e?e.toLowerCase():"";var n=i?i.toLowerCase():"";var a=function(e){return e.split("").reverse().join("")};return(e==i?10:1)*(t==n?10:1)*(this._startsWith(t,n)>=0?1.2:1)*(this._startsWith(a(t),a(n))>=0?1.1:1)}.bind(this);var o=function(e,i){return(i.includes(" ")?.1:1)*s(e.name,i)};var l=function(e,i){return(i.includes(" ")?.1:1.1)*s(e.name,i)};var d=function(e,i){return(i.includes(" ")?.1:1)*s(e.name,i)};if(e.query){var c=e.query.toLowerCase().trim();var _="#"===c;var u="@"===c;t.push(this._getUsersForQuery(c,u?null:n,false).then(function(e){i.unified=i.unified.concat(e.map(function(e){return{is_type_user:true,entity:e,score:l(e,c)}}))}));t.push(this._getChannelsForQuery(c,_?null:a,false).then(function(e){i.unified=i.unified.concat(e.map(function(e){return{is_type_channel:true,entity:e,score:o(e,c)}}))}));t.push(this._getGroupsForQuery(c,r,false).then(function(e){i.unified=i.unified.concat(e.map(function(e){return{is_type_channel:true,entity:e,score:o(e,c)}}))}));t.push(this._getMPIMsForQuery(c,r).then(function(e){i.unified=i.unified.concat(e.map(function(e){return{is_type_mpim:true,entity:e,score:d(e,c)}}))}));var m=this._query_suggestion_cache.suggestion_list.filter(function(e){var i=this._startsWith(e,c)&&e!=c;return i}.bind(this));t.push(Promise.resolve(m).then(function(e){i.unified=i.unified.concat(e.map(function(e){return{is_type_query_completion:true,entity:{completion:e,full_query:e},score:s(e,c)}}))}))}var f=Promise.all(t).then(function(){this._search_pending=false;i.unified=i.unified.sort(function(e,i){return i.score-e.score}).slice(0,10);return i}.bind(this));return f},_getCurrentWordUpToCaret:function(){var e=this._getCaretPosition();var i=this._getWordRangeAtCaretPosition(e);var t=TS.utility.contenteditable.displayValue(this.element);if(t.length&&i.length)return t.substring(i.start,e);return null},_getCaretPosition:function(){return this._caret_position},_getRealCaretPosition:function(){return TS.utility.contenteditable.cursorPosition(this.element).start},_saveCaretPosition:function(){this._caret_position=this._getRealCaretPosition()},_shouldUseTextyAutocomplete:function(e){if(Array.isArray(e)){if("from:"===e[e.length-1].insert)return true}else if(e.endsWith("from:"))return true;return false},_replaceCurrentWord:function(e){if(!e)throw this.widgetName+": A replacement word must be provided.";var i=this._getWordRangeAtCaretPosition();var t=TS.format.texty.convertContentsStringToContents(e);var n=TS.format.texty.convertContentsToStringForDisplay(t).length;TS.utility.contenteditable.cursorPosition(this.element,i.start,i.length);TS.utility.contenteditable.insertContentsAtCursor(this.element,t);TS.utility.contenteditable.cursorPosition(this.element,i.start+n);this._saveCaretPosition()},_replaceEntireInput:function(e){TS.utility.contenteditable.value(this.element,e);TS.utility.contenteditable.setCursorAtEnd(this.element);this._saveCaretPosition()},_startsWith:function(e,i){if(!e||!i||e.length<i.length)return false;return 0===e.indexOf(i)},_getWordAtCaretPosition:function(e){if("undefined"===typeof e)e=this._getCaretPosition();var i=this._getWordRangeAtCaretPosition(e);var t=TS.utility.contenteditable.displayValue(this.element).slice(i.start,i.start+i.length);return t||null},_getWordRangeAtCaretPosition:function(e){if("undefined"===typeof e)e=this._getCaretPosition();var i={start:0,length:0};var t=TS.utility.contenteditable.displayValue(this.element);if(!t.length)return i;var n=e-1;if(e>0)while(n>0){if(" "===t.charAt(n)){var a=TS.utility.contenteditable.getFormats(this.element,n);var r=TS.utility.contenteditable.getFormats(this.element,n+1);if(!a.slackmention||!r.slackmention){i.start=n+1;break}}n-=1}if(e===t.length)i.length=e-i.start;else{n=e;while(n<=t.length){if(n===t.length)i.length=Math.max(n-i.start,0);if(" "===t.charAt(n)){var a=TS.utility.contenteditable.getFormats(this.element,n);if(!a.slackmention){i.length=Math.max(n-i.start,0);break}}n+=1}}return i},_replaceRange:function(e,i,t,n){var a=e.substring(0,i);var r=e.substring(t);var s;if(r===e)s=n;else s=a+n+r;return s},_menuShowing:function(){return this._$menu.is(":visible")},_hasNonWhiteSpace:function(e){return e&&/\S/.test(e)},_modifierAutocompleteShowing:function(){return this._render_data.menu_type===i.modifier},_resultSetIsEmpty:function(e){if(e.show_calendar)return false;if(e.modifier_groups)return false;if(e.unified&&e.unified.length>0)return false;var i=null;if(e.modifiers){if(e.modifiers.length>1)return false;if(1===e.modifiers.length){if(i)return false;i=[e.modifiers[0].modifier+e.modifiers[0].matching_keyword]}}if(e.has){if(e.has.length>1)return false;if(1===e.has.length){if(i)return false;i=["has:"+e.has[0].name]}}if(e.users){if(e.users.length>1)return false;if(1===e.users.length){if(i)return false;i=["from:"+e.users[0].name,"from:@"+e.users[0].name]}}if(e.users_deleted){if(e.users_deleted.length>1)return false;if(1===e.users_deleted.length){if(i)return false;i=["from:"+e.users_deleted[0].name,"from:@"+e.users_deleted[0].name]}}if(e.dms){if(e.dms.length>1)return false;if(1===e.dms.length){if(i)return false;i=[e.conversation_modifier+e.dms[0].name,e.conversation_modifier+"@"+e.dms[0].name]}}if(e.dms_deleted){if(e.dms_deleted.length>1)return false;if(1===e.dms_deleted.length){if(i)return false;i=[e.conversation_modifier+e.dms_deleted[0].name,e.conversation_modifier+"@"+e.dms_deleted[0].name]}}if(e.channels){if(e.channels.length>1)return false;if(1===e.channels.length){if(i)return false;i=[e.conversation_modifier+e.channels[0].name,e.conversation_modifier+"#"+e.channels[0].name]}}if(e.channels_archived){if(e.channels_archived.length>1)return false;if(1===e.channels_archived.length){if(i)return false;i=[e.conversation_modifier+e.channels_archived[0].name,e.conversation_modifier+"#"+e.channels_archived[0].name]}}if(e.groups){if(e.groups.length>1)return false;if(1===e.groups.length){if(i)return false;i=[e.conversation_modifier+e.groups[0].name]}}if(e.groups_archived){if(e.groups_archived.length>1)return false;if(1===e.groups_archived.length){if(i)return false;i=[e.conversation_modifier+e.groups_archived[0].name]}}if(e.history){if(e.history.length>1)return false;if(1===e.history.length){if(i)return false;i=[e.history[0].text]}}if(i){var t=this._getWordAtCaretPosition();var n=i.some(function(e){return e===t});return n}return true},_isHistoryItemElement:function(i){if(!i)throw this.widgetName+": You must pass an AC result list item element to test.";return i&&e(i).closest(p).hasClass(f)},_isModifierItemElement:function(i){if(!i)throw this.widgetName+": You must pass an AC result list item element to test.";return i&&e(i).closest(p).hasClass(m)},_isProfileItemElement:function(e){if(!e)throw this.widgetName+": You must pass an AC result list item element to test.";return e.closest(p).hasClass(h)},_isRevealHiddenElement:function(e){return e.hasClass("reveal_hidden_items")},_modifierItemElementHasKeyword:function(i){if(!i)throw this.widgetName+": You must pass an AC result list item element to test.";return!!e(i).attr(c)},_isModifierItemElementWithoutKeyword:function(e){return this._isModifierItemElement(e)&&!this._modifierItemElementHasKeyword(e)},_shouldAppendSpaceToItem:function(e){if(!e)throw this.widgetName+": You must pass an AC result list item element to test.";if(this._modifierAutocompleteShowing())return false;if(this._isModifierItemElement(e))return this._modifierItemElementHasKeyword(e);if(this._isHistoryItemElement(e))return false;if(TS.search.autocomplete.unifiedAutocompleteIsEnabled())return false;return true},_historyFetched:function(e,i){if(this._block_menu)return;if(e!==this._current_history_query)return;if(e!==TS.utility.contenteditable.value(this.element))return;if(this._menu_index)return;if(1===i.length&&i[0]===e)return;this._current_history_items=i.map(function(e){var i=TS.format.texty.convertContentsStringToDisplayString(e);return{text:e,html:i}});this._render_data.history=this._current_history_items;if(!this._resultSetIsEmpty(this._render_data)){this._render_data.noResults=false;this._syncUI();this._show()}},_cancelCurrentHistoryQuery:function(){this._current_history_query=null},_hideMenuIfTextSelected:function(){var e=TS.utility.contenteditable.cursorPosition(this.element);if(e.start!==e.end){this._hide();return true}return false},_cancelDelayedSearch:function(){_.each(this._search_promises,function(e){e.cancel()});this._search_promises=[];this._search_pending=false;this.options.data.cancelSearch()}});var C={backspace:8,tab:9,enter:13,shift:16,escape:27,up:38,right:39,down:40};var M=function(e){e=e||"";if(e.length>50)e=e.substring(0,50);return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};var I=function(e,i){i=M(i);var t=i.replace(/:/g,":(@|#)?");var n=new RegExp("^"+t+"(.+)","i");var a=n.exec(e);if(a&&a.length>0)return a[a.length-1];return false}})(jQuery)},2679:function(e,i,t){(function(i){e.exports=i["EXIF"]=t(2680)}).call(i,t(7))},2680:function(e,i,t){var a,r;/*!
  * exif-js - JavaScript library for reading EXIF image metadata
  * https://github.com/jseidelin/exif-js
  * MIT License | (c) 2008 Jacob Seidelin
  */
(function(){var t=false;var s=this;var o=function(e){if(e instanceof o)return e;if(!(this instanceof o))return new o(e);this.EXIFwrapped=e};if(true){if("undefined"!==typeof e&&e.exports)i=e.exports=o;i.EXIF=o}else s.EXIF=o;var l=o.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var d=o.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var c=o.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var _=o.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function u(e,i,t){if(e.addEventListener)e.addEventListener(i,t,false);else if(e.attachEvent)e.attachEvent("on"+i,t)}function m(e){return!!e.exifdata}function f(e,i){i=i||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"";e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");var t=atob(e);var n=t.length;var a=new ArrayBuffer(n);var r=new Uint8Array(a);for(var s=0;s<n;s++)r[s]=t.charCodeAt(s);return a}function h(e,i){var t=new XMLHttpRequest;t.open("GET",e,true);t.responseType="blob";t.onload=function(e){if(200==this.status||0===this.status)i(this.response)};t.send()}function g(e,i){function n(t){var n=p(t);var a=S(t);e.exifdata=n||{};e.iptcdata=a||{};if(i)i.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var a=f(e.src);n(a)}else if(/^blob\:/i.test(e.src)){var r=new FileReader;r.onload=function(e){n(e.target.result)};h(e.src,function(e){r.readAsArrayBuffer(e)})}else{var s=new XMLHttpRequest;s.onload=function(){if(200==this.status||0===this.status)n(s.response);else throw"Could not load image";s=null};s.open("GET",e.src,true);s.responseType="arraybuffer";s.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var r=new FileReader;r.onload=function(e){if(t)console.log("Got file of length "+e.target.result.byteLength);n(e.target.result)};r.readAsArrayBuffer(e)}}function p(e){var i=new DataView(e);if(t)console.log("Got file of length "+e.byteLength);if(255!=i.getUint8(0)||216!=i.getUint8(1)){if(t)console.log("Not a valid JPEG");return false}var n=2,a=e.byteLength,r;while(n<a){if(255!=i.getUint8(n)){if(t)console.log("Not a valid marker at offset "+n+", found: "+i.getUint8(n));return false}r=i.getUint8(n+1);if(t)console.log(r);if(225==r){if(t)console.log("Found 0xFFE1 marker");return A(i,n+4,i.getUint16(n+2)-2)}else n+=2+i.getUint16(n+2)}}function S(e){var i=new DataView(e);if(t)console.log("Got file of length "+e.byteLength);if(255!=i.getUint8(0)||216!=i.getUint8(1)){if(t)console.log("Not a valid JPEG");return false}var n=2,a=e.byteLength;var r=function(e,i){return 56===e.getUint8(i)&&66===e.getUint8(i+1)&&73===e.getUint8(i+2)&&77===e.getUint8(i+3)&&4===e.getUint8(i+4)&&4===e.getUint8(i+5)};while(n<a){if(r(i,n)){var s=i.getUint8(n+7);if(s%2!==0)s+=1;if(0===s)s=4;var o=n+8+s;var l=i.getUint16(n+6+s);return v(e,o,l)}n++}}var T={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function v(e,i,t){var n=new DataView(e);var a={};var r,s,o,l,d;var c=i;while(c<i+t){if(28===n.getUint8(c)&&2===n.getUint8(c+1)){l=n.getUint8(c+2);if(l in T){o=n.getInt16(c+3);d=o+5;s=T[l];r=y(n,c+5,o);if(a.hasOwnProperty(s))if(a[s]instanceof Array)a[s].push(r);else a[s]=[a[s],r];else a[s]=r}}c++}return a}function b(e,i,n,a,r){var s=e.getUint16(n,!r),o={},l,d,c;for(c=0;c<s;c++){l=n+12*c+2;d=a[e.getUint16(l,!r)];if(!d&&t)console.log("Unknown tag: "+e.getUint16(l,!r));o[d]=w(e,l,i,n,r)}return o}function w(e,i,t,n,a){var r=e.getUint16(i+2,!a),s=e.getUint32(i+4,!a),o=e.getUint32(i+8,!a)+t,l,d,c,_,u,m;switch(r){case 1:case 7:if(1==s)return e.getUint8(i+8,!a);else{l=s>4?o:i+8;d=[];for(_=0;_<s;_++)d[_]=e.getUint8(l+_);return d}case 2:l=s>4?o:i+8;return y(e,l,s-1);case 3:if(1==s)return e.getUint16(i+8,!a);else{l=s>2?o:i+8;d=[];for(_=0;_<s;_++)d[_]=e.getUint16(l+2*_,!a);return d}case 4:if(1==s)return e.getUint32(i+8,!a);else{d=[];for(_=0;_<s;_++)d[_]=e.getUint32(o+4*_,!a);return d}case 5:if(1==s){u=e.getUint32(o,!a);m=e.getUint32(o+4,!a);c=new Number(u/m);c.numerator=u;c.denominator=m;return c}else{d=[];for(_=0;_<s;_++){u=e.getUint32(o+8*_,!a);m=e.getUint32(o+4+8*_,!a);d[_]=new Number(u/m);d[_].numerator=u;d[_].denominator=m}return d}case 9:if(1==s)return e.getInt32(i+8,!a);else{d=[];for(_=0;_<s;_++)d[_]=e.getInt32(o+4*_,!a);return d}case 10:if(1==s)return e.getInt32(o,!a)/e.getInt32(o+4,!a);else{d=[];for(_=0;_<s;_++)d[_]=e.getInt32(o+8*_,!a)/e.getInt32(o+4+8*_,!a);return d}}}function y(e,i,t){var a="";for(n=i;n<i+t;n++)a+=String.fromCharCode(e.getUint8(n));return a}function A(e,i){if("Exif"!=y(e,i,4)){if(t)console.log("Not valid EXIF data! "+y(e,i,4));return false}var n,a,r,s,o,u=i+6;if(18761==e.getUint16(u))n=false;else if(19789==e.getUint16(u))n=true;else{if(t)console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false}if(42!=e.getUint16(u+2,!n)){if(t)console.log("Not valid TIFF data! (no 0x002A)");return false}var m=e.getUint32(u+4,!n);if(m<8){if(t)console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(u+4,!n));return false}a=b(e,u,u+m,d,n);if(a.ExifIFDPointer){s=b(e,u,u+a.ExifIFDPointer,l,n);for(r in s){switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":s[r]=_[r][s[r]];break;case"ExifVersion":case"FlashpixVersion":s[r]=String.fromCharCode(s[r][0],s[r][1],s[r][2],s[r][3]);break;case"ComponentsConfiguration":s[r]=_.Components[s[r][0]]+_.Components[s[r][1]]+_.Components[s[r][2]]+_.Components[s[r][3]]}a[r]=s[r]}}if(a.GPSInfoIFDPointer){o=b(e,u,u+a.GPSInfoIFDPointer,c,n);for(r in o){switch(r){case"GPSVersionID":o[r]=o[r][0]+"."+o[r][1]+"."+o[r][2]+"."+o[r][3]}a[r]=o[r]}}return a}o.getData=function(e,i){if((e instanceof Image||e instanceof HTMLImageElement)&&!e.complete)return false;if(!m(e))g(e,i);else if(i)i.call(e);return true};o.getTag=function(e,i){if(!m(e))return;return e.exifdata[i]};o.getAllTags=function(e){if(!m(e))return{};var i,t=e.exifdata,n={};for(i in t)if(t.hasOwnProperty(i))n[i]=t[i];return n};o.pretty=function(e){if(!m(e))return"";var i,t=e.exifdata,n="";for(i in t)if(t.hasOwnProperty(i))if("object"==typeof t[i])if(t[i]instanceof Number)n+=i+" : "+t[i]+" ["+t[i].numerator+"/"+t[i].denominator+"]\r\n";else n+=i+" : ["+t[i].length+" values]\r\n";else n+=i+" : "+t[i]+"\r\n";return n};o.readFromBinaryFile=function(e){return p(e)};if(true)a=[],r=function(){return o}.apply(i,a),void 0!==r&&(e.exports=r)}).call(this)},344:function(e,t){(function(e){var t=function(){var t='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_controls"><div class="colpick_color_state"><div class="colpick_new_color"></div><div class="colpick_current_color"></div></div><div class="colpick_color_fields"><div class="colpick_rgb_hsb"><div class="colpick_rgb"><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div></div><div class="colpick_hsb"><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div></div></div><div class="colpick_hex_submit"><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_submit"></div></div></div></div></div>',n={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:true,flat:false,layout:"full",submit:1,submitText:"OK",height:156},o=function(i,t){var n=s(i),a=0;e(t).data("colpick").fields.eq(a).val(n.r).end().eq(a+1).val(n.g).end().eq(a+2).val(n.b).end()},d=function(i,t){var n=3;e(t).data("colpick").fields.eq(n).val(Math.round(i.h)).end().eq(n+1).val(Math.round(i.s)).end().eq(n+2).val(Math.round(i.b)).end()},c=function(i,t){e(t).data("colpick").fields.eq(6).val(l(i))},_=function(i,t){e(t).data("colpick").selector.css("backgroundColor","#"+l({h:i.h,s:100,b:100}));e(t).data("colpick").selectorIndic.css({left:parseInt(e(t).data("colpick").height*i.s/100,10),top:parseInt(e(t).data("colpick").height*(100-i.b)/100,10)})},u=function(i,t){e(t).data("colpick").hue.css("top",parseInt(e(t).data("colpick").height-e(t).data("colpick").height*i.h/360,10))},m=function(i,t){e(t).data("colpick").currentColor.css("backgroundColor","#"+l(i))},f=function(i,t){e(t).data("colpick").newColor.css("backgroundColor","#"+l(i))},h=function(i){var t=e(this).parents(".colpick"),n,m=0;if(this.parentNode.className.indexOf("_swatches")>0){n=a(e(i.target).data("swatch-color"));c(n,t.get(0));o(n,t.get(0));d(n,t.get(0))}else if(this.parentNode.className.indexOf("_hex")>0){t.data("colpick").color=n=a($(this.value));o(n,t.get(0));d(n,t.get(0))}else if(this.parentNode.className.indexOf("_hsb")>0){t.data("colpick").color=n=B({h:parseInt(t.data("colpick").fields.eq(m+3).val(),10),s:parseInt(t.data("colpick").fields.eq(m+4).val(),10),b:parseInt(t.data("colpick").fields.eq(m+5).val(),10)});o(n,t.get(0));c(n,t.get(0))}else{t.data("colpick").color=n=r(P({r:parseInt(t.data("colpick").fields.eq(m).val(),10),g:parseInt(t.data("colpick").fields.eq(m+1).val(),10),b:parseInt(t.data("colpick").fields.eq(m+2).val(),10)}));c(n,t.get(0));d(n,t.get(0))}_(n,t.get(0));u(n,t.get(0));f(n,t.get(0));t.data("colpick").onChange.apply(t.parent(),[n,l(n),s(n),t.data("colpick").el,0])},g=function(i){e(this).parent().removeClass("colpick_focus")},p=function(){var i=e(this).parents(".colpick");i.data("colpick").fields.parent().removeClass("colpick_focus");e(this).parent().addClass("colpick_focus")},S=function(i){i.preventDefault?i.preventDefault():i.returnValue=false;var t=e(this).parent().find("input").focus(),n=e(this).parents(".colpick"),a={el:e(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:i.pageY,field:t,val:parseInt(t.val(),10),preview:n.data("colpick").livePreview};e(document).mouseup(a,v);e(document).mousemove(a,T)},T=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val-e.pageY+e.data.y,10))));if(e.data.preview)h.apply(e.data.field.get(0),[true]);return false},v=function(i){h.apply(i.data.field.get(0),[true]);i.data.el.removeClass("colpick_slider").find("input").focus();e(document).off("mouseup",v);e(document).off("mousemove",T);return false},b=function(i){i.preventDefault?i.preventDefault():i.returnValue=false;var t={cal:e(this).parent(),y:e(this).offset().top};e(document).on("mouseup touchend",t,y);e(document).on("mousemove touchmove",t,w);var n="touchstart"==i.type?i.originalEvent.changedTouches[0].pageY:i.pageY;h.apply(t.cal.data("colpick").fields.eq(3).val(parseInt(360*(t.cal.data("colpick").height-(n-t.y))/t.cal.data("colpick").height,10)).get(0),[t.cal.data("colpick").livePreview]);return false},w=function(e){var i="touchmove"==e.type?e.originalEvent.changedTouches[0].pageY:e.pageY;h.apply(e.data.cal.data("colpick").fields.eq(3).val(parseInt(360*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,i-e.data.y)))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]);return false},y=function(i){o(i.data.cal.data("colpick").color,i.data.cal.get(0));c(i.data.cal.data("colpick").color,i.data.cal.get(0));e(document).off("mouseup touchend",y);e(document).off("mousemove touchmove",w);return false},A=function(i){i.preventDefault?i.preventDefault():i.returnValue=false;var t={cal:e(this).parent(),pos:e(this).offset()};t.preview=t.cal.data("colpick").livePreview;e(document).on("mouseup touchend",t,C);e(document).on("mousemove touchmove",t,k);var n,a;if("touchstart"==i.type)pageX=i.originalEvent.changedTouches[0].pageX,a=i.originalEvent.changedTouches[0].pageY;else{pageX=i.pageX;a=i.pageY}var r=4;h.apply(t.cal.data("colpick").fields.eq(r+1).val(parseInt(100*(t.cal.data("colpick").height-(a-t.pos.top))/t.cal.data("colpick").height,10)).end().eq(r).val(parseInt(100*(pageX-t.pos.left)/t.cal.data("colpick").height,10)).get(0),[t.preview]);return false},k=function(e){var i,t;if("touchmove"==e.type)pageX=e.originalEvent.changedTouches[0].pageX,t=e.originalEvent.changedTouches[0].pageY;else{pageX=e.pageX;t=e.pageY}var n=4;h.apply(e.data.cal.data("colpick").fields.eq(n+1).val(parseInt(100*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.pos.top)))/e.data.cal.data("colpick").height,10)).end().eq(n).val(parseInt(100*Math.max(0,Math.min(e.data.cal.data("colpick").height,pageX-e.data.pos.left))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]);return false},C=function(i){o(i.data.cal.data("colpick").color,i.data.cal.get(0));c(i.data.cal.data("colpick").color,i.data.cal.get(0));e(document).off("mouseup touchend",C);e(document).off("mousemove touchmove",k);return false},M=function(i){var t=e(this).parents(".colpick");var n=t.data("colpick").color;t.data("colpick").origColor=n;m(n,t.get(0));t.data("colpick").onSubmit(n,l(n),s(n),t.data("colpick").el)},I=function(i){if(i)i.stopPropagation();var t=e("#"+e(this).data("colpickId"));t.data("colpick").onBeforeShow.apply(this,[t.get(0)]);var n=e(this).offset();var a=n.top+this.offsetHeight;var r=n.left;var s=E();var o=t.width();if(r+o>s.l+s.w)r-=o;t.css({left:r+"px",top:a+"px"});if(false!=t.data("colpick").onShow.apply(this,[t.get(0)]))t.addClass("visible");e("html").mousedown({cal:t},x);t.mousedown(function(e){e.stopPropagation()})},x=function(i){if(false!=i.data.cal.data("colpick").onHide.apply(this,[i.data.cal.get(0)]))i.data.cal.removeClass("visible");e("html").off("mousedown",x)},E=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth)}},B=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},P=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},$=function(e){var i=6-e.length;if(i>0){var t=[];for(var n=0;n<i;n++)t.push("0");t.push(e);e=t.join("")}return e},D=function(){var i=e(this).parent();var t=i.data("colpick").origColor;i.data("colpick").color=t;o(t,i.get(0));c(t,i.get(0));d(t,i.get(0));_(t,i.get(0));u(t,i.get(0));f(t,i.get(0))};return{init:function(s){s=e.extend({},n,s||{});if("string"==typeof s.color)s.color=a(s.color);else if(void 0!=s.color.r&&void 0!=s.color.g&&void 0!=s.color.b)s.color=r(s.color);else if(void 0!=s.color.h&&void 0!=s.color.s&&void 0!=s.color.b)s.color=B(s.color);else return this;var l=t;if(s.swatches&&Array.isArray(s.swatches)){var T="",v;for(i=0;i<s.swatches.length;i++){v=s.swatches[i];if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(v))T+='<div class="colpick_swatch" style="background-color: '+v+';" data-swatch-color="'+v+'"></div>'}if(T){T='<div class="colpick_swatches">'+T+"</div>";l=t.slice(0,-6)+T+"</div>"}}return this.each(function(){if(!e(this).data("colpickId")){var i=e.extend({},s);i.origColor=s.color;var t="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colpickId",t);var n=e(l).attr("id",t);n.addClass("colpick_"+i.layout+(i.submit?"":" colpick_"+i.layout+"_ns"));if("light"!=i.colorScheme)n.addClass("colpick_"+i.colorScheme);n.find("div.colpick_submit").html(i.submitText).click(M);i.fields=n.find("input").change(h).blur(g).focus(p);n.find("div.colpick_field_arrs").mousedown(S).end().find("div.colpick_current_color").click(D);i.swatches=n.find(".colpick_swatch").click(h);i.selector=n.find("div.colpick_color").on("mousedown touchstart",A);i.selectorIndic=i.selector.find("div.colpick_selector_outer");i.el=this;i.hue=n.find("div.colpick_hue_arrs");huebar=i.hue.parent();var a=navigator.userAgent.toLowerCase();var r="Microsoft Internet Explorer"===navigator.appName;var T=r?parseFloat(a.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0;var v=r&&T<10;var w=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(v){var y,k;for(y=0;y<=11;y++){k=e("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+w[y]+", endColorstr="+w[y+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+w[y]+", endColorstr="+w[y+1]+')";');huebar.append(k)}}else{stopList=w.join(",");huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ")}n.find("div.colpick_hue").on("mousedown touchstart",b);i.newColor=n.find("div.colpick_new_color");i.currentColor=n.find("div.colpick_current_color");n.data("colpick",i);o(i.color,n.get(0));d(i.color,n.get(0));c(i.color,n.get(0));u(i.color,n.get(0));_(i.color,n.get(0));m(i.color,n.get(0));f(i.color,n.get(0));if(i.flat){n.appendTo(this).show();var C={position:"relative"};C.display="flex";n.css(C)}else{n.appendTo(document.body);e(this).on(i.showEvent,I);n.css({position:"absolute"})}}})},showPicker:function(){return this.each(function(){if(e(this).data("colpickId"))I.apply(this)})},hidePicker:function(){return this.each(function(){if(e(this).data("colpickId"))e("#"+e(this).data("colpickId")).hide()})},setColor:function(i,t){t="undefined"===typeof t?1:t;if("string"==typeof i)i=a(i);else if(void 0!=i.r&&void 0!=i.g&&void 0!=i.b)i=r(i);else if(void 0!=i.h&&void 0!=i.s&&void 0!=i.b)i=B(i);else return this;return this.each(function(){if(e(this).data("colpickId")){var n=e("#"+e(this).data("colpickId"));n.data("colpick").color=i;n.data("colpick").origColor=i;o(i,n.get(0));d(i,n.get(0));c(i,n.get(0));u(i,n.get(0));_(i,n.get(0));f(i,n.get(0));n.data("colpick").onChange.apply(n.parent(),[i,l(i),s(i),n.data("colpick").el,1]);if(t)m(i,n.get(0))}})}}}();var n=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}};var a=function(e){return r(n(e))};var r=function(e){var i={h:0,s:0,b:0};var t=Math.min(e.r,e.g,e.b);var n=Math.max(e.r,e.g,e.b);var a=n-t;i.b=n;i.s=0!=n?255*a/n:0;if(0!=i.s)if(e.r==n)i.h=(e.g-e.b)/a;else if(e.g==n)i.h=2+(e.b-e.r)/a;else i.h=4+(e.r-e.g)/a;else i.h=-1;i.h*=60;if(i.h<0)i.h+=360;i.s*=100/255;i.b*=100/255;return i};var s=function(e){var i={};var t=e.h;var n=255*e.s/100;var a=255*e.b/100;if(0==n)i.r=i.g=i.b=a;else{var r=a;var s=(255-n)*a/255;var o=t%60*(r-s)/60;if(360==t)t=0;if(t<60){i.r=r;i.b=s;i.g=s+o}else if(t<120){i.g=r;i.b=s;i.r=r-o}else if(t<180){i.g=r;i.r=s;i.b=s+o}else if(t<240){i.b=r;i.r=s;i.g=r-o}else if(t<300){i.b=r;i.g=s;i.r=s+o}else if(t<360){i.r=r;i.g=s;i.b=r-o}else{i.r=0;i.g=0;i.b=0}}return{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}};var o=function(i){var t=[i.r.toString(16),i.g.toString(16),i.b.toString(16)];e.each(t,function(e,i){if(1==i.length)t[e]="0"+i});return t.join("")};var l=function(e){return o(s(e))};e.fn.extend({colpick:t.init,colpickHide:t.hidePicker,colpickShow:t.showPicker,colpickSetColor:t.setColor});e.extend({colpick:{rgbToHex:o,rgbToHsb:r,hsbToHex:l,hsbToRgb:s,hexToHsb:a,hexToRgb:n}})})(jQuery)},3449:function(e,i){(function(){TS.registerModule("files.media",{INLINE_VIDEO_CLASS_NAME:"inline_video",COUNT_LABEL_MOV_CANPLAY:"inline_mov_canplay",COUNT_LABEL_MOV_ERROR:"inline_mov_error",bindVideoElements:function i(t){var n=$(_.get(t,"container","body"));var a=_.get(t,"onCanplay",_.noop);var r=_.get(t,"onError",_.noop);n[0].addEventListener("canplay",function(i){var t=$(i.target);if(t.hasClass(TS.files.media.INLINE_VIDEO_CLASS_NAME)){e(t,TS.files.media.COUNT_LABEL_MOV_CANPLAY);a(t)}},true);n[0].addEventListener("error",function(i){var t=$(i.target);if(t.hasClass(TS.files.media.INLINE_VIDEO_CLASS_NAME)){e(t,TS.files.media.COUNT_LABEL_MOV_ERROR);r(t)}},true);n[0].addEventListener("play",function(e){var i=$(e.target);var t=i.closest("ts-message");var n=""+t.data("ts");var a=t.data("model-ob-id");var r=t.data("member-id");var s=t.data("app-id");var o=t.data("bot-id");var l=t.find(".msg_inline_video_new_window_button");var d=l.data("referer-original-href");var c=d||l.attr("href");var _={message_timestamp:n,channel_id:a,channel_type:a?a.charAt(0):"",member_id:r,app_id:s,bot_id:o,url:c||""};TS.clog.track("MSG_VIDEO_PLAY",_)},true);n.find("."+TS.files.media.INLINE_VIDEO_CLASS_NAME).each(function(){var e=$(this);if(this.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA)a(e);else if(this.error)r(e)})},test:function e(){return{_isSrcMov:i}}});var e=function e(t,n){if(i(t.attr("src")))TS.metrics.count(n)};var i=function e(i){return _.isString(i)&&"mov"===_.last(i.split(".")).toLowerCase()}})()},345:function(e,i,t){(function(i){e.exports=i["TimezoneDetector"]=t(346)}).call(i,t(7))},3454:function(e,i){(function(){TS.registerModule("coachmark",{$coachmark:null,context:null,is_showing:false,is_small:false,reject_on_off_target_click:false,onStart:function e(){},start:function a(r,s,o){if(!r)return;if(TS.coachmark.is_showing)TS.coachmark.end();if(!TS.coachmark.$coachmark)i(r,s);t(r);var l=TS.coachmark.$coachmark;if(!$("#"+r.coachmark_el_id).length){TS.error(["Cannot show coachmark ",r.id," because there is no element ",r.coachmark_el_id,""].join('"'));l.addClass("hidden");return}o=o||{};TS.coachmark.clean();TS.coachmark.context=r;TS.model.coachmark_is_showing=true;TS.coachmark.is_showing=true;TS.coachmark.reject_on_off_target_click=_.get(o,"reject_on_off_target_click",false);l.removeClass("hidden");l.css("left","").css("right","").css("top","").css("bottom","").css("height","auto").css("width","auto");$("#coachmark_callout").css("left","").css("right","").css("top","").css("bottom","");l.addClass(r.coachmark_el_id);$("#"+r.coachmark_el_id).removeClass("hidden");if(!r.reject)$("#coachmark_footer > .coachmark_footer_text").addClass("hidden");$(window.document).bind("keydown",TS.coachmark.onKeyDown);if(!r.has_close_btn)$("html").bind("mousedown",TS.coachmark.onMouseDown);else $("#coachmark_bg").on("click",function(){TS.coachmark.end();n()});if(r.disable_scrolling)$("#client-ui").addClass("disable_scrolling");l.css("opacity",1);if(r.place&&r.placeSmall){l.addClass("small_coachmark");TS.coachmark.is_small=true}e();$(window).on("resize.coachmark_placement",e);if(TS.coachmark.context.ui_click){$(".coachmark_got_it").removeClass("hidden");$(".coachmark_next_tip").addClass("hidden")}if(!TS.coachmark.context.no_bg_on_small&&!TS.coachmark.context.no_bg)$("#coachmark_bg").removeClass("hidden")},placeRightOf:function e(i,t,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;t=t||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=i.offset();s.css("top",d.top+t);s.css("left",d.left+i.width()+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("top",l+a).css("left",-10);else $("#coachmark_callout").css("top",Math.round(_.clamp(d.top-c.top+(i.height()-o)/2+a,l,c.height-(l+o)))).css("left",-10)},placeBelowOf:function e(i,t,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;t=t||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=i.offset();s.css("top",d.top+i.height()+t);s.css("left",d.left+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("left",l+a).css("top",-10);else $("#coachmark_callout").css("left",Math.round(_.clamp(d.left-c.left+(i.width()-o)/2+a,l,c.width-(l+o)))).css("top",-10)},placeAboveOf:function e(i,t,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;t=t||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=i.offset();s.css("top",d.top-o-s.height()+t);s.css("left",d.left+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("left",l+a).css("bottom",-10);else $("#coachmark_callout").css("left",Math.round(_.clamp(d.left-c.left+(i.width()-o)/2+a,l,c.width-(l+o)))).css("bottom",-10)},placeLeftOf:function e(i,t,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;t=t||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=i.offset();s.css("top",d.top+t);s.css("left",d.left-s.width()+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("top",l+a).css("right",-10);else $("#coachmark_callout").css("top",Math.round(_.clamp(d.top-c.top+(i.height()-o)/2+a,l,c.height-(l+o)))).css("right",-10)},keepInBounds:function e(){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;var i=TS.coachmark.$coachmark;var t=TS.coachmark.context;var n=4;var a=i.dimensions_rect();var r={top:0+n,right:$(window).width()-n,bottom:$(window).height()-n,left:0+n};if(!t.place)i.css("left","").css("right","").css("top","").css("bottom","");if(TS.utility.doesRectContainRect(r,a))return;if(a.left<r.left)i.css("left",r.left);else if(a.right>r.right)i.css("left",Math.max(r.left,r.right-a.width));if(a.top<r.top)i.css("top",r.top);else if(a.bottom>r.bottom)i.css("top",Math.max(r.top,r.bottom-a.height))},clean:function e(){$("#coachmark_footer > .coachmark_footer_text").removeClass("hidden");if(TS.coachmark.context)TS.coachmark.$coachmark.removeClass(TS.coachmark.context.coachmark_el_id).removeClass("small_coachmark");TS.coachmark.is_small=false;TS.coachmark.context=null},reject:function e(i){var t=TS.coachmark.context;if(t&&t.reject)t.reject();TS.coachmark.end();n();if(TS.newxp)TS.clog.track("GROWTH_ONBOARDING",{action:"skip_tutorial_step",step:TS.newxp.getCurrentStepName()});if(i)i.stopPropagation()},resolve:function e(i){var t=TS.coachmark.context;if(t&&t.resolve)t.resolve();TS.coachmark.end();if(i)i.stopPropagation()},expand:function i(t){var n=TS.coachmark.$coachmark;var a=n.find("#coachmark_interior");if(TS.coachmark.is_small){TS.coachmark.is_small=false;a.css("opacity",0);n.removeClass("small_coachmark");e();$("#coachmark_bg").removeClass("hidden");window.setTimeout(function(){a.css("opacity",1)},100)}if(t)t.stopPropagation()},end:function e(){TS.model.coachmark_is_showing=false;TS.coachmark.is_showing=false;var i=TS.coachmark.$coachmark;i.css("opacity",0);TS.coachmark.$coachmark.find(".coachmark_div").remove();TS.coachmark.clean();i.addClass("hidden");$("#coachmark_bg").addClass("hidden");$("#client-ui").removeClass("disable_scrolling");TS.coachmark.$coachmark.remove();TS.coachmark.$coachmark=null;$(window.document).off("keydown",TS.coachmark.onKeyDown);$("html").off("mousedown",TS.coachmark.onMouseDown);$(window).off("resize.coachmark_placement");$("#coachmark_bg").off("click",TS.coachmark.end)},onKeyDown:function e(i){if(i.which==TS.utility.keymap.esc)TS.coachmark.reject(i);else if(i.which==TS.utility.keymap.enter&&!TS.coachmark.context.enter_does_not_dismiss)if(TS.coachmark.is_small)TS.coachmark.expand(i);else TS.coachmark.resolve(i)},onMouseDown:function e(i){if(TS.coachmark.is_small)TS.coachmark.expand(i);else if(!$(i.target).closest("#coachmark").length)if(TS.coachmark.reject_on_off_target_click)TS.coachmark.reject(i);else TS.coachmark.resolve(i)},onClickInvite:function e(i){if($(i.target).is("#coachmark_bg"))return TS.coachmark.resolve(i);if(TS.ui.admin_invites.canInvite())TS.ui.admin_invites.start();return TS.coachmark.resolve(i)}});var e=function e(){var i=TS.coachmark.context;if(i.placeSmall&&TS.coachmark.is_small)i.placeSmall();else if(i.place)i.place();else TS.coachmark.keepInBounds()};var i=function e(i,t){var n;if(t)n=$("."+i.inline_wrapper_el_class);else n=$("#client-ui");if(!n.length&&TS.calls)n=$("#calls_conference_content");n.append(TS.templates.coachmark({has_close_btn:i.has_close_btn,no_footer:i.no_footer}));TS.coachmark.$coachmark=$("#coachmark");var a=TS.coachmark.$coachmark;a.css("opacity",0);a.on("click",".coachmark_skip_link",TS.coachmark.reject);a.on("click",".coachmark_got_it",TS.coachmark.resolve);a.on("click",".coachmark_next_tip",TS.coachmark.resolve);a.on("click",".coachmark_ok",TS.coachmark.resolve);a.on("click",".coachmark_close_btn",TS.coachmark.reject)};var t=function e(i){if(!TS.coachmark.$coachmark)return;if(i.content)TS.coachmark.$coachmark.find("#coachmark_interior").prepend(i.content());if(i.buttonText)TS.coachmark.$coachmark.find(".coachmark_next_tip").text(i.buttonText());else TS.coachmark.$coachmark.find(".coachmark_next_tip").text(TS.i18n.t("Next Tip","coachmarks")());if(i.footer)TS.coachmark.$coachmark.find("#coachmark_footer").html(i.footer())};var n=function e(){if(TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding())TS.lessons.coachmark_closed_sig.dispatch(true)}})()},346:function(e,i,t){"use strict";(function(t){window.timezones_list=function(e){var i=new TimezoneDetector;return i.getList(e)};window.timezones_guess=function(){var e=new TimezoneDetector;var i={};if(arguments.length>0)i.default=arguments[0];var t=e.detect(i);return t.zoneId};(function(){var t=this;var n=t.TimezoneDetector;var a=function(){var e=this;e.getList=function(e){if("fr-FR"==e)return r;else if("es-ES"==e)return s;else if("de-DE"==e)return o;else if("ja-JP"==e)return l;return a};e.detect=function(e){var n={zoneId:"America/Los_Angeles",method:"gave_up"};if(e&&e.default){n.zoneId=e.default;n.method="default"}n.intl=i();var r=n.intl.zoneId;if(r){for(var s=0;s<a.length;s++)if(a[s][1]==r){n.zoneId=r;n.method="intlapi_exact";return n}if(d[r]){n.zoneId=d[r];n.method="intl_api_manual";return n}if(c[r]){n.zoneId=c[r];n.method="intl_api_equivalent";return n}if(_[r]){n.zoneId=_[r];n.method="intl_api_fallback";return n}}n.probe=t();if(n.probe.zoneId){n.zoneId=n.probe.zoneId;n.method="date_probe";return n}return n};var i=function(){var e={zoneId:null,hasIntl:false,hasDateTime:false,hasOptions:false};try{if("undefined"===typeof Intl)return e;e.hasIntl=true;if("undefined"===typeof Intl.DateTimeFormat)return e;var i=Intl.DateTimeFormat();if("undefined"===typeof i)return e;e.hasDateTime=true;if("undefined"===typeof i.resolvedOptions)return e;e.hasOptions=true;e.zoneId=i.resolvedOptions().timeZone}catch(i){return e}return e};var t=function(){var e=[];e.push(-1*new Date(Date.UTC(2008,10,27,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2010,4,30,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2001,10,28,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2002,4,7,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2004,10,3,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2011,11,7,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2012,11,10,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2015,9,22,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2015,11,2,0,0,0,0)).getTimezoneOffset());e.push(-1*new Date(Date.UTC(2016,3,27,0,0,0,0)).getTimezoneOffset());for(var i=1;i<=e.length;i++){var t=e.slice(0,i).join(":");if(n[t])return{zoneId:n[t],probeKey:t,fullKey:e.join(":")}}return{zoneId:null,fullKey:e.join(":")}};var n={"-660:-660:-660:-660:-660:-660":"Pacific/Midway","-540":"America/Adak","-600":"Pacific/Honolulu","-570":"Pacific/Marquesas","-480:-480":"America/Anchorage","-480:-420":"America/Tijuana","-420:-420:-420:-480":"America/Los_Angeles","-420:-420:-420:-420":"America/Phoenix","-420:-360":"America/Chihuahua","-360:-360:-360:-420":"America/Denver","-360:-360:-360:-360":"America/Regina","-300:-300:-300:-360":"America/Chicago","-300:-360":"Pacific/Easter","-360:-300:-360:-360:-300:-360:-360:-300:-360":"America/Mexico_City","-300:-300:-300:-300:-300:-300:-300:-300":"America/Bogota","-360:-300:-360:-360:-300:-360:-360:-300:-300":"America/Cancun","-240:-240:-240:-300:-240:-300:-300:-240:-300":"America/New_York","-300:-300:-300:-300:-300:-300:-300:-240":"America/Port-au-Prince","-300:-240":"America/Havana","-240:-240:-300":"America/Indiana/Indianapolis","-180:-240:-180:-180":"America/Asuncion","-180:-180:-180:-240":"America/Halifax","-270":"America/Caracas","-180:-240:-180:-240:-240:-180:-180:-240":"America/Cuiaba","-240:-240:-240:-240":"America/Manaus","-180:-240:-180:-240:-240:-180:-180:-180":"America/Santiago","-240:-240:-240:-300:-240:-300:-300:-240:-240":"America/Grand_Turk","-150":"America/St_Johns","-180:-180:-120:-180:-180:-180":"America/Fortaleza","-120:-180:-120":"America/Sao_Paulo","-180:-180:-180:-180":"America/Cayenne","-120:-180:-180:-180:-180":"America/Buenos_Aires","-180:-120":"America/Godthab","-120:-180:-180:-180:-120":"America/Montevideo","-120:-120:-120":"America/Miquelon","-180:-180:-120:-180:-180:-120":"America/Bahia","-120:-120:-60":"America/Noronha","-60:0":"Atlantic/Azores","-60:-60":"Atlantic/Cape_Verde","0:0:0:0:0:0:0:60":"Africa/Casablanca","0:60":"Europe/London","0:0:0:0:0:0:0:0":"Africa/Monrovia","60:120":"Europe/Amsterdam","60:60":"Africa/Algiers","120:60":"Africa/Windhoek","180:180:120:180:180":"Asia/Amman","120:180:180":"Europe/Athens","120:180:120:180:180:120:120:180:120":"Asia/Beirut","120:180:120:120:120:120:120:120":"Africa/Cairo","180:180:120:180:120":"Asia/Damascus","120:180:120:120:120:120:120:180":"Asia/Gaza","120:120:120:120:120:120:120":"Africa/Harare","120:180:120:180:120":"Asia/Jerusalem","120:180:120:180:180:180:180:120":"Europe/Kaliningrad","120:120:120:120:120:120:60":"Africa/Tripoli","180:180:180:240":"Asia/Baghdad","120:180:120:180:180:120:120:180:180":"Asia/Istanbul","180:180:180:180":"Asia/Kuwait","120:180:120:180:180:180:180:180":"Europe/Minsk","180:240:180:240:240:240:240:180:180:180":"Europe/Moscow",210:"Asia/Tehran","240:240:240:240":"Asia/Muscat","180:240:180:240:240:240:240:180:180:240":"Europe/Astrakhan","240:300:240:300:300:240:240:300":"Asia/Baku","240:240:240:300:300":"Europe/Samara","300:240":"Indian/Mauritius","240:240:240:300:240":"Asia/Tbilisi","240:300:240:300:300:240:240:240":"Asia/Yerevan",270:"Asia/Kabul","300:300":"Asia/Tashkent","300:360":"Asia/Yekaterinburg","360:300":"Asia/Karachi","330:330:330":"Asia/Kolkata","330:330:360":"Asia/Colombo",345:"Asia/Katmandu","360:360:360:420":"Asia/Almaty","360:360:360:360":"Asia/Dhaka",390:"Asia/Rangoon","360:420:360:420:420:420:420:360:360:360":"Asia/Novosibirsk","420:420:420:420":"Asia/Bangkok","360:420:360:420:420:420:420:360:360:420":"Asia/Barnaul","420:420:420:480":"Asia/Hovd","420:480":"Asia/Krasnoyarsk","360:420:420":"Asia/Tomsk","480:480:480:480":"Asia/Chongqing","480:540":"Asia/Irkutsk","540:480":"Australia/Perth","480:480:480:540":"Asia/Ulaanbaatar","540:540:540:540:540:540:540:510":"Asia/Pyongyang",585:"Australia/Eucla","540:600:540:600:600:600:600:480":"Asia/Chita","540:540:540:540:540:540:540:540":"Asia/Tokyo","540:600:540:600:600:600:600:540":"Asia/Yakutsk",630:"Australia/Adelaide",570:"Australia/Darwin","600:600:600:600:600:600:600:600":"Australia/Brisbane","660:600:660:600:600":"Australia/Canberra","660:600:660:600:660":"Australia/Hobart","600:660:600:660:660:660:660:600:600:600":"Asia/Vladivostok","660:630":"Australia/Lord_Howe","600:600:600:600:600:600:600:660":"Pacific/Bougainville","660:720:660:720:720:720:720:660":"Asia/Srednekolymsk","660:720:660:720:720:720:720:600":"Asia/Magadan",690:"Pacific/Norfolk","600:660:600:660:660:660:660:600:600:660":"Asia/Sakhalin","660:660":"Pacific/Guadalcanal","720:720:720:780":"Asia/Anadyr","780:720":"Pacific/Auckland","720:720:720:720":"Pacific/Fiji",825:"Pacific/Chatham","780:780":"Pacific/Tongatapu","-660:-660:-660:-660:-660:-600":"Pacific/Apia",840:"Pacific/Kiritimati"};var a=[["(UTC-11:00) Midway Island, American Samoa","Pacific/Midway"],["(UTC-10:00) Aleutian Islands","America/Adak"],["(UTC-10:00) Hawaii","Pacific/Honolulu"],["(UTC-09:30) Marquesas Islands","Pacific/Marquesas"],["(UTC-09:00) Alaska","America/Anchorage"],["(UTC-08:00) Baja California","America/Tijuana"],["(UTC-08:00) Pacific Time (US and Canada)","America/Los_Angeles"],["(UTC-07:00) Arizona","America/Phoenix"],["(UTC-07:00) Chihuahua, La Paz, Mazatlan","America/Chihuahua"],["(UTC-07:00) Mountain Time (US and Canada)","America/Denver"],["(UTC-06:00) Central America","America/Belize"],["(UTC-06:00) Central Time (US and Canada)\t","America/Chicago"],["(UTC-06:00) Easter Island","Pacific/Easter"],["(UTC-06:00) Guadalajara, Mexico City, Monterrey","America/Mexico_City"],["(UTC-06:00) Saskatchewan","America/Regina"],["(UTC-05:00) Bogota, Lima, Quito","America/Bogota"],["(UTC-05:00) Chetumal","America/Cancun"],["(UTC-05:00) Eastern Time (US and Canada)","America/New_York"],["(UTC-05:00) Haiti","America/Port-au-Prince"],["(UTC-05:00) Havana","America/Havana"],["(UTC-05:00) Indiana (East)","America/Indiana/Indianapolis"],["(UTC-04:00) Asuncion","America/Asuncion"],["(UTC-04:00) Atlantic Time (Canada)","America/Halifax"],["(UTC-04:00) Caracas","America/Caracas"],["(UTC-04:00) Cuiaba","America/Cuiaba"],["(UTC-04:00) Georgetown, La Paz, Manaus, San Juan","America/Manaus"],["(UTC-04:00) Santiago","America/Santiago"],["(UTC-04:00) Turks and Caicos","America/Grand_Turk"],["(UTC-03:30) Newfoundland","America/St_Johns"],["(UTC-03:00) Araguaina","America/Fortaleza"],["(UTC-03:00) Brasilia","America/Sao_Paulo"],["(UTC-03:00) Cayenne, Fortaleza","America/Cayenne"],["(UTC-03:00) City of Buenos Aires","America/Buenos_Aires"],["(UTC-03:00) Greenland","America/Godthab"],["(UTC-03:00) Montevideo","America/Montevideo"],["(UTC-03:00) Saint Pierre and Miquelon","America/Miquelon"],["(UTC-03:00) Salvador","America/Bahia"],["(UTC-02:00) Fernando de Noronha","America/Noronha"],["(UTC-01:00) Azores","Atlantic/Azores"],["(UTC-01:00) Cabo Verde Islands","Atlantic/Cape_Verde"],["(UTC) Casablanca","Africa/Casablanca"],["(UTC) Dublin, Edinburgh, Lisbon, London","Europe/London"],["(UTC) Monrovia, Reykjavik","Africa/Monrovia"],["(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna","Europe/Amsterdam"],["(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague","Europe/Belgrade"],["(UTC+01:00) Brussels, Copenhagen, Madrid, Paris","Europe/Brussels"],["(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb","Europe/Warsaw"],["(UTC+01:00) West Central Africa","Africa/Algiers"],["(UTC+01:00) Windhoek","Africa/Windhoek"],["(UTC+02:00) Amman","Asia/Amman"],["(UTC+02:00) Athens, Bucharest","Europe/Athens"],["(UTC+02:00) Beirut","Asia/Beirut"],["(UTC+02:00) Cairo","Africa/Cairo"],["(UTC+02:00) Damascus","Asia/Damascus"],["(UTC+02:00) Gaza, Hebron","Asia/Gaza"],["(UTC+02:00) Harare, Pretoria","Africa/Harare"],["(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius","Europe/Helsinki"],["(UTC+02:00) Jerusalem","Asia/Jerusalem"],["(UTC+02:00) Kaliningrad","Europe/Kaliningrad"],["(UTC+02:00) Tripoli","Africa/Tripoli"],["(UTC+03:00) Baghdad","Asia/Baghdad"],["(UTC+03:00) Istanbul","Asia/Istanbul"],["(UTC+03:00) Kuwait, Riyadh","Asia/Kuwait"],["(UTC+03:00) Minsk","Europe/Minsk"],["(UTC+03:00) Moscow, St. Petersburg, Volgograd","Europe/Moscow"],["(UTC+03:00) Nairobi","Africa/Nairobi"],["(UTC+03:30) Tehran","Asia/Tehran"],["(UTC+04:00) Abu Dhabi, Muscat","Asia/Muscat"],["(UTC+04:00) Astrakhan, Ulyanovsk","Europe/Astrakhan"],["(UTC+04:00) Baku","Asia/Baku"],["(UTC+04:00) Izhevsk, Samara","Europe/Samara"],["(UTC+04:00) Port Louis","Indian/Mauritius"],["(UTC+04:00) Tbilisi","Asia/Tbilisi"],["(UTC+04:00) Yerevan","Asia/Yerevan"],["(UTC+04:30) Kabul","Asia/Kabul"],["(UTC+05:00) Tashkent, Ashgabat","Asia/Tashkent"],["(UTC+05:00) Ekaterinburg","Asia/Yekaterinburg"],["(UTC+05:00) Islamabad, Karachi","Asia/Karachi"],["(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi","Asia/Kolkata"],["(UTC+05:30) Sri Jayawardenepura","Asia/Colombo"],["(UTC+05:45) Kathmandu","Asia/Katmandu"],["(UTC+06:00) Astana","Asia/Almaty"],["(UTC+06:00) Dhaka","Asia/Dhaka"],["(UTC+06:30) Yangon (Rangoon)","Asia/Rangoon"],["(UTC+07:00) Novosibirsk","Asia/Novosibirsk"],["(UTC+07:00) Bangkok, Hanoi, Jakarta","Asia/Bangkok"],["(UTC+07:00) Barnaul, Gorno-Altaysk","Asia/Barnaul"],["(UTC+07:00) Hovd","Asia/Hovd"],["(UTC+07:00) Krasnoyarsk","Asia/Krasnoyarsk"],["(UTC+07:00) Tomsk","Asia/Tomsk"],["(UTC+08:00) Beijing, Chongqing, Hong Kong SAR, Urumqi","Asia/Chongqing"],["(UTC+08:00) Irkutsk","Asia/Irkutsk"],["(UTC+08:00) Kuala Lumpur, Singapore","Asia/Kuala_Lumpur"],["(UTC+08:00) Perth","Australia/Perth"],["(UTC+08:00) Taipei","Asia/Taipei"],["(UTC+08:00) Ulaanbaatar","Asia/Ulaanbaatar"],["(UTC+08:30) Pyongyang","Asia/Pyongyang"],["(UTC+08:45) Eucla","Australia/Eucla"],["(UTC+09:00) Chita","Asia/Chita"],["(UTC+09:00) Osaka, Sapporo, Tokyo","Asia/Tokyo"],["(UTC+09:00) Seoul","Asia/Seoul"],["(UTC+09:00) Yakutsk","Asia/Yakutsk"],["(UTC+09:30) Adelaide","Australia/Adelaide"],["(UTC+09:30) Darwin","Australia/Darwin"],["(UTC+10:00) Brisbane","Australia/Brisbane"],["(UTC+10:00) Canberra, Melbourne, Sydney","Australia/Canberra"],["(UTC+10:00) Guam, Port Moresby","Pacific/Guam"],["(UTC+10:00) Hobart","Australia/Hobart"],["(UTC+10:00) Vladivostok","Asia/Vladivostok"],["(UTC+10:30) Lord Howe Island","Australia/Lord_Howe"],["(UTC+11:00) Bougainville Island","Pacific/Bougainville"],["(UTC+11:00) Chokirdakh","Asia/Srednekolymsk"],["(UTC+11:00) Magadan","Asia/Magadan"],["(UTC+11:00) Norfolk Island","Pacific/Norfolk"],["(UTC+11:00) Sakhalin","Asia/Sakhalin"],["(UTC+11:00) Solomon Islands, New Caledonia","Pacific/Guadalcanal"],["(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky","Asia/Anadyr"],["(UTC+12:00) Auckland, Wellington","Pacific/Auckland"],["(UTC+12:00) Fiji Islands","Pacific/Fiji"],["(UTC+12:45) Chatham Islands","Pacific/Chatham"],["(UTC+13:00) Nuku'alofa","Pacific/Tongatapu"],["(UTC+13:00) Samoa","Pacific/Apia"],["(UTC+14:00) Kiritimati Island","Pacific/Kiritimati"]];var r=[["(UTC-11:00) Îles Midway, Samoa américaines, île Jarvis, récif Kingman et atoll Palmyra","Pacific/Midway"],["(UTC-10:00) Îles Aléoutiennes","America/Adak"],["(UTC-10:00) Hawaii","Pacific/Honolulu"],["(UTC-09:30) Îles Marquises","Pacific/Marquesas"],["(UTC-09:00) Alaska","America/Anchorage"],["(UTC-08:00) Basse Californie","America/Tijuana"],["(UTC-08:00) Pacifique (É.-U. et Canada)","America/Los_Angeles"],["(UTC-07:00) Arizona","America/Phoenix"],["(UTC-07:00) Chihuahua, La Paz, Mazatlan","America/Chihuahua"],["(UTC-07:00) Montagnes Rocheuses (É.-U. et Canada)","America/Denver"],["(UTC-06:00) Amérique centrale","America/Belize"],["(UTC-06:00) Centre (É.-U. et Canada)","America/Chicago"],["(UTC-06:00) Île de Pâques","Pacific/Easter"],["(UTC-06:00) Guadalajara, Mexico, Monterrey","America/Mexico_City"],["(UTC-06:00) Saskatchewan","America/Regina"],["(UTC-05:00) Bogota, Lima, Quito, Rio Branco","America/Bogota"],["(UTC-05:00) Chetumal","America/Cancun"],["(UTC-05:00) Est (É.-U. et Canada)","America/New_York"],["(UTC-05:00) Haïti","America/Port-au-Prince"],["(UTC-05:00) Havane (La)","America/Havana"],["(UTC-05:00) Indiana (Est)","America/Indiana/Indianapolis"],["(UTC-04:00) Asunción","America/Asuncion"],["(UTC-04:00) Heure Atlantique (Canada)","America/Halifax"],["(UTC-04:00) Caracas","America/Caracas"],["(UTC-04:00) Cuiaba","America/Cuiaba"],["(UTC-04:00) Georgetown, La Paz, Manaus, San Juan","America/Manaus"],["(UTC-04:00) Santiago","America/Santiago"],["(UTC-04:00) Îles Turques-et-Caïques","America/Grand_Turk"],["(UTC-03:30) Terre-Neuve-et-Labrador","America/St_Johns"],["(UTC-03:00) Araguaína","America/Fortaleza"],["(UTC-03:00) Brasilia","America/Sao_Paulo"],["(UTC-03:00) Cayenne, Fortaleza","America/Cayenne"],["(UTC-03:00) Buenos Aires","America/Buenos_Aires"],["(UTC-03:00) Groenland","America/Godthab"],["(UTC-03:00) Montevideo","America/Montevideo"],["(UTC-03:00) Saint-Pierre-et-Miquelon","America/Miquelon"],["(UTC-03:00) Salvador","America/Bahia"],["(UTC-02:00) Fernando de Noronha","America/Noronha"],["(UTC-01:00) Les Açores","Atlantic/Azores"],["(UTC-01:00) Îles du Cap-Vert","Atlantic/Cape_Verde"],["(UTC) Casablanca","Africa/Casablanca"],["(UTC) Dublin, Édimbourg, Lisbonne, Londres","Europe/London"],["(UTC) Monrovia, Reykjavik","Africa/Monrovia"],["(UTC+01:00) Amsterdam, Berlin, Berne, Rome, Stockholm, Vienne","Europe/Amsterdam"],["(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague","Europe/Belgrade"],["(UTC+01:00) Bruxelles, Copenhague, Madrid, Paris","Europe/Brussels"],["(UTC+01:00) Sarajevo, Skopje, Varsovie, Zagreb","Europe/Warsaw"],["(UTC+01:00) Afrique centrale - Ouest","Africa/Algiers"],["(UTC+01:00) Windhoek","Africa/Windhoek"],["(UTC+02:00) Amman","Asia/Amman"],["(UTC+02:00) Athènes, Bucarest","Europe/Athens"],["(UTC+02:00) Beyrouth","Asia/Beirut"],["(UTC+02:00) Le Caire","Africa/Cairo"],["(UTC+02:00) Damas","Asia/Damascus"],["(UTC+02:00) Gaza, Hébron","Asia/Gaza"],["(UTC+02:00) Harare, Pretoria","Africa/Harare"],["(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius","Europe/Helsinki"],["(UTC+02:00) Jérusalem","Asia/Jerusalem"],["(UTC+02:00) Kaliningrad","Europe/Kaliningrad"],["(UTC+02:00) Tripoli","Africa/Tripoli"],["(UTC+03:00) Bagdad","Asia/Baghdad"],["(UTC+03:00) Istanbul","Asia/Istanbul"],["(UTC+03:00) Koweït, Riyad","Asia/Kuwait"],["(UTC+03:00) Minsk","Europe/Minsk"],["(UTC+03:00) Moscou, Saint-Pétersbourg, Volgograd","Europe/Moscow"],["(UTC+03:00) Nairobi","Africa/Nairobi"],["(UTC+03:30) Téhéran","Asia/Tehran"],["(UTC+04:00) Abu Dhabi, Muscat","Asia/Muscat"],["(UTC+04:00) Astrakhan, Oulianovsk","Europe/Astrakhan"],["(UTC+04:00) Bakou","Asia/Baku"],["(UTC+04:00) Izhevsk, Samara","Europe/Samara"],["(UTC+04:00) Port Louis","Indian/Mauritius"],["(UTC+04:00) Tbilissi","Asia/Tbilisi"],["(UTC+04:00) Erevan","Asia/Yerevan"],["(UTC+04:30) Kaboul","Asia/Kabul"],["(UTC+05:00) Achgabat, Tachkent","Asia/Tashkent"],["(UTC+05:00) Iekaterinbourg","Asia/Yekaterinburg"],["(UTC+05:00) Islamabad, Karachi","Asia/Karachi"],["(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi","Asia/Kolkata"],["(UTC+05:30) Sri Jayawardenepura","Asia/Colombo"],["(UTC+05:45) Katmandou","Asia/Katmandu"],["(UTC+06:00) Astana","Asia/Almaty"],["(UTC+06:00) Dhaka","Asia/Dhaka"],["(UTC+06:30) Rangoon","Asia/Rangoon"],["(UTC+07:00) Novosibirsk","Asia/Novosibirsk"],["(UTC+07:00) Bangkok, Hanoi, Djakarta","Asia/Bangkok"],["(UTC+07:00) Barnaoul, Gorno-Altaïsk","Asia/Barnaul"],["(UTC+07:00) Hovd","Asia/Hovd"],["(UTC+07:00) Krasnoïarsk","Asia/Krasnoyarsk"],["(UTC+07:00) Tomsk","Asia/Tomsk"],["(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi","Asia/Chongqing"],["(UTC+08:00) Irkoutsk","Asia/Irkutsk"],["(UTC+08:00) Kuala Lumpur, Singapour","Asia/Kuala_Lumpur"],["(UTC+08:00) Perth","Australia/Perth"],["(UTC+08:00) Taipei","Asia/Taipei"],["(UTC+08:00) Oulan-Bator","Asia/Ulaanbaatar"],["(UTC+08:30) Pyongyang","Asia/Pyongyang"],["(UTC+08:45) Eucla","Australia/Eucla"],["(UTC+09:00) Chita","Asia/Chita"],["(UTC+09:00) Osaka, Sapporo, Tokyo","Asia/Tokyo"],["(UTC+09:00) Séoul","Asia/Seoul"],["(UTC+09:00) Iakoutsk","Asia/Yakutsk"],["(UTC+09:30) Adélaïde","Australia/Adelaide"],["(UTC+09:30) Darwin","Australia/Darwin"],["(UTC+10:00) Brisbane","Australia/Brisbane"],["(UTC+10:00) Canberra, Melbourne, Sydney","Australia/Canberra"],["(UTC+10:00) Guam, Port Moresby","Pacific/Guam"],["(UTC+10:00) Hobart","Australia/Hobart"],["(UTC+10:00) Vladivostok","Asia/Vladivostok"],["(UTC+10:30) Île Lord Howe","Australia/Lord_Howe"],["(UTC+11:00) Île Bougainville","Pacific/Bougainville"],["(UTC+11:00) Chokurdakh","Asia/Srednekolymsk"],["(UTC+11:00) Magadan","Asia/Magadan"],["(UTC+11:00) Île Norfolk","Pacific/Norfolk"],["(UTC+11:00) Sakhaline","Asia/Sakhalin"],["(UTC+11:00) Îles Salomon, Nouvelle-Calédonie","Pacific/Guadalcanal"],["(UTC+12:00) Anadyr, Petropavlovsk-Kamtchatski","Asia/Anadyr"],["(UTC+12:00) Auckland, Wellington","Pacific/Auckland"],["(UTC+12:00) Fidji","Pacific/Fiji"],["(UTC+12:45) Îles Chatham","Pacific/Chatham"],["(UTC+13:00) Nuku’alofa","Pacific/Tongatapu"],["(UTC+13:00) Samoa","Pacific/Apia"],["(UTC+14:00) Kiritimati, Île","Pacific/Kiritimati"]];var s=[["(UTC-11:00) Islas Midway, Samoa Americana","Pacific/Midway"],["(UTC-10:00) Islas Aleutianas","America/Adak"],["(UTC-10:00) Hawai","Pacific/Honolulu"],["(UTC-09:30) Islas Marquesas","Pacific/Marquesas"],["(UTC-09:00) Alaska","America/Anchorage"],["(UTC-08:00) Baja California","America/Tijuana"],["(UTC-08:00) Hora del Pacífico (EE.UU. y Canadá)","America/Los_Angeles"],["(UTC-07:00) Arizona","America/Phoenix"],["(UTC-07:00) Chihuahua, La Paz, Mazatlán","America/Chihuahua"],["(UTC-07:00) Hora de las Montañas Rocosas (EE.UU. y Canadá)","America/Denver"],["(UTC-06:00) América Central","America/Belize"],["(UTC-06:00) Hora central (EE.UU. y Canadá)","America/Chicago"],["(UTC-06:00) Isla de Pascua","Pacific/Easter"],["(UTC-06:00) Guadalajara, Ciudad de México, Monterrey","America/Mexico_City"],["(UTC-06:00) Saskatchewan","America/Regina"],["(UTC-05:00) Bogotá, Lima, Quito, Rio Branco","America/Bogota"],["(UTC-05:00) Chetumal","America/Cancun"],["(UTC-05:00) Hora del este (EE.UU. y Canadá)","America/New_York"],["(UTC-05:00) Haití","America/Port-au-Prince"],["(UTC-05:00) La Habana","America/Havana"],["(UTC-05:00) Indiana (este)","America/Indiana/Indianapolis"],["(UTC-04:00) Asunción","America/Asuncion"],["(UTC-04:00) Hora del Atlántico (Canadá)","America/Halifax"],["(UTC-04:00) Caracas","America/Caracas"],["(UTC-04:00) Cuiabá","America/Cuiaba"],["(UTC-04:00) Georgetown, La Paz, Manaos, San Juan","America/Manaus"],["(UTC-04:00) Santiago","America/Santiago"],["(UTC-04:00) Islas Turcas y Caicos","America/Grand_Turk"],["(UTC-03:30) Terranova","America/St_Johns"],["(UTC-03:00) Araguaína","America/Fortaleza"],["(UTC-03:00) Brasilia","America/Sao_Paulo"],["(UTC-03:00) Cayena, Fortaleza","America/Cayenne"],["(UTC-03:00) Ciudad de Buenos Aires","America/Buenos_Aires"],["(UTC-03:00) Groenlandia","America/Godthab"],["(UTC-03:00) Montevideo","America/Montevideo"],["(UTC-03:00) San Pedro y Miquelón","America/Miquelon"],["(UTC-03:00) Salvador","America/Bahia"],["(UTC-02:00) Fernando de Noronha","America/Noronha"],["(UTC-01:00) Azores","Atlantic/Azores"],["(UTC-01:00) Cabo Verde","Atlantic/Cape_Verde"],["(UTC) Casablanca","Africa/Casablanca"],["(UTC) Dublín, Edimburgo, Lisboa, Londres","Europe/London"],["(UTC) Monrovia, Reikiavik","Africa/Monrovia"],["(UTC+01:00) Amsterdam, Berlín, Berna, Roma, Estocolmo, Viena","Europe/Amsterdam"],["(UTC+01:00) Belgrado, Bratislava, Budapest, Liubliana, Praga","Europe/Belgrade"],["(UTC+01:00) Bruselas, Copenhague, Madrid, París","Europe/Brussels"],["(UTC+01:00) Sarajevo, Skopie, Varsovia, Zagreb","Europe/Warsaw"],["(UTC+01:00) África Central Occidental","Africa/Algiers"],["(UTC+01:00) Windhoek","Africa/Windhoek"],["(UTC+02:00) Ammán","Asia/Amman"],["(UTC+02:00) Atenas, Bucarest","Europe/Athens"],["(UTC+02:00) Beirut","Asia/Beirut"],["(UTC+02:00) El Cairo","Africa/Cairo"],["(UTC+02:00) Damasco","Asia/Damascus"],["(UTC+02:00) Gaza, Hebrón","Asia/Gaza"],["(UTC+02:00) Harare, Pretoria","Africa/Harare"],["(UTC+02:00) Helsinki, Kiev, Riga, Sofía, Tallin, Vilna","Europe/Helsinki"],["(UTC+02:00) Jerusalén","Asia/Jerusalem"],["(UTC+02:00) Kaliningrado","Europe/Kaliningrad"],["(UTC+02:00) Trípoli","Africa/Tripoli"],["(UTC+03:00) Bagdad","Asia/Baghdad"],["(UTC+03:00) Estambul","Asia/Istanbul"],["(UTC+03:00) Kuwait, Riad","Asia/Kuwait"],["(UTC+03:00) Minsk","Europe/Minsk"],["(UTC+03:00) Moscú, San Petersburgo, Volgogrado","Europe/Moscow"],["(UTC+03:00) Nairobi","Africa/Nairobi"],["(UTC+03:30) Teherán","Asia/Tehran"],["(UTC+04:00) Abu Dabi, Mascate","Asia/Muscat"],["(UTC+04:00) Astrakhan, Ulyanovsk","Europe/Astrakhan"],["(UTC+04:00) Bakú","Asia/Baku"],["(UTC+04:00) Izhevsk, Samara","Europe/Samara"],["(UTC+04:00) Port Louis","Indian/Mauritius"],["(UTC+04:00) Tiflis","Asia/Tbilisi"],["(UTC+04:00) Ereván","Asia/Yerevan"],["(UTC+04:30) Kabul","Asia/Kabul"],["(UTC+05:00) Asjabad, Tashkent","Asia/Tashkent"],["(UTC+05:00) Ekaterimburgo","Asia/Yekaterinburg"],["(UTC+05:00) Islamabad, Karachi","Asia/Karachi"],["(UTC+05:30) Chennai, Kolkata (Calcuta), Mumbai, Nueva Delhi","Asia/Kolkata"],["(UTC+05:30) Sri Jayawardenepura","Asia/Colombo"],["(UTC+05:45) Katmandú","Asia/Katmandu"],["(UTC+06:00) Astaná","Asia/Almaty"],["(UTC+06:00) Dacca","Asia/Dhaka"],["(UTC+06:30) Rangún","Asia/Rangoon"],["(UTC+07:00) Novosibirsk","Asia/Novosibirsk"],["(UTC+07:00) Bangkok, Hanói, Yakarta","Asia/Bangkok"],["(UTC+07:00) Barnaul, Gorno-Altaysk","Asia/Barnaul"],["(UTC+07:00) Hovd","Asia/Hovd"],["(UTC+07:00) Krasnoyarsk","Asia/Krasnoyarsk"],["(UTC+07:00) Tomsk","Asia/Tomsk"],["(UTC+08:00) Pekín, Chongqing, Hong Kong, Urumqi","Asia/Chongqing"],["(UTC+08:00) Irkutsk","Asia/Irkutsk"],["(UTC+08:00) Kuala Lumpur, Singapur, Singapore","Asia/Kuala_Lumpur"],["(UTC+08:00) Perth","Australia/Perth"],["(UTC+08:00) Taipéi","Asia/Taipei"],["(UTC+08:00) Ulán Bator","Asia/Ulaanbaatar"],["(UTC+08:30) Pyongyang","Asia/Pyongyang"],["(UTC+08:45) Eucla","Australia/Eucla"],["(UTC+09:00) Chita","Asia/Chita"],["(UTC+09:00) Osaka, Sapporo, Tokio","Asia/Tokyo"],["(UTC+09:00) Seúl","Asia/Seoul"],["(UTC+09:00) Yakutsk","Asia/Yakutsk"],["(UTC+09:30) Adelaida","Australia/Adelaide"],["(UTC+09:30) Darwin","Australia/Darwin"],["(UTC+10:00) Brisbane","Australia/Brisbane"],["(UTC+10:00) Canberra, Melbourne, Sídney","Australia/Canberra"],["(UTC+10:00) Guam, Port Moresby","Pacific/Guam"],["(UTC+10:00) Hobart","Australia/Hobart"],["(UTC+10:00) Vladivostok","Asia/Vladivostok"],["(UTC+10:30) Isla Lord Howe","Australia/Lord_Howe"],["(UTC+11:00) Isla Bougainville","Pacific/Bougainville"],["(UTC+11:00) Chokurdakh","Asia/Srednekolymsk"],["(UTC+11:00) Magadán","Asia/Magadan"],["(UTC+11:00) Isla Norfolk","Pacific/Norfolk"],["(UTC+11:00) Sajalín","Asia/Sakhalin"],["(UTC+11:00) Islas Salomón, Nueva Caledonia","Pacific/Guadalcanal"],["(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky","Asia/Anadyr"],["(UTC+12:00) Auckland, Wellington","Pacific/Auckland"],["(UTC+12:00) Fiyi","Pacific/Fiji"],["(UTC+12:45) Islas Chatham","Pacific/Chatham"],["(UTC+13:00) Nuku'alofa","Pacific/Tongatapu"],["(UTC+13:00) Samoa","Pacific/Apia"],["(UTC+14:00) Isla Kiritimati","Pacific/Kiritimati"]];var o=[["(UTC-11:00) Midwayinseln, Amerikanisch-Samoa","Pacific/Midway"],["(UTC-10:00) Aleuten-Inseln","America/Adak"],["(UTC-10:00) Hawaii","Pacific/Honolulu"],["(UTC-09:30) Marquesas-Inseln","Pacific/Marquesas"],["(UTC-09:00) Alaska","America/Anchorage"],["(UTC-08:00) Niederkalifornien","America/Tijuana"],["(UTC-08:00) Pacific Zeit (USA & Kanada)","America/Los_Angeles"],["(UTC-07:00) Arizona","America/Phoenix"],["(UTC-07:00) Chihuahua, La Paz, Mazatlan","America/Chihuahua"],["(UTC-07:00) Mountain Zeit (USA & Kanada)","America/Denver"],["(UTC-06:00) Mittelamerika","America/Belize"],["(UTC-06:00) Central Zeit (USA & Kanada)","America/Chicago"],["(UTC-06:00) Osterinsel","Pacific/Easter"],["(UTC-06:00) Guadalajara, Mexiko-Stadt, Monterrey","America/Mexico_City"],["(UTC-06:00) Saskatchewan","America/Regina"],["(UTC-05:00) Bogotá, Lima, Quito, Rio Branco","America/Bogota"],["(UTC-05:00) Chetumal","America/Cancun"],["(UTC-05:00) Eastern Zeit (USA & Kanada)","America/New_York"],["(UTC-05:00) Haiti","America/Port-au-Prince"],["(UTC-05:00) Havanna","America/Havana"],["(UTC-05:00) Indiana (Ost)","America/Indiana/Indianapolis"],["(UTC-04:00) Asuncion","America/Asuncion"],["(UTC-04:00) Atlantic (Kanada)","America/Halifax"],["(UTC-04:00) Caracas","America/Caracas"],["(UTC-04:00) Cuiaba","America/Cuiaba"],["(UTC-04:00) Georgetown, La Paz, Manaus, San Juan","America/Manaus"],["(UTC-04:00) Santiago","America/Santiago"],["(UTC-04:00) Turks- und Caicosinseln","America/Grand_Turk"],["(UTC-03:30) Neufundland","America/St_Johns"],["(UTC-03:00) Araguaína","America/Fortaleza"],["(UTC-03:00) Brasilia","America/Sao_Paulo"],["(UTC-03:00) Cayenne, Fortaleza","America/Cayenne"],["(UTC-03:00) Buenos Aires","America/Buenos_Aires"],["(UTC-03:00) Grönland","America/Godthab"],["(UTC-03:00) Montevideo","America/Montevideo"],["(UTC-03:00) St. Pierre und Miquelon","America/Miquelon"],["(UTC-03:00) Salvador","America/Bahia"],["(UTC-02:00) Fernando de Noronha","America/Noronha"],["(UTC-01:00) Azoren","Atlantic/Azores"],["(UTC-01:00) Cabo Verde","Atlantic/Cape_Verde"],["(UTC) Casablanca","Africa/Casablanca"],["(UTC) Dublin, Edinburgh, Lissabon, London","Europe/London"],["(UTC) Monrovia, Reykjavik","Africa/Monrovia"],["(UTC+01:00) Amsterdam, Berlin, Bern, Rom, Stockholm, Wien","Europe/Amsterdam"],["(UTC+01:00) Belgrad, Bratislava (Pressburg), Budapest, Ljubljana, Prag","Europe/Belgrade"],["(UTC+01:00) Brüssel, Kopenhagen, Madrid, Paris","Europe/Brussels"],["(UTC+01:00) Sarajevo, Skopje, Warschau, Zagreb","Europe/Warsaw"],["(UTC+01:00) West-Zentralafrika","Africa/Algiers"],["(UTC+01:00) Windhuk","Africa/Windhoek"],["(UTC+02:00) Amman","Asia/Amman"],["(UTC+02:00) Athen, Bukarest","Europe/Athens"],["(UTC+02:00) Beirut","Asia/Beirut"],["(UTC+02:00) Kairo","Africa/Cairo"],["(UTC+02:00) Damaskus","Asia/Damascus"],["(UTC+02:00) Gaza, Hebron","Asia/Gaza"],["(UTC+02:00) Harare, Pretoria","Africa/Harare"],["(UTC+02:00) Helsinki, Kiew, Riga, Sofia, Tallinn, Wilna","Europe/Helsinki"],["(UTC+02:00) Jerusalem","Asia/Jerusalem"],["(UTC+02:00) Kaliningrad","Europe/Kaliningrad"],["(UTC+02:00) Tripolis","Africa/Tripoli"],["(UTC+03:00) Bagdad","Asia/Baghdad"],["(UTC+03:00) Istanbul","Asia/Istanbul"],["(UTC+03:00) Kuwait, Riad","Asia/Kuwait"],["(UTC+03:00) Minsk","Europe/Minsk"],["(UTC+03:00) Moskau (Moskwa), St. Petersburg, Wolgograd","Europe/Moscow"],["(UTC+03:00) Nairobi","Africa/Nairobi"],["(UTC+03:30) Teheran","Asia/Tehran"],["(UTC+04:00) Abu Dhabi, Muskat","Asia/Muscat"],["(UTC+04:00) Astrachan, Uljanowsk","Europe/Astrakhan"],["(UTC+04:00) Baku","Asia/Baku"],["(UTC+04:00) Ischewsk, Samara","Europe/Samara"],["(UTC+04:00) Port Louis","Indian/Mauritius"],["(UTC+04:00) Tiflis","Asia/Tbilisi"],["(UTC+04:00) Eriwan","Asia/Yerevan"],["(UTC+04:30) Kabul","Asia/Kabul"],["(UTC+05:00) Aschgabat, Taschkent","Asia/Tashkent"],["(UTC+05:00) Jekaterinburg","Asia/Yekaterinburg"],["(UTC+05:00) Islamabad, Karatschi","Asia/Karachi"],["(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi","Asia/Kolkata"],["(UTC+05:30) Sri Jayawardenepura","Asia/Colombo"],["(UTC+05:45) Katmandu","Asia/Katmandu"],["(UTC+06:00) Astana","Asia/Almaty"],["(UTC+06:00) Dakka","Asia/Dhaka"],["(UTC+06:30) Yangon (Rangun)","Asia/Rangoon"],["(UTC+07:00) Nowosibirsk","Asia/Novosibirsk"],["(UTC+07:00) Bangkok, Hanoi, Jakarta","Asia/Bangkok"],["(UTC+07:00) Barnaul, Gorno-Altaisk","Asia/Barnaul"],["(UTC+07:00) Hovd","Asia/Hovd"],["(UTC+07:00) Krasnojarsk","Asia/Krasnoyarsk"],["(UTC+07:00) Tomsk","Asia/Tomsk"],["(UTC+08:00) Peking, Chongqing, Hongkong (SAR), Urumchi","Asia/Chongqing"],["(UTC+08:00) Irkutsk","Asia/Irkutsk"],["(UTC+08:00) Kuala Lumpur, Singapur","Asia/Kuala_Lumpur"],["(UTC+08:00) Perth","Australia/Perth"],["(UTC+08:00) Taipeh","Asia/Taipei"],["(UTC+08:00) Ulan-Bator","Asia/Ulaanbaatar"],["(UTC+08:30) Pjöngjang","Asia/Pyongyang"],["(UTC+08:45) Eucla","Australia/Eucla"],["(UTC+09:00) Chita","Asia/Chita"],["(UTC+09:00) Osaka, Sapporo, Tokio","Asia/Tokyo"],["(UTC+09:00) Seoul","Asia/Seoul"],["(UTC+09:00) Jakutsk","Asia/Yakutsk"],["(UTC+09:30) Adelaide","Australia/Adelaide"],["(UTC+09:30) Darwin","Australia/Darwin"],["(UTC+10:00) Brisbane","Australia/Brisbane"],["(UTC+10:00) Canberra, Melbourne, Sydney","Australia/Canberra"],["(UTC+10:00) Guam, Port Moresby","Pacific/Guam"],["(UTC+10:00) Hobart","Australia/Hobart"],["(UTC+10:00) Wladiwostok","Asia/Vladivostok"],["(UTC+10:30) Lord-Howe-Insel","Australia/Lord_Howe"],["(UTC+11:00) Bougainville-Insel","Pacific/Bougainville"],["(UTC+11:00) Tschokurdach","Asia/Srednekolymsk"],["(UTC+11:00) Magadan","Asia/Magadan"],["(UTC+11:00) Norfolkinsel","Pacific/Norfolk"],["(UTC+11:00) Sachalin","Asia/Sakhalin"],["(UTC+11:00) Salomonen, Neu-Kaledonien","Pacific/Guadalcanal"],["(UTC+12:00) Anadyr, Petropawlowsk-Kamtschatski","Asia/Anadyr"],["(UTC+12:00) Auckland, Wellington","Pacific/Auckland"],["(UTC+12:00) Fidschi","Pacific/Fiji"],["(UTC+12:45) Chatham-Inseln","Pacific/Chatham"],["(UTC+13:00) Nuku'alofa","Pacific/Tongatapu"],["(UTC+13:00) Samoa","Pacific/Apia"],["(UTC+14:00) Insel Kiritimati","Pacific/Kiritimati"]];var l=[["(UTC-11:00) ミッドウェー島・サモア島","Pacific/Midway"],["(UTC-10:00) アリューシャン諸島","America/Adak"],["(UTC-10:00) ハワイ","Pacific/Honolulu"],["(UTC-09:30) マルキーズ諸島","Pacific/Marquesas"],["(UTC-09:00) アラスカ","America/Anchorage"],["(UTC-08:00) バハカリフォルニア","America/Tijuana"],["(UTC-08:00) 太平洋標準時 (米国およびカナダ)","America/Los_Angeles"],["(UTC-07:00) アリゾナ","America/Phoenix"],["(UTC-07:00) チワワ、ラパス、マサトラン","America/Chihuahua"],["(UTC-07:00) 山岳標準時 (米国およびカナダ)","America/Denver"],["(UTC-06:00) 中央アメリカ","America/Belize"],["(UTC-06:00) 中部標準時 (米国およびカナダ)","America/Chicago"],["(UTC-06:00) イースター島","Pacific/Easter"],["(UTC-06:00) グアダラハラ、メキシコシティ、モンテレー","America/Mexico_City"],["(UTC-06:00) サスカチュワン","America/Regina"],["(UTC-05:00) ボゴタ、リマ、キト、リオ ブランコ","America/Bogota"],["(UTC-05:00) チェトゥマル","America/Cancun"],["(UTC-05:00) 東部標準時 (米国およびカナダ)","America/New_York"],["(UTC-05:00) ハイチ","America/Port-au-Prince"],["(UTC-05:00) ハバナ","America/Havana"],["(UTC-05:00) インディアナ東部","America/Indiana/Indianapolis"],["(UTC-04:00) アスンシオン","America/Asuncion"],["(UTC-04:00) 大西洋標準時 (カナダ)","America/Halifax"],["(UTC-04:00) カラカス","America/Caracas"],["(UTC-04:00) クイアバ","America/Cuiaba"],["(UTC-04:00) ジョージタウン、ラパス、マナウス、サンファン","America/Manaus"],["(UTC-04:00) サンティアゴ","America/Santiago"],["(UTC-04:00) タークス・カイコス諸島","America/Grand_Turk"],["(UTC-03:30) ニューファンドランド","America/St_Johns"],["(UTC-03:00) アラグァイナ","America/Fortaleza"],["(UTC-03:00) ブラジリア","America/Sao_Paulo"],["(UTC-03:00) カイエンヌ、フォルタレザ","America/Cayenne"],["(UTC-03:00) ブエノスアイレス","America/Buenos_Aires"],["(UTC-03:00) グリーンランド","America/Godthab"],["(UTC-03:00) モンテビデオ","America/Montevideo"],["(UTC-03:00) サンピエール・ミクロン","America/Miquelon"],["(UTC-03:00) サルバドル","America/Bahia"],["(UTC-02:00) フェルナンド・デ・ノローニャ島","America/Noronha"],["(UTC-01:00) アゾレス諸島","Atlantic/Azores"],["(UTC-01:00) カーボベルデ諸島","Atlantic/Cape_Verde"],["(UTC) カサブランカ","Africa/Casablanca"],["(UTC) ダブリン、エジンバラ、リスボン、ロンドン","Europe/London"],["(UTC) モロンビア、レイキャビク","Africa/Monrovia"],["(UTC+01:00) アムステルダム、ベルリン、ベルン、ローマ、ストックホルム、ウィーン","Europe/Amsterdam"],["(UTC+01:00) ベオグラード、ブラチスラバ、ブダペスト、リュブリャナ、プラハ","Europe/Belgrade"],["(UTC+01:00) ブリュッセル、コペンハーゲン、マドリード、パリ","Europe/Brussels"],["(UTC+01:00) サラエボ、スコピエ、ワルシャワ、ザグレブ","Europe/Warsaw"],["(UTC+01:00) 西中央アフリカ","Africa/Algiers"],["(UTC+01:00) ウィントフット","Africa/Windhoek"],["(UTC+02:00) アンマン","Asia/Amman"],["(UTC+02:00) アテネ、ブカレスト","Europe/Athens"],["(UTC+02:00) ベイルート","Asia/Beirut"],["(UTC+02:00) カイロ","Africa/Cairo"],["(UTC+02:00) ダマスカス","Asia/Damascus"],["(UTC+02:00) ガザ、ヘブロン","Asia/Gaza"],["(UTC+02:00) ハラーレ、プレトリア","Africa/Harare"],["(UTC+02:00) ヘルシンキ、キエフ、リガ、ソフィア、タリン、ビリニュス","Europe/Helsinki"],["(UTC+02:00) エルサレム","Asia/Jerusalem"],["(UTC+02:00) カリーニングラード","Europe/Kaliningrad"],["(UTC+02:00) トリポリ","Africa/Tripoli"],["(UTC+03:00) バグダッド","Asia/Baghdad"],["(UTC+03:00) イスタンブール","Asia/Istanbul"],["(UTC+03:00) クウェート、リヤド","Asia/Kuwait"],["(UTC+03:00) ミンスク","Europe/Minsk"],["(UTC+03:00) モスクワ、サンクトペテルブルク、ボルゴグラード","Europe/Moscow"],["(UTC+03:00) ナイロビ","Africa/Nairobi"],["(UTC+03:30) テヘラン","Asia/Tehran"],["(UTC+04:00) アブダビ、マスカット","Asia/Muscat"],["(UTC+04:00) アストラハン、ウリヤノフスク","Europe/Astrakhan"],["(UTC+04:00) バク","Asia/Baku"],["(UTC+04:00) イジェフスク、サマーラ","Europe/Samara"],["(UTC+04:00) ポートルイス","Indian/Mauritius"],["(UTC+04:00) トビリシ","Asia/Tbilisi"],["(UTC+04:00) エレバン","Asia/Yerevan"],["(UTC+04:30) カブール","Asia/Kabul"],["(UTC+05:00) アシハバード、タシケント","Asia/Tashkent"],["(UTC+05:00) エカテリンブルク","Asia/Yekaterinburg"],["(UTC+05:00) イスラマバード、カラチ","Asia/Karachi"],["(UTC+05:30) チェンマイ、コルカタ、ムンバイ、ニューデリー","Asia/Kolkata"],["(UTC+05:30) スリジャヤワルダナプラコッテ","Asia/Colombo"],["(UTC+05:45) カトマンズ","Asia/Katmandu"],["(UTC+06:00) アスタナ","Asia/Almaty"],["(UTC+06:00) ダッカ","Asia/Dhaka"],["(UTC+06:30) ヤンゴン (ラングーン)","Asia/Rangoon"],["(UTC+07:00) ノボシビルスク","Asia/Novosibirsk"],["(UTC+07:00) バンコク、ハノイ、ジャカルタ","Asia/Bangkok"],["(UTC+07:00) バウナウル、ゴルノ・アルタイスク","Asia/Barnaul"],["(UTC+07:00) ホブド","Asia/Hovd"],["(UTC+07:00) クラスノヤルスク","Asia/Krasnoyarsk"],["(UTC+07:00) トムスク","Asia/Tomsk"],["(UTC+08:00) 北京、重慶、香港特別行政区、ウルムチ","Asia/Chongqing"],["(UTC+08:00) イルクーツク","Asia/Irkutsk"],["(UTC+08:00) クアラルンプール、シンガポール","Asia/Kuala_Lumpur"],["(UTC+08:00) パース","Australia/Perth"],["(UTC+08:00) 台北","Asia/Taipei"],["(UTC+08:00) ウランバートル","Asia/Ulaanbaatar"],["(UTC+08:30) 平壌","Asia/Pyongyang"],["(UTC+08:45) ユークラ","Australia/Eucla"],["(UTC+09:00) チタ","Asia/Chita"],["(UTC+09:00) 大阪、札幌、東京","Asia/Tokyo"],["(UTC+09:00) ソウル","Asia/Seoul"],["(UTC+09:00) ヤツーツク","Asia/Yakutsk"],["(UTC+09:30) アデレード","Australia/Adelaide"],["(UTC+09:30) ダーウィン","Australia/Darwin"],["(UTC+10:00) ブリズベン","Australia/Brisbane"],["(UTC+10:00) キャンベラ、メルボルン、シドニー","Australia/Canberra"],["(UTC+10:00) グアム、ポートモレスビー","Pacific/Guam"],["(UTC+10:00) ホバート","Australia/Hobart"],["(UTC+10:00) ウラジオストク","Asia/Vladivostok"],["(UTC+10:30) ロードハウ島","Australia/Lord_Howe"],["(UTC+11:00) ブーゲンビル島","Pacific/Bougainville"],["(UTC+11:00) チョクルダフ","Asia/Srednekolymsk"],["(UTC+11:00) マガダン","Asia/Magadan"],["(UTC+11:00) ノーフォーク島","Pacific/Norfolk"],["(UTC+11:00) サハリン","Asia/Sakhalin"],["(UTC+11:00) ソロモン諸島、ニューカレドニア","Pacific/Guadalcanal"],["(UTC+12:00) アナディリ、ペトロパブロスク・カムチャツキー","Asia/Anadyr"],["(UTC+12:00) オークランド、ウェリントン","Pacific/Auckland"],["(UTC+12:00) フィジー","Pacific/Fiji"],["(UTC+12:45) チャタム諸島","Pacific/Chatham"],["(UTC+13:00) ヌクアロファ","Pacific/Tongatapu"],["(UTC+13:00) サモア","Pacific/Apia"],["(UTC+14:00) クリスマス島","Pacific/Kiritimati"]];var d={"America/Guatemala":"America/Belize","America/Indianapolis":"America/Indiana/Indianapolis","America/La_Paz":"America/Manaus",UTC:"Africa/Monrovia","Atlantic/Reykjavik":"Africa/Monrovia","Europe/Berlin":"Europe/Amsterdam","Europe/Budapest":"Europe/Belgrade","Europe/Paris":"Europe/Brussels","Africa/Lagos":"Africa/Algiers","Europe/Bucharest":"Europe/Athens","Africa/Johannesburg":"Africa/Harare","Europe/Kiev":"Europe/Helsinki","Europe/Istanbul":"Asia/Istanbul","Asia/Riyadh":"Asia/Kuwait","Asia/Dubai":"Asia/Muscat","Asia/Calcutta":"Asia/Kolkata","Asia/Shanghai":"Asia/Chongqing","Asia/Singapore":"Asia/Kuala_Lumpur","Australia/Sydney":"Australia/Canberra","Pacific/Port_Moresby":"Pacific/Guam","Asia/Kamchatka":"Asia/Anadyr"};var c={"Africa/Abidjan":"Africa/Monrovia","Africa/Accra":"Africa/Monrovia","Africa/Addis_Ababa":"Europe/Moscow","Africa/Asmara":"Europe/Moscow","Africa/Asmera":"Europe/Moscow","Africa/Bamako":"Africa/Monrovia","Africa/Bangui":"Africa/Algiers","Africa/Banjul":"Africa/Monrovia","Africa/Bissau":"Africa/Monrovia","Africa/Blantyre":"Africa/Harare","Africa/Brazzaville":"Africa/Algiers","Africa/Bujumbura":"Africa/Harare","Africa/Ceuta":"Europe/Amsterdam","Africa/Conakry":"Africa/Monrovia","Africa/Dakar":"Africa/Monrovia","Africa/Dar_es_Salaam":"Europe/Moscow","Africa/Djibouti":"Europe/Moscow","Africa/Douala":"Africa/Algiers","Africa/El_Aaiun":"Africa/Casablanca","Africa/Freetown":"Africa/Monrovia","Africa/Gaborone":"Africa/Harare","Africa/Johannesburg":"Africa/Harare","Africa/Juba":"Europe/Moscow","Africa/Kampala":"Europe/Moscow","Africa/Khartoum":"Europe/Moscow","Africa/Kigali":"Africa/Harare","Africa/Kinshasa":"Africa/Algiers","Africa/Lagos":"Africa/Algiers","Africa/Libreville":"Africa/Algiers","Africa/Lome":"Africa/Monrovia","Africa/Luanda":"Africa/Algiers","Africa/Lubumbashi":"Africa/Harare","Africa/Lusaka":"Africa/Harare","Africa/Malabo":"Africa/Algiers","Africa/Maputo":"Africa/Harare","Africa/Maseru":"Africa/Harare","Africa/Mbabane":"Africa/Harare","Africa/Mogadishu":"Europe/Moscow","Africa/Ndjamena":"Africa/Algiers","Africa/Niamey":"Africa/Algiers","Africa/Nouakchott":"Africa/Monrovia","Africa/Ouagadougou":"Africa/Monrovia","Africa/Porto-Novo":"Africa/Algiers","Africa/Sao_Tome":"Africa/Monrovia","Africa/Timbuktu":"Africa/Monrovia","Africa/Tunis":"Africa/Algiers","America/Anguilla":"America/Manaus","America/Antigua":"America/Manaus","America/Araguaina":"America/Buenos_Aires","America/Argentina/Buenos_Aires":"America/Buenos_Aires","America/Argentina/Catamarca":"America/Buenos_Aires","America/Argentina/ComodRivadavia":"America/Buenos_Aires","America/Argentina/Cordoba":"America/Buenos_Aires","America/Argentina/Jujuy":"America/Buenos_Aires","America/Argentina/La_Rioja":"America/Buenos_Aires","America/Argentina/Mendoza":"America/Buenos_Aires","America/Argentina/Rio_Gallegos":"America/Buenos_Aires","America/Argentina/Salta":"America/Buenos_Aires","America/Argentina/San_Juan":"America/Buenos_Aires","America/Argentina/San_Luis":"America/Buenos_Aires","America/Argentina/Tucuman":"America/Buenos_Aires","America/Argentina/Ushuaia":"America/Buenos_Aires","America/Aruba":"America/Manaus","America/Atikokan":"America/Bogota","America/Atka":"America/Adak","America/Bahia_Banderas":"America/Mexico_City","America/Barbados":"America/Manaus","America/Belem":"America/Buenos_Aires","America/Blanc-Sablon":"America/Manaus","America/Boa_Vista":"America/Manaus","America/Boise":"America/Denver","America/Cambridge_Bay":"America/Denver","America/Campo_Grande":"America/Cuiaba","America/Catamarca":"America/Buenos_Aires","America/Cayman":"America/Bogota","America/Coral_Harbour":"America/Bogota","America/Cordoba":"America/Buenos_Aires","America/Costa_Rica":"America/Regina","America/Creston":"America/Phoenix","America/Curacao":"America/Manaus","America/Danmarkshavn":"Africa/Monrovia","America/Dawson":"America/Los_Angeles","America/Dawson_Creek":"America/Phoenix","America/Detroit":"America/New_York","America/Dominica":"America/Manaus","America/Edmonton":"America/Denver","America/Eirunepe":"America/Bogota","America/El_Salvador":"America/Regina","America/Ensenada":"America/Los_Angeles","America/Fort_Wayne":"America/New_York","America/Glace_Bay":"America/Halifax","America/Goose_Bay":"America/Halifax","America/Grenada":"America/Manaus","America/Guadeloupe":"America/Manaus","America/Guatemala":"America/Regina","America/Guayaquil":"America/Bogota","America/Guyana":"America/Manaus","America/Hermosillo":"America/Phoenix","America/Indiana/Knox":"America/Chicago","America/Indiana/Marengo":"America/New_York","America/Indiana/Petersburg":"America/New_York","America/Indiana/Tell_City":"America/Chicago","America/Indiana/Vevay":"America/New_York","America/Indiana/Vincennes":"America/New_York","America/Indiana/Winamac":"America/New_York","America/Indianapolis":"America/New_York","America/Inuvik":"America/Denver","America/Iqaluit":"America/New_York","America/Jamaica":"America/Bogota","America/Jujuy":"America/Buenos_Aires","America/Juneau":"America/Anchorage","America/Kentucky/Louisville":"America/New_York","America/Kentucky/Monticello":"America/New_York","America/Knox_IN":"America/Chicago","America/Kralendijk":"America/Manaus","America/La_Paz":"America/Manaus","America/Lima":"America/Bogota","America/Louisville":"America/New_York","America/Lower_Princes":"America/Manaus","America/Maceio":"America/Buenos_Aires","America/Managua":"America/Regina","America/Marigot":"America/Manaus","America/Martinique":"America/Manaus","America/Matamoros":"America/Chicago","America/Mazatlan":"America/Chihuahua","America/Mendoza":"America/Buenos_Aires","America/Menominee":"America/Chicago","America/Merida":"America/Mexico_City","America/Moncton":"America/Halifax","America/Monterrey":"America/Mexico_City","America/Montreal":"America/New_York","America/Montserrat":"America/Manaus","America/Nassau":"America/New_York","America/Nipigon":"America/New_York","America/Nome":"America/Anchorage","America/North_Dakota/Beulah":"America/Chicago","America/North_Dakota/Center":"America/Chicago","America/North_Dakota/New_Salem":"America/Chicago","America/Ojinaga":"America/Denver","America/Panama":"America/Bogota","America/Pangnirtung":"America/New_York","America/Paramaribo":"America/Buenos_Aires","America/Port_of_Spain":"America/Manaus","America/Porto_Acre":"America/Bogota","America/Porto_Velho":"America/Manaus","America/Puerto_Rico":"America/Manaus","America/Rainy_River":"America/Chicago","America/Rankin_Inlet":"America/Chicago","America/Recife":"America/Buenos_Aires","America/Resolute":"America/Chicago","America/Rio_Branco":"America/Bogota","America/Rosario":"America/Buenos_Aires","America/Santa_Isabel":"America/Los_Angeles","America/Santarem":"America/Buenos_Aires","America/Santo_Domingo":"America/Manaus","America/Scoresbysund":"Atlantic/Azores","America/Shiprock":"America/Denver","America/Sitka":"America/Anchorage","America/St_Barthelemy":"America/Manaus","America/St_Kitts":"America/Manaus","America/St_Lucia":"America/Manaus","America/St_Thomas":"America/Manaus","America/St_Vincent":"America/Manaus","America/Swift_Current":"America/Regina","America/Tegucigalpa":"America/Regina","America/Thule":"America/Halifax","America/Thunder_Bay":"America/New_York","America/Toronto":"America/New_York","America/Tortola":"America/Manaus","America/Vancouver":"America/Los_Angeles","America/Virgin":"America/Manaus","America/Whitehorse":"America/Los_Angeles","America/Winnipeg":"America/Chicago","America/Yakutat":"America/Anchorage","America/Yellowknife":"America/Denver","Antarctica/Casey":"Asia/Chongqing","Antarctica/Davis":"Asia/Bangkok","Antarctica/DumontDUrville":"Australia/Brisbane","Antarctica/Macquarie":"Pacific/Bougainville","Antarctica/Mawson":"Asia/Tashkent","Antarctica/McMurdo":"Pacific/Auckland","Antarctica/Palmer":"America/Santiago","Antarctica/Rothera":"America/Buenos_Aires","Antarctica/South_Pole":"Pacific/Auckland","Antarctica/Syowa":"Europe/Moscow","Antarctica/Vostok":"Asia/Dhaka","Arctic/Longyearbyen":"Europe/Amsterdam","Asia/Aden":"Europe/Moscow","Asia/Aqtau":"Asia/Tashkent","Asia/Aqtobe":"Asia/Tashkent","Asia/Ashgabat":"Asia/Tashkent","Asia/Ashkhabad":"Asia/Tashkent","Asia/Bahrain":"Europe/Moscow","Asia/Bishkek":"Asia/Dhaka","Asia/Brunei":"Asia/Chongqing","Asia/Calcutta":"Asia/Kolkata","Asia/Choibalsan":"Asia/Ulaanbaatar","Asia/Chungking":"Asia/Chongqing","Asia/Dacca":"Asia/Dhaka","Asia/Dili":"Asia/Tokyo","Asia/Dubai":"Asia/Muscat","Asia/Dushanbe":"Asia/Tashkent","Asia/Harbin":"Asia/Chongqing","Asia/Hebron":"Asia/Gaza","Asia/Ho_Chi_Minh":"Asia/Bangkok","Asia/Hong_Kong":"Asia/Chongqing","Asia/Jakarta":"Asia/Bangkok","Asia/Jayapura":"Asia/Tokyo","Asia/Kamchatka":"Asia/Anadyr","Asia/Kashgar":"Asia/Dhaka","Asia/Kathmandu":"Asia/Katmandu","Asia/Khandyga":"Asia/Tokyo","Asia/Kuching":"Asia/Chongqing","Asia/Macao":"Asia/Chongqing","Asia/Macau":"Asia/Chongqing","Asia/Makassar":"Asia/Chongqing","Asia/Manila":"Asia/Chongqing","Asia/Nicosia":"Europe/Athens","Asia/Novokuznetsk":"Asia/Bangkok","Asia/Omsk":"Asia/Dhaka","Asia/Oral":"Asia/Tashkent","Asia/Phnom_Penh":"Asia/Bangkok","Asia/Pontianak":"Asia/Bangkok","Asia/Qatar":"Europe/Moscow","Asia/Qyzylorda":"Asia/Dhaka","Asia/Riyadh":"Europe/Moscow","Asia/Saigon":"Asia/Bangkok","Asia/Samarkand":"Asia/Tashkent","Asia/Shanghai":"Asia/Chongqing","Asia/Singapore":"Asia/Chongqing","Asia/Tel_Aviv":"Asia/Jerusalem","Asia/Thimbu":"Asia/Dhaka","Asia/Thimphu":"Asia/Dhaka","Asia/Ujung_Pandang":"Asia/Chongqing","Asia/Ulan_Bator":"Asia/Ulaanbaatar","Asia/Urumqi":"Asia/Dhaka","Asia/Ust-Nera":"Australia/Brisbane","Asia/Vientiane":"Asia/Bangkok","Atlantic/Bermuda":"America/Halifax","Atlantic/Canary":"Europe/London","Atlantic/Faeroe":"Europe/London","Atlantic/Faroe":"Europe/London","Atlantic/Jan_Mayen":"Europe/Amsterdam","Atlantic/Madeira":"Europe/London","Atlantic/Reykjavik":"Africa/Monrovia","Atlantic/South_Georgia":"America/Noronha","Atlantic/St_Helena":"Africa/Monrovia","Atlantic/Stanley":"America/Buenos_Aires","Australia/ACT":"Australia/Canberra","Australia/Broken_Hill":"Australia/Adelaide","Australia/Currie":"Australia/Canberra","Australia/LHI":"Australia/Lord_Howe","Australia/Lindeman":"Australia/Brisbane","Australia/Melbourne":"Australia/Canberra","Australia/NSW":"Australia/Canberra","Australia/North":"Australia/Darwin","Australia/Queensland":"Australia/Brisbane","Australia/South":"Australia/Adelaide","Australia/Sydney":"Australia/Canberra","Australia/Tasmania":"Australia/Canberra","Australia/Victoria":"Australia/Canberra","Australia/West":"Asia/Chongqing","Australia/Yancowinna":"Australia/Adelaide","Brazil/Acre":"America/Bogota","Brazil/DeNoronha":"America/Noronha","Brazil/East":"America/Sao_Paulo","Brazil/West":"America/Manaus",CET:"Europe/Amsterdam",CST6CDT:"America/Chicago","Canada/Atlantic":"America/Halifax","Canada/Central":"America/Chicago","Canada/East-Saskatchewan":"America/Regina","Canada/Eastern":"America/New_York","Canada/Mountain":"America/Denver","Canada/Newfoundland":"America/St_Johns","Canada/Pacific":"America/Los_Angeles","Canada/Saskatchewan":"America/Regina","Canada/Yukon":"America/Los_Angeles","Chile/Continental":"America/Santiago","Chile/EasterIsland":"Pacific/Easter",Cuba:"America/Havana",EET:"Europe/Athens",EST:"America/New_York",EST5EDT:"America/New_York",Egypt:"Africa/Cairo",Eire:"Europe/London","Etc/GMT":"Africa/Monrovia","Etc/GMT+0":"Africa/Monrovia","Etc/GMT+1":"Atlantic/Cape_Verde","Etc/GMT+10":"Pacific/Honolulu","Etc/GMT+11":"Pacific/Midway","Etc/GMT+2":"America/Noronha","Etc/GMT+3":"America/Buenos_Aires","Etc/GMT+4":"America/Manaus","Etc/GMT+5":"America/Bogota","Etc/GMT+6":"America/Regina","Etc/GMT+7":"America/Phoenix","Etc/GMT-0":"Africa/Monrovia","Etc/GMT-1":"Africa/Algiers","Etc/GMT-10":"Australia/Brisbane","Etc/GMT-11":"Pacific/Bougainville","Etc/GMT-12":"Asia/Anadyr","Etc/GMT-13":"Pacific/Tongatapu","Etc/GMT-14":"Pacific/Kiritimati","Etc/GMT-2":"Africa/Harare","Etc/GMT-3":"Europe/Moscow","Etc/GMT-4":"Asia/Muscat","Etc/GMT-5":"Asia/Tashkent","Etc/GMT-6":"Asia/Dhaka","Etc/GMT-7":"Asia/Bangkok","Etc/GMT-8":"Asia/Chongqing","Etc/GMT-9":"Asia/Tokyo","Etc/GMT0":"Africa/Monrovia","Etc/Greenwich":"Africa/Monrovia","Etc/UCT":"Africa/Monrovia","Etc/UTC":"Africa/Monrovia","Etc/Universal":"Africa/Monrovia","Etc/Zulu":"Africa/Monrovia","Europe/Andorra":"Europe/Amsterdam","Europe/Belfast":"Europe/London","Europe/Berlin":"Europe/Amsterdam","Europe/Bratislava":"Europe/Amsterdam","Europe/Bucharest":"Europe/Athens","Europe/Budapest":"Europe/Amsterdam","Europe/Busingen":"Europe/Amsterdam","Europe/Copenhagen":"Europe/Amsterdam","Europe/Dublin":"Europe/London","Europe/Gibraltar":"Europe/Amsterdam","Europe/Guernsey":"Europe/London","Europe/Isle_of_Man":"Europe/London","Europe/Istanbul":"Asia/Istanbul","Europe/Jersey":"Europe/London","Europe/Kiev":"Europe/Athens","Europe/Kirov":"Europe/Moscow","Europe/Lisbon":"Europe/London","Europe/Ljubljana":"Europe/Amsterdam","Europe/Luxembourg":"Europe/Amsterdam","Europe/Madrid":"Europe/Amsterdam","Europe/Malta":"Europe/Amsterdam","Europe/Mariehamn":"Europe/Athens","Europe/Monaco":"Europe/Amsterdam","Europe/Nicosia":"Europe/Athens","Europe/Oslo":"Europe/Amsterdam","Europe/Paris":"Europe/Amsterdam","Europe/Podgorica":"Europe/Amsterdam","Europe/Prague":"Europe/Amsterdam","Europe/Riga":"Europe/Athens","Europe/Rome":"Europe/Amsterdam","Europe/San_Marino":"Europe/Amsterdam","Europe/Sarajevo":"Europe/Amsterdam","Europe/Simferopol":"Europe/Moscow","Europe/Skopje":"Europe/Amsterdam","Europe/Sofia":"Europe/Athens","Europe/Stockholm":"Europe/Amsterdam","Europe/Tallinn":"Europe/Athens","Europe/Tirane":"Europe/Amsterdam","Europe/Ulyanovsk":"Europe/Astrakhan","Europe/Uzhgorod":"Europe/Athens","Europe/Vaduz":"Europe/Amsterdam","Europe/Vatican":"Europe/Amsterdam","Europe/Vienna":"Europe/Amsterdam","Europe/Vilnius":"Europe/Athens","Europe/Volgograd":"Europe/Moscow","Europe/Zagreb":"Europe/Amsterdam","Europe/Zaporozhye":"Europe/Athens","Europe/Zurich":"Europe/Amsterdam",Factory:"Africa/Monrovia",GB:"Europe/London","GB-Eire":"Europe/London",GMT:"Africa/Monrovia","GMT+0":"Africa/Monrovia","GMT-0":"Africa/Monrovia",GMT0:"Africa/Monrovia",Greenwich:"Africa/Monrovia",HST:"Pacific/Honolulu",Hongkong:"Asia/Chongqing",Iceland:"Africa/Monrovia","Indian/Antananarivo":"Europe/Moscow","Indian/Chagos":"Asia/Dhaka","Indian/Christmas":"Asia/Bangkok","Indian/Cocos":"Asia/Rangoon","Indian/Comoro":"Europe/Moscow","Indian/Kerguelen":"Asia/Tashkent","Indian/Mahe":"Asia/Muscat","Indian/Maldives":"Asia/Tashkent","Indian/Mayotte":"Europe/Moscow","Indian/Reunion":"Asia/Muscat",Iran:"Asia/Tehran",Israel:"Asia/Jerusalem",Jamaica:"America/Bogota",Japan:"Asia/Tokyo",Kwajalein:"Asia/Anadyr",Libya:"Africa/Harare",MET:"Europe/Amsterdam",MST:"America/Denver",MST7MDT:"America/Denver","Mexico/BajaNorte":"America/Los_Angeles","Mexico/BajaSur":"America/Chihuahua","Mexico/General":"America/Mexico_City",NZ:"Pacific/Auckland","NZ-CHAT":"Pacific/Chatham",Navajo:"America/Denver",PRC:"Asia/Chongqing",PST8PDT:"America/Los_Angeles","Pacific/Chuuk":"Australia/Brisbane","Pacific/Efate":"Pacific/Bougainville","Pacific/Enderbury":"Pacific/Tongatapu","Pacific/Fakaofo":"Pacific/Tongatapu","Pacific/Funafuti":"Asia/Anadyr","Pacific/Galapagos":"America/Regina","Pacific/Johnston":"Pacific/Honolulu","Pacific/Kosrae":"Pacific/Bougainville","Pacific/Kwajalein":"Asia/Anadyr","Pacific/Majuro":"Asia/Anadyr","Pacific/Nauru":"Asia/Anadyr","Pacific/Niue":"Pacific/Midway","Pacific/Noumea":"Pacific/Bougainville","Pacific/Pago_Pago":"Pacific/Midway","Pacific/Palau":"Asia/Tokyo","Pacific/Pohnpei":"Pacific/Bougainville","Pacific/Ponape":"Pacific/Bougainville","Pacific/Port_Moresby":"Australia/Brisbane","Pacific/Rarotonga":"Pacific/Honolulu","Pacific/Saipan":"Australia/Brisbane","Pacific/Samoa":"Pacific/Midway","Pacific/Tahiti":"Pacific/Honolulu","Pacific/Tarawa":"Asia/Anadyr","Pacific/Truk":"Australia/Brisbane","Pacific/Wake":"Asia/Anadyr","Pacific/Wallis":"Asia/Anadyr","Pacific/Yap":"Australia/Brisbane",Poland:"Europe/Amsterdam",Portugal:"Europe/London",ROC:"Asia/Chongqing",ROK:"Asia/Tokyo",Singapore:"Asia/Chongqing",Turkey:"Asia/Istanbul",UCT:"Africa/Monrovia","US/Alaska":"America/Anchorage","US/Aleutian":"America/Adak","US/Arizona":"America/Phoenix","US/Central":"America/Chicago","US/East-Indiana":"America/New_York","US/Eastern":"America/New_York","US/Hawaii":"Pacific/Honolulu","US/Indiana-Starke":"America/Chicago","US/Michigan":"America/New_York","US/Mountain":"America/Denver","US/Pacific":"America/Los_Angeles","US/Pacific-New":"America/Los_Angeles","US/Samoa":"Pacific/Midway",UTC:"Africa/Monrovia",Universal:"Africa/Monrovia","W-SU":"Europe/Moscow",WET:"Europe/Amsterdam",Zulu:"Africa/Monrovia"};var _={"America/Fort_Nelson":"America/Denver"};return e};if(true){if("undefined"!==typeof e&&e.exports)i=e.exports=a;i.TimezoneDetector=a}else if("function"===typeof define&&define.amd)define(function(){return a});else t.TimezoneDetector=a}).call(function(){return this||("undefined"!==typeof window?window:t)}())}).call(i,t(7))},3586:function(e,i){(function(){TS.registerModule("client.highlights",{updated_sig:new signals.Signal,feedback_submitted_sig:new signals.Signal,last_request_id:null,sli_recaps_debug_group:null,onStart:function e(){if(!TS.client||!TS.boot_data.feature_sli_recaps)return;if(TS.boot_data.feature_react_messages)return;TS.client.login_sig.addOnce(function(){t=_.get(TS.shared.getActiveModelOb(),"id")});TS.channels.switched_sig.add(o);TS.groups.switched_sig.add(u);TS.mpims.switched_sig.add(u);TS.ims.switched_sig.add(u);TS.client.threads.switched_sig.add(u);TS.client.unread.switched_sig.add(u);TS.channels.history_fetched_sig.add(h);TS.client.unread.marked_group_as_read_sig.add(l);TS.experiment.loadUserAssignments().then(a)},msgIsHighlight:function i(t,n){return!!(e[t]&&e[t][n]&&e[t][n].show_recap)},msgIsHighlightUnfurl:function i(t,n){return!!(e[t]&&e[t][n]&&e[t][n].is_unfurl)},msgIsLeavingFeedback:function i(t,n){return!!(e[t]&&e[t][n]&&e[t][n].is_leaving_feedback)},canShowRecapDebug:function i(t,n){return"sli_debug_info"===TS.client.highlights.sli_recaps_debug_group&&e[t]&&e[t][n]},shouldRenderHighlightsUI:function e(i,t){return TS.boot_data.feature_sli_recaps_interface&&(TS.client.highlights.msgIsHighlight(i,t)||TS.client.highlights.msgIsLeavingFeedback(i,t))},isMsgBeingRequested:function e(t,n){return i[t]&&i[t][n]},getHighlight:function i(t,n){if(TS.boot_data.feature_store_highlights_in_redux)return TS.interop.redux.models.messagesMeta.getHighlightByChannelAndTs(TS.redux.getState(),{channelId:t,ts:n});return e[t]&&e[t][n]},getHighlightsForChannel:function i(t){return e[t]},addHighlights:function i(t){var n={};e=_.reduce(t,function(e,i,t){e[t]=e[t]||{};_.each(i,function(i,a){if(!e[t][a]||!e[t][a].show_recap&&!e[t][a].is_leaving_feedback&&!e[t][a].left_feedback){e[t][a]=i;e[t][a].justification=TS.format.formatWithOptions(i.justification||"",void 0,{no_linking:true});n[t]=n[t]||{};n[t][a]=e[t][a]}else{e[t][a].request_id=i.request_id;e[t][a].cached_request_id=i.cached_request_id}});return e},e);if(!_.isEmpty(n))TS.client.highlights.updated_sig.dispatch(n)},setDefaultFeedbackForHighlight:function i(t,a,r,s){if(TS.boot_data.feature_store_highlights_in_redux){var o=TS.interop.redux.models.messagesMeta.getHighlightByChannelAndTs(TS.redux.getState(),{channelId:t,ts:a});var l=r&&"positive"===r.feedback;var d=o.feedbackOptions[l?"default_positive":"default_negative"].args;d.source=s;d.request_id=o.request_id;var c=l?"default_positive":"default_negative";if("dismiss"===r.feedback)c="dismiss";TS.redux.dispatch(TS.interop.redux.models.messagesMeta.setFeedbackForHighlight({channelId:t,ts:a,feedback:c,leftFeedback:false,isLeavingFeedback:true,args:d}))}if(e[t]&&e[t][a]){e[t][a]=_.assign({},e[t][a],r);if("negative"===r.feedback){e[t][a].show_recap=false;e[t][a].is_leaving_feedback=true}var u={};u[t]={};u[t][a]=e[t][a];TS.client.highlights.feedback_submitted_sig.dispatch(u);var m;if("dismiss"===r.feedback)m="dismiss";else m="default_"+r.feedback;n(e[t][a],_.get(e[t][a],["feedback_options",m,"args"]),s)}},setNegativeFeedbackForHighlight:function i(t,a,r,s){if(TS.boot_data.feature_store_highlights_in_redux){var o=TS.interop.redux.models.messagesMeta.getHighlightByChannelAndTs(TS.redux.getState(),{channelId:t,ts:a});var l=_.get(o,["feedbackOptions","negative",r,"args"]);l.source=s;l.request_id=o.request_id;TS.redux.dispatch(TS.interop.redux.models.messagesMeta.setFeedbackForHighlight({channelId:t,ts:a,source:s,feedback:"negative",leftFeedback:false,isLeavingFeedback:true,args:l}))}if(e[t]&&e[t][a]){e[t][a].is_leaving_feedback=false;e[t][a].left_feedback=true;var d={};d[t]={};d[t][a]=e[t][a];TS.client.highlights.feedback_submitted_sig.dispatch(d);n(e[t][a],_.get(e[t][a],["feedback_options","negative",r,"args"]),s)}},getHighlightsForMessages:function e(i){if(!i.timestamps.length)return;var t=_.map(i.timestamps,function(e){return{ts:e,is_unread:true}});r(i.channel.id,i.timestamps);return TS.api.call("highlights.list",{channel:i.channel.id,messages:JSON.stringify(t),channel_open_ts:i.channel_open_ts||TS.interop.datetime.makeTsStamp(i.channel.last_made_active,{padder:"0"}),channel_open_last_read_ts:i.channel.last_read}).then(function(e){TS.client.highlights.last_request_id=e.request_id;TS.client.highlights.addHighlights(e.data.messages)}).catch(function(e){TS.error(e)}).finally(function(){s(i.channel.id,i.timestamps)})},test:function i(){var t={};Object.defineProperty(t,"_cache",{get:function i(){return e},set:function i(t){e=t}});return t}});var e={};var i={};var t=null;var n=function e(i,t,n){if(t){var a=_.assign({},t,{request_id:i.request_id||TS.client.highlights.last_request_id,source:n});if(i.cached_request_id)a.cached_request_id=i.cached_request_id;TS.api.call("highlights.feedback",a).catch(function(e){TS.error(e)})}};var a=function e(){TS.client.highlights.sli_recaps_debug_group=TS.experiment.getGroup("sli_recaps_debug")};var r=function e(t,n){i[t]=i[t]||{};_.each(n,function(e){i[t][e]=true})};var s=function e(t,n){_.each(n,function(e){if(i[t]&&i[t][e])delete i[t][e]});if(!_.isUndefined(i[t])&&_.isEmpty(i[t]))delete i[t]};var o=function e(){var i=TS.shared.getModelObById(t);if(i)d(i);t=_.get(TS.shared.getActiveModelOb(),"id");u()};var l=function e(i){d(i.model_ob)};var d=function i(t){if(e[t.id]){var n=parseFloat(t.last_read);_.each(e[t.id],function(e,i){if(parseFloat(i)<=n)c(t.id,i)});if(_.isEmpty(e[t.id]))delete e[t.id]}};var c=function i(t,n){if(e[t]&&e[t][n])delete e[t][n]};var u=function e(){f={}};var m={};var f={};var h=function e(i){if(!i||i.is_mpim||i.is_im||!i.unread_cnt||i.id!==TS.model.active_channel_id)return;if(m[i.id])return;m[i.id]=true;TS.membership.promiseToGetMembershipCounts(i).then(function(e){if(e.member_count<5)return;var t=TS.utility.msgs.getUnreadMsgTimestampsWithoutHighlights(i);_.each(t,function(e,i){if(f[i])delete t[i];else f[i]=true});if(_.isEmpty(t))return;TS.client.highlights.getHighlightsForMessages({channel:i,timestamps:_.keys(t)})}).finally(function(){delete m[i.id]})}})()},3587:function(e,i){(function(){TS.registerModule("client.ui.highlights",{openNegativeFeedbackMenu:function t(n,a,r,s){var o=TS.client.highlights.getHighlight(a,r);if(!o)return;var l=$("<ul></ul>");_.each(o.feedback_options.negative,function(e){l.append('<li role="menuitem" data-js="highlights_feedback_item"><a href="#">'+TS.format.formatWithOptions(e.text,"",{no_linking:true})+"</a></li>")});TS.menu.startWithList(n,l,{close_on_click:true,menu_class:"sli_briefing__menu",position_by_click:true,onClick:function e(i){i.preventDefault();var t=$(i.target).parents("li[data-js=highlights_feedback_item]").index();TS.client.highlights.setNegativeFeedbackForHighlight(a,r,t,s)}});TS.menu.positionAt($(n.target),e,i)}});var e=0;var i=18})()},3597:function(e,i){(function(){TS.registerModule("magic_login",{onStart:function e(){},make:function e(i,t){n(i,t)},execute:function e(i){a(i)}});var e;var i;var t;var n=function n(a,s){e=s.app_uri;i=s.browser_uri;t=s.fall_back_to_browser;if(e)a.attr("href",e);else e=a.attr("href");if(t&&i)r(a)};var a=function n(a){e=a.app_uri;i=a.browser_uri;t=a.fall_back_to_browser;d()};var r=function e(i){i.on("click",function(e){d(e)})};var s=function t(){window.navigator.msLaunchUri(e,function(){},function(){window.location.href=i})};var o=function t(n){if(n)n.preventDefault();var a=window.setTimeout(function(){window.location.href=i},1500);window.addEventListener("blur",function(){clearTimeout(a)});var r=document.createElement("iframe");r.className="hidden";r.src=e;document.body.appendChild(r)};var l=function t(n){if(n)n.preventDefault();var a=window.setTimeout(function(){window.location.href=i},1500);window.addEventListener("blur",function(){clearTimeout(a)});window.location.href=e};var d=function t(n){if(bowser&&(bowser.firefox||bowser.safari))o(n);else if(bowser&&(bowser.msie||bowser.msedge)&&"undefined"!==typeof window.navigator.msLaunchUri&&e.indexOf("://")>0)s(n);else if(bowser&&bowser.chromeBook)window.location.href=i;else l(n)}})()},3598:function(e,i){(function(){TS.registerModule("menu.date",{onStart:function e(){},startWithExpirationPresets:function t(r){e=r.date_picker_args;i=r.onSelect;a();n(r)}});var e;var i;var t=5;var n=function e(i){var n=_.isUndefined(i.attach_to_target)?true:i.attach_to_target;TS.menu.start(i.event,false,{attach_to_target_at_full_width:n,onClose:i.onClose});if(n){var a=-1*TS.menu.$menu.outerHeight()-t;var r=i.$target.position().left-TS.menu.$menu.outerWidth()/2+i.$target.outerWidth()/2;TS.menu.$menu.css({top:Math.floor(a),left:Math.floor(r)})}else{var s=i.$target.outerWidth()/2*-1;var o=i.$target.outerHeight()+t;TS.menu.positionAt(i.$target,Math.floor(s),Math.floor(o))}};var a=function e(){TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu.addClass("expiration_date_picker");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_expiration_date_items());TS.menu.$menu_items.on("click.menu","li",o);TS.menu.$menu_footer.removeClass("hidden").html(TS.templates.menu_expiration_context())};var r=function i(){TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu.addClass("date_picker expiration_date_picker");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_footer.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_expiration_date_picker());TS.menu.$menu_items.on("click.menu","li#date_picker_back_item",function(e){a();e.stopPropagation()});var t={onChange:s,onHide:l};_.assign(t,e);var n=TS.menu.$menu.find("#date_picker_container");TS.ui.date_picker.startExpirationDatePicker(n,t)};var s=function e(t){if("string"===typeof t)t=parseInt(t,10);if(isNaN(t)){TS.warn("date_ts could not be parsed as a number.");return}if(i)i(t);TS.menu.end()};var o=function e(i){if(TS.menu.isRedundantClick(i))return;var t=$(this).attr("data-expiration-option");if(!t){TS.warn("Selected an invalid expiration date menu item.");return}var n;switch(t){case"none":s(0);break;case"7days":n=d(7);s(n);break;case"30days":n=d(30);s(n);break;case"60days":n=d(60);s(n);break;case"custom":r()}i.stopPropagation()};var l=function e(){var i=$("#date_picker_container");if(i.pickmeup)_.defer(function(){i.pickmeup("destroy")})};var d=function e(i){if(!_.isNumber(i)){TS.error("num_days must be a number.");return}var t=new Date;t.setHours(23,59,59,0);t.setDate(t.getDate()+i);var n=t.getTime()/1e3;return n}})()},3606:function(e,i){(function(){TS.registerModule("ui.admin_invites",{invites_sent_sig:new signals.Signal,emails_parsed_sig:new signals.Signal,onStart:function e(){w();TS.ui.admin_invites.invites_sent_sig.add(oe,TS.ui.admin_invites);TS.ui.admin_invites.emails_parsed_sig.add(ce,TS.ui.admin_invites);TS.team.team_email_domain_changed_sig.add(C,TS.ui.admin_invites);TS.prefs.team_auth_mode_changed_sig.add(W,TS.ui.admin_invites);TS.prefs.team_sso_auth_restrictions_changed_sig.add(W,TS.ui.admin_invites);TS.prefs.team_invites_only_admins_changed_sig.add(TS.ui.admin_invites.maybeShowInviteLink,TS.ui.admin_invites);if(TS.web)TS.web.login_sig.add(TS.ui.admin_invites.onLogin,TS.ui.admin_invites);if(TS.client)TS.client.login_sig.add(TS.ui.admin_invites.onLogin,TS.ui.admin_invites);r=TS.storage.fetchInvitesState();$("body").on("click",'[data-action="admin_invites_modal"]',function(){if(TS.isPartiallyBooted())return;var e={};if($(this).data("account-type"))e.account_type=$(this).data("account-type");y(e)})},onLogin:function e(){C()},start:function e(i){if(TS.isPartiallyBooted())return;if(ge())y(i)},switchToPicker:function e(){if(ge())Z()},maybeShowInviteLink:function e(){if(!TS.client)return;var i=false;var t=false;if(ge()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26)i=true;if(ge()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length>=2)t=true;$("#channel_list_invites_link").toggleClass("hidden",!i).toggleClass("dim",t)},populateInvites:function i(t){if(!ge())return;if(!t)return;var n=r.reduce(function(e,i){e[i.email]=true;return e},{});t.forEach(function(e){if(!n[e.email]){n[e.email]=true;r.push(e)}});TS.storage.storeInvitesState(r);if(r.length&&TS.ui.fs_modal.is_showing){e.find(".admin_invite_row").remove();r.forEach(function(e){O(e)})}},canInvite:function e(){return ge()},test:function e(){var i={_error_map:b,_getError:Se};Object.defineProperty(i,"_getError",{get:function e(){return Se},set:function e(i){Se=i}});Object.defineProperty(i,"_error_map",{get:function e(){return b},set:function e(i){b=i}});return i}});var e;var i=0;var t=0;var n=[];var a=[];var r=[];var s=TS.utility.exampleEmailAddress();var o=s;var l="";var d="";var c;var u;var m="#admin_invites_show_date_picker";var f;var h;var g;var p;var S="INVITEMODAL";var T=S+"_ACTION";var v=3;var b={};var w=function e(){b={url_in_message:TS.i18n.t("Sorry, but URLs are not allowed in the custom message. Please remove it and try again!","invite")(),invalid_email:TS.i18n.t("That doesn’t look like a valid email address!","invite")(),already_in_team:TS.i18n.t("This person is already in your workspace.","invite")(),user_disabled:function e(){var i=TS.i18n.t('This person is already in your workspace, but their account is deactivated. You can <a href="{url}#disabled">manage</a> their account.',"invite")({url:TS.utility.getTeamUrl()});return i},already_invited:TS.i18n.t("This person has already been invited to your workspace.","invite")(),sent_recently:TS.i18n.t("This person was recently invited. No need to invite them again just yet.","invite")(),invite_failed:TS.i18n.t("Something went wrong with this invite :(","invite")(),ura_limit_reached:TS.i18n.t("You’ve reached your workspace limit for Single-channel Guests. You must invite more paid members first.","invite")(),user_limit_reached:TS.i18n.t("You’ve reached the maximum number of users for this workspace.","invite")(),not_allowed:TS.i18n.t("You can’t invite this type of account based on your current SSO settings.","invite")(),custom_message_not_allowed:TS.i18n.t("Sorry, you can’t add a custom message to this invite. Please remove it and try again!","invite")(),domain_mismatch:TS.i18n.t("Your SSO settings prevent you from inviting people from this email domain.","invite")(),invite_limit_reached:TS.i18n.t("Your workspace has exceeded the limit on invitations. After more people have accepted the ones your workspace has sent, you can send more. Revoking invitations will not lift the limit. Our Help Center has <a href='https://get.slack.help/hc/{locale}/articles/201330256#invitation_limits'>more details on invitation limits</a>.","invite")({locale:TS.i18n.zdLocale()}),too_long:TS.i18n.t("This person’s name exceeds the 35-character limit.","invite")(),org_user_is_disabled:TS.i18n.t("This person has a deactivated account for your organization.","invite")(),org_user_is_disabled_but_present:TS.i18n.t("This person is already in your workspace, but they have been deactivated by your organization. Contact an organization administrator to re-enable their account","invite")(),mismatch_with_pending_team_invite:function e(i){var t;switch(i.user_type){case"ultra_restricted":t=TS.i18n.t("Single-Channel Guest","invite")();break;case"restricted":t=TS.i18n.t("Multi-Channel Guest","invite")();break;default:t=TS.i18n.t("full Member","invite")()}return TS.i18n.t("This person can’t be invited, because they have already been invited as a {account_type} to your organization","invite")({account_type:t})},user_type_mismatch:function e(i){var t;var n;switch(i.issue){case"org_user_is_restricted":t=TS.i18n.t("Multi-Channel Guest","invite")();break;case"org_user_is_ultra_restricted":t=TS.i18n.t("Single-Channel Guest","invite")();break;case"org_user_not_restricted":case"org_user_not_ultra_restricted":t=TS.i18n.t("full Member","invite")()}if(_.isUndefined(t))n=TS.i18n.t("This person already has an account for your organization","invite")();else n=TS.i18n.t("This person already has a {account_type} account for your organization, so you can only invite them in that role.","invite")({account_type:t});return n}}};var y=function e(i){var t;u=null;if(pe()){if(i&&i.account_type)t=i.account_type}else t="full";if(i&&i.initial_channel_id)c=i.initial_channel_id;var n=TS.templates.admin_invite_modal({can_add_ura:TS.model.can_add_ura,team_name:TS.model.team.name,team_in_org:TS.model.team.enterprise_id,hide_full_member_option:TS.utility.invites.hideFullMemberInviteOption(),team_signup_url:"https://"+TS.model.team.domain+".slack.com/signup",invites_limit:""===TS.model.team.plan&&TS.prefs.getTeamPref("invites_limit"),show_custom_message:TS.model.team.plan,is_paid_team:TS.model.team.plan,is_our_app:TS.model.is_our_app});var a={body_template_html:n,onShow:A,onCancel:k,clog_name:"INVITEMODAL"};if(TS.client)TS.ui.a11y.saveCurrentFocus();TS.ui.fs_modal.start(a);if(t)setTimeout(function(){ee(t)},0)};var A=function i(){e=$("#admin_invites_container");var t=e.find(".admin_invites_custom_message_container");var n=e.find("#admin_invites_alert");var a=e.find('button[data-action="api_send_invites"]');if(!TS.model.team.plan&&TS.model.user.is_admin){n.removeClass("hidden");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"admin_invites",action:"impression",ui_element:"invite_modal_guest_alert"}}})}else n.addClass("hidden");e.find("#admin_invites_switcher").on("click",'[data-action="switch_type"]',function(e){var i=$(e.target);if(i.is("a"))return;if(i.closest(".admin_invites_account_type_option").hasClass("disabled"))return;ee($(this).data("account-type"))});e.find('[data-action="admin_invites_add_row"]').on("click",O);e.find('a[data-action="admin_invites_switch_view"]').on("click",function(){X($(this).data("view"))});e.find("#invite_rows").on("keydown",function(e){if(e.which===TS.utility.keymap.enter)a.trigger("click")});a.on("click",function(e){e.preventDefault();ae();if(!TS.model.team.plan&&TS.model.user.is_admin)n.css("visibility","hidden")});e.find('button[data-action="api_parse_emails"]').on("click",function(e){e.preventDefault();le();$(this).find(".ladda-label").text(TS.i18n.t("Processing email addresses ...","invite")())});x();M();e.find('a[data-action="admin_invites_show_custom_message"]').on("click",function(){N()});e.find('[data-action="admin_invites_hide_custom_message"]').on("click",function(){H()}).hover(function(){t.addClass("delete_highlight")},function(){t.removeClass("delete_highlight")});e.find("#admin_invite_custom_message").on("input",Q);e.find("#bulk_emails").css("overflow","hidden").autogrow();r=TS.storage.fetchInvitesState();if(r.length)TS.ui.admin_invites.populateInvites(r);else O();var s=e.find(".admin_invite_row").length;if(s<v){var o=v-s;_.times(o,O)}};var k=function e(){i=0;t=0;r=a.length?[]:ne();n=[];a=[];K();if(p)p();TS.storage.storeInvitesState(r);if(TS.client)TS.ui.a11y.restorePreviousFocus()};var C=function e(){o=s};var M=function e(){if(!TS.model.team.plan)return I(false);TS.api.callImmediately("users.admin.canAddUltraRestricted").then(function(e){I(e.data.ok)},function(){I(false)})};var I=function e(i){TS.model.can_add_ura=i;var t=$('.admin_invites_account_type_option[data-account-type="ultra_restricted"]');t.toggleClass("disabled",!TS.model.can_add_ura);if(!TS.model.can_add_ura){var n=$(".account_type_disabled_hover",t);n.removeClass("hidden")}};var x=function e(){h=document.getElementById("btn_connect_contacts");if(!h)return;h.addEventListener("click",E);g=TS.model.user.id+Date.now();TS.google_auth.getAuthLink(g).then(function(){TS.utility.disableElement(h,false)})};var E=function e(){TS.google_auth.getAuthLink(g).then(function(e){var i="menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes,width=600,height=500";var t=window.open(e,"auth_window",i);B(t)})};var B=function e(i){p=TS.google_auth.pollForAuthStatus(g,P,i).cancel};var P=function i(t){p=null;if(t){var n=TS.i18n.t("Google contacts connected","invite")();e.find(".btn_connect_contacts_text").text(n);h.removeEventListener("click",E);TS.clog.track(T,{action:"google_auth_success",trigger:"user_allowed_access"});D()}};var D=function e(){var i={page:1,count:1e3};TS.google_auth.getContactList(g,i).then(function(e){var i=$("input.email_field").filter(function(){return!this.value});if(0===i.length)O();U(e)})};var U=function e(i){if(!i)return;f=f||i.items;$("input.email_field").lazyFilterSelect({approx_item_height:50,data:f,single:true,placeholder_text:TS.utility.exampleEmailAddress(),onReady:function e(){F(this)},filter:function e(i,t){t=t.toLowerCase();if(i.full_name)var n=i.full_name.toLowerCase();if(i.email)var a=i.email.toLowerCase();return n&&-1!==n.indexOf(t)||a&&-1!==a.indexOf(t)},noResultsTemplate:function e(i){var t=TS.i18n.t("None of your Google contacts match <strong>{query}</strong>","invite")({query:_.escape(i)});return t},onItemAdded:function e(i){F(this,i);TS.clog.track(T,{action:"add_google_email",trigger:"select_google_contact_from_dropdown"})},onInputFocus:function e(){$(".ts_tip_tip").remove();$(".lazy_filter_select").removeClass("ts_tip ts_tip_top ts_tip_float ts_tip_multiline ts_tip_delay_1000")},onInputBlur:function e(){F(this)},template:function e(i){var t=TS.templates.admin_invite_filter_select_contact({contact:i});return new Handlebars.SafeString(t)}}).addClass("hidden");if(void 0!==i.items){var t=TS.i18n.t("Type here to search your Google contacts","invite")();var n='<span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+t+"</span></span>";var a=$("input.email_field").filter(function(){return!this.value}).first();a.lazyFilterSelect("container").addClass("ts_tip ts_tip_top ts_tip_float ts_tip_multiline ts_tip_delay_1000").append(n)}};var F=function e(i,t){var n=i.$container[0];var a=$(n).parents(".admin_invite_row");if(t){$(a).find("input[name*=real_name]").val(t.full_name);$(a).find("input[name*=email_address]").val(t.email)}else{var r=$(a).find("input.lfs_input").val();var s=$(a).find("input[name*=email_address]").val();if(r){$(a).find("input.email_field").lazyFilterSelect("clearValue");$(a).find("input[name*=email_address]").val(r)}else if(s)$(a).find("input.lfs_input").val(s)}};var O=function t(n){var a=true;if(0===e.find(".admin_invite_row").length)a=false;else e.find(".admin_invite_row").first().find(".delete_row").removeClass("hidden");e.find("#invite_rows").append(TS.templates.admin_invite_row({index:i,show_delete_btn:a,placeholder_email_address:o}));var r=e.find("#invite_"+i);r.find('[data-action="admin_invites_delete_row"]').on("click",function(){G(r)}).hover(function(){r.addClass("delete_highlight")},function(){r.removeClass("delete_highlight")});r.find('[name="email_address"]').focus();if(n){r.find('[name="email_address"]').val(n.email);r.find(".lfs_input_container input.lfs_input").val(n.email);if(n.real_name)r.find('[name="real_name"]').val(n.real_name);else if(n.first_name){var s=[n.first_name];if(n.last_name)s.push(n.last_name);r.find('[name="real_name"]').val(s.join(" "))}}if(TS.google_auth.isAuthed(g)&&f)U(f);i+=1};var R=function i(t,n){e.find("#invite_notice").toggleClass("alert_warning","alert_warning"===t).toggleClass("alert_info","alert_info"===t).toggleClass("alert_error","alert_error"===t).html(n).slideDown(100)};var N=function i(){e.find(".admin_invites_hide_custom_message").addClass("hidden");e.find(".admin_invites_show_custom_message").removeClass("hidden");Q()};var H=function i(){e.find(".admin_invites_hide_custom_message").removeClass("hidden");e.find(".admin_invites_show_custom_message").addClass("hidden");Q()};var Q=function i(){var t=e.find("#admin_invite_custom_message");var n=t.val().trim();var a=e.find(".admin_invites_show_custom_message");var r=!a.hasClass("hidden")&&!!t.data("validation")&&t.data("validation").includes("hasnourl")&&!!TS.interop.url.findUrlsInString(n).length;L(r)};var L=function i(t){e.find("#admin_invites_submit_btn").toggleClass("disabled",t)};var G=function i(t){if(!t||!t.length)return;t.slideToggle(100,function(){t.remove();var i=$(".admin_invite_row").length;if(0===i)O();else if(1===i)e.find(".admin_invite_row").first().find(".delete_row").addClass("hidden")})};var j=function i(){var t=$("#account_type").val();var n;if("full"===t)n=TS.i18n.t("Send Invitations","invite")();else n=TS.i18n.t("Invite Guests","invite")();e.find('button[data-action="api_send_invites"]').find(".ladda-label").text(n)};var K=function e(){c=void 0};var W=function i(){var t=e.find("#account_type").val();var n=false;var a="google"===TS.prefs.getTeamPref("auth_mode")||"saml"===TS.prefs.getTeamPref("auth_mode");var r=false;var s=TS.boot_data.page_needs_enterprise;var o="";if(s&&"full"===t||a&&0===TS.prefs.getTeamPref("sso_auth_restrictions")){r=true;var l=TS.redux.enterprise.getEnterprise();var d=TS.utility.enterprise.getProviderLabel(l,_.get(TS.model,"enterprise.sso_provider.label","single sign-on"));o=TS.i18n.t("Only people with {account_type} accounts will be able to accept invitations.","invite")({account_type:d})}if("google"===TS.prefs.getTeamPref("auth_mode")){if("full"===t&&(0===TS.prefs.getTeamPref("sso_auth_restrictions")||1===TS.prefs.getTeamPref("sso_auth_restrictions")))n=true;else if(("restricted"===t||"ultra_restricted"===t)&&0===TS.prefs.getTeamPref("sso_auth_restrictions"))n=true}else if("saml"===TS.prefs.getTeamPref("auth_mode"))if(0===TS.prefs.getTeamPref("sso_auth_restrictions")||1===TS.prefs.getTeamPref("sso_auth_restrictions"))if("full"===t)if(!s){var c=TS.templates.admin_invite_switcher({can_add_ura:TS.model.can_add_ura,hide_full_member_option:TS.utility.invites.hideFullMemberInviteOption(),team_signup_url:"https://"+TS.model.team.domain+".slack.com/signup",team_in_org:TS.model.team.enterprise_id});$("#admin_invites_switcher").html(c);Z()}$("#google_auth_email_domain_notice").toggleClass("hidden",!n);$("#sso_signup_notice").html(o).toggleClass("hidden",!r)};var V=function i(t){var n;e.find('input[name="email_address"]').each(function(){if($(this).val()==t)n=$(this).closest(".admin_invite_row")});return n};var q=function e(i,t){if(!_.isObject(t))TS.error("_rowError did not receive an error object: ",t);var n=Se(t);if(i){i.find("label.email").addClass("error").end().find(".error_msg").removeClass("hidden").html(n);if("too_long"===t.error)i.find("label").addClass("error");if(!b[t.error])i.find("label").addClass("error");i.find("input").on("keyup.admin_invite_error_fixed",function(){z(i)})}};var z=function e(i){if(i){i.find("label").removeClass("error").end().find(".error_msg").addClass("hidden");i.find("input").off(".admin_invite_error_fixed")}};var Y=function i(){setTimeout(function(){Ladda.stopAll();e.find(".admin_invite_row").remove();n=[];a=[];u=null;j();_.times(v,O)},0)};var J=function i(){setTimeout(function(){Ladda.stopAll();e.find('button[data-action="api_parse_emails"]').find(".ladda-label").text(TS.i18n.t("Add Invitees","invite")());e.find("#bulk_emails").prop("disabled",false)},0)};var Z=function i(){var t=TS.i18n.t("people","invites")();e.find("#admin_invites_header").find(".admin_invites_header_type").removeClass("normal").text(t).end().find(".admin_invites_header_team_name").removeClass("hidden");e.find("#admin_invites_switcher").removeClass("hidden");e.find("#admin_invites_workflow").addClass("hidden");TS.ui.fs_modal.hideBackButton()};var X=function i(t){if("individual"===t){e.find("#individual_invites").removeClass("hidden");e.find("#bulk_invites, #bulk_notice").addClass("hidden");e.find("#bulk_emails").val("");e.find(".email_field").first().focus();e.find(".invite_modal_options_container").removeClass("hidden");J()}else if("bulk"===t){e.find("#bulk_invites").removeClass("hidden");e.find("#individual_invites").addClass("hidden");e.find(".invite_modal_options_container").addClass("hidden");var n=e.find('button[data-action="api_parse_emails"]');if(!n.hasClass("ladda")){Ladda.bind('button[data-action="api_parse_emails"]');n.addClass("ladda")}n.find(".ladda-label").text(TS.i18n.t("Add Invitees","invite")());var a=ne();if(a){var r="";$.each(a,function(e,i){if(i.real_name)r+=i.real_name+" ";r+="<"+i.email+">, "});e.find("#bulk_emails").val(r).autogrow()}e.find("#bulk_emails").focus()}};var ee=function i(t){var n=[];var a=TS.channels.getUnarchivedChannelsForUser();if(_.isArray(TS.prefs.getTeamPref("default_channels")))a.forEach(function(e){if(-1!==TS.prefs.getTeamPref("default_channels").indexOf(e.id)){e.is_default=true;n.push(e)}});var r=TS.channels.getGeneralChannel();var s="";if(r){s=r.name;if(!n.length)n.push(r)}var o={invite_type:t,channels:a,default_channels:n,general_name:s,groups:TS.groups.getUnarchivedGroups(),email_domains:TS.model.team.email_domain.split(","),is_admin:TS.model.user.is_admin,initial_channel_id:c};var l="enterprise"!==TS.model.team.plan;var d=TS.templates.admin_invite_channel_picker(o);var u=TS.i18n.t("Members","invite")();if("restricted"===t)u=TS.i18n.t("Multi-Channel Guests","invite")();else if("ultra_restricted"===t)u=TS.i18n.t("Single-Channel Guests","invite")();e.find("#admin_invites_header").find(".admin_invites_header_type").addClass("normal").text(u).end().find(".admin_invites_header_team_name").addClass("hidden");e.find("#admin_invites_channel_picker_container").html(d);e.find("#account_type").val(t);e.find("#admin_invites_switcher, #admin_invites_workflow").toggleClass("hidden");e.find("#admin_invites_billing_notice").toggleClass("hidden",!(l&&"ultra_restricted"!==t));e.find("#admin_guide_to_billing_at_slack").toggleClass("hidden",!(l&&"ultra_restricted"!==t));e.find("#ura_warning").toggleClass("hidden","restricted"!==t&&"ultra_restricted"!==t);e.find("#invite_notice").hide();e.find(".admin_invites_guest_expiration_date_container").toggleClass("hidden","full"===t);e.find(m).on("click",ie);var f="";if("restricted"===t)f=TS.i18n.t("These guests will only have access to messages and files in specified channels.","invite")();else if("ultra_restricted"===t)f=TS.i18n.t("These guests will only have access to messages and files in a single channel.","invite")();e.find("#admin_invites_subheader").text(f).toggleClass("hidden","full"===t);e.find("#ultra_restricted_channel_picker").on("change",function(){j();K()});e.find(".email_field").first().focus();var h=e.find('button[data-action="api_send_invites"]');if(!h.hasClass("ladda")){Ladda.bind('button[data-action="api_send_invites"]');h.addClass("ladda")}j();W();e.find("#defaultchannelsmulti, #ultra_restricted_channel_picker").lazyFilterSelect({onItemRemoved:function e(i){if(i.value==c)K()}}).addClass("hidden");if(pe()){TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker);TS.ui.fs_modal.showBackButton()}};var ie=function e(i){var t={event:i,$target:$(m),onSelect:te,date_picker_args:{}};if(u)t.date_picker_args.selected_expiration_ts=u;TS.menu.date.startWithExpirationPresets(t)};var te=function e(i){if(!_.isNumber(i)||i===u)return;var t;var n;if(0===i){u=null;t=TS.i18n.t("By default, guest accounts stay active indefinitely.","invite")();n=TS.i18n.t("Set a time limit","invite")()}else{u=i;t=TS.i18n.t("These accounts will be deactivated on <strong>{date} at {time}</strong>.","invite")({date:TS.interop.datetime.formatDate(i,"{date}"),time:TS.interop.datetime.formatDate(i,"{time}")});n=TS.i18n.t("Change","invite")()}$("#admin_invites_guest_expiration_copy").html(t);$(m).text(n)};var ne=function i(){var t=[];var n;e.find(".admin_invite_row").each(function(){n=$.trim($(this).find('[name="email_address"]').val());var e=$.trim($(this).find('[name="real_name"]').val());if(n){var i={};i.email=n;if(e)i.real_name=e;t.push(i)}else if($(".admin_invite_row").length>1)G($(this))});r=t;TS.storage.storeInvitesState(r);return t};var ae=function i(){var n=false;e.find(".admin_invite_row").each(function(){var e=$.trim($(this).find('[name="email_address"]').val());if(e)if(!TS.utility.email_regex.test(e)){q($(this),{error:"invalid_email"});n=true}else z($(this));else if($(".admin_invite_row").length>1)G($(this))});if(n){setTimeout(Ladda.stopAll,0);return}var a=ne();if(!a.length){var r='<i class="ts_icon ts_icon_info_circle"></i> '+TS.i18n.t("Add at least one email address before sending invitations.","invite")();R("alert_info",r);setTimeout(Ladda.stopAll,0)}else if(a){var s=e.find("#account_type").val();var o=e.find(".admin_invites_show_custom_message");var l=e.find("#admin_invite_custom_message");var c;var _=TS.google_auth.isAuthed(g)?"contact":"manual";if("full"===s||"restricted"===s){var m=e.find("#defaultchannelsmulti").val();if(m)c=m.join(",")}else if("ultra_restricted"===s)c=e.find("#ultra_restricted_channel_picker").val();if(!o.hasClass("hidden"))d=l.val();else d="";t=a.length;$.each(a,function(e,i){var t={email:i.email,source:"invite_modal",mode:_};if(c)t.channels=c;if(d)t.extra_message=d;if(i.real_name)t.real_name=i.real_name;if(("restricted"===s||"ultra_restricted"===s)&&u)t.expiration_ts=u;if("restricted"===s)t.restricted=1;else if("ultra_restricted"===s)t.ultra_restricted=1;TS.api.call("users.admin.invite",t).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;if(re)re(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;if(re)re(a,i,t,n);return{data:i,args:t,request_id:n}})})}};var re=function i(t,r,s){if(t){n.push({email:s.email,real_name:s.real_name});var o=V(s.email);G(o)}else{var l;if("requires_channel"===r.error){setTimeout(Ladda.stopAll,0);e.find("#ra_channel_picker_header").highlightText();var d=TS.i18n.t("Pick at least one channel before inviting Multi-Channel Guests.","invite")();l='<i class="ts_icon ts_icon_info_circle"></i> '+d;R("alert_warning",l);return}else if("requires_one_channel"===r.error){setTimeout(Ladda.stopAll,0);e.find("#ura_channel_picker_header").highlightText();var c=TS.i18n.t("Pick a channel before inviting Single-Channel Guests.","invite")();l='<i class="ts_icon ts_icon_info_circle"></i> '+c;R("alert_warning",l);return}var u=r.error;u=TS.ui.validation.maybeConvertNameErrorCode(u);if(TS.boot_data.page_needs_enterprise){var m=null!==TS.members.getMemberByEmail(s.email);if(m&&"org_user_is_disabled"===u)u="org_user_is_disabled_but_present"}a.push({email:s.email,error:u,error_msg:Se(_.extend({},r,{error:u}))})}se()};var se=function e(){t-=1;if(0===t){r=[];TS.storage.storeInvitesState(r);var i=function e(){setTimeout(Ladda.stopAll,0);TS.ui.admin_invites.invites_sent_sig.dispatch()};l=ue(n);if(l)TS.api.call("team.checkEmailDomains",{email_domains:l}).then(function(e){if(e.data.ok)l=e.data.email_domains;else l=""},function(){l=""}).finally(i);else i()}};var oe=function i(){var t=$("#account_type").val();var r;var s;if("full"===t){var o=TS.i18n.t("{invites_length,plural,=1{{invites_length} Member}other{{invites_length} Members}}","invite")({invites_length:n.length});r="<strong>"+o+"</strong>"}else if("restricted"===t){var c=TS.i18n.t("{invites_length,plural,=1{{invites_length} Multi-Channel Guest}other{{invites_length} Multi-Channel Guests}}","invite")({invites_length:n.length});r="<strong>"+c+"</strong>"}else if("ultra_restricted"===t){var _=TS.i18n.t("{invites_length,plural,=1{{invites_length} Single-Channel Guest}other{{invites_length} Single-Channel Guests}}","invite")({invites_length:n.length});r="<strong>"+_+"</strong>"}if(u&&("restricted"===t||"ultra_restricted"===t))s=TS.i18n.t("{invites_length,plural,=1{This account}other{These accounts}} will be deactivated on {date} at {time}.","invite")({invites_length:n.length,date:TS.interop.datetime.formatDate(u,"{date}"),time:TS.interop.datetime.formatDate(u,"{time}")});var m={success_invites_html:r,success_invites:n,error_invites:a,team_name:TS.model.team.name,domains:l,paid_team:""!==TS.model.team.plan,is_admin:TS.model.user.is_admin,expiration_msg:s};if(TS.model.team.plan)m.custom_message=d;var f=TS.templates.admin_invite_summary(m);e.find("#invite_notice").slideUp(100);e.find("#admin_invites_workflow, #admin_invites_header, #admin_invites_subheader").addClass("hidden");e.find("#admin_invites_success").html(f).removeClass("hidden");function h(){Y();$("#admin_invites_workflow, #admin_invites_success").toggleClass("hidden");if(!TS.model.team.plan&&TS.model.user.is_admin)$("#admin_invites_alert").css("visibility","visible");$("#admin_invites_header, #admin_invites_subheader").removeClass("hidden");TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker)}e.find('button[data-action="admin_invites_reset"]').on("click",h);TS.ui.fs_modal.bindBackButton(h);e.find('button[data-action="admin_invites_try_again"]').on("click",function(){$.each(a,function(e,i){var t=V(i.email);q(t,i)});$("#admin_invites_workflow, #admin_invites_success").toggleClass("hidden");$("#admin_invites_header, #admin_invites_subheader").removeClass("hidden");TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker);n=[];a=[]});if(_e()){var g=e.find('button[data-action="add_signup_domains"]').on("click",fe);e.on("keyup","#invite_signup_domains",TS.ui.resetButtonSpinner.bind(Object.create(null),g.get(0)))}};var le=function i(){var t=$.trim($("#bulk_emails").val().replace(/[\u200B-\u200D\uFEFF]/g,""));e.find("#bulk_emails").prop("disabled",true);TS.api.call("users.admin.parseEmails",{emails:t}).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;if(de)de(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;if(de)de(a,i,t,n);return{data:i,args:t,request_id:n}})};var de=function i(t,n){if(!t){TS.error("failed onEmailsParsed");var a=TS.i18n.t("Oops! There was an error processing those emails. Please try again.","invite")();e.find("#bulk_notice").html('<i class="ts_icon ts_icon_warning"></i> '+a).removeClass("hidden");J();return}if(0===n.emails.length){var r=TS.i18n.t("We couldn’t find any email addresses in that text. Please try again.","invite")();e.find("#bulk_notice").html('<i class="ts_icon ts_icon_warning"></i> '+r).removeClass("hidden");J();return}TS.ui.admin_invites.emails_parsed_sig.dispatch(n.emails)};var ce=function i(t){e.find(".admin_invite_row").remove();X("individual");var n;if(1==t.length){var a=TS.i18n.t("We found 1 email address to invite. We’ve done our best to guess a name. See if it looks right, then press Invite.","invite")();n='<i class="ts_icon ts_icon_check_circle_o_large"></i> '+a}else{var s=TS.i18n.t("We found {emails_length} email addresses to invite. We’ve done our best to guess a name for each one. See if everything looks right, then press Invite.","invite")({emails_length:t.length});n='<i class="ts_icon ts_icon_check_circle_o_large"></i> '+s}R("alert_info",n);e.find(".admin_invite_row").each(function(){var e=$.trim($(this).find('[name="email_address"]').val());if(!e)G($(this))});$.each(t,function(e,i){O(i)});r=t;TS.storage.storeInvitesState(r)};var _e=function e(){var i=$("#account_type").val();return"full"===i&&TS.model.user.is_owner&&"normal"===TS.prefs.getTeamPref("auth_mode")};var ue=function e(i){if(!_e())return"";var t=i.map(function(e){return e.email.split("@")[1]});if(TS.model.team.email_domain){var n=TS.model.team.email_domain.split(",").reduce(function(e,i){e[i]=true;return e},{});t=_.uniq(t.filter(function(e){return!n[e]}))}return t.join(", ")};var me=function e(i){if(!i)return i;var t=i.split(",").reduce(function(e,i){e[i]=true;return e},{});return Object.keys(t).join(",")};var fe=function i(){TS.ui.startButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0));var t=e.find("#invite_signup_domains").val();if(TS.model.team.email_domain)t=[TS.model.team.email_domain,t].join(",");t=me(t);var n={prefs:JSON.stringify({signup_mode:"email",signup_domains:t})};TS.api.call("team.prefs.set",n).then(function(i){TS.ui.stopButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0),true);TS.model.team.email_domain=i.data.prefs.signup_domains},function(i){TS.ui.stopButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0),false);var t=TS.i18n.t("Sorry! Something went wrong. Please try again.","invite")();if("signup_domains_missing"===i.data.error)t=TS.i18n.t("Please enter a domain","invite")();else if("bad_domain"===i.data.error)t=TS.i18n.t("Sorry! You can’t use {response_data_domain}.","invite")({response_data_domain:i.data.domain});else if("invalid_domain"===i.data.error)t=TS.i18n.t("Hmm, this doesn’t look like a domain! Check for typos?","invite")();else if("too_many_domains"===i.data.error)t=TS.i18n.t("Sorry! You’ve entered too many domains.","invite")();$("#invite_signup_domains").focus().tooltip({title:t,trigger:"manual"}).tooltip("show").on("blur",function(){$(this).tooltip("destroy")})})};var he=function e(){if(!TS.model.team||!TS.model.user)return false;return!TS.prefs.getTeamPref("invites_only_admins")&&!TS.model.user.is_restricted};var ge=function e(){if(!TS.model.user)return false;return TS.model.user.is_admin||he()};var pe=function e(){if(TS.boot_data.page_needs_enterprise)return TS.permissions.members.canOrgUserManageGuests();return TS.model.user.is_admin&&""!==TS.model.team.plan};var Se=function e(i){var t="";if(!i||!i.error)return"";if(!b[i.error])return TS.ui.validation.getErrorMessage(i.error,{maxlength:80});if(!b[i.error])return"";t=b[i.error];return _.isFunction(t)?t(i):t}})()},3608:function(e,i){(function(){TS.registerModule("ui.date_picker",{onStart:function e(){},start:function e(i,t){i.pickmeup(t)},startJumpToDatePicker:function e(i){var t=$("#channel_actions_toggle").attr("data-oldest-ts");if(t){var a=TS.interop.datetime.toDateObject(t);n(i,a)}else{var r=TS.shared.getActiveModelOb();var s={channel:r.id,oldest:283996800,count:1,inclusive:1,include_pin_count:true};if(TS.useReactMessages())s.ignore_replies=true;TS.api.callImmediately("conversations.history",s).then(function(e){var t;if(e.data.messages.length<1)t=TS.shared.getActiveModelOb().created;t=_(e.data.messages).map("ts").min();var a=TS.interop.datetime.toDateObject(t);n(i,a);return true}).catch(function(){n(i);return TS.warn("couldn’t find messages in this channel :"+r.id)})}},startArchiveDatePicker:function e(i){var t=TS.shared.getActiveModelOb();var n=TS.interop.datetime.toDateObject(t.created);var a=Date.now();var r=a;if(boot_data.calendar_start)r=TS.interop.datetime.toDateObject(boot_data.calendar_start);if(boot_data.calendar_oldest)n=TS.interop.datetime.toDateObject(boot_data.calendar_oldest);TS.ui.date_picker.start(i,{first_day:window.moment.localeData().firstDayOfWeek()||0,hide_on_select:true,select_year:true,date:r,min:n,max:a,title_format:"ja-JP"===TS.i18n.locale()?"Y年B":"B Y",locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()},change:function e(){r=$(this).pickmeup("get_date");var i=1e3*Date.parse(r);var n=t.is_mpim?TS.mpims.getMpimArchivesPath(t):"/archives/"+t.id;window.location=n+"/s"+i}})},startExpirationDatePicker:function e(i,t){t=t||{};var n=new Date;var r=n.getTime();var s;var o;if(t.selected_expiration_ts)o=new Date(1e3*t.selected_expiration_ts);else{o=new Date;o.setDate(n.getDate()+a)}o.setHours(0,0,0,0);s=o.getTime();var l={first_day:window.moment.localeData().firstDayOfWeek()||0,select_year:false,min:r,date:s,format:"s",position:"top",flat:true,hide_on_select:true,title_format:"ja-JP"===TS.i18n.locale()?"Y年B":"B Y",locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()}};if(t.class_name)l.class_name=t.class_name;if(t.onHide)l.hide=t.onHide;if(t.onChange)l.change=function(e){var i=new Date(1e3*e);i.setHours(23,59,59,0);var n=Math.floor(i.getTime()/1e3);t.onChange(n)};TS.ui.date_picker.start(i,l)},getOldestMsgTs:function e(){var i=$("#channel_actions_toggle").attr("data-oldest-ts");if(i)return;var t=TS.shared.getActiveModelOb();var n={channel:t.id,oldest:283996800,count:1,inclusive:1,include_pin_count:true};if(TS.useReactMessages())n.ignore_replies=true;TS.api.callImmediately("conversations.history",n).then(function(e){var i;if(e.data.messages.length<1)return;i=_(e.data.messages).map("ts").min();$("#channel_actions_toggle").attr("data-oldest-ts",i);return true}).catch(function(){return TS.warn("couldn’t find messages in this channel :"+t.id)})}});var e=function e(t){var n=TS.shared.getActiveModelOb();if(TS.useReactMessages()){TS.client.ui.tryToJump(n.id,""+Date.parse(t)/1e3);return}if(n.is_channel&&!n.is_member){if(n.id==TS.client.archives.current_model_ob.id)i(n,t)}else{if(n.msgs.length<1){TS.warn("no messages in this channel: "+n.id);return}var a=Date.parse(t)/1e3;var r=n.msgs[n.msgs.length-1];var s=parseFloat(r.ts);if(s<a){if(TS.model.archive_view_is_showing)TS.client.archives.cancel();var o=TS.utility.msgs.getDisplayedMsgAfterTS(a,n.msgs);if(o)TS.client.ui.scrollMsgsSoMsgIsInView(o.ts,false,true);else if(!o&&n.msgs.length>0){o=TS.utility.msgs.getDisplayedMsgBeforeTS(a,n.msgs);TS.client.ui.scrollMsgsSoMsgIsInView(o.ts,false,true)}}else i(n,t)}};var i=function e(i,n){var a=Date.parse(n)/1e3;a=a.toString()+".000000";t(i,a).then(function(e){if(TS.utility.msgs.getMsg(e,i.msgs)){if(TS.model.archive_view_is_showing)TS.client.archives.cancel();TS.client.ui.scrollMsgsSoMsgIsInView(e,false,true)}else TS.client.archives.start(e);return true}).catch(function(){return TS.warn("couldn’t find message for date: "+a+" in channel: "+i.id)})};var t=function e(i,t,n){n=n||1;if(n>100){if(i._archive_msgs&&i._archive_msgs.length>0)return i._archive_msgs[0];throw new Error("no_visible_message_found")}return new Promise(function(e,a){var r={channel:i.id,oldest:t,count:n,inclusive:1,ignore_replies:true,include_pin_count:true};TS.api.call("conversations.history",r).then(function(t){if(!t||!t.data||0===t.data.messages.length)if(i._archive_msgs&&i._archive_msgs.length>0)e(i._archive_msgs[0]);else a(new Error("api_call_failed"));else{var n=t.data.messages;for(var r=n.length-1;r>=0;r-=1){var s=n[r];if(!TS.utility.msgs.isMsgReply(s)&&!("pinned_item"===s.subtype))e(s.ts)}a(new Error("no_visible_message_found"))}})}).then(function(e){return e},function(a){if("no_visible_message_found"===a.message)return e(i,t,10*n);throw a})};var n=function i(t,n){if(!n)n=TS.interop.datetime.toDateObject(TS.shared.getActiveModelOb().created);var a=Date.now();var r=a;TS.ui.date_picker.start(t,{first_day:window.moment.localeData().firstDayOfWeek()||0,hide_on_select:true,select_year:false,flat:true,date:r,min:n,max:a,title_format:"ja-JP"===TS.i18n.locale()?"Y年B":"B Y",locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()},change:function i(){r=$(this).pickmeup("get_date");e(r);TS.menu.$menu.css("opacity",0);TS.menu.end()},hide:function e(){window.setTimeout(function(){if($(this).pickmeup)$(this).pickmeup("destroy")}.bind(this),0)}});t.pickmeup("show")};var a=7})()},3609:function(e,i){(function(){TS.registerModule("ui.paste",{catcher_div:null,onStart:function e(){if(!window.Clipboard){TS.ui.paste.catcher_div=document.createElement("div");TS.ui.paste.catcher_div.setAttribute("tabindex","-1");TS.ui.paste.catcher_div.setAttribute("contenteditable","");TS.ui.paste.catcher_div.setAttribute("class","offscreen");document.body.appendChild(TS.ui.paste.catcher_div)}var i=86;$(window.document).keydown(function(e){if(!TS.ui.paste.okToGo())return;if(TS.utility.cmdKey(e)&&e.which==i){if(!TS.ui.paste.catcher_div)return;if(e.altKey)return;if(!TS.utility.isFocusOnInput())TS.ui.paste.catcher_div.focus()}});$(window).bind("paste",TS.ui.paste.handler)},okToGo:function e(){if(TS.web)return true;if(TS.client&&!TS.client.ui.$msg_input)return false;if(!TS.utility.isFocusOnInput()||TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input))return true;return false},handler:function e(i){if(!TS.ui.paste.okToGo())return;i=i.originalEvent||i;var t=TS.model.shift_key_pressed;if(window.desktop&&window.desktop.app.getModifierKeys){var n=window.desktop.app.getModifierKeys();t=t||n&&n.shift}if(!(TS.model.is_FF&&bowser.version<50)&&i.clipboardData){var a=TS.ui.paste.detectImageFromEvent(i);if(a){i.preventDefault();if(i.clipboardData.items)TS.client.ui.file_pasted_sig.dispatch(a,t);else TS.ui.paste.startUploadFromMacSSBReadImage(a,t)}else if(!TS.model.is_FF&&i.clipboardData.items&&TS.client&&!TS.utility.isFocusOnInput())TS.utility.contenteditable.paste(TS.client.msg_input.$input,i)}else{var r=i.clipboardData&&i.clipboardData.types;var s;if(r&&_.includes(r,"text/plain"))s=i.clipboardData.getData("text");setTimeout(TS.ui.paste.checkCatcher,0,t,s)}},supportsUploadOnPaste:function e(){return!TS.model.is_IE},detectImageFromEvent:function e(i){var t;var n;var a=i.clipboardData.items;var r={};if(a){for(t=0;t<a.length;t+=1)if(a[t])r[a[t].type]=true;for(t=0;t<a.length;t+=1)if(-1!==a[t].type.indexOf("image"))if(TS.model.is_mac&&r["text/plain"]&&r["text/html"]&&r["text/rtf"])TS.info("Ignoring pasted image data, likely from Office/Word for Mac.");else if(TS.model.is_win&&r["text/plain"]&&r["text/html"]&&r["image/png"])TS.info("Ignoring pasted image data from Windows, which should render as text");else{n=a[t].getAsFile();if(null!==n)return n}}else{TS.warn("no clipboardData.items");var s=i.clipboardData.types||[];for(t=0;t<s.length;t+=1)if(s[t])r[s[t]]=true;var o=window.winssb;if(o&&o.clipboard&&o.clipboard.readImage)if(!r["text/rtf"]&&o.clipboard.readImage())return o.clipboard.readImage()}return false},startUploadFromMacSSBReadImage:function e(i,t){var n=document.getElementById("converter_canvas");if(!n){$("body").append('<canvas id="converter_canvas" class="offscreen"></canvas>');n=document.getElementById("converter_canvas")}var a=n.getContext("2d");var r=new Image;r.src="data:image/tiff;base64,"+i;r.onload=function(){n.width=r.width;n.height=r.height;a.clearRect(0,0,n.width,n.height);a.drawImage(r,0,0);var e=TS.utility.base64StrFromDataURI(n.toDataURL("image/png"));TS.client.ui.file_pasted_sig.dispatch(e,t)}},checkCatcher:function e(i,t){var n=TS.ui.paste.catcher_div;if(!n)return;var a=n.childNodes[0];var r=TS.utility.contenteditable.value(TS.client.ui.$msg_input);var s=t;if(!s){s="textContent"in n?n.textContent:n.innerText;s=$.trim(s)}var o;var l;if(a)if("IMG"===a.tagName)TS.client.ui.file_pasted_sig.dispatch(TS.utility.base64StrFromDataURI(a.src),i);else{if(r){l=TS.client.ui.$msg_input.getCursorRange();var d=l.l;var c=l.s;var _=r.substr(0,c);var u=r.substr(c+d);o=_+s+u}else o=s;TS.client.msg_input.populate(o)}n.innerHTML="";if(l)TS.client.ui.$msg_input.setCursorPosition(l.s+l.l+s.length)},getPlainTextFromClipboard:function e(i){if(i&&i.clipboardData)return i.clipboardData.getData("text/plain");if(window.clipboardData)return window.clipboardData.getData("Text");return null}})})()},3610:function(e,i){(function(){TS.registerModule("utility.window",{onStart:function i(){e=!!window.winssb},open:function i(r){r=_.defaults(r,t);r.width=m(r.width);r.height=f(r.height);r.x=r.x||c(r.width);r.y=r.y||u(r.width);return e?a(r):n(r)},alwaysOpenInBrowser:function i(t){var n=window.open(t);if(!e)try{n.focus()}catch(e){h()}},get:function i(t){if(e)return;return s(t)}});var e;var i={};var t={title:"",url:"about:blank",show:true,width:590,height:520,no_spinner:true,allowThirdPartyNavigation:true,try_window_open_in_ssb:false};var n=function e(i){var t=window.open(i.url,i.title,d(i));try{t.focus()}catch(e){h();return}return r(t)};var a=function e(i){if(i.try_window_open_in_ssb){var t=window.open(i.url,i.title,d(i));try{t.focus();return Date.now()}catch(e){TS.warn(e)}}return TS.client.windows.openWindow(i)};var r=function t(n){if(e||!l(n))return;o();var a=Date.now();i[a]=n;return a};var s=function e(t){o();return i[t]};var o=function e(){i=_.pickBy(i,function(e){return l(e)&&!e.closed})};var l=function e(i){return i===i.window};var d=function e(i){var t={left:i.x,top:i.y,width:i.width,height:i.height,menubar:0,toolbar:0};return _.toPairs(t).map(function(e){return e.join("=")}).join(",")};var c=function e(i){var t=window.screenX||window.screenLeft;var n=window.outerWidth||document.documentElement.offsetWidth;return t+(n-i)/2};var u=function e(i){var t=window.screenY||window.screenTop;var n=window.outerHeight||document.documentElement.offsetHeight;return t+(n-i)/2};var m=function e(i){var t=window.outerWidth||document.documentElement.offsetWidth;if(i>t)i=t;return i};var f=function e(i){var t=window.outerHeight||document.documentElement.offsetHeight;if(i>t)i=t;return i};var h=function e(){if(bowser&&bowser.name)$("#allow_popups_banner_browser").text(bowser.name);TS.ui.banner.show("allow_popups")}})()},3637:function(e,i){(function(){TS.registerModule("ui.shortcuts_dialog",{$div:null,showing:false,is_space:false,onStart:function e(){},onKeydown:function e(i){if(!TS.ui.shortcuts_dialog.showing)return;if(i.which==TS.utility.keymap.enter||i.which==TS.utility.keymap.esc){TS.ui.shortcuts_dialog.cancel();i.preventDefault()}if(70==i.which&&TS.utility.cmdKey(i))i.preventDefault()},start:function e(){TS.ui.shortcuts_dialog.is_space=TS.web&&TS.web.space;TS.tips.hideAll();if(!TS.ui.shortcuts_dialog.$div)TS.ui.shortcuts_dialog.build();var i=TS.templates.shortcuts_dialog({meta_key:TS.model.is_mac?TS.i18n.t("Option","keys")():TS.i18n.t("Alt","keys")(),cmd_key:TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")(),cmd_key_label:TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")(),can_show_a11y_keyboard_shortcuts:TS.boot_data.feature_a11y_keyboard_shortcuts,can_show_unread_view:TS.client&&TS.client.unread.isEnabled(),show_browse_dms_shortcut:true});if(TS.ui.shortcuts_dialog.is_space)i=TS.templates.shortcuts_spaces_dialog({clear_formatting:!TS.model.is_win,meta_key:TS.model.is_mac?TS.i18n.t("Option","keys")():TS.i18n.t("Alt","keys")(),cmd_key:TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")(),cmd_key_label:TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")()});var t=TS.ui.shortcuts_dialog.$div;t.html(i).modal("show").find(".dialog_cancel").click(TS.ui.shortcuts_dialog.cancel);if(!TS.ui.shortcuts_dialog.is_space)TS.ui.a11y.saveCurrentFocusAndFocusOnElement(t)},cancel:function e(){TS.ui.shortcuts_dialog.$div.modal("hide")},end:function e(){TS.model.dialog_is_showing=false;TS.ui.shortcuts_dialog.showing=false;TS.ui.shortcuts_dialog.$div.empty();$(window.document).unbind("keydown",TS.ui.shortcuts_dialog.onKeydown);if(!TS.ui.shortcuts_dialog.is_space)TS.ui.a11y.restorePreviousFocusAndCleanUpElement(TS.ui.shortcuts_dialog.$div);TS.tips.unhideAll()},build:function e(){var i;if(TS.ui.shortcuts_dialog.is_space){$("body").append('<div id="shortcuts_spaces_dialog" class="modal hide fade"></div>');TS.ui.shortcuts_dialog.$div=$("#shortcuts_spaces_dialog");i=TS.ui.shortcuts_dialog.$div}else{$("body").append('<div id="shortcuts_dialog" class="modal hide fade"></div>');TS.ui.shortcuts_dialog.$div=$("#shortcuts_dialog");i=TS.ui.shortcuts_dialog.$div}i.on("hidden",function(e){if(e.target!=this)return;TS.ui.shortcuts_dialog.end()});i.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.shortcuts_dialog.showing=true});i.on("shown",function(e){if(e.target!=this)return;$(window.document).bind("keydown",TS.ui.shortcuts_dialog.onKeydown);TS.ui.shortcuts_dialog.height=i.outerHeight()+i.offset().top;TS.ui.shortcuts_dialog.width=i.outerWidth();TS.ui.shortcuts_dialog.toggleScrollbars();$(window).on("resize",TS.ui.shortcuts_dialog.toggleScrollbars)})},toggleScrollbars:function e(){if(!TS.ui.shortcuts_dialog.showing)return;var i=TS.ui.shortcuts_dialog.width>$(window).width();var t=TS.ui.shortcuts_dialog.height>$(window).height()||i;TS.ui.shortcuts_dialog.$div.toggleClass("single_column",i);TS.ui.shortcuts_dialog.$div.toggleClass("scroll_content",t)}})})()},3638:function(e,i){(function(){TS.registerModule("coachmarks",{coachmarks:{shared_channels_create:{id:"shared_channels_coachmark",coachmark_el_id:"shared_channels_coachmark_div",place:function e(){var i=$('[data-qa-channel-sidebar-section-heading="shared_channels"] .p-channel_sidebar__section_heading_plus').length?"shared_channels":"channels";TS.coachmark.placeRightOf($('[data-qa-channel-sidebar-section-heading="'+i+'"] .p-channel_sidebar__section_heading_plus'),-26,19,5)},content:function e(){return TS.templates.shared_channels_coachmark({show_create_button:true,without_animation:!TS.prefs.getPref("a11y_animations")})},resolve:function e(){TS.ui.share_channel_dialog.start({element:"shared_channels_coachmark_create_btn"})},no_footer:true},shared_channels_get_started:{id:"shared_channels_coachmark",coachmark_el_id:"shared_channels_coachmark_div",place:function e(){var i=$('[data-qa-channel-sidebar-section-heading="shared_channels"] .p-channel_sidebar__section_heading_plus').length?"shared_channels":"channels";TS.coachmark.placeRightOf($('[data-qa-channel-sidebar-section-heading="'+i+'"] .p-channel_sidebar__section_heading_plus'),-26,19,5)},content:function e(){return TS.templates.shared_channels_coachmark({without_animation:!TS.prefs.getPref("a11y_animations")})},resolve:function e(){TS.ui.shared_channels_open_beta_modal.showModal({show_create_button_only:true})},no_footer:true},channels:{id:"channels_coachmark",coachmark_el_id:"channels_coachmark_div",place:function e(){TS.coachmark.placeRightOf($('[data-qa-channel-sidebar-section-heading="channels"]'),-26,-5,5)},content:function e(){var i=TS.channels.getChannelsForUser().length;var t=TS.groups.getUnarchivedGroups().length;var n=TS.groups.getUnarchivedGroups().length?TS.groups.getUnarchivedGroups()[0].name:"";var a={channels_count:i,groups_count:t,total_count:i+t,first_group_channel_name:n,in_single_private_channel:!i&&1===t};return TS.templates.channels_coachmark(a)}},invites:{id:"invites_coachmark",coachmark_el_id:"invites_coachmark_div",place:function e(){TS.coachmark.placeRightOf($(".p-channel_sidebar__link--invites"),-26,-5,5)},content:function e(){return TS.templates.invites_coachmark()}},direct_messages:{id:"direct_messages_coachmark",coachmark_el_id:"direct_messages_coachmark_div",place:function e(){TS.coachmark.placeRightOf($('[data-qa-channel-sidebar-section-heading="ims"]'),-26,-5,5)},content:function e(){var i={channels_count:TS.channels.getChannelsForUser().length,groups_count:TS.groups.getUnarchivedGroups().length};return TS.templates.direct_messages_coachmark(i)}},highlights_feedback:{id:"highlights_feedback_coachmark",coachmark_el_id:"highlights_feedback_coachmark_div",inline_wrapper_el_class:"highlights_feedback_to_coach",no_bg:true,has_close_btn:true,place:function e(){TS.coachmark.placeBelowOf($(".highlights_feedback_to_coach"),40,-330,340,true)},content:function e(){return TS.templates.highlights_feedback_coachmark()},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()}},recent_mentions:{id:"recent_mentions_coachmark",coachmark_el_id:"recent_mentions_coachmark_div",no_bg_on_small:true,place:function e(){TS.coachmark.placeBelowOf($("#recent_mentions_toggle"),25,-340,1)},placeSmall:function e(){TS.coachmark.placeBelowOf($("#recent_mentions_toggle"),25,-240,1)},content:function e(){return TS.templates.recent_mentions_coachmark()}},starred_items:{id:"starred_items_coachmark",coachmark_el_id:"starred_items_coachmark_div",no_bg_on_small:true,place:function e(){TS.coachmark.placeBelowOf($("#stars_toggle"),25,-340,3)},placeSmall:function e(){TS.coachmark.placeBelowOf($("#stars_toggle"),25,-220,8)},content:function e(){return TS.templates.starred_items_coachmark()}},unread_view:{id:"unread_view_coachmark",coachmark_el_id:"unread_view_coachmark_div",place:function e(){TS.coachmark.placeRightOf($(".p-channel_sidebar__link--all-unreads"),-16)},content:function e(){return TS.templates.unread_view_coachmark()}},calls_screen_share_window:{id:"calls_screen_share_window_coachmark",coachmark_el_id:"calls_screen_share_window_coachmark_div",place:function e(){TS.coachmark.placeAboveOf($("#screen"),0,-180,12)},buttonText:function e(){return TS.i18n.t("Got It","coachmarks")()},content:function e(){return TS.templates.calls_screen_share_window_coachmark()},ui_click:true},calls_interactive_screen_share:{id:"calls_interactive_screen_share_coachmark",coachmark_el_id:"calls_interactive_screen_share_coachmark_div",place:function e(){TS.coachmark.placeBelowOf($(".call_icon"),17,-25,5)},buttonText:function e(){return TS.i18n.t("Got It","coachmarks")()},content:function e(){return TS.templates.calls_interactive_screen_share_coachmark()}},gdrive:{id:"gdrive_coachmark",coachmark_el_id:"gdrive_coachmark_div",place:function e(){TS.coachmark.placeAboveOf($("#primary_file_button"),13,-6,0)},content:function e(){return TS.templates.gdrive_coachmark()}},intl_channel_names:{id:"intl_channel_names_coachmark",coachmark_el_id:"intl_channel_names_coachmark_div",place:function e(){TS.coachmark.placeBelowOf($(".title_input"),70,105,20)},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()},content:function e(){return TS.templates.intl_channel_names_coachmark()}}},onStart:function e(){}})})()},4911:function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=t(4912);var a=t.n(n);var r=t(4913);var s=t.n(r);var o=t(4914);var l=t.n(o);var d=t(4915);var c=t.n(d);var _=t(4916);var u=t.n(_);var m=t(4917);var f=t.n(m);var h=t(4918);var g=t.n(h);var p=t(4919);var S=t.n(p);var T=t(4920);var v=t.n(T);var b=t(4921);var w=t.n(b);var y=t(4922);var A=t.n(y);var k=t(4923);var C=t.n(k);var M=t(4924);var I=t.n(M);var x=t(4925);var E=t.n(x);var B=t(4926);var P=t.n(B);var $=t(4927);var D=t.n($);var U=t(4928);var F=t.n(U);var O=t(4929);var R=t.n(O);var N=t(4930);var H=t.n(N);var Q=t(4931);var L=t.n(Q);var G=t(4932);var j=t.n(G);var K=t(4933);var W=t.n(K);var V=t(4934);var q=t.n(V);var z=t(4935);var Y=t.n(z);var J=t(4936);var Z=t.n(J);var X=t(4937);var ee=t.n(X);var ie=t(4938);var te=t.n(ie);var ne=t(4939);var ae=t.n(ne);var re=t(4940);var se=t.n(re);var oe=t(4941);var le=t.n(oe);var de=t(3597);var ce=t.n(de);var _e=t(4942);var ue=t.n(_e);var me=t(2671);var fe=t.n(me);var he=t(681);var ge=t.n(he);var pe=t(2672);var Se=t.n(pe);var Te=t(2673);var ve=t.n(Te);var be=t(4943);var we=t.n(be);var ye=t(4944);var Ae=t.n(ye);var ke=t(4945);var Ce=t.n(ke);var Me=t(4946);var Ie=t.n(Me);var xe=t(3609);var Ee=t.n(xe);var Be=t(4947);var Pe=t.n(Be);var $e=t(2679);var De=t.n($e);var Ue=t(4948);var Fe=t.n(Ue);var Oe=t(4949);var Re=t.n(Oe);var Ne=t(4950);var He=t.n(Ne);var Qe=t(4951);var Le=t.n(Qe);var Ge=t(4952);var je=t.n(Ge);var Ke=t(3454);var We=t.n(Ke);var Ve=t(3638);var qe=t.n(Ve);var ze=t(4953);var Ye=t.n(ze);var Je=t(4954);var Ze=t.n(Je);var Xe=t(4955);var ei=t.n(Xe);var ii=t(4956);var ti=t.n(ii);var ni=t(3606);var ai=t.n(ni);var ri=t(4957);var si=t.n(ri);var oi=t(3637);var li=t.n(oi);var di=t(4958);var ci=t.n(di);var _i=t(4959);var ui=t.n(_i);var mi=t(344);var fi=t.n(mi);var hi=t(4960);var gi=t.n(hi);var pi=t(4961);var Si=t.n(pi);var Ti=t(4962);var vi=t.n(Ti);var bi=t(4963);var wi=t.n(bi);var yi=t(4964);var Ai=t.n(yi);var ki=t(4965);var Ci=t.n(ki);var Mi=t(4966);var Ii=t.n(Mi);var xi=t(4967);var Ei=t.n(xi);var Bi=t(4968);var Pi=t.n(Bi);var $i=t(345);var Di=t.n($i);var Ui=t(4969);var Fi=t.n(Ui);var Oi=t(4970);var Ri=t.n(Oi);var Ni=t(4971);var Hi=t.n(Ni);var Qi=t(4972);var Li=t.n(Qi);var Gi=t(3610);var ji=t.n(Gi);var Ki=t(4973);var Wi=t.n(Ki);var Vi=t(3449);var qi=t.n(Vi);var zi=t(4974);var Yi=t.n(zi);var Ji=t(4975);var Zi=t.n(Ji);var Xi=t(4976);var et=t.n(Xi);var it=t(4977);var tt=t.n(it);var nt=t(4978);var at=t.n(nt);var rt=t(4979);var st=t.n(rt);var ot=t(3598);var lt=t.n(ot);var dt=t(3608);var ct=t.n(dt);var _t=t(4980);var ut=t.n(_t);var mt=t(4981);var ft=t.n(mt);var ht=t(4982);var gt=t.n(ht);var pt=t(4983);var St=t.n(pt);var Tt=t(4984);var vt=t.n(Tt);var bt=t(4985);var wt=t.n(bt);var yt=t(4986);var At=t.n(yt);var kt=t(4987);var Ct=t.n(kt);var Mt=t(4988);var It=t.n(Mt);var xt=t(4989);var Et=t.n(xt);var Bt=t(4990);var Pt=t.n(Bt);var $t=t(4991);var Dt=t.n($t);var Ut=t(4992);var Ft=t.n(Ut);var Ot=t(3586);var Rt=t.n(Ot);var Nt=t(3587);var Ht=t.n(Nt);var Qt=t(4993);var Lt=t.n(Qt);var Gt=t(4994);var jt=t.n(Gt);var Kt=t(4995);var Wt=t.n(Kt);var Vt=t(4996);var qt=t.n(Vt);var zt=t(4997);var Yt=t.n(zt);var Jt=t(4998);var Zt=t.n(Jt);var Xt=t(4999);var en=t.n(Xt);var tn=t(5e3);var nn=t.n(tn);var an=t(5001);var rn=t.n(an);var sn=t(5002);var on=t.n(sn);var ln=t(5003);var dn=t.n(ln);var cn=t(5004);var _n=t.n(cn)},4912:function(e,i){var t=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]}return e};(function(){TS.registerModule("client",{before_login_sig:new signals.Signal,login_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,flexpane_display_switched_sig:new signals.Signal,core_url:null,onStart:function e(){TS.client.core_url=document.location.href.split(/\/+messages/)[0]+"/messages";TS.model.ui_state=TS.storage.fetchUIState();TS.model.initial_ui_state_str=TS.model.ui_state?JSON.stringify(TS.model.ui_state):"none";TS.model.flex_name_in_url=TS.utility.getFlexNameFromUrl(location.href).toLowerCase();TS.model.flex_extra_in_url=TS.utility.getFlexExtraFromUrl(location.href);if(-1==TS.model.flex_names.indexOf(TS.model.flex_name_in_url)){TS.model.flex_name_in_url="";TS.model.flex_extra_in_url=""}if(TS.model.flex_name_in_url&&"search"!==TS.model.flex_name_in_url){TS.model.ui_state.flex_name=TS.model.flex_name_in_url;TS.model.ui_state.flex_extra=TS.model.flex_extra_in_url||""}if("list"===TS.model.ui_state.flex_name)TS.model.ui_state.flex_name="files";if("activity"===TS.model.ui_state.flex_name)TS.model.ui_state.flex_name="mentions";if(TS.boot_data.feature_deprecate_files&&"files"===TS.model.ui_state.flex_name)TS.model.ui_state.flex_extra_type=TS.utility.getFlexExtraTypeFromUrl(location.href).toLowerCase();TS.model.ui_state.flex_visible=!!TS.model.ui_state.flex_name;TS.storage.storeUIState(TS.model.ui_state);var i=$("body");if(TS.boot_data.feature_file_threads)i.addClass("feature_file_threads");if(TS.boot_data.feature_min_web&&TS.model.is_electron){if(!window.desktop)TS.error("TS.model.is_electron is true, but window.desktop is not present");if(window.desktop&&desktop.teams&&desktop.teams.setTeamIdleTimeout)U()}TS.client.user_added_to_team_sig.add(TS.client.userAddedToTeam);TS.client.user_removed_from_team_sig.add(TS.client.userRemovedFromTeam);TS.redux.socket.troubleConnectingSig.add(TS.client.showConnectionTroubleDialog)},isEnhancedDebuggingEnabled:function e(){return!!k},gogogo:function e(){$(window).bind("popstate",h)},updateTeamIcon:function e(){if(TS.model.team.icon)if(TS.model.team.icon.image_68&&true!==TS.model.team.icon.image_default)if(window.winssb)TSSSB.call("setImage",TS.model.team.icon);else TSSSB.call("setImage",TS.model.team.icon.image_68);else TSSSB.call("setImage",false)},markLastReadsWithAPI:function e(){if(TS.isPartiallyBooted())return;var i=TS.redux.channels.getAllIdsNeedingMarking();i.forEach(TS.client.markEntityReadWithAPI);if(i.length)TS.redux.channels.clearAllMarkingFlags()},markUnmutedLastReadsWithAPI:function e(){if(TS.isPartiallyBooted())return;var i=TS.redux.channels.getAllUnmutedIdsNeedingMarking();i.forEach(TS.client.markEntityReadWithAPI);if(i.length)TS.redux.channels.clearMarkingFlagsForIds(i)},markMutedLastReadsWithAPI:function e(){if(TS.isPartiallyBooted())return;var i=TS.redux.channels.getAllMutedIdsNeedingMarking();i.forEach(TS.client.markEntityReadWithAPI);if(i.length)TS.redux.channels.clearMarkingFlagsForIds(i)},markEntityReadWithAPI:function e(i){var t=TS.redux.channels.getEntityById(i);if(!t)return;TS.model.last_reads_set_by_client[t.id+"_"+t.last_read]=true;var n="muted"===t._marked_reason;var a=TS.channels.onMarked;if(TS.redux.channels.isGroup(t))a=TS.groups.onMarked;else if(TS.redux.channels.isIm(t)){a=TS.ims.onMarked;n=void 0}else if(TS.redux.channels.isMpim(t))a=TS.mpims.onMarked;TS.api.call("conversations.mark",{channel:i,ts:t.last_read,reason:t._marked_reason},null,n).then(function(e){var i=e.data,t=e.args,n=e.request_id;var r=true;if(a)a(r,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var r=false;if(a)a(r,i,t,n);return{data:i,args:t,request_id:n}})},activeChannelDisplayGoneAway:function e(){TS.model.active_history.pop();var i;var t;var n;var a=function e(i){TS.model.active_history.push(i.id);TS.model.active_channel_id=null;TS.model.active_im_id=null;TS.model.active_group_id=null;TS.model.active_mpim_id=null;if(i.is_im)TS.model.active_im_id=i.id;else if(i.is_mpim&&i.is_group)TS.model.active_mpim_id=i.id;else if(i.is_group)TS.model.active_group_id=i.id;else if(i.is_channel)TS.model.active_channel_id=i.id;TS.model.active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id};while(TS.model.active_history.length&&!n){i=TS.model.active_history.pop();t=TS.shared.getModelObById(i);if(t.is_im&&t.is_open){n=true;if(TS.has_pri[N])TS.log(N,"switching to im "+t.id);if(TS.client.activeChannelIsHidden())return a(t);TS.ims.displayIm(t.id);TS.client.channelDisplaySwitched({id:t.id})}else if(t.is_mpim&&t.is_group&&t.is_open){n=true;if(TS.has_pri[N])TS.log(N,"switching to mpim "+t.id);if(TS.client.activeChannelIsHidden())return a(t);TS.mpims.displayMpim({id:t.id,replace_history_state:true})}else if(t.is_group&&!t.is_archived&&!t.is_mpim){n=true;if(TS.has_pri[N])TS.log(N,"switching to group "+t.id);if(TS.client.activeChannelIsHidden())return a(t);TS.groups.displayGroup({id:t.id})}else if(t.is_channel){n=true;if(TS.has_pri[N])TS.log(N,"switching to channel "+t.id);if(TS.client.activeChannelIsHidden())return a(t);TS.channels.displayChannel({id:t.id,replace_history_state:true})}}if(!TS.model.active_history.length){var r=TS.channels.getUnarchivedChannelsForUser();var s=TS.groups.getUnarchivedGroups();if(r.length>0){var o=_.find(r,{is_member:true})||r[0];if(TS.client.activeChannelIsHidden())return a(o);TS.channels.displayChannel({id:o.id,replace_history_state:true});return}else if(s.length>0){if(TS.client.activeChannelIsHidden())return a(s[0]);TS.groups.displayGroup({id:s[0].id});return}TS.error("WTF no channel or group to display?")}},flexDisplaySwitched:function e(i,t,n,a){t=p(t);n=true;if(!a&&(TS.model.c_name_in_url||TS.client.activeChannelIsHidden())){var r=function(){if(TS.model.unread_view_is_showing)return"/unreads";if(TS.model.threads_view_is_showing)return"/threads";if(TS.model.home_screen_view_is_showing)return"/zen";if(TS.model.apps_dashboard_view_is_showing)return"/dashboard";return"/messages/"+TS.model.c_name_in_url}();var s=TS.utility.refashionUrl(window.location.href,r,i,t);S(s,n)}var o=TS.model.ui_state.flex_name;var l=TS.model.ui_state.flex_extra;TS.model.flex_name_in_url=i;TS.model.flex_extra_in_url=t;TS.model.ui_state.flex_name=i;TS.model.ui_state.flex_extra=t;TS.model.ui_state.prev_flex_name=o;TS.model.ui_state.prev_flex_extra=l;TS.storage.storeUIState(TS.model.ui_state);TS.client.flexpane_display_switched_sig.dispatch(o,l)},channelDisplaySwitched:function e(i){var t=_.defaults({},i,{from_history:false,replace_history_state:false});var n=t.id;if(!n){TS.error("no model id supplied");return}var a=t.replace_history_state;var r=t.no_history_add;if(!n){TS.error("no model_ob_id?");return false}var s=TS.shared.getModelObById(n);if(!s){TS.error("unknown model_ob id: "+n);return false}var o=s.id;var l=t.channel_path||"/messages/"+o;if(!r){var d=p(TS.model.flex_extra_in_url);var c=TS.utility.refashionUrl(window.location.href,l,TS.model.flex_name_in_url,d);S(c,!TS.model.c_name_in_url||a)}TS.model.c_name_in_url=o;if(!TS.client.activeChannelIsHidden()){if(s.is_channel&&n==TS.model.active_channel_id){TS.warn("not switching, it is the active channel already");return false}if(s.is_im&&n==TS.model.active_im_id){TS.warn("not switching, it is the active im already");return false}if(s.is_mpim&&n==TS.model.active_mpim_id){TS.warn("not switching, it is the active mpim already");return false}if(s.is_group&&n==TS.model.active_group_id){TS.warn("not switching, it is the active group already");return false}}TS.utility.msgs.checkForMsgsToTruncate();TS.model.last_active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id;TS.model.active_channel_id=null;TS.model.active_im_id=null;TS.model.active_group_id=null;TS.model.active_mpim_id=null;TS.model.unread_view_is_showing=false;TS.model.threads_view_is_showing=false;if(s.is_im)TS.model.active_im_id=n;else if(s.is_channel)TS.model.active_channel_id=n;else if(s.is_mpim&&s.is_group)TS.model.active_mpim_id=n;else if(s.is_group)TS.model.active_group_id=n;TS.model.active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id;TSSSB.call("displayChannel",TS.model.active_cid);TS.view.updateTitleWithContext();s.last_made_active=Date.now();var u=n;if(TS.has_pri[N])TS.log(N,u+" is now active");var m=TS.model.active_history;var f=m.indexOf(u);if(-1!=f)m.splice(f,1);m.push(u);if(TS.has_pri[N])TS.log(N,m);TS.storage.storeActiveHistory(m);TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem(u));return true},unreadViewActivated:function e(i,t){if(!t){var n=p(TS.model.flex_extra_in_url);var a=TS.utility.refashionUrl(window.location.href,"/unreads",TS.model.flex_name_in_url,n);if(!i)if(!TS.model.unread_view_is_showing&&!TS.model.c_name_in_url)i=true;S(a,i)}if(TS.model.unread_view_is_showing){TS.warn("not switching, unread view is already active");return false}TS.client.threads.destroyThreadsView();TS.model.threads_view_is_showing=false;if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if(TS.boot_data.feature_sli_home&&TS.client.ui.home_screen.isEnabled()&&TS.client.ui.home_screen.isShowing())TS.client.ui.home_screen.stop();if(TS.client.ui.apps_dashboard.isEnabled()&&TS.client.ui.apps_dashboard.isShowing())TS.client.ui.apps_dashboard.stop();TS.client.archives.cancel(true);TS.model.unread_view_is_showing=true;TS.view.updateTitleWithContext();if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.hideMessagePane());return true},threadsViewActivated:function e(i,t){if(!t){var n=p(TS.model.flex_extra_in_url);var a=TS.utility.refashionUrl(window.location.href,"/threads",TS.model.flex_name_in_url,n);if(!i)if(!TS.model.threads_view_is_showing&&!TS.model.c_name_in_url)i=true;S(a,i)}if(TS.model.threads_view_is_showing){TS.warn("not switching, threads view is already active");return false}if(TS.client.unread.isEnabled()){TS.client.unread.destroyUnreadView();TS.model.unread_view_is_showing=false}if(TS.boot_data.feature_sli_home&&TS.client.ui.home_screen.isEnabled()&&TS.client.ui.home_screen.isShowing())TS.client.ui.home_screen.stop();if(TS.client.ui.apps_dashboard.isEnabled()&&TS.client.ui.apps_dashboard.isShowing())TS.client.ui.apps_dashboard.stop();TS.model.threads_view_is_showing=true;TS.client.archives.cancel(true);TS.view.updateTitleWithContext();if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.hideMessagePane());return true},homeScreenViewActivated:function e(i,t){if(!t){var n=p(TS.model.flex_extra_in_url);var a=TS.utility.refashionUrl(window.location.href,"/zen",TS.model.flex_name_in_url,n);if(!i)if(!TS.model.home_screen_view_is_showing&&!TS.model.c_name_in_url)i=true;S(a,i)}if(TS.model.home_screen_view_is_showing){TS.warn("not switching, unread view is already active");return false}TS.client.threads.destroyThreadsView();TS.client.unread.destroyUnreadView();TS.model.threads_view_is_showing=false;TS.model.unread_view_is_showing=false;if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if(TS.client.ui.apps_dashboard.isEnabled()&&TS.client.ui.apps_dashboard.isShowing())TS.client.ui.apps_dashboard.stop();TS.model.home_screen_view_is_showing=true;TS.client.archives.cancel(true);TS.view.updateTitleWithContext();if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.hideMessagePane());return true},appsDashboardViewActivated:function e(i,t){if(!t){var n=p(TS.model.flex_extra_in_url);var a=TS.utility.refashionUrl(window.location.href,"/dashboard",TS.model.flex_name_in_url,n);if(!i)if(!TS.model.apps_dashboard_view_is_showing&&!TS.model.c_name_in_url)i=true;S(a,i)}if(TS.model.apps_dashboard_view_is_showing){TS.warn("not switching, dashboard view is already active");return false}TS.client.threads.destroyThreadsView();TS.client.unread.destroyUnreadView();TS.model.threads_view_is_showing=false;TS.model.unread_view_is_showing=false;if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if(TS.client.ui.home_screen.isEnabled()&&TS.client.ui.home_screen.isShowing())TS.client.ui.home_screen.stop();TS.model.apps_dashboard_view_is_showing=true;TS.client.archives.cancel(true);TS.view.updateTitleWithContext();if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.hideMessagePane());return true},calculateInitialCid:function e(){return T()},calculateInitialMessage:function e(){return v()},startCheckingForCleanup:function e(){f()},complianceExportStartChanged:function e(){u()},onFirstLoginMS:function e(){D("timing-www-perceived-load");I();g();if(!TS.useReactMessages()){setInterval(TS.client.markUnmutedLastReadsWithAPI,5e3);setInterval(TS.client.markMutedLastReadsWithAPI,3e4)}else setInterval(TS.client.markLastReadsWithAPI,5e3);f();TS.redux.socket.connectedSig.add(s);TS.redux.socket.connectedSig.addOnce(H);TS.channels.renamed_sig.add(n);TS.groups.renamed_sig.add(i);TS.members.changed_name_sig.add(r);TS.members.changed_account_type_sig.add(a);TS.view.members.unknown_resolution_rebuild_sig.add(r);TS.prefs.box_enabled_changed_sig.add(d);TS.prefs.dropbox_enabled_changed_sig.add(c);TS.prefs.compliance_export_start_changed_sig.add(u);TS.prefs.team_disallow_public_file_urls_changed_sig.add(m);if(TS.prefs.getTeamPref("compliance_export_start"))u();if(TS.model.mac_ssb_version&&!TS.prefs.getPref("no_macssb1_banner"))TS.prefs.setPrefByAPI({name:"no_macssb1_banner",value:true});if(window.winssb&&!TS.prefs.getPref("no_winssb1_banner"))TS.prefs.setPrefByAPI({name:"no_winssb1_banner",value:true});if(1==TS.qs_args.halt_at_loading_screen)throw new Error("Intentionally halting at loading screen");if(TS._incremental_boot)if(TS.client.ui&&TS.client.ui.$messages_input_container)TS.client.ui.$messages_input_container.addClass("pretend-to-be-online");$("#loading_welcome").transition({opacity:0},200,function(){$("#col_channels_bg").css("z-index",0);$("#loading-zone").transition({opacity:0},200,function(){$("body").removeClass("loading");TS.view.resizeManually("onFirstLoginMS");$("#loading-zone, #loading_zone_styles").remove();o();if(TS.model.initial_msg_ts){var e=TS.shared.getActiveModelOb();if(e&&e.id)TS.client.ui.tryToJump(e.id,TS.model.initial_msg_ts,TS.model.initial_thread_ts)}})});var t=TS.shared.getActiveModelOb();var l=t&&t.msgs&&(t.msgs.length>0||null===t.latest);if(TS.client.archives.current_model_ob);else if(l){TS.metrics.mark("content_visible");TS.metrics.measure("client_content_visible_4","start_nav","content_visible")}else if(t)TS.client.ui.record_content_visible_metric_after_fetching_model_ob=t.id;if(TS.experiment)TS.experiment.getGroup("perf_aa",["client_total_load","beachballs"])},onEveryLoginMS:function i(t){var n=TS.shared.getActiveModelOb();var a=TS.shared.getControllerForModelOb(n);var r=true;if(TS.i18n.locale()!==TS.prefs.getPref("locale")&&!TS.qs_args.locale)TS.prefs.locale_changed_sig.dispatch(TS.prefs.getPref("locale"));if(window.desktop&&desktop.teams&&desktop.teams.setTeamLocale)desktop.teams.setTeamLocale(TS.prefs.getPref("locale"));if(n&&!n.history_is_being_fetched)TS.shared.checkInitialMsgHistory(n,a);if(!TS.model.ms_logged_in_once){TS.log(850,Date.now()-TS.boot_data.start_ms+"ms from first html to login_sig.dispatch()");TS.client.before_login_sig.dispatch();TS.client.login_sig.dispatch()}if(r&&!TS.useReactMessages())if(TS.isPartiallyBooted()){if(t._incremental_boot_users_counts_resp){e=t._incremental_boot_users_counts_resp;A(e)}}else if(e){A(e);e=void 0}else y();TS.model.ims.forEach(function(e){if(e.id==TS.model.active_im_id)return;if(!e.is_open&&!TS.shared.hasUnreads(e))return;TS.shared.checkInitialMsgHistory(e,TS.ims,r)});TS.model.channels.forEach(function(e){if(e.id==TS.model.active_channel_id)return;if(!e.is_member)return;TS.shared.checkInitialMsgHistory(e,TS.channels,r)});TS.model.groups.forEach(function(e){if(e.id==TS.model.active_group_id)return;if(e.is_archived)return;TS.shared.checkInitialMsgHistory(e,TS.groups,r)});TS.model.mpims.forEach(function(e){if(e.id==TS.model.active_mpim_id)return;if(e.is_archived)return;if(!e.is_open&&!TS.shared.hasUnreads(e))return;TS.shared.checkInitialMsgHistory(e,TS.mpims,r)})},handleDeepLink:function e(i){i=decodeURIComponent(i);TS.info("handleDeepLink url:"+i);if(!i)return;if(!i.indexOf)return;if(-1==i.indexOf("://"))return;if(-1==i.indexOf("?"))return;var t=i.split("?");var n=t[0].split("://")[1];TS.info("handleDeepLink cmd:"+n);if(!n)return;var a=t[1];TS.info("handleDeepLink qs:"+a);var r=TS.interop.url.queryStringParse(a);TS.info("handleDeepLink qs_args:"+JSON.stringify(r,null,2));TS.client._handleParsedDeepLink(n,r)},handleDeepLinkWithArgs:function e(i){TS.info("handleDeepLinkWithArgs string:"+i);var t=TS.utility.parseJSONOrElse(i,null);if(!t)return;var n=t.cmd;if(!n)return;delete t.cmd;TS.client._handleParsedDeepLink(n,t)},_handleParsedDeepLink:function e(i,t){if(!t.team)return;if(t.team!=TS.model.team.id){TS.generic_dialog.alert(TS.i18n.t("Sorry, you tried to perform an action on a workspace you’re not yet logged into!","client")());return}var n=t.id;var a;if("channel"===i){a=TS.shared.getModelObById(n);if(!a)return TS.error(n+" is not a recognized channel/dm/group");if("false"===t.thread_ts)delete t.thread_ts;TS.client.ui.tryToJump(a.id,t.message,t.thread_ts);return}if("user"===i){var r=TS.members.getMemberById(n);if(!r)return TS.error(n+" is not a recognized member");if(!r.is_bot)TS.client.ui.previewMember(n);var s=TS.ims.getImByMemberId(n);if(!s)return TS.error("Could not get im channel for user "+n);a=TS.shared.getModelObById(s.id);if(!a)return TS.error(s+" is not a recognized dm");TS.client.ui.tryToJump(a.id,t.message);return}if("file"===i){TS.client.ui.files.previewFile(n);return}if("files"===i){var l=t.user_id||"all";var d=t.file_type||"all";var c;if(TS.interop.utility.looksLikeMemberId(l))c=TS.members.ensureMembersArePresent([l]);else if("all"===l)c=Promise.resolve();c.then(function(){TS.client.ui.files.filterFileList(d);TS.view.files.setButtonState(d);TS.client.ui.files.toggleFileList(l);TS.client.ui.files._displayFileList();TS.client.flexDisplaySwitched("files",null,false,true)})}if("team"===i)if(n)TS.client.ui.showTeamFromHistory(n);else TS.client.ui.showTeamFromHistory();if("invite"===i)o("invite_members");if("notifications"===i)o("notifications");if("preferences"===i){var _=t.section;o("preferences",_)}if("create"===i){var u=t.item;if("channel"===u)o("create_channel")}},manualReconnectNow:function e(){TS.interop.SocketManager.reconnectImmediately()},apiPaused:function e(i){var t;if(i.reason.API_ERROR)t=TS.i18n.t('We’re having trouble connecting to Slack. We’ll try again shortly, or you can <a onclick="TS.client.manualReconnectNow()">try now</a>.',"client")();else if(i.reason.SERVICE_DOWN){var n=TS.prefs.getTeamPref("custom_status_site");var a="https://status.slack.com/"+_.escape(n);t=TS.i18n.t('Slack is unavailable, but don’t worry — we’re on the case. <a href="{status_uri}">Check our status page</a> for updates.',"client")({status_uri:a})}else if(i.reason.OFFLINE)t=TS.i18n.t('Your computer seems to be offline. We’ll keep trying to reconnect, or you can <a onclick="TS.client.manualReconnectNow()">try now</a>.',"client")();if(TS.model.ms_logged_in_once){$("#connection_div").html(t).removeClass("hidden");TS.client.msg_pane.topMessagesBannerShown()}else{$("#loading_message_attribution").empty();$("#loading_message_attribution_img").remove();$("#loading_welcome_msg").html(t)}},apiUnpaused:function e(){if(TS.model.ms_logged_in_once){$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden()}else{$("#loading_message_attribution").empty();$("#loading_message_attribution_img").remove();$("#loading_welcome_msg").html(TS.i18n.t("Trying to log in again.","client")())}},displayModelObById:function e(i,t){var n=TS.shared.getModelObById(i);if(n){TS.client.displayModelOb(n,t);return true}return false},displayModelOb:function e(i,n){if(i.presence){if(n&&n.waitForDisplay)return TS.ims.promiseToStartImByMemberId(i.id,n&&n.from_history);return TS.ims.startImByMemberId(i.id,n&&n.from_history)}else if(i.is_im)return TS.ims.startImById(i.id,n&&n.from_history);else if(i.is_channel)return TS.channels.displayChannel(t({id:i.id},_.pick(n,"from_history","replace_history_state")));else if(i.is_mpim)return TS.mpims.displayMpim(t({id:i.id},_.pick(n,"from_history","replace_history_state")));else if(i.is_group)return TS.groups.displayGroup(t({id:i.id},_.pick(n,"from_history","replace_history_state")))},activateMsgRateLimit:function e(i){if(TS.model.is_msg_rate_limited)return;if(!i)i={};TS.model.is_msg_rate_limited=true;if(i.notify_user)TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("To stop overzealous bots from flooding channels, Slack sets a limit on flurries of messages. You are reading this, so you are not a bot. And yet — somehow — you hit this limit.","client")(),ephemeral_type:"disconnected_feedback",slackbot_feels:"sad_surprise"})},deactivateMsgRateLimit:function e(){if(!TS.model.is_msg_rate_limited)return;TS.model.is_msg_rate_limited=false},userAddedToTeam:function e(i,t){TS.info("You have been added to a team with the ID of "+i+".");if(!TS.model.is_our_app||!TS.model.is_electron)return;var n=TS.redux.enterprise.getEnterpriseId();var a={user_id:TS.model.user.id,enterprise_id:n,team_ids:i};if(!TS.shared.isRelevantTeam()){TS.info("This team is not relevant, ignoring user_added_to_team for "+i+".");return}TS.info("Attempting to sign in to team with ID of "+i,a);var r=TSSSB.call("getSignedInTeamIds");if(!r||!r.length){TS.warn("WTF no signed-in team IDs from app?",r);return}if(-1!==r.indexOf(i)){TS.info("User is already signed into team "+i+". Exiting.");F=_.union(F,[i]);return}TS.info("calling enterprise.teams.signin for team_id = "+i,a);return TS.api.call("enterprise.teams.signin",a).then(function(e){var n=e.data.teams;if(!n||!n.length){TS.warn("WTF no authed_teams from enterprise.teams.signin?");return}var a;_.each(n,function(e){if(e&&e.team_id==i){var n=document.domain.split(".").splice(1).join(".");a={name:TS.model.user.name,id:TS.model.user.id,team_id:i,team_name:e.team_name,team_url:"https://"+e.team_domain+"."+n,no_switch:t}}});if(a){TS.info("calling TSSSB didSignIn with app_params",a);TSSSB.call("didSignIn",a);TS.prefs.removeTeamFromEnterpriseExcluedTeamPref(i)}else TS.warn("WTF did not find matching authed team?",n)})},userRemovedFromTeam:function e(i){if(i!==TS.model.team.id){TS.info("You have been removed from the team with ID = "+i+".");return}if(TS.model._user_removed_from_team)return;TS.model._user_removed_from_team=true;TS.generic_dialog.start({body:"<p>"+TS.i18n.t("You have been removed from <strong>{team_name}</strong>.","client")({team_name:_.escape(TS.model.team.name)})+"</p>",show_cancel_button:false,esc_for_ok:true,go_button_text:TS.i18n.t("OK","client")(),onGo:function e(){if(_.includes(F,i)){TS.info("Was going to remove this team, but we were told to add them before the user hit ok to the original removal event.");F=_.remove(F,function(e){return e===i});return}if(TS.boot_data.feature_leave_workspace_improvements)TS.client.reloadOrRemoveTeam(i);else if(TS.model.is_our_app){TS.info("calling TSSSB.signOutAndRemoveTeam because user_removed_from_team with team_id = "+i);TSSSB.signOutAndRemoveTeam(i)}else TS.reload(null,"user_removed_from_team with team_id = "+i)}})},reloadOrRemoveTeam:function e(i){if(TS.model.is_our_app){TS.info("calling TSSSB.signOutAndRemoveTeam because user_removed_from_team with team_id = "+i);TSSSB.signOutAndRemoveTeam(i)}else TS.reload(null,"user_removed_from_team with team_id = "+i)},activeChannelIsHidden:function e(){if(TS.boot_data.feature_sli_home||TS.client.ui.apps_dashboard.isEnabled())return TS.model.unread_view_is_showing||TS.model.threads_view_is_showing||TS.model.home_screen_view_is_showing||TS.model.apps_dashboard_view_is_showing;return TS.model.unread_view_is_showing||TS.model.threads_view_is_showing},setClientLoadWatchdogTimer:function e(){if(null!==E){P("www-load-watchdog-v2",B);B*=2}if(B<3e5)E=window.setTimeout(TS.client.setClientLoadWatchdogTimer,B)},showConnectionTroubleDialog:function e(){TS.info("Showing connection trouble dialog :(");var i;if(TS.model.is_our_app)i=TS.i18n.t("We’ve seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.","ms")();else i=TS.i18n.t("We’ve seen this problem clear up with a restart of your browser, a solution which we suggest to you now only with great regret and self-loathing.","ms")();var t=TS.i18n.t("Connection trouble","ms")();TS.generic_dialog.start({title:t,body:TS.i18n.t("<p>Apologies, we’re having some trouble with your WebSocket connection.</p>","ms")()+"<p>"+i+"</p>",show_cancel_button:false,go_button_text:TS.i18n.t("OK","ms")(),esc_for_ok:true,onGo:function e(){TS.reload(null,"Connection trouble")}});TS.redux.socket.connectedSig.addOnce(function(){if(!TS.generic_dialog.is_showing)return;var e=_.get(TS.generic_dialog.current_setting,"title");if(e===t)TS.generic_dialog.cancel()})}});var e;var i=function e(i){if(i.id!=TS.model.active_group_id)return;if(TS.client.activeChannelIsHidden())return;TS.client.channelDisplaySwitched({id:i.id,replace_history_state:true})};var n=function e(i){if(i.id!=TS.model.active_channel_id)return;if(TS.client.activeChannelIsHidden())return;TS.client.channelDisplaySwitched({id:i.id,replace_history_state:true})};var a=function e(i){if(!i||i.id!=TS.model.user.id)return;var t;if(i.is_ultra_restricted)t=TS.i18n.t("Your account permissions have changed! You are now a single-channel guest of the workspace. You must now reload for the changes to take effect.","client")();else if(i.is_restricted)t=TS.i18n.t("Your account permissions have changed! You are now a multi-channel guest of the workspace. You must now reload for the changes to take effect.","client")();else t=TS.i18n.t("Your account permissions have changed! You are now a full member of the workspace. You must now reload for the changes to take effect.","client")();TS.generic_dialog.start({title:TS.i18n.t("Reload required","client")(),body:"<p>"+t+"</p>",show_cancel_button:false,esc_for_ok:true,go_button_text:TS.i18n.t("Reload","client")(),onGo:function e(){TS.reload()}})};var r=function e(i){if(TS.model.active_im_id&&i&&i.id){var t=TS.ims.getImByMemberId(i.id);if(!t||t.id!=TS.model.active_im_id)return;TS.client.channelDisplaySwitched({id:t.id,replace_history_state:true})}else if(TS.model.active_mpim_id&&i&&i.id){var n=TS.mpims.getMpimById(TS.model.active_mpim_id);if(!n||!i)return;var a=TS.membership.getUserChannelMembershipStatus(i.id,n);var r=a.is_known&&!a.is_member;if(r)return;TS.client.channelDisplaySwitched({id:n.id,replace_history_state:true})}};var s=function e(){TS.ims.checkForOldImsToClose();if(TS.shared){if(TS.has_pri[R])TS.log(R,"_socketConnected: calling TS.shared.maybeResetHistoryFetchedOnAll");TS.shared.maybeResetHistoryFetchedOnAll()}};var o=function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n=i||TS.qs_args.open;var a=t||TS.qs_args.section;if(!n)return;switch(n){case"create_channel":if(TS.redux.socket.isConnected()||TS.model.change_channels_when_offline)if(TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups())TS.ui.new_channel_modal.start();break;case"invite_members":if(TS.model.user.is_admin||!TS.prefs.getTeamPref("invites_only_admins")&&!TS.model.user.is_restricted)TS.ui.admin_invites.start();break;case"help":TS.help_modal.start();break;case"channel_membership":TS.client.channel_page.members_dialog.show(TS.shared.getActiveModelOb());break;case"notifications":TS.ui.prefs_dialog.start("notifications");break;case"preferences":TS.ui.prefs_dialog.start(a)}var r=TS.interop.url.removeUrlQueryStringValue(location.href,"open");r=TS.interop.url.removeUrlQueryStringValue(r,"section");S(r,true)};var l=function e(i,t,n,a){var r;var s;var o=i;var l=document.getElementById(o);var d="data-app-key";if(l)return;s=document.getElementsByTagName("head");if(s&&s[0])s=s[0];else s=document.body;r=document.createElement("script");r.setAttribute("async",true);if(t)r.setAttribute(d,t);r.id=o;r.src=n;if(s)s.appendChild(r);else if(TS.logError)TS.logError({message:a},"No target_node for TS.client._dynamicallyLoadJS")};var d=function e(){if(window.BoxSelect||!TS.prefs.getPref("box_enabled")||!boot_data.box_js_url)return;var i="boxjs";var t=boot_data.box_app_key;var n=boot_data.box_js_url;var a="_boxEnabledChanged: Could not append box script node";l(i,t,n,a)};var c=function e(){if(window.Dropbox)return;if(!TS.prefs.getPref("dropbox_enabled"))return;if(!boot_data.dropbox_js_url)return;var i="dropboxjs";var t=boot_data.dropbox_app_key;var n=boot_data.dropbox_js_url;var a="_dropboxEnabledChanged: Could not append dropbox script node";l(i,t,n,a)};var u=function e(){var i;var t;var n=$(".show_when_ce_enabled");var a=$(".show_when_ce_disabled");var r=$(".js_compliance_export_start");if(TS.prefs.getTeamPref("compliance_export_start")){r.html(TS.interop.datetime.toDate(TS.prefs.getTeamPref("compliance_export_start")));n.removeClass("hidden");a.addClass("hidden")}else{n.addClass("hidden");a.removeClass("hidden")}i=TS.shared.getActiveModelOb();if(!i)return;t=TS.members.getMemberById(i.user);if(!t)return;if(i.is_im)$("#im_meta").html(TS.templates.dm_badge({member:t,model_ob:i,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start")}))};var m=function e(){if(TS.prefs.getTeamPref("disallow_public_file_urls")){$(".file_public_link").remove();$("#file_public_link_revoker").remove()}};var f=function e(){setInterval(function(){if(TS.redux.socket.isConnected())TS.ims.checkForOldImsToClose();TS.utility.msgs.checkForMsgsToTruncate()},9e5)};var h=function e(){if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.close();if(TS.ui.jumper.is_showing)TS.ui.jumper.end();var i=history.location||document.location;TS.qs_args=TS.interop.url.queryStringParse(i.search.substring(1));var t=TS.utility.isUnreadViewPath(i.pathname);var n=TS.utility.isThreadsViewPath(i.pathname);var a=TS.boot_data.feature_sli_home&&TS.utility.isHomeScreenViewPath(i.pathname);var r=TS.client.ui.apps_dashboard.isEnabled()&&TS.utility.isAppsDashboardViewPath(i.pathname);var s=TS.utility.getFlexNameFromUrl(i.href);var o=TS.utility.getFlexExtraFromUrl(i.href);if(!t&&!n&&!a&&!r&&!TS.model.ui_state.flex_name&&TS.model.ui_state.details_tab_active){s="details";o=""}else{s=TS.model.ui_state.flex_name;o=TS.model.ui_state.flex_extra}if((t||n||a||r)&&"details"===s){s="";o=""}var l=TS.utility.getChannelNameFromUrl(i.href);var d=l.split(":");l=d[0];var c=d.length>1?d[1]:"";if(!TS.model.channels)return;var _;var u;var m;var f;var h;var g;var p=false;m=TS.shared.getModelObById(l);if(m){_=m.id;if(m.is_im)u=m;else if(m.is_mpim)g=m;else if(m.is_channel)f=m;else if(m.is_group)h=m}if(!_&&l){f=TS.channels.getChannelByName(l);if(f)_=f.id;else if(-1!=l.indexOf("@")){u=TS.ims.getImByUsername(l);if(u)_=u.id}if(!_){h=TS.groups.getGroupByName(l);if(h)_=h.id}if(!_){g=TS.mpims.getMpimByName(l);if(g&&g.is_open)_=g.id}}TS.info("_onPopState\nc_extra from new url:"+c+"\nflex_name from new url:"+s+"\nflex_extra from new url:"+o);if(_){p=true;TS.info("c_name from new url is good, using id = "+_)}else if(!t&&!n&&!a&&!r){if(TS.model.channels.length){f=TS.channels.getFirstChannelYouAreIn();if(f){_=f.id;TS.info("got getFirstChannelYouAreIn:"+_)}}if(!_&&TS.model.ims.length){u=TS.ims.getFirstOpenIm();if(u){_=u.id;TS.info("got getFirstOpenIm:"+_)}}}if(u)if(TS.useReactMessages())TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(u.id,{from_history:true}));else TS.ims.startImByMemberId(u.user,true);else if(f)if(TS.useReactMessages())TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(f.id,{from_history:true,replace_history_state:!p}));else TS.channels.displayChannel({id:f.id,from_history:true,replace_history_state:!p});else if(h)if(TS.useReactMessages())TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(h.id,{from_history:true,replace_history_state:!p}));else TS.groups.displayGroup({id:h.id,from_history:true,replace_history_state:!p});else if(g)if(TS.useReactMessages())TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(g.id,{from_history:true,replace_history_state:!p}));else TS.mpims.displayMpim({id:g.id,from_history:true,replace_history_state:!p});else if(t)TS.client.unread.showUnreadView(true,true);else if(n)TS.client.threads.showThreadsView(true,true);else if(a&&TS.boot_data.feature_sli_home&&TS.client.ui.home_screen.isEnabled())TS.client.ui.home_screen.start(true,true);else if(r&&TS.client.ui.apps_dashboard.isEnabled())TS.client.ui.apps_dashboard.start(true,true);else TS.error("WTF DONT KNOW WHAT TO DO");TS.client.ui.flex.setFlexStateFromHistory(s,o);var T=function(){if(t)return"/unreads";if(n)return"/threads";if(a)return"/zen";if(r)return"/dashboard";return"/messages/"+l}();var v=TS.utility.refashionUrl(window.location.href,T,s,o);var b=true;S(v,b)};var g=function e(){if(!TS.model.initial_cid){TS.error("TS.model.initial_cid was empty when _switchToInititalModelOb was called, which should be impossible");return}var i=TS.shared.getModelObById(TS.model.initial_cid);if(!i)TS.error("TS.model.initial_cid ("+TS.model.initial_cid+") referred to a channel that does not exist in _switchToInititalModelOb, which should be impossible");var t=true;if(i.is_im)if(i.is_open)TS.client.channelDisplaySwitched({id:i.id,replace_history_state:t});else TS.ims.startImByMemberId(i.user,t);else if(i.is_mpim&&i.is_group)TS.mpims.displayMpim({id:i.id,replace_history_state:t});else if(i.is_group&&!i.is_mpim)TS.groups.displayGroup({id:i.id,replace_history_state:t});else if(i.is_channel)TS.client.channelDisplaySwitched({id:i.id,replace_history_state:t});if(TS.model.initial_unread_view&&TS.prefs.getPref("enable_unread_view")){var n=true;TS.client.unread.showUnreadView(false,t,n)}if(TS.model.initial_threads_view)TS.client.threads.showThreadsView(false,t);if(TS.boot_data.feature_sli_home&&TS.model.initial_home_screen_view&&TS.client.ui.home_screen.isEnabled())TS.client.ui.home_screen.start(false,t);if(TS.client.ui.apps_dashboard.isEnabled()&&TS.model.initial_apps_dashboard_view)TS.client.ui.apps_dashboard.start(false,t)};var p=function e(i){if(!i)return i;if(-1!=i.indexOf("#"))i=i.replace(/#/g,"%23");if(-1!=i.indexOf("/"))i=i.replace(/\//g,"%252F");return i};var S=function e(i,t){if(!history.pushState){TS.warn("This browser does not support pushState.");return}if(window.location.href.replace(/%20/g," ")!==i.replace(/%20/g," "))if(t)window.history.replaceState(null,null,i);else window.history.pushState(null,null,i)};var T=function e(){if(TS.model.initial_cid){TS.client.calculateInitialMessage();return}var i=TS.storage.fetchActiveHistory();var t;var n;var a;var r;var s;var o;var l;var d=function e(){if(TS.model.welcome_model_ob&&TS.model.welcome_model_ob.id)return;var i=TS.ims.getImByMemberId("USLACKBOT");if(i)TS.model.welcome_model_ob=i;else{TS.error("Tried to lookup Slackbot but failed");TS.api.callImmediately("conversations.open",{users:"USLACKBOT"}).finally(function(){var e=TS.i18n.t("Slack has encountered a problem and needs to reload.","client")();var i=TS.i18n.t("Reload required","client")();var t=TS.i18n.t("Reload","client")();return TS.generic_dialog.alert(e,i,t)}).then(function(){TS.reload()})}};if(!window.location.pathname.match(/^\/(message|unreads|threads|zen|app-space|dashboard)/)&&window.history)window.history.replaceState(null,null,window.location.origin+"/messages");d();for(n=0;n<i.length;n+=1){t=i[n];if(TS.model.active_history.indexOf(t)>-1)continue;l=TS.shared.getModelObById(t);if(!l)continue;if(l.is_im&&l.is_open)TS.model.active_history.push(t);else if(l.is_mpim&&l.is_open)TS.model.active_history.push(t);else if(l.is_group&&!l.is_archived)TS.model.active_history.push(t);else if(l.is_channel&&!l.is_archived&&!TS.model.user.is_restricted)TS.model.active_history.push(t)}TS.model.c_name_in_url=TS.utility.getChannelNameFromUrl(location.href);var c=TS.model.c_name_in_url;var u=TS.utility.isUnreadViewPath(location.pathname);var m=TS.utility.isThreadsViewPath(location.pathname);var f=TS.utility.isHomeScreenViewPath(location.pathname);var h=TS.utility.isAppsDashboardViewPath(location.pathname);if(u)TS.model.initial_unread_view=true;if(m)TS.model.initial_threads_view=true;if(f)TS.model.initial_home_screen_view=true;if(h)TS.model.initial_apps_dashboard_view=true;var g=function e(){if(c){a=TS.channels.getChannelByName(c);if(a)return a.id;s=TS.ims.getImByUsername(c);if(s)return s.id;r=TS.groups.getGroupByName(c);if(r)return r.id;o=TS.mpims.getMpimByName(c);if(o)return o.id;if(TS.shared.getModelObById(c))return c}if(TS.model.active_history.length){t=TS.model.active_history[TS.model.active_history.length-1];l=TS.shared.getModelObById(t);if(l)return t}var i;if(TS.model.user.is_restricted){var d=TS.model.channels;d.sort(function(e,i){if(e._name_lc>i._name_lc)return 1;if(i._name_lc>e._name_lc)return-1;return 0});for(n=0;n<d.length;n+=1){a=d[n];if(a.is_archived)continue;if(!a.is_member)continue;return a.id}var u=TS.model.groups;u.sort(function(e,i){if(e._name_lc>i._name_lc)return 1;if(i._name_lc>e._name_lc)return-1;return 0});for(n=0;n<u.length;n+=1){r=u[n];if(u.is_archived)continue;return r.id}i=TS.ims.getImByMemberId("USLACKBOT");if(i)return i.id}else{if(TS.model.user.is_primary_owner&&!TS.prefs.getPref("newxp_seen_last_message")){i=TS.ims.getImByMemberId("USLACKBOT");if(i)return i.id}var m=TS.channels.getGeneralChannel();if(m)return m.id;TS.info("No general channel?! Known channel IDs:",_.map(TS.model.channels,"id"));var f=TS.ims.getImByMemberId("USLACKBOT");if(f){TS.info("Using IM with Slackbot ("+f.id+") as our initial model object");return f.id}}alert(TS.i18n.t("ERROR could not find starting channel","client")())};TS.model.initial_cid=g();if(!TS.model.initial_cid){var p="TS.client.calculateInitialCid() failed to find a channel";TS.error(p);throw new Error(p)}TS.client.calculateInitialMessage()};var v=function e(){if(TS.model.initial_msg_ts)return;TS.model.initial_msg_ts=TS.utility.getMessageTimestampFromUrl(location.href);TS.model.initial_thread_ts=TS.qs_args.thread_ts};var b=function e(i,t,n){var a=true;if(TS.has_pri[R])TS.log(R,"we have a muted channel: "+i.id);if("hide_read_channels"===TS.prefs.getPref("sidebar_behavior")){if(TS.has_pri[R])TS.log(R,"user pref is to HIDE READ CHANNELS");if(!t&&!n){if(TS.has_pri[R])TS.log(R,i.id+" has no unreads");if(i.id==TS.model.active_cid){if(TS.has_pri[R])TS.log(R,i.id+" is currently being viewed. showing even though no unreads.");a=true}else{if(TS.has_pri[R])TS.log(R,i.id+" is not the active channel. no unreads, can be hidden.");a=false}}else{if(TS.has_pri[R])TS.log(R,i.id+" has unreads.");a=false}}else if("hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")){if(TS.has_pri[R])TS.log(R,"user pref is to HIDE READ CHANNELS UNLESS STARRED");if(!t&&!n){if(TS.has_pri[R])TS.log(R,i.id+" has no unreads");if(i.is_starred){if(TS.has_pri[R])TS.log(R,i.id+" IS STARRED - showing even though no unreads.");a=true}else if(i.id==TS.model.active_cid){if(TS.has_pri[R])TS.log(R,i.id+" is currently being viewed. showing even though no unreads.");a=true}else{if(TS.has_pri[R])TS.log(R,i.id+" is not the active channel. no unreads, can be hidden.");a=false}}else{if(TS.has_pri[R])TS.log(R,i.id+" has unreads.");a=false}}return a};var w=function e(i){var t=[];var n=[];i.forEach(function(e){var i=TS.redux.channels.getEntityById(e.id);if(!i){TS.warn("users.counts returned data for a model_ob we don't know about",e.id);return}if(i.is_archived&&!i.is_member)return;var a=TS.shared.getControllerForModelOb(i);i._latest_via_users_counts=e.latest;TS.shared.setUserCountsInfoForId(i.id,e);var r=parseInt(i.unread_cnt,10);var s=parseInt(i.unread_highlight_cnt,10);var o=i._show_in_list_even_though_no_unreads;var l=o;var d=r;var c=s;var _=e.has_unreads?1:0;var u=i.is_im||i.is_mpim;if(u)d=e.unread_count_display||e.dm_count||_;else{if(_)d=Math.max(i.unread_cnt,e.unread_count_display||e.dm_count||_);else d=e.unread_count_display||e.dm_count||_;c=e.mention_count_display||0}var m=TS.notifs.isCorGMuted(i.id);if(!a){TS.warn("Unable to figure out controller for model_ob with id="+i.id);return}if(i.msgs.length&&(d!==r||c!==s)){if(TS.has_pri[R])TS.log(R,'msgs exist, calculating unreads for "'+i.id+'"');n.push(function(){var e=false;a.calcUnreadCnts(i,e)})}if(m){if(!c){d=0;n.push(function(){a.markMostRecentReadMsg(i,TS.model.marked_reasons.none_qualify)})}l=b(i,d,c);if(!c)n.push(function(){TS.shared.maybeMarkReadIfMuted(i,a)})}var f={id:i.id};var h=false;if(d!==r){h=true;f.unread_cnt=d}if(c!==s){h=true;f.unread_highlight_cnt=c}if(l!==o){h=true;f._show_in_list_even_though_no_unreads=l}if(h)t.push(f);if(d!==r&&!m){if(TS.has_pri[R])TS.log(R,'unread count has changed for "'+i.id+'", from '+r+" to "+i.unread_cnt);n.push(function(){a.unread_changed_sig.dispatch(i)})}if(c!==s){if(TS.has_pri[R])TS.log(R,'unread highlight count has changed for "'+i.id+'", from '+s+" to "+i.unread_highlight_cnt);n.push(function(){a.unread_highlight_changed_sig.dispatch(i)})}if(d||c){if(!TS.client.history_prefetch){TS.warn("WTF no TS.client.history_prefetch module?");return}TS.client.history_prefetch.addToHistoryFetchQueue(i.id)}});if(!_.isEmpty(t))TS.redux.channels.bulkUpdateEntities(t);n.forEach(function(e){e()})};var y=function e(){var i={mpim_aware:true,only_relevant_ims:true,simple_unreads:true,include_threads:true};TS.api.callImmediately("users.counts",i).then(A)};var A=function e(i){if(TS.client.history_prefetch)TS.client.history_prefetch.resetHistoryFetchQueue();var t=0;var n=0;var a=_.compact(i.data.channels.concat(i.data.groups).concat(i.data.ims).concat(i.data.mpims));w(a);var r=i.data.threads;if(r){TS.client.threads.setThreadsUnreadData(r.has_unreads,r.mention_count,null,r.mention_count_by_channel);TS.client.threads.logThreadState("users.counts: "+!!r.has_unreads+" "+r.mention_count)}if(TS.client.history_prefetch)TS.client.history_prefetch.processHistoryFetchQueue();TS.info("Finished processing users.counts");i.data.ims.forEach(function(e){if(e.has_unreads)t+=1;if(e.dm_count)n+=e.dm_count});TS.info(t+" IMs with unreads, "+n+" total dm_count");return null};var k;function C(){if(!_.isFunction(window.requestAnimationFrame)){TS.warn("Enhanced debugging: unable to install beachball detector without requestAnimationFrame");return}TS.info("Enhanced debugging: installing beachball detector");var e=[];var i=TS.replaceConsoleFunction(function(t,n,a){var r=_.toArray(a).slice(1).join(" ");e.push({type:t,pri:n,msg:r,time:performance.now()});return i.apply(window,arguments)});var t=60;var n=4;var a=[];var r=performance.now();var s=function i(){var s=performance.now();var o=s-r;var l=r;r=s;a.push(o);if(a.length>t)a.shift();requestAnimationFrame(i);if(a.length<t){e.length=0;return}var d=_.sum(a)/a.length;if(o>n*d&&TS.has_pri[N]){TS.log(N,"========");TS.log(N,"Enhanced debugging: slowness detected");TS.log(N,"Current time: "+s+"; previous frame was at "+l);TS.log(N,"Last frame took: "+Math.round(o)+" ms");TS.log(N,"Average frame takes: "+Math.round(d)+" ms");if(e.length){TS.log(N,"Begin logs since last healthy tick:");e.forEach(function(e){var i=e.time-l;var t="["+_.padStart(Math.floor(i),5," ")+"]";var n=e.pri?" ("+e.pri+")":"";TS.log(N,t+" "+e.type+n+": "+e.msg)});TS.log(N,"End logs since last healthy tick")}else TS.log(N,"(No logs captured, sorry)");TS.log(N,"========")}e.length=0};requestAnimationFrame(s)}var M=function e(){if(JSON._shimmed)return;JSON._shimmed=true;var i=JSON.parse;JSON.parse=function(e){var t=performance.now();var n=i.apply(this,arguments);var a=performance.now()-t;if(a>1)TS.info("JSON parsing: "+_.toString(e).length+" bytes took "+_.round(a,2)+" ms");return n};var t=JSON.stringify;JSON.stringify=function(){var e=performance.now();var i=t.apply(this,arguments);var n=performance.now()-e;if(n>1)TS.info("JSON stringify into "+i.length+" bytes took "+_.round(n,2)+" ms");return i}};var I=function e(){k=TS.client&&(TS.qs_args.enhanced_debugging||TS.prefs.getPref("enhanced_debugging"));if("0"===TS.qs_args.enhanced_debugging)k=false;if(!k)return false;C();M();x();return true};var x=function e(){if(!TS.model.is_our_app)return;var i;var t;var n=300;window.addEventListener("sleep",function(){if(i)return;i=setInterval(function(){TS.info("Debug tick")},1e3)},false);window.addEventListener("wake",function(){if(t)return;TS.info("Will stop debug ticking in "+n+" seconds");t=setTimeout(function(){clearTimeout(i);t=void 0;i=void 0;TS.info("Stopping debug ticking")},1e3*n)},false)};var E=null;var B=1e4;var P=function e(i,t){};var D=function e(i){window.clearTimeout(E);if(!window.performance)return;if(!performance.timing)return;P(i,Date.now()-window.performance.timing.navigationStart)};var U=function e(){var i=5;var t=43200;var n="dev"===TS.boot_data.version_ts?i:t;TSSSB.call("setTeamIdleTimeout",n)};var F=[];var O=1989;var R=58;var N=4;var H=function e(){var i=100;var t=TS.boot_data.page_needs_enterprise?"W":"U";var n=_.map(TS.model.members,"id");var a=_(TS.ui.frecency.getMostCommonWithPrefix(t,i)).map("id").difference(n).value();if(!a.length)return;if(TS.has_pri[O])TS.log(O,"Flannel: pre-fetching "+a.length+" most frequently accessed members...");TS.members.ensureMembersArePresent(a).then(function(e){if(TS.has_pri[O])TS.log(O,"Flannel: pre-fetched "+e.length+" most frequently accessed members 👍")}).catch(_.noop)}})()},4913:function(e,i){(function(){TS.registerModule("view",{file_list_heading:TS.i18n.t("All File Types","view")(),file_list_lazyload:null,members_list_lazyload:null,user_groups_members_list_lazyload:null,member_stars_list_lazyload:null,last_attachment_max_width:null,resize_sig:new signals.Signal,onStart:function e(){TS.view.rebuildMentionsImmediately=TS.view.rebuildMentions;TS.view.rebuildMentions=_.throttle(TS.view.rebuildMentions,1e3,{leading:false});TS.view.maybeRebuildUserGroupList=TS.utility.throttleFunc(TS.view.rebuildUserGroupList,1e3);TS.client.login_sig.add(TS.view.loggedIn,TS.view);TS.channels.read_only.list_updated_sig.add(TS.view.checkIfInputShouldBeDisabledAndPopulate);TS.user_groups.updated_sig.add(TS.view.userGroupUpdated,TS.view);TS.members.view.team_filter_changed_sig.add(function(){TS.view.maybeRebuildUserGroupList()},TS.view);TS.bots.added_sig.add(TS.view.botChanged,TS.view);TS.bots.changed_name_sig.add(TS.view.botChanged,TS.view);TS.bots.changed_icons_sig.add(TS.view.botChanged,TS.view);TS.ui.window_unloaded_sig.add(TS.view.windowUnloaded,TS.view);TS.client.flexpane_display_switched_sig.add(TS.view.flexpaneDisplaySwitched,TS.view);TS.client.ui.file_dropped_sig.add(TS.view.filesDropped);TS.client.ui.file_pasted_sig.add(TS.view.filePasted);TS.team.team_plan_changed_sig.add(TS.view.teamPlanChanged,TS.view);TS.team.team_profile_changed_sig.add(TS.view.teamProfileChanged,TS.view);TS.mentions.mentions_fetched_sig.add(TS.view.mentionsFetched,TS.view);TS.mentions.mention_changed_sig.add(TS.view.mentionChanged,TS.view);TS.mentions.mention_removed_sig.add(TS.view.mentionRemoved,TS.view);TS.mentions.mentions_being_fetched_sig.add(TS.view.mentionsBeingFetched,TS.view);TS.prefs.enable_unread_view_changed_sig.add(TS.view.resize);TS.prefs.team_disable_file_editing_changed_sig.add(TS.view.rebuildMsgFile);TS.view.members.unknown_resolution_rebuild_sig.add(TS.view.rebuildMentions);TS.view.resizeManually("TS.view.onStart");$(window).resize(TS.view.onResize);if("0"!=TS.qs_args.new_scroll){var n="1"==TS.qs_args.debug_scroll;if(!TS.environment.supports_custom_scrollbar)TS.client.ui.$msgs_scroller_div.monkeyScroll({debug:n,always_show:true,no_gutter:true});if(!TS.environment.supports_custom_scrollbar)$(".flex_content_scroller").monkeyScroll({debug:n})}TS.view.ms.changeConnectionStatus("trouble");$("a.clear_unread_messages").tooltip({placement:"bottom",delay:{show:500,hide:150}});$(".channels_list_new_btn").tooltip({container:"body",delay:{show:400,hide:150}});$(".channel_list_header_label, #direct_messages_header, #apps_header").tooltip({placement:"top-left",container:"body",delay:{show:400,hide:150}});TS.view.cached_wh=0;TS.view.resizeManually("TS.view.onStart 2");var a=false;$(window).bind("scroll",function(){if(a)return;a=true;$(window).unbind("mouseup.scroll").bind("mouseup.scroll",function(){a=false;$(window).unbind("mouseup.scroll");$("body").scrollTop(0)})});if(TS.model.is_mac)$("#drag_drop_mac_key").text(TS.i18n.t("Command","view")());var r=10;i=TS.utility.enableFeatureForUser(r);$("#stars_scroller").on("click.fetchUserStarredItems",".flexpane_load_more_btn",function(){var e=$(this);if(!e.data("ladda"))e.data("ladda",Ladda.create(this));e.data("ladda").start();TS.stars.fetchUserStarredItems().finally(function(){e.data("ladda").stop()})});t=!TS.boot_data.feature_initial_scroll_position||!TS.environment.supports_custom_scrollbar},was_at_bottom_at_first_resize_event:false,resize_tim:0,onResize:function e(){if(!TS.view.triggering_resize)TS.view.cached_wh=0;TS.model.ui.cached_file_preview_scroller_rect=null;TS.model.ui.cached_msgs_scroller_rect=null;TS.model.ui.cached_msgs_scroll_result=null;TS.model.ui.cached_search_scroller_rect=null;TS.model.ui.cached_archives_scroller_rect=null;TS.model.ui.cached_archive_scroll_result=null;TS.model.ui.cached_convo_scroller_rect=null;TS.model.ui.cached_unread_scroller_rect=null;TS.model.ui.cached_threads_scroller_rect=null;if(TS.view.resize_tim){clearTimeout(TS.view.resize_tim);TS.view.resize_tim=0}else if(t)TS.view.was_at_bottom_at_first_resize_event=TS.client.ui.areMsgsScrolledToBottom(50);TS.view.resize_tim=setTimeout(function(){clearTimeout(TS.view.resize_tim);TS.view.resize_tim=0;if(TS.view.should_reset_input)TS.view.resetForInput();TS.view.resize(true);TS.view.should_reset_input=false},250);if(TS.view.triggering_resize)return;TS.view.resize(false,true)},team_menu_h:$("#team_menu").outerHeight(),cached_wh:0,last_msgs_div_width:0,last_input_height:0,last_preview_height:0,last_preview_height_changed:0,last_input_container_height:0,msgs_scroller_y:-1,footer_outer_h:-1,triggering_resize:false,resizeManually:function e(i,t){if(!TS.model.ms_logged_in_once)return;i=i||"unspecified";if(TS.has_pri[o])TS.log(o,"======================================resizeManually ("+i+") starting");var n=Date.now();TS.view.resize(false,false,!!t);if(TS.has_pri[o])TS.log(o,"======================================resizeManually ("+i+") took "+(Date.now()-n)+"ms")},resetUI:function e(){TS.view.should_reset_input=true},resetForInput:function e(){TS.view.cached_wh=0;TS.view.last_input_height=0;TS.view.last_preview_height=0;TS.view.last_preview_height_changed=0;TS.view.last_input_container_height=0;TS.view.msgs_scroller_y=-1;TS.view.footer_outer_h=-1},resizeForBanner:function e(i){TS.view.msgs_scroller_y=-1;TS.view.resizeManually(i);var t=$("html");t.height(t.height());TS.utility.rAF(function(){t.height("")})},resize:function e(n,a,r){if(i){var s="start_resize";TS.metrics.mark(s)}var d=Date.now();if(TS.has_pri[o])TS.log(o,d+" #1 cached_wh:"+TS.view.cached_wh+" TS.view.resize from_timer:"+n+" no_trigger:"+a+" "+(Date.now()-d)+"ms");d=Date.now();var c=t&&TS.client.ui.areMsgsScrolledToBottom(50);if(t&&!r&&(c||TS.view.was_at_bottom_at_first_resize_event)){var _=TS.shared.getActiveModelOb();if(_)if(TS.prefs.prefs_loaded&&TS.prefs.getPref("start_scroll_at_oldest")){if(_.unread_cnt&&(-1==_.scroll_top||void 0===_.scroll_top)&&TS.client.ui.$msgs_unread_divider&&!TS.client.ui.$msgs_unread_divider.hasClass("no_unreads"))if(TS.client.msg_pane.dont_check_unreads_til_switch){if(TS.has_pri[l])TS.log(l,"view resize: NOT scrolling despite unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+_.scroll_top+"), because _has_auto_scrolled is true.");if(c){if(TS.has_pri[l])TS.log(l,"view resize: was at bottom, so insta-scrolling to bottom.");TS.client.ui.instaScrollMsgsToBottom()}else if(TS.has_pri[l])TS.log(l,"view resize: was NOT scrolled to bottom before resize, so not doing anything.")}else if(_._has_auto_scrolled){if(TS.has_pri[l])TS.log(l,"view resize: NOT scrolling first unread into view despite unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+_.scroll_top+"), because _has_auto_scrolled is true.")}else{if(TS.has_pri[l])TS.log(l,"view resize: scrolling first unread into view because unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+_.scroll_top+")");TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}else if(c){if(TS.has_pri[l])TS.log(l,"view resize: insta-scrolling to bottom because was_at_bottom, AND, !unread_cnt ("+_.unread_cnt+") OR scroll_top ("+_.scroll_top+") OR !TS.client.ui.$msgs_unread_divider ("+TS.client.ui.$msgs_unread_divider+") OR $msg_unread_divider has .no_unreads ("+(TS.client.ui.$msgs_unread_divider?TS.client.ui.$msgs_unread_divider.hasClass("no_unreads"):"undefined")+")");TS.client.ui.instaScrollMsgsToBottom()}}else TS.client.ui.instaScrollMsgsToBottom()}if(n)TS.view.was_at_bottom_at_first_resize_event=false;else if(!a){TS.view.triggering_resize=true;$(window).trigger("resize");TS.view.triggering_resize=false}if(TS.view.msgs_unscrollable)TS.view.makeMsgsDivUnscrollable();TS.view.resize_sig.dispatch();if(TS.has_pri[o])TS.log(o,d+" #15 "+(Date.now()-d)+"ms");if(i){TS.metrics.measure("resize",s);TS.metrics.clearMarks(s)}},never_set:true,measureMsgPreview:function e(){TS.view.footer_outer_h=$("#footer").outerHeight();TS.view.last_preview_height_changed=TS.view.last_preview_height!==TS.view.footer_outer_h;TS.view.last_preview_height=TS.view.footer_outer_h},makeAttachmentWidthRule:function e(i){var t;var n;var a;var r;var s;r=-96;if(TS.prefs.prefs_loaded&&"dense"===TS.prefs.getPref("theme"))r=-144;t=i+r;s="\t\t\t#msgs_div div.dynamic_content_max_width {\t\t\t\tmax-width:"+t+"px;\t\t\t}\t\t";if(TS.view.last_attachment_max_width!==t){TS.view.last_attachment_max_width=t;n="dynamic_content_max_width_rule";a=$("#"+n);if(a.length)a.html(s);else $('<style type="text/css" id="'+n+'">'+s+"</style>").appendTo("head")}},filesSelected:function e(i){TS.client.ui.files.validateFiles(i,false,function(e){TS.ui.upload_dialog.startWithCommentFromChatInput(e)})},filePasted:function e(i,t){if("disable_all"===TS.prefs.getTeamPref("disable_file_uploads")){TS.generic_dialog.start({title:TS.i18n.t("Upload failed","view")(),body:TS.i18n.t("At the request of your administrator, file uploads have been disabled in this workspace.","view")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});return}if(t)TS.files.justUploadTheseFileNow([i]);else TS.ui.upload_dialog.startWithCommentFromChatInput([i])},filesDropped:function e(i,t){if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.close();if(t)TS.files.justUploadTheseFileNow(i);else TS.ui.upload_dialog.startWithCommentFromChatInput(i)},updateTypingText:function e(){var i=TS.typing.getTypersInChannel(TS.shared.getActiveModelOb().id);if(!i||!i.length||TS.model.archive_view_is_showing){$("#typing_text").empty();$("#notification_bar").removeClass("showing_typing");return}if(!TS.prefs.getPref("show_typing"))return;$("#notification_bar").addClass("showing_typing");var t;var n;var a;t=TS.members.getPrefCompliantMemberName(i[0],true);if(2==i.length)n=TS.members.getPrefCompliantMemberName(i[1],true);if(1==i.length)a=TS.i18n.t("{user_name} is typing","view")({user_name:'<span class="typing_name">'+t+"</span>"});else if(2==i.length)a=TS.i18n.t("{user_name} and {another_user_name} are typing","view")({user_name:'<span class="typing_name">'+t+"</span>",another_user_name:'<span class="typing_name">'+n+"</span>"});else a=TS.i18n.t("several people are typing","model")();$("#typing_text").html(a)},botChanged:function e(){if(TS.bots.is_in_bulk_upsert_mode)return;if(TS.isPartiallyBooted())return;var i=true;TS.client.msg_pane.rebuildMsgsWithReason("botChanged",i)},switchedHelper:function e(i){var t=TS.shared.getActiveModelOb();var a=TS.shared.getModelObById(TS.model.last_active_cid);if(a){TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",a.id);a._show_in_list_even_though_no_unreads=false;s(TS.model.last_active_cid)}if(TS.client.unread.isEnabled())TS.client.unread.destroyUnreadView();TS.client.threads.destroyThreadsView();if(TS.boot_data.feature_sli_home&&TS.client.ui.home_screen.isEnabled()&&TS.client.ui.home_screen.isShowing())TS.client.ui.home_screen.stop();if(TS.client.ui.apps_dashboard.isEnabled()&&TS.client.ui.apps_dashboard.isShowing())TS.client.ui.apps_dashboard.stop();if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if(!TS.model.ui_state.flex_name&&TS.model.ui_state.details_tab_active)TS.client.ui.flex.openFlexTab("details",true);var r=false;var o={};if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannel({channelId:t.id,startTs:n}));TS.client.ui.rebuildAllButMsgs(o,r)}else{if(t.is_channel&&(!t.is_member||t.is_archived))TS.client.archives.start();else if(t.is_group&&t.is_archived)TS.client.archives.start();else if(TS.ims.isImWithDeletedMember(t))TS.client.archives.start();else TS.client.archives.cancel(true);t._show_in_list_even_though_no_unreads=false;TS.client.msg_pane.clearBlueBarTimer();if(i)TS.client.ui.rebuildAllButMsgs(o,r);else{var l=t.scroll_top;TS.client.ui.rebuildAll(r);if(TS.boot_data.feature_initial_scroll_position)TS.client.msg_pane.setInitialScrollPosition(l)}}window.setTimeout(TS.view.focusMessageInput,0);TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.utility.contenteditable.clearHistory(TS.client.ui.$msg_input);TS.view.showInterstitialAfterChannelOrImShown();if(!TS.client.activeChannelIsHidden()&&!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);var d="start_channel_change_"+TS.model.active_cid;var c="channel_change";if(TS.useReactMessages())c+="_react_msgs";if(TS.shared.isModelObShared(t))c+="_shared";if(t.is_im)c+="_im";else if(t.is_mpim)c+="_mpim";else if(t.is_group)c+="_group";else if(t.is_private)c+="_private";if(TS.boot_data.feature_tinyspeck)TS.metrics.measureAndClear(c,d);else if(TS.utility.enableFeatureForUser(1))TS.metrics.measureAndClear(c,d)},removeMsg:function e(i,t){TS.view.removeMessageDiv(t,false,i.is_archived)},removeMsgsAfterTruncation:function e(i){var t;var n;for(var a=0;a<i.length;a+=1){t=i[a];n=TS.client.msg_pane.getDivsForMsg(t.ts);var r=n.parent(".day_msgs");TS.client.msg_pane.cleanMsgDiv(n);n.remove();if(!r.children().length)r.parent(".day_container").remove()}var s=TS.utility.msgs.getDisplayedMsgs(TS.shared.getActiveModelOb().msgs);if(s)TS.view.rebuildMsg(s[s.length-1]);TS.client.msg_pane.updateEndMarker();TS.view.resizeManually("TS.view.removeMsgsAfterTruncation")},removeMessageDiv:function e(i,t,n){var a;if(n)a=TS.client.msg_pane.getDivForArchiveMsg(i.ts);else a=TS.client.msg_pane.getDivsForMsg(i.ts);if(!a.length)return;TS.client.msg_pane.cleanMsgDiv(a);var r=TS.client.msg_pane.last_rendered_msg&&TS.client.msg_pane.last_rendered_msg.ts==a.data("ts");var s;var o=a.nextAll(".message:not(.hidden)").first();if(r)s=a.prevAll(".message:not(.hidden)").first();var l=function e(){a=TS.client.msg_pane.getDivsForMsg(i.ts);var t=a.parent(".day_msgs");a.remove();if(!t.children().length)t.parent(".day_container").remove();if(TS.client.ui.$msgs_unread_divider){var n=TS.client.ui.$msgs_unread_divider.nextAll(".message:not(.hidden)");if(!n.length){TS.info("calling TS.client.ui.markMostRecentReadMsgInActive(true) after message removal because there are no displayed messages after the red line now");TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.deleted,true)}}if(r&&s&&s.length){var l=TS.utility.msgs.getMsg(s.data("ts"),TS.shared.getActiveModelOb().msgs);if(l){TS.client.msg_pane.last_rendered_msg=l;TS.client.msg_pane.last_in_stream_msg=TS.client.msg_pane.last_rendered_msg;TS.info("set a new TS.client.msg_pane.last_rendered_msg && TS.client.msg_pane.last_in_stream_msg because the deleted msg was the last one")}}if(o&&o.length){var d=TS.utility.msgs.getMsg(o.data("ts"),TS.shared.getActiveModelOb().msgs);if(d)TS.view.rebuildMsg(d)}TS.view.resizeManually("TS.view.removeMessageDiv")};if(t||TS.utility.msgs.isTempMsg(i))l();else a.addClass("delete_mode").slideUp(200,l)},updateTitleWithContext:function i(){var t;var n;var a;var r;var s;n=TS.shared.getActiveModelOb();if(TS.model.unread_view_is_showing)a=TS.i18n.t("Unread Messages","view")();else if(TS.model.threads_view_is_showing)a=TS.i18n.t("Threads","view")();else if(TS.boot_data.feature_sli_home&&TS.model.home_screen_view_is_showing)a=TS.i18n.t("Home","view")();else if(TS.boot_data.feature_app_canvases&&TS.client.ui.apps_dashboard.isEnabled())a=TS.i18n.t("Dashboard","view")();else if(n)if(n.is_im)a=TS.members.getPrefCompliantMemberNameById(n.user);else if(n.is_mpim)a=TS.mpims.getDisplayName(n);else a=n.name||"";if(!a)return;t=" | ";s=document.title;r=s.indexOf(t);if(-1!==r)s=a+t+s.substr(r+t.length);else s=a+t+s;if(e!==s){e=s;document.title=s}},start_time:new Date,checkIfInputShouldBeDisabledAndPopulate:function e(i){TS.view.actuallyCheckIfInputShouldBeDisabledAndPopulate(i)},actuallyCheckIfInputShouldBeDisabledAndPopulate:function e(i){var t=TS.shared.getActiveModelOb();var n;if(t&&t.is_general&&!TS.permissions.members.canPostInGeneral(TS.model.user)){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);TS.utility.contenteditable.disable(TS.client.ui.$msg_input);n=$("#msg_input_message span");n.html(TS.i18n.t("Your Workspace Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+t.name+"</strong>"}));TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else if(t&&(t.is_channel||t.is_group)&&TS.shared.isModelObOrgShared(t)&&!TS.permissions.members.canPostInChannel(t)){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);TS.utility.contenteditable.disable(TS.client.ui.$msg_input);n=$("#msg_input_message span");if(t.is_group)n.html(TS.i18n.t("Your Workspace Owners have limited who can post to {channel_or_group}","view")({channel_or_group:'<ts-icon class="ts_icon_lock prefix"></ts-icon>'+t.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon>'}));else n.html(TS.i18n.t("Your Workspace Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+t.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>'}));TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else if(t&&t._checking_at_channel_status){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,TS.i18n.t("Sending...","view")());TS.utility.contenteditable.disable(TS.client.ui.$msg_input)}else{TS.utility.contenteditable.enable(TS.client.ui.$msg_input);if(!i){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);TS.client.msg_input.populateWithLast()}TS.client.msg_input.setPlaceholder()}},userGroupUpdated:function e(i){if(r)TS.view.maybeRebuildUserGroupList();if(i&&TS.model.previewed_user_group_id===i){var t=TS.user_groups.getUserGroupsById(i);if(t&&-1===t.date_delete){TS.model.previewed_user_group_id="";if("team"===TS.model.ui_state.flex_name)$("#back_from_user_group_preview").trigger("click");return}TS.client.ui.previewUserGroup(i)}if(TS.client&&TS.client.msg_pane){var n=TS.shared.getActiveModelOb();if(!n||!n.msgs)return;var a="<!subteam^"+i;_.each(n.msgs,function(e){if(e.text&&-1!==e.text.indexOf(a))TS.view.rebuildMsg(e)})}},maybeRebuildUserGroupList:_.noop,rebuildUserGroupList:function e(i){var t="user_groups_flexpane_rebuild";var n="start_user_groups_flexpane_rebuild";TS.metrics.mark(n);if(!i)i=TS.model.user_groups.concat();var a=TS.client.ui.user_groups.getUserGroupQuery();if(void 0!==a&&null!==a&&a.length){a=a.toLowerCase();i=i.filter(function(e){return!e.date_delete&&(-1!==e.handle.indexOf(a)||-1!==e._name_lc.indexOf(a)||e.description&&-1!==e.description.toLowerCase().indexOf(a))})}else{a=null;i=i.filter(function(e){return!e.date_delete})}var r=$("#user_groups_list");if(i.length){r.empty();var s=97;var o=$('<div id="user_groups_list_wrapper">');r.append(o);o.longListView({items:i,approx_item_height:s,preserve_dom_order:true,scrollable:$("#user_group_list_scroller"),makeElement:function e(){return $('<div style="width:100%">')},renderItem:function e(i,t){var n=TS.templates.builders.buildUserGroupHTML(t,true);i.html(n)},calcItemHeight:function e(i){var t=i.outerHeight();if(!t)return s;return t}});if("groups"!==TS.model.ui_state.flex_name)o.longListView("setHidden",true)}else if(a&&TS.model.user_groups.length){var l={query:a,tab:{label:TS.i18n.t("User Groups","view")()}};var d='<div class="no_results top_margin">'+TS.templates.team_list_no_results(l)+"</div>";r.html(d)}else r.html(TS.templates.user_group_tip({is_flexpane:true}));if(TS.utility.enableFeatureForUser(1))TS.metrics.measureAndClear(t,n)},showUnSentControlsForMsg:function e(i,t,n){if(n&&n.error&&("6"==n.error.code||"7"==n.error.code||"8"==n.error.code)){TS.utility.msgs.handleFailedMsgSend(i.ts,t,false);var a={text:TS.i18n.t("A Workspace Owner has restricted posting to the {channel_name} channel.","view")({channel_name:"#*"+t.name+"*"}),ephemeral_type:"general_posting_restricted",slackbot_feels:"sad_surprise"};TS.client.ui.addOrFlashEphemeralBotMsg(a);TS.utility.contenteditable.value(TS.client.ui.$msg_input,TS.format.unFormatMsg(i.text));TS.view.focusMessageInput();return}setTimeout(function(){TS.model.display_unsent_msgs[i.ts]=true;if(TS.utility.msgs.isMsgReply(i)){TS.ui.replies.maybeUpdateConversationWithMessage(t,i);TS.client.threads.maybeRerenderMessage(t,i)}else TS.view.rebuildMsg(i)},5e3)},scroll_down_when_msg_from_user_is_added:false,addMsg:function e(i,t){var n=false;var a=TS.shared.getActiveModelOb();if(i.user==TS.model.user.id&&TS.view.scroll_down_when_msg_from_user_is_added){TS.view.scroll_down_when_msg_from_user_is_added=false;n=true}else if(TS.client.ui.areMsgsScrolledToBottom())n=true;var r=TS.utility.msgs.getPrevDisplayedMsg(i.ts,a.msgs);var s=TS.templates.builders.msgs.buildHTML({msg:i,model_ob:a,prev_msg:r,container_id:"msgs_div",enable_slack_action_links:true});var o=TS.client.ui.$msgs_div;var l=TS.client.ui.$msgs_div.find(".day_msgs").last();if(TS.interop.datetime.toCalendarDate(i.ts)===l.attr("data-date"))o=l;else{s='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(i.ts)+'" data-ts="'+i.ts+'">'+s+"</div>";s='<div class="day_container">'+TS.templates.messages_day_divider({ts:i.ts})+s+"</div>"}l=null;o.append(s);o=null;var d=TS.client.msg_pane.getCanonicalDivForMsg(i.ts);if(TS.prefs.getPref("animate_new_msgs")){d.css("opacity","0");d.transition({opacity:1},200)}TS.utility.makeSureAllLinksHaveTargets(d);if(!i.is_pending){TS.client.msg_pane.last_in_stream_msg=i;if(!TS.utility.msgs.isMsgHidden(i))TS.client.msg_pane.last_rendered_msg=i}TS.client.msg_pane.assignLastReadMsgDiv(a);if(n)TS.client.ui.instaScrollMsgsToBottom(false);var c=TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&t<2;if(i.user==TS.model.user.id||c)TS.client.msg_pane.checkUnreads();else TS.client.ui.checkInlineImgsAndIframes("main");TS.client.msg_pane.insertUnreadDivider();TS.attachment_actions.select.decorateNewElements();TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div)},reClassUnreads:function e(i){var t=TS.client.ui.areMsgsScrolledToBottom();TS.client.ui.$msgs_div.children("div.message").each(function(){var e=$(this).data("ts");if(e>i)$(this).addClass("unread");else $(this).removeClass("unread")});if(TS.shared.getActiveModelOb().unread_cnt)TS.client.msg_pane.insertUnreadDivider();if(t)TS.client.ui.instaScrollMsgsToBottom(false)},rebuildMsg:function e(i){if(!i)return;var t=TS.shared.getActiveModelOb();var n=TS.client.msg_pane.getCanonicalDivForMsg(i.ts,t.is_archived);if(!n.length)return;var a=TS.client.ui.areMsgsScrolledToBottom();var r;var s;var o;var l;var d=false;var c=false;if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.msgHasReplies(i)||TS.ui.thread.isMessageBeingConvertedToThread(t.id,i)){o=TS.ui.thread.makeInlineThread(t.id,i.thread_ts||i.ts);if(!n.closest("ts-thread").length){r=TS.ui.thread.buildThreadHTML(o,{inline:true,expanded:TS.ui.thread.isThreadExpanded(t.id,i.ts)});d=TS.ui.thread.isThreadExpanded(t.id,i.ts)}else r=TS.templates.builders.buildThreadMsgHTML(i,t,o,{inline:true})}else{s=TS.utility.msgs.getPrevDisplayedMsg(i.ts,t.msgs);r=TS.templates.builders.msgs.buildHTML({msg:i,model_ob:t,prev_msg:s,container_id:"msgs_div",enable_slack_action_links:true});l=n.closest("ts-thread");if(l.length&&l.attr("data-thread-ts")===i.ts)c=true}else{s=TS.utility.msgs.getPrevDisplayedMsg(i.ts,t.msgs);r=TS.templates.builders.msgs.buildHTML({msg:i,model_ob:t,prev_msg:s,container_id:"msgs_div",enable_slack_action_links:true})}TS.client.msg_pane.cleanMsgDiv(n);var _=n.hasClass("hidden");if(c)l.replaceWith(r);else n.replaceWith(r);n=TS.client.msg_pane.getCanonicalDivForMsg(i.ts);if(_)n.addClass("hidden");if(d)TS.ui.thread.renderReplyInput(n.closest("ts-thread"),o);TS.utility.makeSureAllLinksHaveTargets(n);if(a)TS.client.ui.instaScrollMsgsToBottom(true);TS.client.ui.checkInlineImgsAndIframes("main");TS.attachment_actions.select.decorateNewElements()},rebuildMsgsIncludingMember:function e(i){var t=TS.shared.getActiveModelOb();if(!t)return;_.each(t.msgs,function(e){if(TS.utility.msgs.messageIncludesMember(i,e)){if(TS.has_pri[l])TS.log(l,"memberChangedProfile: Rebuilding msg "+e.ts+" because it includes member "+i.id);TS.view.rebuildMsg(e)}})},rebuildMsgCurrentStatusIncludingMember:function e(i){var t=TS.shared.getActiveModelOb();if(!t){var n={"TS.model.active_channel_id":TS.model.active_channel_id,"TS.model.active_im_id":TS.model.active_im_id,"TS.model.active_mpim_id":TS.model.active_mpim_id,"TS.model.active_group_id":TS.model.active_group_id,"TS.boot_data.channel_id":TS.boot_data.channel_id,"TS.boot_data.im_id":TS.boot_data.im_id,"TS.boot_data.mpim_id":TS.boot_data.mpim_id,"TS.boot_data.group_id":TS.boot_data.group_id};TS.console.logError(n,"We tried to rebuildMsgCurrentStatusIncludingMember without a model object",null,!TS.boot_data.feature_tinyspeck);return}var a={member:i,for_message:true};_.each(t.msgs,function(e){if(TS.utility.msgs.memberSentMessage(i,e)){var t=TS.client.msg_pane.getCanonicalDivForMsg(e.ts).find(".message_current_status");t.replaceWith(TS.templates.current_status(a))}})},rebuildMsgFile:function e(i,t,n){if(!i||!t)return;var a=n?TS.client.msg_pane.getDivForArchiveMsg(i.ts):TS.client.msg_pane.getCanonicalDivForMsg(i.ts);a=a.length?a:TS.client.msg_pane.getDivForArchiveMsg(i.ts);if(!a.length)return TS.warn("Trying to rebuild message file, but invalid message");var r=a.find(".file_container");var s=TS.files.getFileActions(t);s.file=t;s.is_message=true;s.msg_dom_id=a.attr("id");s.new_window=!s.edit;s.download=!("snippet"===t.mode||"post"===t.mode||"space"===t.mode);$.extend(s,TS.files.getFileTemplateArguments(t));if("post"===t.mode||"space"===t.mode)r.replaceWith(TS.templates.file_post(s));else if("snippet"===t.mode){var o=$(TS.templates.file_snippet(s));o=o.filter(".file_container");r.replaceWith(o)}else if("email"===t.mode)r.replaceWith(TS.templates.file_email(s));else if("arugula"===t.mode)r.replaceWith(TS.templates.file_arugula(s));else return TS.warn("Trying to rebuild message file, but cannot rebuild "+t.mode);TS.utility.makeSureAllLinksHaveTargets(a);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(a)},showInterstitialAfterChannelOrImShown:function e(){var i=TS.channels.getChannelById(TS.model.active_channel_id);var t=TS.groups.getGroupById(TS.model.active_group_id);var n=false;if(i&&i.needs_created_message)if(TS.prefs.getPref("no_created_overlays"))i.needs_created_message=false;else{n=true;TS.view.overlay.startWithCreatedChannel(i)}else if(i&&i.needs_invited_message)if(TS.prefs.getPref("no_joined_overlays"))i.needs_invited_message=false;else{n=true;TS.view.overlay.startWithInvitedChannel(i)}else if(i&&i.needs_joined_message)if(TS.prefs.getPref("no_joined_overlays"))i.needs_joined_message=false;else{n=true;TS.view.overlay.startWithJoinedChannel(i)}else if(t&&t.needs_invited_message)if(TS.prefs.getPref("no_joined_overlays"))t.needs_invited_message=false;else{n=true;TS.view.overlay.startWithInvitedGroup(t)}else if(t&&t.needs_created_message)if(TS.prefs.getPref("no_created_overlays"))t.needs_created_message=false;else{n=true;TS.view.overlay.startWithCreatedGroup(t)}if(!n)if(TS.useReactMessages())TS.view.overlay.cancelIfShowing();else TS.view.overlay.fadeInAndOut()},toggleStarsError:function e(i){$("#member_stars_more").toggleClass("hidden",i);$("#member_stars_error").toggleClass("hiden",!i)},rebuildStars:function e(i){if(!i&&"stars"!==TS.model.ui_state.flex_name)return;var t="";var n=$("#member_stars_list");var a=$("#member_stars_explanation");var r=$("#stars_scroller");var s=$("#member_stars_more");TS.view.cleanStars();var o=TS.stars.getAllStars();if(o&&o.length)o.forEach(function(e){t+=TS.templates.builders.buildStarredItemHTML(e)});if(t){n.html(t);TS.view.member_stars_list_lazyload=n.find(".lazy").lazyload({container:r});TS.utility.makeSureAllLinksHaveTargets(n);a.addClass("hidden");if(TS.stars.has_more)s.css("visibility","visible");else s.css("visibility","hidden")}else{n.html("");a.removeClass("hidden");s.css("visibility","hidden")}r.trigger("resize")},cleanStars:function e(){if(TS.view.member_stars_list_lazyload&&TS.view.member_stars_list_lazyload.detachEvents){TS.view.member_stars_list_lazyload.detachEvents();TS.view.member_stars_list_lazyload=null}$("#member_stars_list").empty()},mentionChanged:function e(i){TS.warn("mentionChanged:"+i.message.ts);var t=$("#member_mentions").find("#"+TS.templates.makeMsgDomId(i.message.ts));if(!t.length)return TS.view.rebuildMentions();var n=TS.templates.builders.buildMentionHTML(i);if(!n)return TS.view.rebuildMentions();t.replaceWith(n)},mentionRemoved:function e(i){TS.warn("mentionRemoved:"+i);var t=$("#member_mentions").find("#"+TS.templates.makeMsgDomId(i));if(!t.length)return;var n=function e(){TS.view.rebuildMentions()};t.addClass("delete_mode").slideUp(200,n)},mentionsFetched:function e(){TS.view.rebuildMentions();if($("#member_mentions_more_btn").data("ladda"))$("#member_mentions_more_btn").data("ladda").stop()},rebuildMentions:function e(i){if(!i&&"mentions"!==TS.model.ui_state.flex_name)return;$("#mentions_spinner").empty();TS.view.prefs.rebuildMentionOptions();var t=$("#member_mentions_more_btn");if(void 0===t.data("ladda")){t.data("ladda",Ladda.create(document.querySelector("#member_mentions_more_btn")));t.bind("click.fetchMoreMentions",function(){TS.mentions.fetchMoreMentions();$(this).data("ladda").start()})}$("#exclude_at_channels").unbind("change.toggle_exclude_at_channels").bind("change.toggle_exclude_at_channels",function(){var e=$(this).is(":checked");TS.mentions.setExcludeAtChannelsPref(!e)});$("#exclude_at_user_groups").unbind("change.toggle_exclude_at_user_groups").bind("change.toggle_exclude_at_user_groups",function(){var e=$(this).is(":checked");TS.mentions.setExcludeAtUserGroupsPref(!e)});var n=TS.templates.builders.buildMentions();if(n){$("#member_mentions").html(n);TS.utility.makeSureAllLinksHaveTargets($("#member_mentions"));$("#member_mentions_explanation").addClass("hidden");if(TS.mentions.has_more)$("#member_mentions_more").css("visibility","visible");else TS.view.hideMentionsMoreButton()}else{$("#member_mentions").html("");$("#member_mentions_explanation").toggleClass("hidden","replies"===TS.mentions.active_tab);$("#member_mentions_more").css("visibility","hidden")}TS.view.resize()},rebuildMentionsLoading:function e(){$("#member_mentions").html(TS.templates.builders.loadingHTML())},hideMentionsMoreButton:function e(){$("#member_mentions_more").css("visibility","hidden")},cleanMentions:function e(){$("#member_mentions").empty()},mentionsBeingFetched:function e(i){if(!i)return;$("#mentions_spinner").html(TS.templates.loading_indicator())},loggedIn:function e(){r=true;TS.templates.makeSidebarBehaviorRule();TS.ui.setThemeClasses(true);var i=TS.shared.getActiveModelOb();if(!TS.isPartiallyBooted()&&i.is_group)TS.client.ui.rebuildAllButMsgs();else{TS.client.ui.rebuildAll();if(TS.boot_data.feature_initial_scroll_position)TS.client.msg_pane.setInitialScrollPosition(-1)}if(TS.useReactMessages()){var t=i.msgs;if(t&&t.length){var n=true;var s=true;TS.redux.messages.addMessages(t,n,s)}if(!TS.client.activeChannelIsHidden())TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannel({channelId:i.id}))}TS.view.focusMessageInput();new TS.PresenceList(TS.model.user.id);a();TS.client.ui.rebuildMemberListToggle();TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();TS.view.showProperTeamPaneFiller();var o={full_profile_filter:true,is_long_list_view:false,include_bots:true,include_deleted:false};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",o);TS.view.showInterstitialAfterChannelOrImShown();TS.view.prefs.toggleSpellcheck();if(TS.members.shouldDisplayRealNames())$("#col_channels").addClass("real_names");else $("#col_channels").removeClass("real_names");if(!TS.model.is_iOS)if(TS.ui.growls.no_notifications&&"1"!=window.readCookie("no_growl_prompt")){$("#growl_prompt_div").removeClass("hidden");$("#growl_prompt_a").bind("click",function(){TS.view.overlay.startWithGrowlPromptDisplay()})}else if(TS.ui.growls.shouldShowPermissionButton()&&"denied"!==TS.ui.growls.getPermissionLevel()&&"1"!=window.readCookie("no_growl_prompt")){$("#growl_prompt_div").removeClass("hidden");$("#growl_prompt_a").bind("click",function(){TS.view.overlay.startWithGrowlPromptDisplay()})}if(TS.model.is_FF)TS.client.ui.$msgs_scroller_div.removeAttr("tabindex");if(TS.boot_data.feature_tinyspeck);if(!TS.model.unread_view_is_showing&&!TS.model.threads_view_is_showing&&!TS.model.home_screen_view_is_showing&&!TS.model.apps_dashboard_view_is_showing)if(TS.shared.getActiveModelOb().is_channel&&!TS.shared.getActiveModelOb().is_member||TS.ims.isImWithDeletedMember(TS.shared.getActiveModelOb()))TS.client.archives.start()},showProperTeamPaneFiller:function e(){var i=TS.members.getActiveMembersWithSelfAndSlackbot().length;var t=4;if(TS.model.user.is_admin){$("#team_block").removeClass("hidden");if(i>t){$("#team_block_admin_invite_few").addClass("hidden");$("#team_block_admin_invite_many").removeClass("hidden")}else{$("#team_block_admin_invite_few").removeClass("hidden");$("#team_block_admin_invite_many").addClass("hidden")}}if(i>t)$("#team_block_description").addClass("hidden");else{$("#team_block").removeClass("hidden");$("#team_block_description").removeClass("hidden")}if(TS.model.team.email_domain){var n=TS.model.team.email_domain.split(",");if(1==n.length)$("#team_block_email_domains").html("<b>@"+_.escape(TS.model.team.email_domain)+"</b>");else{var a=_.escape(n.pop());var r=n.join("</b>, <b>@")+"</b> "+TS.i18n.t("or","view")()+" <b>@"+_.escape(a)+"</b>";$("#team_block_email_domains").html("<b>@"+r)}$("#team_block").removeClass("hidden");$("#team_block_email_on").removeClass("hidden");$("#team_block_admin_email_off").addClass("hidden")}else{$("#team_block_email_on").addClass("hidden");if(TS.model.user.is_owner){$("#team_block").removeClass("hidden");$("#team_block_admin_email_off").removeClass("hidden")}}if(!TS.model.user.profile||!TS.model.user.profile.phone||!TS.model.user.profile.real_name){$("#team_block").removeClass("hidden");$("#team_block_fill_prompt").removeClass("hidden")}else $("#team_block_fill_prompt").addClass("hidden")},current_unread_status:null,changeUnreadStatus:function e(i){TS.view.current_unread_status=i;TS.view.maybeChangeFavIco()},maybeChangeFavIco:function e(){var i=TS.view.ms.current_connection_status;var t=TS.view.current_unread_status;var n;if("online"===i)n="app_icon_32px_green";else if("trouble"===i)n="app_icon_32px_yellow";else n="app_icon_32px_red";if("unreads"===t)n+="_unreads";else if("mentions"===t)n+="_mentions";var a=d[n];var r=$("#favicon");if(r.attr("href")!=a)r.replaceWith('<link id="favicon" rel="shortcut icon" href="'+a+'" sizes="16x16 32x32 48x48" type="image/png" />')},windowUnloaded:function e(){if(!TS.model.mac_ssb_version||TS.model.mac_ssb_version>=.32){$("BODY").addClass("loading");$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden()}},buildMemberPresenceStatusHTML:function e(i){var t="";t+='<span class="'+TS.templates.makeMemberStatusDomClass(i.id)+'">';if(i.status)t+=' - "'+i.status+'"';t+="</span>";return t},last_team_list_html:null,large_team_directory_trigger:2e3,rebuildTeamMember:function e(i){if(!TS.model.ui_state.flex_visible||"team"!==TS.model.ui_state.flex_name)return;if(!i||!i.id)return;var t='#team_list .team_list_item[data-member-id="'+i.id+'"]';var n=$(t);if(n.length){if(TS.view.members_list_lazyload){TS.view.members_list_lazyload.detachEvents();TS.view.members_list_lazyload=null}n.replaceWith(TS.templates.team_list_item({member:i}));n=$(t);if(!n.length)TS.error("Unable to find node at selector "+t);var a=$("#team_list_scroller");var r=$("#team_list_members");var s=r.find(".lazy");TS.view.members_list_lazyload=s.lazyload({container:a,ignore_when_hidden_element:r,all_images_same_size:true});TS.utility.makeSureAllLinksHaveTargets(n);TS.view.updateTeamListCache()}},clearTeamListCache:function e(){TS.view.last_team_list_html=null},updateTeamListCache:function e(){if(TS.view.last_team_list_html)TS.view.last_team_list_html=$("#team_list_members_wrapper").html()},refilterTeamList:function e(){if(!TS.model.ui_state.flex_visible||"team"!==TS.model.ui_state.flex_name)return;var i=$("#team_list_container input.member_filter");var t=TS.storage.fetchFilterState();if("string"!==typeof t)t="";if(t){i.val(t);$("#team_list_container .icon_close").toggleClass("hidden",!t);TS.members.view.filterTeam(t,"#team_filter","#team_list_scroller",true)}},buildLongListTeamListItems:function e(i,t){var n=i.members;var a=i.disabled_members;var r=i.deleted_bots;var s=i.bots;var o=i.restricted_members;var l=i.ultra_restricted_members;var d=i.admin_members;var c=n.slice(0);if(s.length){if(!t)c.push({bot:true,is_divider:true});c.push.apply(c,s)}var _=[];if(o.length){if(!t)_.push({multi_channel_guest:true,is_divider:true});_.push.apply(_,o)}if(l.length){if(!t)_.push({single_channel_guest:true,restricted_members:!!o.length,is_divider:true});_.push.apply(_,l)}var u=a.slice(0);if(r.length){if(!t)u.push({deleted_bot:true,is_divider:true});u.push.apply(u,r)}var m=[];if(d&&d.length)m=d;return{active_members_list_items:c,restricted_members_list_items:_,deleted_members_list_items:u,admin_members_list_items:m}},cleanTeamList:function e(i){if(TS.view.members_list_lazyload&&TS.view.members_list_lazyload.detachEvents){TS.view.members_list_lazyload.detachEvents();TS.view.members_list_lazyload=null}var t=$("#team_list_members");t.off("click.toggle_list_item");t.off("click.member_preview_menu");if(i)t.remove();t=null},triggerInitialTeamListLazyLoad:function e(){TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members"));$("#team_list_scroller").trigger("resize-immediate")},maybeFollowLink:function e(i){if(!TS.utility.isSpaceClickEventSafe(i))return true;if(!i.metaKey&&!i.ctrlKey)return false;var t=$(i.target);var n=t.closest("a[href]");if(n.length&&document.hasFocus())return true;return false},markAllUnread:function e(){TS.model.last_reads_set_by_client={};function i(e){var i=TS.utility.msgs.getDisplayedMsgs(e.msgs);if(!i.length)return;var t=i[i.length-1];if(!t)return;if(e.is_channel)TS.channels.markReadMsg(e.id,t.ts);else if(e.is_im)TS.ims.markReadMsg(e.id,t.ts);else if(e.is_group)TS.groups.markReadMsg(e.id,t.ts);else{TS.warn("markIt "+e.id+"????");return}TS.info("markIt "+e.id+" "+t.ts)}_.forOwn(TS.model.channels,function(e){if(e.is_archived)return;if(!e.is_member)return;i(e)});_.forOwn(TS.model.ims,function(e){if(!e.is_open)return;i(e)});_.forOwn(TS.model.groups,function(e){if(e.is_archived)return;i(e)});TS.model.client.reads.length=0;TS.client.markLastReadsWithAPI();TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();TS.client.msg_pane.insertUnreadDivider();TS.client.msg_pane.dont_check_unreads_til_switch=true},onGroupReferenceClick:function e(i,t){var n=TS.groups.getGroupById(t);if(!n)return;if(n.is_archived&&!n.was_archived_this_session){i.preventDefault();TS.groups.displayGroup({id:n.id})}else{i.preventDefault();TS.groups.displayGroup({id:n.id})}},onChannelReferenceClick:function e(i,t){var n=TS.channels.getChannelById(t);if(!n)return;i.preventDefault();TS.channels.displayChannel({id:n.id})},onMemberReferenceClick:function e(i,t){var n;if(TS.interop.utility.looksLikeMemberId(t))n=TS.members.getMemberById(t)||TS.members.getMemberByName(t);else n=TS.members.getMemberByName(t);if(!n)return;TS.menu.member.startWithMember(i,n.id)},onUserGroupReferenceClick:function e(i,t){var n=TS.user_groups.getUserGroupsById(t);if(!n)return;TS.client.ui.previewUserGroup(n.id)},adjustForWelcomeSlideShow:function e(){if(TS.model.cancelled_welcome_2_this_session)return;TS.model.showing_welcome_2=true;$(".messages_banner").css("visibility","hidden");TS.view.makeMsgsDivUnscrollable()},msgs_unscrollable:false,makeMsgsDivUnscrollable:function e(){TS.view.msgs_unscrollable=true;TS.client.ui.$msgs_scroller_div.css("overflow-y","hidden").css("height","100%");$("#monkey_scroll_wrapper_for_msgs_scroller_div").find(".monkey_scroll_bar").css("visibility","hidden");TS.client.ui.$msgs_scroller_div.scrollTop(0);TS.client.ui.$msgs_div.css("visibility","hidden");$("#footer").addClass("hidden")},unAdjustForWelcomeSlideShow:function e(i){if(!TS.model.showing_welcome_2){TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);return}TS.model.showing_welcome_2=false;$(".messages_banner").css("visibility","");if(TS.model.seen_onboarding_this_session&&TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id)$("#messages_unread_status").css("visibility","hidden");else $("#messages_unread_status").css("visibility","");if(TS.view.makeMsgsDivScrollable()){TS.view.resizeManually("ran TS.view.makeMsgsDivScrollable()",true);if(i)TS.client.ui.$msgs_scroller_div.scrollTop(0)}else TS.view.resizeManually("NOT ran TS.view.makeMsgsDivScrollable()",true)},makeMsgsDivScrollable:function e(){if(!TS.view.msgs_unscrollable)return false;TS.view.msgs_unscrollable=false;TS.client.ui.$msgs_scroller_div.css("overflow-y","auto").css("height","");$("#monkey_scroll_wrapper_for_msgs_scroller_div").find(".monkey_scroll_bar").css("visibility","");TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);TS.client.ui.$msgs_div.css("visibility","visible");$("#footer").removeClass("hidden");return true},submit:function e(){var i=TS.utility.contenteditable.value(TS.client.ui.$msg_input);i=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(i);if(TS.environment.isSSBAndAtLeastVersion("3.0.0")){var t=TSSSB.call("languageIdentifier");if(t&&t.appendBufferText)try{t.appendBufferText(TS.format.cleanForLanguageIdentifier(i))}catch(e){}}if(!TS.redux.socket.isConnected()&&"/wakewake"!==i)return false;TS.client.ui.onSubmit(i);if(TS.i18n.sendButtonEnabled())TS.utility.contenteditable.focus(TS.client.msg_input.$input);return true},focusMessageInput:function e(){var i=TS.ims.getImById(TS.model.active_im_id);var t=TS.shared.getActiveModelOb();if(!t)return;if(i&&TS.members.getMemberById(i.user).deleted){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"account deactivated");TS.utility.contenteditable.disable(TS.client.ui.$msg_input);return}if(TS.utility.contenteditable.isDisabled(TS.client.ui.$msg_input))return;if(!TS.client.ui.isUserAttentionOnChat())return;if(TS.model.is_iOS)return;var n=TS.model.last_key_down_e;var a=TS.utility.keymap;if(n&&n.altKey&&(n.which==a.down||n.which==a.up))return;TS.utility.contenteditable.focus(TS.client.ui.$msg_input);if(!TS.model.archive_view_is_showing){var r=TS.model.input_cursor_positions[t.id];if(r){TS.utility.contenteditable.cursorPosition(TS.client.ui.$msg_input,r.start,r.length);delete TS.model.input_cursor_positions[t.id]}else TS.utility.contenteditable.setCursorAtEnd(TS.client.ui.$msg_input)}},clearMessageInput:function e(){TS.client.msg_input.populate("")},updateTitleBarColor:function e(){if(TS.model.is_our_app)TSSSB.call("updateTitleBarColor",TS.utility.rgb2hex($("#team_menu").css("background-color")))},teamPlanChanged:function e(i){TS.model.team.plan=i.plan;TS.model.can_add_ura=i.can_add_ura},teamProfileChanged:function e(){TS.view.refilterTeamList();TS.view.rebuildPreviewedMember()},rebuildPreviewedMember:function e(){if(TS.model.previewed_member_id)TS.client.ui.previewMember(TS.model.previewed_member_id)},displayMsgInModelOb:function e(i,t){if(TS.useReactMessages()){var a=TS.shared.getActiveModelOb();if(a.id===i.id&&!TS.client.activeChannelIsHidden()){TS.redux.dispatch(TS.interop.redux.features.messagePane.jumpToTimestamp({ts:t,highlight:true}));return}n=t}if(i.is_channel)TS.channels.displayChannel({id:i.id});else if(i.is_mpim)TS.mpims.displayMpim({id:i.id});else if(i.is_group)TS.groups.displayGroup({id:i.id});else TS.ims.startImById(i.id);if(TS.useReactMessages()){n=null;return}if(i.id!=TS.model.active_cid)return;var r=TS.utility.msgs.getMsg(t,i.msgs);if(r&&!TS.model.archive_view_is_showing)TS.client.ui.scrollMsgsSoMsgIsInView(t,false,true);else TS.client.archives.start(t)},flexpaneDisplaySwitched:function e(i){var t=TS.model.ui_state.flex_name;if(!t||"team"===i&&"team"!==t){TS.view.cleanTeamList(true);return}if("team"!==i&&"team"===t)return;if("mentions"===t)if(TS.mentions.mentions_needs_fetched){var n=true;TS.mentions.maybeUpdateMentions(n)}if("files"===t)TS.client.flex_pane.maybeFetchFileList()},_maybeUpdateOnboarding:function e(){if(TS.model.seen_onboarding_this_session)if(TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id)TS.onboarding.startOnboarding();else TS.onboarding.cancelOnboarding()},addReplyMsg:function e(i,t){if(!TS.ui.thread.isThreadExpanded(i.id,t.thread_ts))return;var n=TS.client.ui.$msgs_div.find('ts-thread[data-thread-ts="'+t.thread_ts+'"]');if(!n.length)return;var a=TS.ui.thread.makeInlineThread(i.id,t.thread_ts);var r=true;TS.ui.thread.updateThreadWithMessage(n,a,t,r)}});var e=null;var i=false;var t=true;var n=null;var a=function e(){TS.view.ms.maybeChangeConnectionDisplay()};var r;var s=function e(i){if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)){delete TS.model.input_cursor_positions[i];return}var t=TS.utility.contenteditable.cursorPosition(TS.client.ui.$msg_input);if(t)TS.model.input_cursor_positions[i]=t};var o=389;var l=888;var d={app_icon_32px_green:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2lJREFUeNqMVk1vGkEMndmu4MLmkOWQoCqkh0APqAdUVNpKiXLux/+tFKlSDlEitcm15RI4BBBiucCFjdDUs571eL1L1EEC450d28/P9ujvH7+qbBljFFtaa9SgAN9ij9Xnb/LNdBrKIUn0rNKGKi1vvkpPQqi0syYiIBvlN7lt2kM7C6ErE2gr6BfcpCXO4mg4AURlCg6ZHCIrGuk1Kckp/q20P13u1NknW4E7VMkAreE8ONTLEA0Lpep0jDvgSReZIGRQbkSNuBnT0+ggOowP0X3uB0cC1qvu6453Te8lT3/Qv7i8SLfpbDrDN4efh4MPg91ut1gsMBprqYSEY1EledA1fNo+bcN3kiS0HzVgz7pMwGrJhRBs5glS+EuVQbkDZKIoAmHyOEEP2m/s6WmaJsnKRZ5XoijJkIrAWtKG8sP5dNw6ds46Puhmswni+HFsmclKnZe9M0BmiXD4uFavdbod3ERC713PRZDhA2GhJlkmmBuOj0vkt+EXbhl5BnY6bzvDT0P1f+v25nb0Z8SZ6rikMwO51gcGf8G7xkEDNtRqtfPLc1Be/7zebreYkv77PghXP65g5ypZWT3RP3ufjIWeOb6A7LPNZrNerymfIE/GE4wSKgAZNX2aenIrhwF5jzZCOpg3Ly4jf1bIlozsWF+zpxmxQ+liN81UWBaBMrIjOhpoZwkpBGl0hW0U1vNmvXGFooycHMbHFJY7OO4jwqAB6BOkieMYM9GrW818Oge4CuzUDCIqcW4GDsU00iKm0jrrnqFw/+t+uVxyHhZA9jRlZuAvOg5wgyXI8N3NHb55cnoCxgCxh98P6A1gBR/uIkc7LGQ4xx0WFA4lAEAAwuA76Ph85jR82ogJmje7whD37RBfOGodYYaJ4GgSMKFZW25BHiiVzwMaOx47KLF6DfPpupAxkFioO99Eiye6GhYRFEZYcdi2Wi0sMYCYJwYCek6fOdC+GRt5zQmlC8wSdGNgiG3RxlX46O8ITfojlBHDkuLwzU7cscr1LLqhd5y3hfK8Iogq7lLZ8jZK9zU+9co3KK4P+LnCca9nG8T9RedLXBL8tUUMIGwvojXtc99dthiqLnoWViADNHvvAGL2uROVFtcykZjwhZdFcAJc6TjbwTEM3QAq3lP40VSThRxU3U0rgf0nwADpJQebhAz3/AAAAABJRU5ErkJggg==",app_icon_32px_green_unreads:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4JJREFUeNqMVj1MFEEUntlsx1FzQgmXnI13JGA0XIWJmvgTEzAxBhXbw0Rjg4VWamFLIjWGUkwgFoIFNkAhJN5VHGEpMVBz1OPbfW/evJldyc1d9t7Nzrzf7/3o+9fvqmwZY5RYWmvcQQKewZl0396Uh5kb0jFT/K5QhsotJ75on4lYaZIWWMAy8jelbD7DJz3TlYl0SugL1OQV8JLeIAJIZTyFjHVRSppQa95kpeRTacc9PKmzT7YiYqpCA1PB1jjcD000wpQi7mh3JIMeRII9k8eYp4oyUg/pCVix5zJdAFAg+kp98x/f1Mbr3bPu45uPkN3aznd4tndb716+ZT+z7nw3QhTltaMLGa+JGw3gjuzw/JWxGp7s6y+lKiM7Gwp2XWoByLQBUvjLmcEXRqojyK4FArIzvNPea1G8tZZ3WemYzUklaWejxFNtrE7sMgvg05hskMjfLSVSXaY9CQhcJiMGXAYGB4AoD5VxZ2KygRYPWwtGqpVKtQI735ZXgiyhQN67dkdKplAbNf3k4dPmM9XbSjrJ6+evJFIJSzrLA7trI5N5CXXvcW1vbiltPSrSIs0VsCBwnKEkpUjMzb+49eA2EIufPq+v/oBjUzPTaNyXxSXwDOqbL7pUTW0KK1m8JM3uTg4SxG5tnDB6+veUqoBWQT5hqOAZKRNWRFIkMxlSjBGZ7B8i2J3IziGKDDsHwT79G+crOPG9XIG/jnsnwVwr9Zfgi5vloUvwPeokkOEeOrVIWOhoaIvMZ+D1fuFDjxHm+uFSSjg5MlzDtSvUAO3eIXRyfBIEkksnJZos8Sh8ZfkrhBSI2eYsehwAc3RwBMTUzBT6CvDT3mvDmfOzrqxCxu+Asd/EDQOitftHxnNjdb3bPYdLzfk5wv6vrWQ/8Qq1bNS2vsZeERWRAHq4OsxOAEdjhMuDZQuqpKCRcA5bvMZeC/ObbX181CuZWtevjrqq52tNrHMZF8ms81ouVIuhAcYoZjjXD6jbdIUbgHEhlO06LmxhqALwPTleAv9AqcFXP9c20Hs7m9uyqJFOHGqR2Ronu8KZR3g21bZwCAumIzEREPqjoDbJHHH7/3EjR5hfSYy4RPPGN+VyJGh+8qScnaQRqB/PWPA3Cg00xTOAlOFxVDoYyyRS0yBfcDkwzjk3531vBDZezYjxV1nMkY2y//DMI2NQNJsWOvafAAMAxE3MJSrFyPAAAAAASUVORK5CYII=",app_icon_32px_green_mentions:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABExJREFUeNqkVktsG0UYnpl9OF6/4JDYaWirNrFIgTbvNEilByS4FHogQeJQoCcOidQjiF6LBGcEnIs4cABBKZeUQw+IQkUicFDVJo0TJ0gtSW2paWLHr90d/t2ZnZ11TBubie3Mzu7+3//9b3z2xdeQuyilKLhMy6yb8KmVq+VLPT0j0RhqfakgF2MMO/YrlnfOYa098PsFQJjLamBA3SVQdyyrPQCCHdWbMJCx4PtPrdYmA64+osgjIJA4MMKEkFy10iYDLgv5QoWtYA+i4Qc+i+Xy/wJgPBo9QZ0PcWHyprVU3m3LyZJXGQ0B46huExAfiUSmzk2VCg/R3VzrDHCTDGBsYKMQomAyOjH63InnN48e3ia4nSjypLJ48fHYLeDR198XiUY6nk5cteotA/iJxv48T7gWc6yvEGVodCgWi8UT8av37y+36AlVeJgpDtEqwvTUy6e6urtM0zx45NDWw61EIv7C8MB3j7YvVMwwwi07WbiXZcTU22++M/0uXAFAtVI1IkY8kXjjrcnNjc3fF7On/7qD6b4BuPpSPgNG8kCSPQEm0jTNMAxAqtfr8M2nj96s1k4urZJ9FCj8+sQZBiAsQxHnz4w2/f7MK2dfrdVqn3/y2eyPs6ZVP/nSxND4sLq6NvLHrfiTbEXEA9Rb2NszQn3H0uBqILGeW9cUVVXUkfGRzmQnerbv43plfmf7SSZyFRYkRBF1vI0wRCfEKJwAxtrdHPyqSD0+fBxMpev631vbF/P5gXD4vVR3Omw8LorkngPSHbnH0nAJ0tlJdjE7MDYIJx1GONWdKpV29ZD+zKGDncmulbX1mdzqoGGMRaKnE08ldT3gA+hoTFk5n0HWpU8/aqza7rJtm8VVpVIpl3aLpVLhQeHihQ/h3LJNeKBH06KKciQUUjGGa5XLxTzT2GW6P90kHljxUBSnymKiqqquaaFwR2Gz0KGHbGpblgYK5Kn9wLRzZpnFixpoyJ4zvv3qm+xSFjbnp8/3ulb68ovLK0srsJk8N3lidABr+MrX3y/ML0DfLj7a0VTNIUdseMB2Mwl7MtVAlrm2YpeZuT9BASYd1rUrs8ViCV6a/mCGUbn582/Lt5eZQhBaTEvgwaIGds4tTIOZLHkC9r39vWy/cW+juFOETTQWTR1IcbffyTIkpylRN/wwJRD3DIBwk6h+FdozXgyODbHNwnyGnQ+OeydzGT/tRfOgvPo6ogi/RURoikcFiWQPrxYQo8xjon5k5jKiqPDXpXxiZvZ94LewIBuQu3HvMtjnxvVf2K2ffrjGrPfr9RtckNxCvNEBS/UDs8lOToK9eIiPYLTpfNYwi3gFjY8pBAXflPu+f/4fZhSjgrjV0A0DHU0gixdkiXIUyPpSRGUSckfhg08jQdp8BpAxAhIRlj0n93Ze7B7zcgM537h7rO8mqTxp+jZU2X/kxZxcsQPAXq/2WneAVmDUDBr2XwEGADZFpKJDFtSPAAAAAElFTkSuQmCC",app_icon_32px_yellow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA6VJREFUeNp8Vr1PVEEQn3m+Ais+TOQ4TCCeARMxRyESC6EwkUIDpf530kqnJVZqZayMFBI5wpGAYMEdDZzR3Dqzszs7b+9gL7k3b97sfP5mdnH9yUvwyzkHZiGicISg/0yG+XGnFVZtQpdK6behNmBgJfPD+EqUgMFaFoHaGNxpbauMSlZCB1cgE3iNm7oyXTYbgSASXMUhF1PEpMu9VqY6Zf8Bk/ZcEv3PryIohTxANhyDE34eojOhDNMucRe26FklNDNCj4/CdC3pnxjD+mRw3/phM0HrxvydueQaXgmetVX3eqPf60GrLRtxY63/4pn7+w8Oj1CiYUsDmQgoGgoecU2+Lswz/+gEVN5zcL/tXdbEYo6FkmzGAoE8tTO0dpSZ8TEmdnaDgwvz/HrZg6NT3ib67F51ukiNJr9YCV+usO7OsHTrAAMeEKdrrHfnB2uCak9k+SjVrAJO7N0cgaVmwPXjZqjP02XnI+5LxibGiMM5o9S12i7rkliDgdkgSh/eh+erfUi5w8asa8yC0ML3HH59t42ttnE0ZpuI0uAXbXl/HsCbLepzDuXVOou/fV9cXPKueo1AxbY3tyjD8Os3Xlya5mKkpimZIsDUQPytew6drov1xE6XKyw+3hpn/vEJ7h3ITielCc0EaVzQW6mKhxaKaI8f59ESwD51m01STsIkT3Mg6vEsaYtCuzzlR3CFYf89zjtSGQO0XOjns25sFHD5yRFgH1OUTXCRW1kmMU50w2N0YhQJQiJWr3EE9RqujPAm6u3jU9M9Jt2cIm1xa6YxQxBysSK8lhbB5NZzmoIx2P5YUHzqfna6lGn2IqiZ/UPc3GL21CRPoU6XgSguPphzS4sM/A+fCu8NnJ1DVkjbz2WlwjHvtChwHwqDYq/NgJE9j5reg8ixp012gsqnonqIm1ntaSnA8Yk0ecien3pOz1oFSLDHuEpIKSqdbCpBNLVYnQGDFIG4RPi5yYXloa2TMY0A6eEsgsGjVZ3yAKUCQOc88L37VADs/al4nVS7VG3Ba5m7YEpE05gQ8n03jnGAr99YA5lMZQSXHZZqLA277I6lNqiMYRjET+T45y8QnDNDLUQfzw/b2eXgzUejSSAZuK/ZsTh4g7L8wurNBlHiG4Hs/hLPJMwuCenaUmnxeOBko+kq98Nlq4oOPVGEU+QBuivvANnZFzQCZtcywMpMKa/ZnAWXJTd33EjYHJbyhOo9xarWu2WlBsPupkMT+1+AAQCmPwV2bobFnwAAAABJRU5ErkJggg==",app_icon_32px_yellow_unreads:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1hJREFUeNqMVr1PFUEQn9lcIc+ORylHB9gBNpLY+dEISKWhNHYWdhb+FRaa+CeYWJnYKVoJdAiVQMc7Oh90go1vnX2zOzs7dxj2JXfz9mbne36zuLa8AuPlvQe1EJF3mKCn4Qn76aRmFmlMV0LJt04d0FpZfde+EBVg1GY8EB3tk1q38Ahn4Tp4h4HA/5gpy8jS0YgEkeALg3wKUSC9tVo2xSj9BMzSLSeOf+PlolCwDgbFyTnety565UqXdPbb6aSbTEhk2jVWmAJe26EjQasqQoYdBUrExDX/7Kmfnx2dX8DLV47FvX39l54HR/jmHUqcxXY5G6uos3jYNPq6tEjSA8/BITL/3Gzk7PUCH4g3aGuhohMpQcBv6QzJ3fR0FHd4FHnqaZ92MOYbUZ8Vo11uNP6lTIwjFhebLx7QztJiVPnzIJtv+oNXZUKmM3ZrwU9Ohs2pfuReXGDOUX0jSqlrmKmDNV++2i5JOWgVBoflwT14tDIyuVlf9QCFgetjnsEJkoJsaIo2EU7Vb9TMldDvdyDHZWv3B3Do2Expi9Arq7cfarwELgpV+xtP/J3lQLz/4L5vh2P373p27uMnMhzZ3jboxipKLQydiSJaCqY5ifg1l3J+dparw/QTFyc9XXZHyp8NGbtMLSb5PB5E/BKVx01UaSdHLPvwt2ojeJRbh78ia9AgN9f1nu9NRGOpuqb6vmmQOlwHWRwKGaWJxr7o+iVZL56PrphhwQ+pIh1k5wXDMQP1TH31CoLhEE0iBTpzHwjEs/LPmxQT0g3razEHVDDNSThAJcSNTfVDSEc8FxcZVPQEtY2m4XAMk+GYZHhrG8//BJzbeJxqfx8HA3HaFqjgqys6WWWC6Dph3PA0BJpOU3qnUgOSdCNRAL/woBhh5bCdn4PkTdy/OV+CqAZOhodWxznddcXIhWxs08QOZ+wLIHqYZ0YeZJinZpGD9ghjEwYN/Bri6Sns7kUM396hkI6I3tsvQC3aJKlWkaraNx8J6NaOS+5Hnt/nfvObM1OvfYPS+85gk+6RvH9JGKXe5ZOuETvRRLMcMMNPc+q7k0ZGPVF4x1kH/aV3ADP7ZHiYa1meNiYH7cPGORNca7ji0DGs+A3lPaWYP3Ln0Tnoupt2BvafAAMA603M1k3efM4AAAAASUVORK5CYII=",app_icon_32px_yellow_mentions:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABBhJREFUeNqkVk1vG0UYfudj/bExbWo3kJLaKRWO3aaooIoKOMCBDwlBI06F/oEeQOIHcIU7N34CEieQekMIkBDtBaEgDk1aRIgdRGiSpqSpN1nvzPDOzuzurO2SxozX69lZz/vM836ThRffhngopSA/IhH1I7zCYD/4eGbmQuUxOPzgKJcQgjNzT0eybmHFEPyjAgCxsgYYqHikqPeFGA+AEn30EQxcLPz+FYZjMrDHBwUJgRTJAgOhlK7s743JwMqCTGiqK5yjaLzhtRQE/wvA8Bi0hNIXjWE2IrEc9MYHsFaN1ZTC6KPjl1K/RBbepJv1u2MBkBERYNjghFHKCD13lj59mv4xtf0PhON4USLV+EuGZ14hh0ad+WVWrNAvg/VDA2SBZj6JJTRMrH1G2ZkWmZjglQq/dmfn9iEtwVon54adx0wuPAfzZ+WpWTh/DqRUeG3dVUti5yI95hF6aIBMdHx74zW4clm256DVNHrT+ntyWvnV/hrsNnePZbo90Ivs8RMMs7NWs4QoBY+TcolVfH7kiDc5Wdid3vt2alXAI2UncumFtwxAqhllOVhrv/eueumi7Efy8y/ghxtRJPrPzIft5r7/d/GVtVNHqXewm7rZTSMlc0Noto4kCOd0fZ16jHPG59terVoIZ8JPdn/76f7OQdk0PnBKIk2iqHNcLpdU46TGYpSs/YlOhRt4q6n6EXge6T4QH213zpfLV6dPNMv+QwAcx09PreU29GOjblZgtUNacwhPSyU1VeO9PVLw6InHRXWS3V7vf7Dy+7O+//xE5eWjk08UCjkbYEUzh3XjuTUHH74vB7N2/F5IJSIVhnI/FMGe7AXR9rb49DN0YilkhEJmPK/C2FPFIicEn7mVS2ykmcfZxih/0ElF64pwncEZJx6XxQK9d0+VCjpOhPCUkhtK3onkShQYf+G5gpwY4+tvoNPFIId3FrQN8M1X10h3TfvD668qjAw0+3ffw81lJoR80FOIhLsk1aRlnDRJIpO7Cc7oyjwu3dIHMNJx/HidoN5x05XLlsrir3R1Fd1B64AzaU6JPIzX4EwLJIrnlOBYAuf1up1vbkEvZuyX4XjNmr3TsZGvi5KK3Y8oin5vAKhVCU+z0HB70W5Bwsaun2lbyOVb2T+z4qFs9tWiqH1FU9dM/5qSOJ5ki27XRni1alduLidbkhrlxpNRc2aDrITl2XS6sLFJtrbg50Wbw6/fwNwlcb74SyLILSFJ6+DmQWI6OzcIhvHAtmBqZH82kOSThGbbFAr5nW5hyNYfosa0VUhfDVTDXEVLkdMNrkTXC9zzKlAuCZvNwGl8Bgmq0T2Ai5GTCMS1nFvbbbL7j80D5DLlDmk/DlK308x0yM0vJD7nZuwcMKicDfK0cq1mXrH/CjAAfjaCPa5V5tYAAAAASUVORK5CYII=",app_icon_32px_red:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2pJREFUeNp8Vr13EzEMly5uQl+nlKnpRrtRNsp7DO1Ilz5W/gZW/iG6MrLCyMhIN9JsKVvDlH7dRdiWLcu6K27fxaeTrY/fT7Lx/dtziIOIQA1EZAlP/NPoBHleqZVlN547mcm3QRvQG8X8kFwmDjBZMxGIjf5KbVt0RLMKHajBMMH/uCnD7KWzkSZ+ClQ5RDlFYUrWaxGKU/oJWHa3mhj/4mjSpmADDIZzcCy3IZIKZWh3jrvRoBskJDM8nzawPyr7745w1iT3tR86E3401XZAg+Txr2fP4NMOHbmy8t2EPu7Aybj4J1mWHPiRWDRIHnaNv/LWyw2IPksWm6AHkli0XHA+Xxkg4F+pDMFu38E0hnr5mDw42grPW4JlF5bxfnqtOO2kCIIlJMFH8+lFzPVVK3zACAYFewFV1NVa/GMDJYNUIbaNcDxOlt6Mk7bPOGtyfnYbOJkE7WXnzZOpklzJvd7AaXm1FWDUXw9c+AdVSlESXr/e4VUEVZiatDAayFLU8P5u6fM6ZMOH8mE7qH+5xXV0ajbCs2j7Yh3w+7PB9UYVV2BqYWOJAEsBhW9/CVatnxLjudrAZcsJx+cR8OsO5i1DRQxNKiYVo39zsrFuXno+jQgHgub+tRcNeMyFHYB1N42iACf4QiPbERMNMK0/jNW7bHNhU6rnm00uFCB7ciTa5xSZDs56p5MUx4EQJnNpFg3MHJ5yKB36dFXsRJUidoGtiRm/qaHQ8dh28uOtpPDtHpctifvmdHGl9yKImUWHF+sg3hvR2SQg7InIfrx05I154n+/T3y7iRQyXUiy7SqEc9798IHHUAIp5h3Ocx29jqEsskTaWGmU9Qno6kOchBC84GAUntctpQLzJhnzjuSs7begkiigpqpkhQSXGOM575JLnj/bmDgqnbG0ACLL19BN9RFWH7aHMT8egFWmMrcKD8Bd7AZV4+QCI3vNcdYFZcl3Y8+QX4+pnfvHz4egsiKVE31GCU2wxsDcscSGh3HeVn3wDvHHAx+uoJtaCiKfH7qyXf/mI9EUOvfua7ot9m9QWt7ofU0jKnKlYO4vmIe5JJRrizmAuL2Y1vSU++mypTqjPlFY0tgA6ck7gDn70o6A5loGul9rDPqLTXAmudZxpaFz6PgX6nuK3lpqssJg6G46mNh/AgwA1LYLPz5hMyUAAAAASUVORK5CYII=",app_icon_32px_red_unreads:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAzFJREFUeNqMVr1zUzEMlxyHtincsdDOyUo6Aytz6Qoz3HVk5y/gr6ATQ2dgBWZYKWvDDAsDaZvmJUZ+smVZ77UXp5e4sqyPn76MR08OoV0hBFALEZnCG/o2PJGeb2pmkcZ7Lzs569UBnVXU99Fl4wGTNuOB6Oje1LqFRzgr1yE4jBu8xUxZRpZGI21oC6EyKGSI4jZYq4UoRulvwCLdcmL7aZdLQsE6GBVn55huXQzKlT7p7LfTQTeREGS6OVaZAkHboZGg5SvIsCdBaTOC8PoeTH2YBzj+mwx/fz8enS3h7RwEZ7Fd7qYs6k0eNo1OH90h6cDimH86TJy7LvKBeIM2FzzpzAEC/pXKkNiNs59nTeIZDxSF442o74rRrhQaf3IkWsTSmoqC1gOikE+KUtWEwcMbyHTEHg/hgYvEvZQKQHLZY/FgPMDJIHr18SqYKskx6CQGw3K0jc93bGxe7ABAqCnx39mKFChDM9q0cSp/k2bOBLZ9w/XtOkHHZkpZxEou5pcCimcnl/DuIjK+GsHTrUg/ucDPi2jjsy1g504vo+FsrzRdVD62dYC2l5lGNvZpTzhwsj/MVv1ZR2mqL5R64lDRtyvuSPpzXrUuj1Q8z5sUIMna81WqLzs5UtrHf323g7Pcia+yhczn4trF+Mdr3+G+oyOc6+pRcEfEaKKxLzp/Sdabu5tGWPqHZJEG2QXp4Vga9WSAm6fQ7zWYQErrLHUgLZ6Vf7gK5DhppsRnlChhfq3ihcPtwIVN+fOziTzzdWkqeoLaQtPtkNaPpo1nBurLAubtpZejnPtLmDWCe9WCClCQ54GMnZKggBJhAoGAptsUXmkbswaMRGn4lQfVCKuH7cEwFU1qmYgHQzCUaoKGquL4yOlpXo1c6haDUBmr+gc1UZkZZZBhmZpVDLojjE0guaeriA+1Gj76ep1K9/sSdFNLNkmoFVK++/IRQElcdj/x/FuHTws0U6/7gtJ0p+WaRlToN8Ao+S5HOkfsRBPNcsEMP82p3066M+qJwhRnHQw3vgHM7JPhYZ5lgNVM8rdcNs4ZcK3hikNj6PkX6neKFl3ePDoGfW/TXmD/CzAAcryyBfjeu1oAAAAASUVORK5CYII=",app_icon_32px_red_mentions:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA+pJREFUeNqkVktvHEUQ7q7unp19xAkHJ6BFAhshgeI8pAgpuSAO3OLkCJw5cOEXwBX4F/yAiBMCxA1yyQWUG4kEIsoGoyiWDYg4jsc7091F9XRPT8/YkeNlPLvunUd99X1V1VX8+pV1Vh+IyLqHNrrSdJbFvPhsOr00OcGOf0iyyzmnlf+OR3M9wJoD8M8LwHiw1WOA9RFRnxizGABw5/ohDFIs+jwqywUZBPcZsoZARArAjAPAbL6/IINgi7VGo1a0JtP0ReevRfG/ADyPfiTQnVDDbGvzW7G3OECIai1ThHGu0wdgzPl7Y3i8+89CAPyQCvBsaCEABIeLA/FGJh7uPd6pykWyqLHq86XF87eIw0oGIyEHnH+9vXlsgLbQ/F8TCQdTqy9AnM/ERIolJb/9d+f3Y0YCYoR9CFK5Liu2PsCrOZ9KGAt5Qqo3c/HVo43iOEUne9LHUF/P+ftDx0IjKw1JJJakvDZWW/Py1ubs3elrrbZHMgjuN/Xs31yGQEWQFwBDQSrJk0q9oFSh57c2N55zd+LXLl/1ALGAkQXfvFwfjtg7GVbWfrmLPxSVNtUlVq6xciAHV868siTV0Wma7m4OqVl7QqvS1RqReIighJRCns+z5UFmTPnFg3u3n+wcFYPa4UgibqIUCbo8Yrgi3COE8YdllFSSybNDXmmmOGzMq0//3LgwHH704kuvD0fPDHLMnOg12V2VDoOs+wqZGbaWETzkyE4rXnCeAbyci2Wp71XVx7P7F0ejt8aTt0+eOpNlnRhQR/POpgm6ptgnk0N2bTotokYsjd23hvJ1z5i/KvP5jrHWGkt3cKrURIiVwUByykCUwS4PleZ/roqmrFNffFLVyeDKD7gCyEH8zU2eWYvWGIVot9FuaTvThfdJdhpyE4xv9nFmnEQfDJlX6UbBHhgHsZ7jWemS+fsC71ag0ewaUJKIoQXLaoq1JMGm7FRZrZX/+Yt2BbfSCPXjnD2tHaGs9U/c1vy+pnSQ9JwU1ntJPHzW0MoZ5Nit5CQStH5VhPWWZU/dEsecnYYm7Dq0PNeUsE4/jkB57wEgSCLj7n9wvDinQiTu6EDxnGK9K23ugXPYL5wpCLcgpmZ8NJJYbhjMdMiiuH/cqZpXmh6V1pMXsY1B28K6bMjuDeP0+akMt26WjhPZ+bliwVDaQprRId0HZTqtpDDeXJNd4Zldi9/NOzNHHEb6c1tzHVK7vamivf4MGeOoEG/1umGno0Xk+EJqMc2C1F9kmI45aUcJg0+fIB4+A6QYHYuMp5FLe3s/Bgdf7pHridt3vDNpthpK/581EUt37A4ww04MurQ6o2ZX2P8EGAAu1YEi4TmT9gAAAABJRU5ErkJggg=="}})()},4914:function(e,i){(function(){TS.registerModule("view.channel",{channel_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.channels.renamed_sig.add(TS.view.channel.channelRenamed,TS.view.channel);TS.channels.switched_sig.add(TS.view.channel.channelSwitched,TS.view.channel);TS.channels.member_joined_sig.add(TS.view.channel.channelMemberJoined,TS.view.channel);TS.channels.member_left_sig.add(TS.view.channel.channelMemberLeft,TS.view.channel);TS.channels.history_fetched_sig.add(TS.view.channel.channelHistoryFetched,TS.view.channel);TS.channels.history_being_fetched_sig.add(TS.view.channel.channelHistoryBeingFetched,TS.view.channel);if(!TS.useReactMessages()){TS.channels.message_received_sig.add(TS.view.channel.channelMessageReceived,TS.view.channel);TS.channels.message_removed_sig.add(TS.view.channel.channelMessageRemoved,TS.view.channel);TS.channels.message_changed_sig.add(TS.view.channel.channelMessageChanged,TS.view.channel)}TS.channels.marked_sig.add(TS.view.channel.channelMarked,TS.view.channel);TS.channels.unread_changed_sig.add(TS.view.channel.channelUnreadCountChanged,TS.view.channel);TS.channels.topic_changed_sig.add(TS.view.channel.channelTopicChanged,TS.view.channel);TS.channels.purpose_changed_sig.add(TS.view.channel.channelPurposeChanged,TS.view.channel);TS.channels.archived_sig.add(TS.view.channel.channelArchived,TS.view.channel);TS.channels.unarchived_sig.add(TS.view.channel.channelUnArchived,TS.view.channel);TS.channels.msg_not_sent_sig.add(TS.view.channel.channelMsgNotsent,TS.view.channel)},channelRenamed:function e(){TS.client.ui.rebuildAll();TS.view.updateTitleWithContext()},channelSwitched:function e(){TS.view._maybeUpdateOnboarding();TS.view.switchedHelper();TS.view.updateTitleWithContext();TS.view.updateTypingText()},channelMemberJoined:function e(i){if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.rebuildChannelMembersList();if(i.needs_created_message)TS.view.overlay.startWithCreatedChannel(i)},channelMemberLeft:function e(i){if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.rebuildChannelMembersList()},channelHistoryFetched:function e(i){if(i.id!=TS.model.active_channel_id)return;TS.client.ui.afterHistoryFetch(i)},channelHistoryBeingFetched:function e(i){if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.updateEndMarker();i=TS.channels.getChannelById(TS.model.active_channel_id);if(!i||!i.msgs.length)return;if(TS.redux.socket.isConnected())if(i.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(i.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")},channelMessageReceived:function e(i,t){if(i.id!=TS.model.active_channel_id)return;if(!t){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(t)){TS.view.addReplyMsg(i,t);return}if(TS.utility.msgs.isMsgHidden(t))return;var n=_.reject(i.msgs,TS.utility.msgs.isMsgHidden);var a=n;var r=a.length>1&&TS.utility.msgs.msgMightBeRolledUp(t)&&TS.utility.msgs.msgMightBeRolledUp(a[1]);if(r||1==a.length||a[0]!=t){var s=!i.is_mpim;TS.client.msg_pane.rebuildMsgsWithReason("channelMessageReceived",s)}else{TS.view.addMsg(t,i.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(i,t)}TS.view.channel.channel_ui_updated_with_new_msg_sig.dispatch(t)},channelMessageRemoved:function e(i,t){if(i.id!=TS.model.active_channel_id)return;if(!t){TS.error("no msg?");return}TS.view.removeMsg(i,t)},channelMessageChanged:function e(i,t,n){if(i.id!=TS.model.active_channel_id)return;setTimeout(function(){if(_.includes(n,"_hidden_reply")){if(t._hidden_reply&&_.includes(n,"subtype"))TS.view.channel.channelMessageRemoved(i,t);else if(!t._hidden_reply&&"thread_broadcast"===t.subtype)TS.view.channel.channelMessageReceived(i,t)}else TS.view.rebuildMsg(t,n)},0)},channelMarked:function e(i){if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.assignLastReadMsgDiv(i);TS.view.reClassUnreads(i.last_read)},channelUnreadCountChanged:function e(i){if(TS.useReactMessages())return;if(!i)return;TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(i);TS.client.msg_pane.maybeResetAndAutoScroll(i)},channelTopicChanged:function e(i){if(!i)return;if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.updateEndMarker()},channelPurposeChanged:function e(i){if(!i)return;if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.updateEndMarker()},channelArchived:function e(i){TS.client.msg_pane.rebuildChannelMembersList();if(i.id!=TS.model.active_channel_id||TS.model.threads_view_is_showing||TS.model.unread_view_is_showing)return;TS.client.archives.start()},channelUnArchived:function e(i){if(i.id!=TS.model.active_channel_id)return;TS.client.msg_pane.rebuildChannelMembersList();TS.client.msg_pane.rebuildMsgsWithReason("channelUnArchived")},channelMsgNotsent:function e(i,t,n){if(i.id!=TS.model.active_channel_id)return;TS.view.showUnSentControlsForMsg(t,i,n)}})})()},4915:function(e,i){(function(){TS.registerModule("view.dnd",{onStart:function e(){TS.dnd.dnd_statuses_changed_sig.add(TS.view.dnd.dndStatusesChanged,TS.view.dnd);TS.dnd.current_user_dnd_status_changed_sig.add(TS.view.dnd.currentUserDndStatusChanged,TS.view.dnd)},dndStatusesChanged:function e(i){if(!i||!i.length)return;var t=$(".presence[data-member-presence]");var n={};t.each(function(){var e=$(this);var i=e.attr("data-member-presence");if(!n[i])n[i]=[];n[i].push(e)});var a=0;i.forEach(function(e){var i=n[e.id];if(!i)return;i.forEach(function(i){a+=1;var t=TS.templates.makeMemberPresenceStateClass(e);i.removeClass("away active dnd").addClass(t);var n=TS.ims.getImByMemberId(e.id);if(n)i.closest(".im_name").attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:e,im:n}))})});if(TS.has_pri[2002])TS.log(2002,"dndStatusesChanged updated "+a+" out of "+t.length+" presence icons")},currentUserDndStatusChanged:function e(){if(TS.redux.socket.isConnected())TS.view.ms.maybeChangeConnectionDisplay();var i=$("#team_menu").find(".notifications_menu_btn");if(TS.dnd.isMemberInDnd(TS.model.user))i.removeClass("ts_icon_bell_o").addClass("ts_icon_snooze_outline");else i.removeClass("ts_icon_snooze_outline").addClass("ts_icon_bell_o")}})})()},4916:function(e,i){(function(){TS.registerModule("view.files",{onStart:function e(){TS.files.team_file_added_sig.add(TS.view.files.teamAdded,TS.view.files);TS.files.team_file_deleted_sig.add(TS.view.files.teamDeleted,TS.view.files);TS.files.team_file_changed_sig.add(TS.view.files.teamChanged,TS.view.files);TS.files.file_uploaded_sig.add(TS.view.files.uploaded,TS.view.files);TS.files.file_uploading_sig.add(TS.view.files.uploading,TS.view.files);TS.files.file_progress_sig.add(TS.view.files.progress,TS.view.files);TS.files.file_canceled_sig.add(TS.view.files.canceled,TS.view.files);TS.files.file_queue_emptied_sig.add(TS.view.files.queueEmptied,TS.view.files)},teamAdded:function e(i){if(!i.is_deleted&&TS.view.files.shouldAppearInlist(i))TS.view.files.throttledRebuildList()},teamDeleted:function e(i){if(TS.view.files.shouldAppearInlist(i))TS.view.files.throttledRebuildList()},teamChanged:function e(i){if(!i.is_deleted&&TS.view.files.shouldAppearInlist(i))TS.view.files.singleListItemChanged(i);var t=TS.shared.getActiveModelOb();if(t)TS.utility.msgs.updateFileMsgs(t,i)},uploaded:function e(i,t){if(TS.useReactMessages()){if(i)TS.redux.dispatch(TS.interop.redux.features.fileUpload.uploadComplete());return}$("#file_progress").queue(function(e){if(i){$(this).removeClass("loaded").find(".progress_bar").addClass("seafoam_green_bg no_transition").end().find(".progress_bar_progress_animated_thin").addClass("no_transition progress_bar_progress_thin progress_bar_progress_striped").removeClass("progress_bar_progress_animated_thin").attr("data-label-left",TS.i18n.t("Processing uploaded file… complete!","files")()).css({width:"0%"}).end();if(TS.model.ui_state.flex_visible){var n=TS.files.getFileById(t);if(n&&("snippet"===n.mode||"post"===n.mode))TS.client.ui.files.previewFile(n.id,"file_list")}}e()}).delay(1e3)},uploading:function e(i,t,n){if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.features.fileUpload.uploadStarting({fileName:i,isRetry:t,cancelable:n}));return}var a="";if(n)a+='<a id="cancel_upload_in_progress" class="float_right very_small_right_margin">'+TS.i18n.t("cancel","files")()+"</a>";var r="";if(t)r=TS.i18n.t("Re-uploading {filename}","files")({filename:i});else r=TS.i18n.t("Uploading {filename}","files")({filename:i});$("#file_progress").queue(function(e){$(this).toggleClass("is_cancelable",!!n).removeClass("hidden loaded").find(".progress_bar").removeClass("candy_red_bg seafoam_green_bg").end().find(".progress_bar_progress_thin").removeClass("no_transition").data("label-left-original",r).attr("data-label-left",r).end().find("#progress_text").html(a).find("#cancel_upload_in_progress").click(TS.files.cancelCurrentUpload);e();TS.client.msg_pane.topMessagesBannerShown()}).fadeIn(200)},progress:function e(i){if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.features.fileUpload.progressUpdate({percentComplete:i}));return}$("#file_progress").queue(function(e){$(this).find(".progress_bar.no_transition").removeClass("no_transition");var t=$(".progress_bar_progress_thin");var n="";if(TS.files.uploadQ.length)n=TS.i18n.t("(1 of {total})","files")({total:TS.files.uploadQ.length+1});if(i<99){var a=t.data("label-left-original")+"…"+i+"% "+n;t.css({width:i+"%"}).attr("data-label-left",a)}else $("#file_progress").addClass("loaded").find(".progress_bar_progress_thin").removeClass("progress_bar_progress_thin progress_bar_progress_striped").addClass("progress_bar_progress_animated_thin").css({width:"100%"}).attr("data-label-left",TS.i18n.t("Processing uploaded file…","files")()+" "+n).end().find("#cancel_upload_in_progress").remove().end();e()})},canceled:function e(i){if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.features.fileUpload.uploadCanceled());return}$("#file_progress").queue(function(e){$(this).removeClass("loaded").find(".progress_bar").addClass("candy_red_bg").end().find(".progress_bar_progress_thin").addClass("no_transition progress_bar_progress_striped").css({width:"0%"}).attr("data-label-left","").end().find("#progress_text").html(TS.i18n.t('Canceling <strong class="filename">{filename}</strong>…',"files")({filename:_.escape(i)})).end().find("#cancel_upload_in_progress").remove().end();e()}).delay(1e3)},queueEmptied:function e(){if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.features.fileUpload.uploadQueueEmptied());return}$("#file_progress").fadeOut(200,function(){TS.client.msg_pane.topMessagesBannerHidden()})},getNoFilesMessage:function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=i.type,n=void 0===t?"all":t,a=i.user,r=void 0===a?null:a;switch(n){case"posts":case"spaces":case"arugula":return!r?TS.i18n.t("No posts from you.","files")():TS.i18n.t("No posts from {user}.","files")({user:r});case"snippets":return!r?TS.i18n.t("No snippets from you.","files")():TS.i18n.t("No snippets from {user}.","files")({user:r});case"emails":return!r?TS.i18n.t("No emails from you.","files")():TS.i18n.t("No emails from {user}.","files")({user:r});case"images":return!r?TS.i18n.t("No images from you.","files")():TS.i18n.t("No images from {user}.","files")({user:r});case"videos":return!r?TS.i18n.t("No videos from you.","files")():TS.i18n.t("No videos from {user}.","files")({user:r});case"pdfs":return!r?TS.i18n.t("No PDFs from you.","files")():TS.i18n.t("No PDFs from {user}.","files")({user:r});case"gdocs":return!r?TS.i18n.t("No Google Docs from you.","files")():TS.i18n.t("No Google Docs from {user}.","files")({user:r});case"all":return!r?TS.i18n.t("No files from you.","files")():TS.i18n.t("No files from {user}.","files")({user:r});default:return TS.i18n.t("No files","files")()}},throttledRebuildList:function e(){TS.utility.throttle.method(TS.view.files.maybeRebuildList,"file_list_rebuild",1e3)},maybeRebuildList:function e(){if(!TS.model.ui_state.flex_visible||TS.model.ui_state.flex_name&&"files"!==TS.model.ui_state.flex_name||!TS.model.ui_state.flex_name&&"files"!==TS.model.default_flex_name)return;TS.view.files.rebuildList()},last_files_html:"",rebuildList:function i(){TS.metrics.mark("start_file_flexpane_rebuild");var t=$("#file_list");var n=$("#file_list_block");var a=t.data("list");var r=TS.model.files;var s;var o="/files";if("user"===a){r=TS.model.user.files;o+="/"+TS.model.user.name}else if(TS.interop.utility.looksLikeMemberId(a)){s=TS.members.getMemberById(a);if(s){r=s.files;o+="/"+s.name}else TS.error(a+" is not valid?")}var l=r.filter(function(e){return!e.is_deleted&&TS.view.files.shouldAppearInlist(e)});$("#file_list_heading").find(".heading_label").text(TS.view.file_list_heading);$("#file_list_toggle").removeClass("hidden");$("#file_search_cancel").addClass("hidden");var d=TS.model.file_list_types;var c=!d||!d.length||-1!=d.indexOf("all");n.find(".subsection").addClass("hidden");if(c)n.find('.subsection[data-filter="all"]').removeClass("hidden");else{if("all"===TS.model.active_file_list_member_filter)o+="/all";o+="/"+TS.model.active_file_list_filter;n.find('.subsection[data-filter="'+d[0]+'"]').removeClass("hidden")}if(!l.length){var _=TS.i18n.t("No files.","files")();if(c){if("user"===a)_=TS.i18n.t("No files from you.","files")();else if(s)_=TS.i18n.t("No files from {user}.","files")({user:"<strong>"+TS.members.getPrefCompliantMemberName(s,true)+"</strong>"})}else if("user"===a)_=TS.view.files.getNoFilesMessage({type:d[0]});else if(s)_=TS.view.files.getNoFilesMessage({type:d[0],user:"<strong>"+TS.members.getPrefCompliantMemberName(s,true)+"</strong>"});if(e){t.longListView("destroy");e=false}t.empty().html('<p class="no_results">'+_+"</p>")}if(l.length)if(!e){t.empty();var u=80;t.longListView({items:l,approx_item_height:u,preserve_dom_order:true,scrollable:$("#file_list_scroller"),makeElement:function e(){return $("<div>")},renderItem:function e(i,t){var n=TS.templates.builders.fileHTML(t,{show_channel_name:true});n=TS.format.replaceHighlightMarkers(n);var a=$(n);a.find("i.lazy").each(function(){var e=$(this);e.removeClass("lazy");e.css("background-image","url("+e.attr("data-original")+")")});i.attr("id",a.attr("id"));i.attr("class",a.attr("class"));i.attr("data-file-id",t.id);i.data("file-id",t.id);if(TS.boot_data.feature_arugula){i.attr("draggable","true");i.attr("data-drag-meta",TS.templates.makeFileDragData(t))}i.empty();a.children().each(function(){i.append(this)});TS.utility.makeSureAllLinksHaveTargets(i)},calcItemHeight:function e(i){var t=i.outerHeight();if(!t)return u;return t+12}});e=true}else t.longListView("setItems",l,false,true);if(0===TS.model.files.length)$("#file_listing_bottom_button").addClass("hidden");else $("#file_listing_bottom_button").removeClass("hidden").attr("href",o);TS.ui.utility.updateClosestMonkeyScroller(t);TS.metrics.measureAndClear("file_flexpane_rebuild","start_file_flexpane_rebuild")},filterSet:function e(){if("files"!==TS.model.ui.active_tab_id||!TS.model.ui_state.flex_visible||TS.model.previewed_file_id)TS.client.ui.files.showFileList();TS.view.files.maybeRebuildList();$("#file_list_scroller").scrollTop(0);TS.client.flex_pane.maybeFetchFileList()},clearFilter:function e(){TS.model.active_file_list_filter="all";TS.view.file_list_heading=TS.i18n.t("All File Types","files")();TS.model.file_list_types=["all"];TS.view.files.filterSet();TS.view.files.setButtonState("all");$("#file_list_clear_filter").addClass("hidden")},setButtonState:function e(i){$(".secondary_file_button").addClass("hidden");if("snippets"===i)$("#secondary_snippet_button").removeClass("hidden");else if("posts"===i)$("#secondary_post_button").removeClass("hidden");else $("#file_list_button").removeClass("hidden")},shouldAppearInlist:function e(i){var t=TS.model.file_list_types;if(!t)return true;if(!t.length)return true;if(t.indexOf("all")>-1)return true;if(t.indexOf("snippets")>-1&&"snippet"===i.mode)return true;if(t.indexOf("posts")>-1&&"post"===i.mode)return true;if(t.indexOf("spaces")>-1&&"space"===i.mode)return true;if(TS.boot_data.feature_arugula)if(t.indexOf("arugula")>-1&&"arugula"===i.mode)return true;if(t.indexOf("emails")>-1&&"email"===i.mode)return true;if(t.indexOf("zips")>-1&&"zip"===i.filetype)return true;if(t.indexOf("pdfs")>-1&&"pdf"===i.filetype)return true;if(t.indexOf("images")>-1&&i.mimetype&&0===i.mimetype.indexOf("image/"))return true;if(t.indexOf("videos")>-1&&i.mimetype&&0===i.mimetype.indexOf("video/"))return true;if(t.indexOf("gdocs")>-1&&i.mimetype&&0===i.mimetype.indexOf("application/vnd.google-apps"))return true;return false},singleListItemChanged:function i(t){if(!e)return;if("files"!==TS.model.ui_state.flex_name)return;$("#file_list").longListView("itemUpdated",t)},cleanList:function i(){if(e){$("#file_list").longListView("destroy");e=false}},hideList:function i(){if(!e)return;$("#file_list_scroller").data("disable-scroll",true);$("#file_list").longListView("setHidden",true)},unHideList:function i(){$("#file_list_scroller").data("disable-scroll",false);if(e)$("#file_list").longListView("setHidden",false);else TS.view.files.rebuildList()},shareInCurrentChannelOrIM:function e(i,t){TS.ui.share_dialog.start(i,void 0,void 0,t,true)},delete:function e(i){var t;var n;var a;var r=TS.files&&TS.files.getFileById?TS.files.getFileById(i):null;if(r&&r.filetype&&"space"===r.filetype){t=TS.i18n.t("Delete post","files")();n=TS.i18n.t("Are you sure you want to delete this post permanently?","files")();a=TS.i18n.t("Yes, delete this post","files")()}else{t=TS.i18n.t("Delete file","files")();n=r.is_external?TS.i18n.t("Are you sure you want to permanently delete this file from Slack?","files")():TS.i18n.t("Are you sure you want to delete this file permanently?","files")();a=TS.i18n.t("Yes, delete this file","files")()}TS.generic_dialog.start({title:t,body:n,show_cancel_button:true,show_go_button:true,go_button_class:"btn_danger",go_button_text:a,cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:function e(){TS.files.deleteFile(i)}})},saveToDropbox:function e(i){TS.generic_dialog.start({title:TS.i18n.t("Save to Dropbox","files")(),body:TS.i18n.t("Do you want to save this file to your Dropbox Slack folder?","files")(),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes","files")(),cancel_button_text:TS.i18n.t("No","files")(),onGo:function e(){TS.files.saveFileToDropbox(i)}})}});var e=false})()},4917:function(e,i){(function(){TS.registerModule("view.group",{group_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.groups.renamed_sig.add(TS.view.group.groupRenamed,TS.view.group);TS.groups.switched_sig.add(TS.view.group.groupSwitched,TS.view.group);TS.groups.member_joined_sig.add(TS.view.group.groupMemberJoined,TS.view.group);TS.groups.member_left_sig.add(TS.view.group.groupMemberLeft,TS.view.group);TS.groups.history_fetched_sig.add(TS.view.group.groupHistoryFetched,TS.view.group);TS.groups.history_being_fetched_sig.add(TS.view.group.groupHistoryBeingFetched,TS.view.group);if(!TS.useReactMessages()){TS.groups.message_received_sig.add(TS.view.group.groupMessageReceived,TS.view.group);TS.groups.message_removed_sig.add(TS.view.group.groupMessageRemoved,TS.view.group);TS.groups.message_changed_sig.add(TS.view.group.groupMessageChanged,TS.view.group)}TS.groups.marked_sig.add(TS.view.group.groupMarked,TS.view.group);TS.groups.unread_changed_sig.add(TS.view.group.groupUnreadCountChanged,TS.view.group);TS.groups.unread_highlight_changed_sig.add(TS.view.group.groupUnreadHighlightCountChanged,TS.view.group);TS.groups.topic_changed_sig.add(TS.view.group.groupTopicChanged,TS.view.group);TS.groups.purpose_changed_sig.add(TS.view.group.groupPurposeChanged,TS.view.group);TS.groups.opened_sig.add(TS.view.group.groupOpened,TS.view.group);TS.groups.closed_sig.add(TS.view.group.groupClosed,TS.view.group);TS.groups.archived_sig.add(TS.view.group.groupArchived,TS.view.group);TS.groups.unarchived_sig.add(TS.view.group.groupUnArchived,TS.view.group);TS.groups.msg_not_sent_sig.add(TS.view.group.groupMsgNotSent,TS.view.group)},groupRenamed:function e(){TS.view.updateTitleWithContext();TS.client.ui.rebuildAll()},groupSwitched:function e(){TS.view._maybeUpdateOnboarding();TS.view.switchedHelper();TS.view.unAdjustForWelcomeSlideShow();TS.view.updateTitleWithContext();TS.view.updateTypingText()},created_group_overlay_tim:0,groupMemberJoined:function e(i){if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.rebuildChannelMembersList();if(i.needs_created_message){clearTimeout(TS.view.group.created_group_overlay_tim);TS.view.group.created_group_overlay_tim=setTimeout(function(){if(i.id==TS.model.active_group_id)TS.view.overlay.startWithCreatedGroup(i)},1e3)}},groupMemberLeft:function e(i){if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.rebuildChannelMembersList()},groupHistoryFetched:function e(i){if(i.id!=TS.model.active_group_id)return;TS.client.ui.afterHistoryFetch(i)},groupHistoryBeingFetched:function e(i){if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.updateEndMarker();i=TS.groups.getGroupById(TS.model.active_group_id);if(!i||!i.msgs.length)return;if(TS.redux.socket.isConnected())if(i.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(i.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")},groupMessageReceived:function e(i,t){if(i.id!=TS.model.active_group_id)return;if(!t){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(t)){TS.view.addReplyMsg(i,t);return}if(TS.utility.msgs.isMsgHidden(t))return;var n=_.reject(i.msgs,TS.utility.msgs.isMsgHidden);var a=n;var r=a.length>1&&TS.utility.msgs.msgMightBeRolledUp(t)&&TS.utility.msgs.msgMightBeRolledUp(a[1]);if(r||1==a.length||a[0]!=t){var s=true;TS.client.msg_pane.rebuildMsgsWithReason("groupMessageReceived",s)}else{TS.view.addMsg(t,i.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(i,t)}TS.view.group.group_ui_updated_with_new_msg_sig.dispatch(t)},groupMessageRemoved:function e(i,t){if(i.id!=TS.model.active_group_id)return;if(!t){TS.error("no msg?");return}TS.view.removeMsg(i,t)},groupMessageChanged:function e(i,t,n){if(i.id!=TS.model.active_group_id)return;setTimeout(function(){if(_.includes(n,"_hidden_reply")){if(t._hidden_reply&&_.includes(n,"subtype"))TS.view.group.groupMessageRemoved(i,t);else if(!t._hidden_reply&&"thread_broadcast"===t.subtype)TS.view.group.groupMessageReceived(i,t)}else TS.view.rebuildMsg(t,n)},0)},groupMarked:function e(i){if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.assignLastReadMsgDiv(i);TS.view.reClassUnreads(i.last_read)},groupUnreadCountChanged:function e(i){if(TS.useReactMessages())return;if(!i)return;var t="."+TS.templates.makeGroupDomId(i);var n=$(t);if(0===i.unread_cnt)n.removeClass("unread mention");else{n.addClass("unread");if(i.unread_highlight_cnt>0)n.addClass("mention")}if(i._show_in_list_even_though_no_unreads)n.addClass("show_in_list_even_though_no_unreads");else n.removeClass("show_in_list_even_though_no_unreads");var a=n.find(".group_name");if(a.length)a.attr("aria-label",TS.templates.builders.makeChannelLinkAriaLabelSafe(i));t="."+TS.templates.makeUnreadMsgsDomId(i);var r=$(t);if(0===i.unread_cnt)r.html(i.unread_cnt).addClass("hidden");else if(i.unread_cnt<10)r.html(i.unread_cnt).removeClass("hidden");else r.html("9+").removeClass("hidden");TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(i);TS.client.msg_pane.maybeResetAndAutoScroll(i)},groupUnreadHighlightCountChanged:function e(i){if(TS.useReactMessages())return;if(!i)return;var t="."+TS.templates.makeUnreadHighlightDomId(i);if(0===i.unread_highlight_cnt)$(t).html(i.unread_highlight_cnt).addClass("hidden");else if(i.unread_highlight_cnt<10)$(t).html(i.unread_highlight_cnt).removeClass("hidden");else $(t).html("9+").removeClass("hidden")},groupTopicChanged:function e(i){if(!i)return;if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.updateEndMarker()},groupPurposeChanged:function e(i){if(!i)return;if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.updateEndMarker()},groupOpened:function e(){TS.client.msg_pane.rebuildChannelMembersList()},groupClosed:function e(){TS.client.msg_pane.rebuildChannelMembersList()},groupArchived:function e(i){if(i.id!=TS.model.active_group_id||TS.model.threads_view_is_showing||TS.model.unread_view_is_showing)return;TS.client.archives.start()},groupUnArchived:function e(i){if(i.id!=TS.model.active_group_id)return;TS.client.msg_pane.rebuildMsgsWithReason("groupUnArchived")},groupMsgNotSent:function e(i,t,n){if(i.id!=TS.model.active_group_id)return;TS.view.showUnSentControlsForMsg(t,i,n)}})})()},4918:function(e,i){(function(){TS.registerModule("view.im",{im_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.ims.opened_sig.add(TS.view.im.imOpened,TS.view.im);TS.ims.closed_sig.add(TS.view.im.imClosed,TS.view.im);TS.ims.switched_sig.add(TS.view.im.imSwitched,TS.view.im);TS.ims.history_fetched_sig.add(TS.view.im.imHistoryFetched,TS.view.im);TS.ims.history_being_fetched_sig.add(TS.view.im.imHistoryBeingFetched,TS.view.im);if(!TS.useReactMessages()){TS.ims.message_received_sig.add(TS.view.im.imMessageReceived,TS.view.im);TS.ims.message_removed_sig.add(TS.view.im.imMessageRemoved,TS.view.im);TS.ims.message_changed_sig.add(TS.view.im.imMessageChanged,TS.view.im)}TS.ims.marked_sig.add(TS.view.im.imMarked,TS.view.im);TS.ims.unread_changed_sig.add(TS.view.im.imUnreadCountChanged,TS.view.im);TS.ims.unread_highlight_changed_sig.add(TS.view.im.imUnreadHighlightCountChanged,TS.view.im);TS.ims.msg_not_sent_sig.add(TS.view.im.imMsgNotsent,TS.view.im)},imOpened:function e(){TS.client.msg_pane.rebuildChannelMembersList()},imClosed:function e(){TS.client.msg_pane.rebuildChannelMembersList()},imSwitched:function e(){TS.view._maybeUpdateOnboarding();TS.view.switchedHelper();if(!TS.onboarding.inOnboarding())TS.view.unAdjustForWelcomeSlideShow();TS.view.updateTitleWithContext();TS.view.updateTypingText()},imHistoryFetched:function e(i){if(i.id!==TS.model.active_im_id)return;TS.client.ui.afterHistoryFetch(i)},imHistoryBeingFetched:function e(i){if(i.id!==TS.model.active_im_id)return;TS.client.msg_pane.updateEndMarker();i=TS.ims.getImById(TS.model.active_im_id);if(!i||!i.msgs.length)return;if(TS.redux.socket.isConnected())if(i.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(i.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;TS.client.msg_pane.updateEndMarker();$("html").unbind("mousemove.monkeyScroll")},imMessageReceived:function e(i,t,n){if(!n&&TS.model.user&&TS.model.user.is_restricted)if(-1===(TS.model.guest_accessible_user_ids||[]).indexOf(i.user)){TS.members.maybeUpdateMembersUserCanSee(i.user).then(function(){TS.view.im.imMessageReceived(i,t,true)});return}if(i.id!==TS.model.active_im_id)return;if(!t){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(t)){TS.view.addReplyMsg(i,t);return}if(TS.utility.msgs.isMsgHidden(t))return;if(1===i.msgs.length||i.msgs[0]!==t)TS.client.msg_pane.rebuildMsgsWithReason("imMessageReceived");else{TS.view.addMsg(t,i.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(i,t)}TS.view.im.im_ui_updated_with_new_msg_sig.dispatch(t)},imMessageRemoved:function e(i,t){if(i.id!==TS.model.active_im_id)return;if(!t){TS.error("no msg?");return}TS.view.removeMsg(i,t)},imMessageChanged:function e(i,t,n){if(i.id!==TS.model.active_im_id)return;setTimeout(function(){if(_.includes(n,"_hidden_reply")){if(t._hidden_reply&&_.includes(n,"subtype"))TS.view.im.imMessageRemoved(i,t);else if(!t._hidden_reply&&"thread_broadcast"===t.subtype)TS.view.im.imMessageReceived(i,t)}else TS.view.rebuildMsg(t,n)},0)},imMarked:function e(i){if(i.id!==TS.model.active_im_id)return;TS.client.msg_pane.assignLastReadMsgDiv(i);TS.view.reClassUnreads(i.last_read)},imUnreadCountChanged:function e(i){if(TS.useReactMessages())return;if(!i)return;var t=TS.members.getMemberById(i.user);var n="."+TS.templates.makeMemberDomId(t);var a=$(n);var r="."+TS.templates.makeUnreadHighlightDomId(t);if(0===i.unread_cnt){a.removeClass("unread mention");$(r).html(i.unread_cnt).addClass("hidden")}else if(i.unread_cnt<10){a.addClass("unread mention");$(r).html(i.unread_cnt).removeClass("hidden")}else{a.addClass("unread mention");$(r).html("9+").removeClass("hidden")}var s=a.find(".im_name");if(s.length)s.attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:t,im:i}));TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(i);TS.client.msg_pane.maybeResetAndAutoScroll(i)},imUnreadHighlightCountChanged:function e(i){if(TS.useReactMessages())return;if(!i)return;var t="."+TS.templates.makeUnreadHighlightDomId(i);$(t).html(i.unread_highlight_cnt)},imMsgNotsent:function e(i,t,n){if(i.id!==TS.model.active_im_id)return;TS.view.showUnSentControlsForMsg(t,i,n)}})})()},4919:function(e,i){(function(){TS.registerModule("view.members",{unknown_resolution_rebuild_sig:new signals.Signal,onStart:function e(){TS.members.presence_changed_sig.add(TS.view.members.memberPresenceChanged,TS.view.members);TS.members.status_changed_sig.add(TS.view.members.memberStatusChanged,TS.view.members);TS.members.changed_name_sig.add(TS.view.members.memberChangedName,TS.view.members);TS.members.changed_self_sig.add(TS.view.members.somethingChangedOnUser,TS.view.members);TS.members.changed_deleted_sig.add(i,TS.view.members);TS.members.non_loaded_changed_deleted_sig.add(i,TS.view.members);TS.members.changed_profile_sig.add(TS.view.members.memberChangedProfile,TS.view.members);TS.members.changed_current_status_sig.add(TS.view.members.memberChangedCurrentStatus,TS.view.members);TS.members.changed_tz_sig.add(TS.view.members.memberChangedTZ,TS.view.members);TS.members.changed_account_type_sig.add(TS.view.members.memberAccountTypeChanged,TS.view.members);TS.members.changed_admin_perms_sig.add(TS.view.members.memberAdminPermsChanged,TS.view.members);TS.members.changed_owner_perms_sig.add(TS.view.members.memberAdminPermsChanged,TS.view.members);TS.members.changed_is_unknown_sig.add(t);TS.typing.started_sig.add(TS.view.members.memberTypingStarted,TS.view.members);TS.typing.ended_sig.add(TS.view.members.memberTypingEnded,TS.view.members);TS.stars.member_stars_fetched_sig.add(TS.view.members.memberStarsFetched,TS.view.members);TS.view.members.unknown_resolution_rebuild_sig.add(TS.view.members.memberChangedName)},memberPresenceChanged:function e(i){if(!i)return;var t;var n;var a;if(i.is_self){if(TS.redux.socket.isConnected())TS.view.ms.maybeChangeConnectionDisplay();var r=$("#menu").find("#member_presence").find(".menu_item_label");if("away"===i.presence)r.text(TS.i18n.t("[Away] Set yourself to active","view_members")());else r.text(TS.i18n.t("Set yourself away","view_members")())}else{t="."+TS.templates.makeMemberDomId(i);n=$(t).not(".call_icon");if("away"===i.presence)n.addClass("away");else n.removeClass("away")}t="."+TS.templates.makeMemberPresenceDomClass(i.id);a=TS.templates.makeMemberPresenceStateClass(i);var s="active"===i.presence?TS.i18n.t("active","view_members")():TS.i18n.t("away","view_members")();$(t).removeClass("away active dnd").addClass(a).attr("title",s);var o=TS.ims.getImByMemberId(i.id);if(o)$(t).closest(".im_name").attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:i,im:o}));TS.view.last_team_list_html=null},memberStatusChanged:function e(i){if(!i)return;if(i.is_self)$(".user_status_label").text(i.status||"");var t="."+TS.templates.makeMemberStatusDomClass(i.id);$(t).html(i.status?i.status:"-");TS.view.updateTeamListCache()},memberChangedName:function e(i){if(i.id==TS.model.user.id){TS.view.members.updateUserDisplayName();TS.prefs.setHighlightWords(TS.prefs.getPref("highlight_words"))}TS.view.updateTitleWithContext();var t=true;TS.client.ui.rebuildAll(t);TS.view.rebuildTeamMember(i);if(i.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(i.id)},somethingChangedOnUser:function e(){TS.view.showProperTeamPaneFiller()},memberChangedProfile:function e(i){var t=[];if(!TS.members.is_in_bulk_upsert_mode){var n=false;var a=TS.shared.getActiveModelOb();if(a)n=a.is_im&&a.user===i.id||a.is_mpim&&a.members.indexOf(i.id)>-1;var r=_.map(TS.model.ims,"user").indexOf(i.id)>-1;var s=i.id===TS.model.user.id;var o={channel_header:!n,user_current_status:!s,channel_pane_channels:true,channel_pane_apps:true,channel_pane_ims:!r,channel_pane_starred:!r};var l=true;TS.client.ui.rebuildAllButMsgs(o,l);TS.view.rebuildMsgsIncludingMember(i);TS.client.ui.threads.rebuildMsgsIncludingMember(i);TS.ui.replies.rebuildMsgsIncludingMember(i);if(TS.client.unread.isEnabled())TS.client.ui.unread.rebuildMsgsIncludingMember(i)}if(i.id==_.get(TS.model.user,"id")){TS.view.members.updateUserDisplayName();t.push("url("+i.profile.image_72+")");$('a[data-member-id="'+TS.model.user.id+'"] .member_image, a[data-member-id="'+TS.model.user.id+'"].member_image').attr("style","background-image: "+t.join(","));$('#menu a[data-member-id="'+TS.model.user.id+'"].member_image').attr("style","background-image: "+TS.templates.builders.makeMemberPreviewCardLinkImageBackground(TS.model.user.id))}TS.view.rebuildTeamMember(i);if(i.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(i.id)},memberChangedCurrentStatus:function e(i){if(!TS.members.is_in_bulk_upsert_mode){var t=TS.shared.getActiveModelOb();var n=t&&t.is_im&&t.user===i.id||t&&t.is_mpim&&t.members.indexOf(i.id)>-1;var a=_.map(TS.model.ims,"user").indexOf(i.id)>-1;var r=i.id===TS.model.user.id;var s={channel_header:!n,user_current_status:!r,channel_pane_channels:true,channel_pane_apps:true,channel_pane_ims:!a,channel_pane_starred:!a};var o=true;TS.client.ui.rebuildAllButMsgs(s,o);TS.view.rebuildMsgCurrentStatusIncludingMember(i);TS.client.ui.threads.rebuildMsgCurrentStatusIncludingMember(i);TS.ui.replies.rebuildMsgCurrentStatusIncludingMember(i);TS.client.ui.flex.rebuildMsgCurrentStatusIncludingMember(i);TS.client.ui.unread.rebuildMsgCurrentStatusIncludingMember(i);$(".team_list_item.member_item .current_status.color_"+i.id).replaceWith(TS.templates.current_status({member:i}));var l=TS.templates.current_status({member:i,classes:"ts_tip_float"});$(".member_info .current_status.color_"+i.id).replaceWith(l);$("#channel_page_member_"+i.id+" .current_status").replaceWith(l)}if(i.id==TS.model.user.id)TS.view.members.updateUserCurrentStatus();TS.view.rebuildTeamMember(i);if(i.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(i.id)},memberChangedTZ:function e(i){var t=true;TS.client.ui.rebuildAll(t);TS.view.rebuildTeamMember(i);if(i.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(i.id)},member_account_changed_tim:0,memberAccountTypeChanged:function e(i){if(i&&i.id==TS.model.user.id)return;clearTimeout(TS.view.members.member_account_changed_tim);TS.view.members.member_account_changed_tim=setTimeout(function(){if(i.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(i.id)},1e3)},memberAdminPermsChanged:function e(i){if(i&&i.id==TS.model.user.id)TS.ui.admin_invites.maybeShowInviteLink();$("#team_list_admin_link").toggleClass("hidden",!i.is_admin);if(TS.model.previewed_member_id===i.id)TS.client.ui.previewMember(i.id)},updateUserDisplayName:function e(){$(".current_user_name").html(TS.members.getPrefCompliantMemberName(TS.model.user,true))},updateUserCurrentStatus:function e(){$(".current_user_current_status").replaceWith(TS.templates.current_status({member:TS.model.user,tip_direction:"bottom",classes:"current_user_current_status ts_tip_float"}))},getUserPresenceStr:function e(){var i=TS.model.user;if("away"===i.manual_presence)return i.presence+" "+TS.i18n.t("(manual)","view_members")();return i.presence},memberTypingStarted:function e(i,t){if(!TS.prefs.getPref("show_typing"))return;var n=TS.shared.getActiveModelOb();if(n&&i.id==n.id)TS.view.updateTypingText();if(t.is_self)return;var a=TS.view.members.getSelectorForTypingIndicator(i,t);if(a)$(a).addClass("typing")},memberTypingEnded:function e(i,t){var n=TS.shared.getActiveModelOb();if(n&&i.id==n.id)TS.view.updateTypingText();var a=TS.view.members.getSelectorForTypingIndicator(i,t);if(a)$(a).removeClass("typing")},getSelectorForTypingIndicator:function e(i,t){var n;var a=TS.shared.getActiveModelOb();if(i.is_im)n=".channels_list_holder ul li."+TS.templates.makeMemberDomId(t);else if(a&&i.id===a.id)n="#"+TS.templates.makeChannelListDomId(i)+" ."+TS.templates.makeMemberDomId(t);return n},memberStarsFetched:function e(i,t){TS.view.toggleStarsError(!!i);if(i)return;if(!t||!t.is_self)return;TS.view.rebuildStars()}});var e=false;var i=function i(){if(e)return;var t=TS.shared.getActiveModelOb();if(!t)return;e=true;TS.utility.rAF(function(){e=false;TS.client.msg_pane.rebuildChannelMembersList()})};var t=function e(i){if($(".unknown_member").length>0)TS.view.members.unknown_resolution_rebuild_sig.dispatch(i)}})()},4920:function(e,i){(function(){TS.registerModule("view.mpim",{mpim_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.mpims.switched_sig.add(TS.view.mpim.mpimSwitched,TS.view.mpim);TS.mpims.history_fetched_sig.add(TS.view.mpim.mpimHistoryFetched,TS.view.mpim);TS.mpims.history_being_fetched_sig.add(TS.view.mpim.mpimHistoryBeingFetched,TS.view.mpim);if(!TS.useReactMessages()){TS.mpims.message_received_sig.add(TS.view.mpim.mpimMessageReceived,TS.view.mpim);TS.mpims.message_removed_sig.add(TS.view.mpim.mpimMessageRemoved,TS.view.mpim);TS.mpims.message_changed_sig.add(TS.view.mpim.mpimMessageChanged,TS.view.mpim)}TS.mpims.marked_sig.add(TS.view.mpim.mpimMarked,TS.view.mpim);TS.mpims.unread_changed_sig.add(TS.view.mpim.mpimUnreadCountChanged,TS.view.mpim);TS.mpims.unread_highlight_changed_sig.add(TS.view.mpim.mpimUnreadHighlightCountChanged,TS.view.mpim);TS.mpims.msg_not_sent_sig.add(TS.view.mpim.mpimMsgNotsent,TS.view.mpim)},mpimSwitched:function e(){TS.view._maybeUpdateOnboarding();var i=!TS.model.ms_logged_in_once;TS.view.switchedHelper(i);if(!TS.onboarding.inOnboarding())TS.view.unAdjustForWelcomeSlideShow();TS.view.updateTitleWithContext();TS.view.updateTypingText()},mpimHistoryFetched:function e(i){if(i.id!==TS.model.active_mpim_id)return;TS.client.ui.afterHistoryFetch(i)},mpimHistoryBeingFetched:function e(i){if(i.id!==TS.model.active_mpim_id)return;TS.client.msg_pane.updateEndMarker();i=TS.mpims.getMpimById(TS.model.active_mpim_id);if(!i||!i.msgs.length)return;if(TS.redux.socket.isConnected())if(i.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(i.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")},mpimMessageReceived:function e(i,t){if(i.id!==TS.model.active_mpim_id)return;if(!t){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(t)){TS.view.addReplyMsg(i,t);return}if(TS.utility.msgs.isMsgHidden(t))return;if(1===i.msgs.length||i.msgs[0]!==t)TS.client.msg_pane.rebuildMsgsWithReason("mpimMessageReceived");else{TS.view.addMsg(t,i.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(i,t)}TS.view.mpim.mpim_ui_updated_with_new_msg_sig.dispatch(t)},mpimMessageRemoved:function e(i,t){if(i.id!==TS.model.active_mpim_id)return;if(!t){TS.error("no msg?");return}TS.view.removeMsg(i,t)},mpimMessageChanged:function e(i,t,n){if(i.id!==TS.model.active_mpim_id)return;setTimeout(function(){if(_.includes(n,"_hidden_reply")){if(t._hidden_reply&&_.includes(n,"subtype"))TS.view.mpim.mpimMessageRemoved(i,t);else if(!t._hidden_reply&&"thread_broadcast"===t.subtype)TS.view.mpim.mpimMessageReceived(i,t)}else TS.view.rebuildMsg(t,n)},0)},mpimMarked:function e(i){if(i.id!==TS.model.active_mpim_id)return;TS.client.msg_pane.assignLastReadMsgDiv(i);TS.view.reClassUnreads(i.last_read)},mpimUnreadCountChanged:function e(i){if(TS.useReactMessages())return;if(!i)return;var t=$("#im-list, #starred-list").find("."+TS.templates.makeMpimDomId(i));t.replaceWith(TS.templates.mpim({model_ob:i}));TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(i);TS.client.msg_pane.maybeResetAndAutoScroll(i)},mpimUnreadHighlightCountChanged:function e(){},mpimMsgNotsent:function e(i,t,n){if(i.id!==TS.model.active_mpim_id)return;TS.view.showUnSentControlsForMsg(t,i,n)}})})()},4921:function(e,i){(function(){TS.registerModule("view.ms",{onStart:function e(){TS.redux.socket.troubleConnectingSig.add(TS.view.ms.socketTroubled,TS.view.ms);TS.redux.socket.waitingForRateLimitSig.add(TS.view.ms.socketReconnecting,TS.view.ms);TS.redux.socket.connectedSig.add(TS.view.ms.socketConnected,TS.view.ms);TS.redux.socket.disconnectedSig.add(TS.view.ms.socketDisconnected,TS.view.ms)},ever_connected:false,socketConnected:function i(t){var n=!!TS.view.ms.ever_connected;if(TS.view.ms.ever_connected){TS.utility.msgs.removeAllEphemeralMsgsByType("disconnected_feedback");TS.client.ui.rebuildAllButMsgs();TS.client.ui.rebuildMemberListToggle();TS.mentions.maybeUpdateMentions();if(t){var a=TS.shared.getActiveModelOb();if(a)TS.shared.maybeDealWithAllSentTempMsgs(a,TS.shared.getControllerForModelOb(a))}}else{if(TS.metrics.getLatestMark("start_load")){TS.metrics.measure("client_load","start_load");if(TS.useReactMessages())TS.metrics.measure("client_load_react_msgs","start_load");else TS.metrics.measure("client_load_legacy_msgs","start_load")}TS.metrics.measure("client_total_load","start_nav");TS.interop.metrics.logPerfTimingSections();e()}TS.view.ms.ever_connected=true;TS.client.msg_input.setOnline();s();$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden();TS.view.ms.changeConnectionStatus("online");TS.view.prefs.toggleSpellcheck();TS.view.checkIfInputShouldBeDisabledAndPopulate(n);TS.ui.a11y.annouceCurrentChannelOrImOrGroup()},socketTroubled:function e(){TS.view.ms.changeConnectionStatus("trouble");TS.client.msg_input.setOffline();TS.info("Hiding the reconnection banner because we are troubled");s()},socketDisconnected:function e(){TS.view.ms.changeConnectionStatus("offline");TS.client.msg_input.setOffline();TS.info("Hiding the reconnection banner because we are disconnected");s()},socketReconnecting:function e(i){if(TS.model.window_unloading){TS.info("Hiding the reconnection banner because we are unloading");s();$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden()}else if($("#connection_div").hasClass("hidden"))a(i);else r(i)},current_connection_status:null,changeConnectionStatus:function e(i){TS.view.ms.current_connection_status=i;TS.view.maybeChangeFavIco();TS.view.ms.maybeChangeConnectionDisplay()},maybeChangeConnectionDisplay:function e(){var i=$("#presence");var t="";var n;switch(TS.view.ms.current_connection_status){case"online":TSSSB.call("setConnectionStatus","online");if("away"===TS.model.user.presence){n=TS.dnd.isMemberInDnd(TS.model.user)?TS.i18n.t('Away<br><span class="greigh">Notifications snoozed</span>',"ms")():TS.i18n.t("Away","ms")();t="away"}else{n=TS.dnd.isMemberInDnd(TS.model.user)?TS.i18n.t('Active<br><span class="greigh">Notifications snoozed</span>',"ms")():TS.i18n.t("Active","ms")();t="active"}if(TS.dnd.isMemberInDnd(TS.model.user))t+=" dnd";break;case"trouble":TSSSB.call("setConnectionStatus","connecting");n=TS.i18n.t("Connecting...","ms")();t="connecting";break;default:TSSSB.call("setConnectionStatus","offline");n=TS.i18n.t("away","ms")();t="Away"}TS.tips.updateTipTitle($("#presence_container"),n);i.removeClass("active away connecting dnd");i.addClass(t)}});var e=function e(){var i=Array.prototype.slice.call(document.getElementsByTagName("style"));var t=Array.prototype.slice.call(document.getElementsByTagName("link"));var n=Array.prototype.slice.call(document.getElementsByTagName("script"));var a=n.filter(function(e){return!e.src&&"text/x-handlebars-template"!==e.type});var r=n.filter(function(e){return!!e.src});var s=n.filter(function(e){return!e.src&&"text/x-handlebars-template"===e.type});t=t.filter(function(e){return"stylesheet"===e.rel});TS.metrics.store("inline_script_nodes",a.length,{is_count:true});TS.metrics.store("inline_template_nodes",s.length,{is_count:true});TS.metrics.store("inline_style_nodes",i.length,{is_count:true});TS.metrics.store("external_script_nodes",r.length,{is_count:true});TS.metrics.store("external_link_nodes",t.length,{is_count:true})};var i=1e4;var t;var n;var a=function e(a){n=a;if(t)return;if(1e3*a>i){r(a);return}t=setTimeout(function(){t=void 0;if(!TS.redux.socket.isConnected())r(n)},i)};var r=function e(i){s();if(TS.api.isPaused()&&!$("#connection_div").hasClass("hidden")){TS.info("Not showing reconnecting banner because API is paused and showing its own banner");return}var t=TS.i18n.t("Reconnecting...","ms")();if(i){t=TS.i18n.t("Reconnecting in {num_secs, plural, =1 {# second} other {# seconds...}}","ms")({num_secs:i});if(i>2)t+=' <a onclick="TS.client.manualReconnectNow()">'+TS.i18n.t("Retry now?","ms")()+"</a>"}$("#connection_div").html(t).removeClass("hidden");TS.client.msg_pane.topMessagesBannerShown()};var s=function e(){if(!t)return;clearTimeout(t);t=void 0}})()},4922:function(e,i){(function(){TS.registerModule("view.prefs",{onStart:function i(){TS.prefs.webapp_spellcheck_changed_sig.add(TS.view.prefs.toggleSpellcheck,TS.view.prefs);TS.prefs.highlight_words_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.highlight_words_changed_sig"),TS.view.prefs);TS.prefs.emoji_mode_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.expand_inline_imgs_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_inline_imgs_changed_sig"),TS.view.prefs);TS.prefs.expand_internal_inline_imgs_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_internal_inline_imgs_changed_sig"),TS.view.prefs);TS.prefs.expand_non_media_attachments_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_non_media_attachments_changed_sig"),TS.view.prefs);TS.prefs.obey_inline_img_limit_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.obey_inline_img_limit_changed_sig"),TS.view.prefs);TS.prefs.messages_theme_changed_sig.add(TS.ui.setThemeClasses,TS);TS.prefs.dtop_notif_changed_sig.add(TS.view.prefs.dTopNotificationChanged,TS.view.prefs);TS.prefs.sidebar_behavior_changed_sig.add(TS.view.prefs.sidebarBehaviorPrefChanged,TS.view.prefs);TS.prefs.team_hide_referers_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.team_hide_referers_changed_sig"),TS.view.prefs);TS.prefs.team_perms_pref_changed_sig.add(TS.view.prefs.teamPermsPrefChanged,TS.view.prefs);TS.prefs.display_real_names_override_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.team_display_real_names_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.time24_changed_sig.add(TS.view.prefs.time24PrefChanged,TS.view.prefs);TS.prefs.sidebar_theme_changed_sig.add(TS.view.prefs.sidebarThemePrefChanged,TS.view.prefs);TS.prefs.mentions_exclude_at_channels_changed_sig.add(TS.view.prefs.rebuildMentionOptions,TS.view.prefs);TS.prefs.mentions_exclude_at_user_groups_changed_sig.add(TS.view.prefs.rebuildMentionOptions,TS.view.prefs);TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.add(e,TS.view.prefs);TS.prefs.team_display_email_addresses_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.hide_hex_swatch_changed_sig.add(TS.view.prefs.hideHexSwatchPrefChanged,TS.view.prefs)},toggleSpellcheck:function e(){var i='textarea, [contenteditable="true"]';$(i).attr("autocorrect","off");$(i).attr("autocomplete","off");if(TS.prefs.getPref("webapp_spellcheck"))$(i).attr("spellcheck",true);else $(i).attr("spellcheck",false)},farReachingDisplayPrefChanged:function e(){var i=true;TS.client.msg_pane.rebuildMsgsWithReason("farReachingDisplayPrefChanged",i);TS.search.view.renderResults();TS.view.rebuildMentions();TS.view.rebuildStars();TS.view.files.throttledRebuildList();TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();TS.client.msg_pane.displayTitle();TS.client.msg_pane.rebuildChannelMembersList();TS.view.rebuildPreviewedMember();if(TS.members.shouldDisplayRealNames())$("#col_channels").addClass("real_names");else $("#col_channels").removeClass("real_names");if(TS.model.previewed_file_id)TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},dTopNotificationChanged:function e(){TS.utility.msgs.reCalcAndCountAllUnreads()},mutedChannelsChanged:function e(i){if(i&&i.length){TS.log(389,"mutedChannelsChanged: recalculating unreads for newly-unmuted channel(s): "+i.join(", "));TS.utility.msgs.reCalcAndCountSomeUnreads(i)}else TS.log(389,"mutedChannelsChanged: No newly-unmuted channels, no need to recalculate unreads.");TS.client.msg_pane.displayTitle()},sidebarBehaviorPrefChanged:function e(){TS.utility.msgs.reCalcAndCountAllUnreads()},teamPermsPrefChanged:function e(i){if("who_can_at_channel"===i||"who_can_at_everyone"===i||"who_can_post_general"===i)TS.utility.msgs.reCalcAndCountAllUnreads();if("who_can_edit_user_groups"===i||"who_can_create_delete_user_groups"===i)TS.view.userGroupPrefUpdated();TS.view.checkIfInputShouldBeDisabledAndPopulate()},time24PrefChanged:function e(){TS.client.msg_pane.rebuildMsgsWithReason("time24PrefChanged");TS.search.view.renderResults();TS.view.rebuildMentions();TS.view.rebuildStars();TS.view.files.throttledRebuildList();if(TS.model.previewed_file_id)TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},hideHexSwatchPrefChanged:function e(){TS.client.msg_pane.rebuildMsgsWithReason("hideHexSwatchPrefChanged");TS.search.view.renderResults();TS.view.rebuildMentions();TS.view.rebuildStars();if(TS.model.previewed_file_id)TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},sidebarThemePrefChanged:function e(i){i=false!==i;if(TS.prefs.getPref("sidebar_theme")){if(TS.prefs.last_theme_selected_in_UI&&TS.prefs.getPref("sidebar_theme")!==TS.prefs.last_theme_selected_in_UI)return;else if(TS.prefs.last_theme_selected_in_UI&&i){TS.prefs.last_theme_selected_in_UI=null;TS.prefs.setPrefLocal("sidebar_theme_custom_values",TS.sidebar_themes.default_themes[TS.prefs.getPref("sidebar_theme")])}if("arctic_theme"===TS.prefs.getPref("sidebar_theme"))TS.prefs.setPrefLocal("sidebar_theme","hoth_theme");var t=$("#client-ui");var n="sidebar_theme_";var a=t[0];var r=a.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(n,0)});a.className=r.join(" ");t.addClass(n+TS.prefs.getPref("sidebar_theme"))}if("default"===TS.prefs.getPref("sidebar_theme")||"default_theme"===TS.prefs.getPref("sidebar_theme")||"basic_theme"===TS.prefs.getPref("sidebar_theme"))$("#sidebar_theme_css").remove();else if(TS.prefs.getPref("sidebar_theme_custom_values")){var s=JSON.parse(TS.prefs.getPref("sidebar_theme_custom_values"));if(TS.environment.supports_custom_scrollbar)_.forEach(s,function(e,i){s[i+"_rgb"]=TS.utility.hex2rgb(e)});var o=TS.templates.sidebar_theme_css({theme:s});if($("#sidebar_theme_css").length)$("#sidebar_theme_css").replaceWith(o);else $("head").append(o)}TS.view.updateTitleBarColor();TSSSB.call("refreshTileColors")},rebuildMentionOptions:function e(){var i;var t=TS.prefs.getPref("mentions_exclude_at_channels");var n=TS.prefs.getPref("mentions_exclude_at_user_groups");if(t&&n)i=TS.i18n.t("mentions and reactions, no {at_label} or User Groups","prefs")({at_label:TS.templates.builders.atLabel("channel")});else if(!t&&n)i=TS.i18n.t("mentions, reactions, and {at_label} mentions","prefs")({at_label:TS.templates.builders.atLabel("channel")});else if(t&&!n)i=TS.i18n.t("mentions, reactions, and User Group mentions","prefs")();else i=TS.i18n.t("everything","prefs")();var a=TS.templates.mentions_options({include_text:i});$("#mentions_options").html(a);$(".mentions_filter_menu_target").click(TS.menu.startWithMentionsFilter)},userGroupPrefUpdated:function e(){var i=$("#user_group_edit.tab_action");var t=TS.permissions.members.canEditUserGroups();var n=TS.permissions.members.canCreateAndDeleteUserGroups();$('[data-action="admin_user_groups_modal"]').toggleClass("hidden",t);$('[data-action="admin_user_groups_modal_new"]').toggleClass("hidden",n);i.toggleClass("hidden",!(t||n))}});var e=function e(){if(TS.prefs.getPref("k_key_omnibox_auto_hide_count")===TS.ui.jumper.k_key_omnibox_auto_hide_count_max){if(TS.boot_data.feature_jumper_sidebar&&TS.prefs.getPref("show_sidebar_quickswitcher_button"))TS.prefs.setPrefByAPI({name:"show_sidebar_quickswitcher_button",value:false});else if(!TS.prefs.getPref("no_omnibox_in_channels"))TS.prefs.setPrefByAPI({name:"no_omnibox_in_channels",value:true});TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"button_hidden"})}}})()},4923:function(e,i){(function(){TS.registerModule("client.windows",{open_log:"WINDOWS OPENED:",win_became_key_sig:new signals.Signal,win_resigned_key_sig:new signals.Signal,win_crashed_sig:new signals.Signal,win_will_close_sig:new signals.Signal,win_began_loading_sig:new signals.Signal,win_estimated_progress_changed_sig:new signals.Signal,win_finished_loading_sig:new signals.Signal,onStart:function e(){TS.client.login_sig.add(TS.client.windows.onLogin);TS.ui.window_unloaded_sig.add(o);u=TS.utility.throttleFunc(c,2e3)},onLogin:function e(){var n;var a;var r=false;var s=TSSSB.call("listWindows");if(TS.has_pri[p])TS.log(p,"listWindows windows_str:"+s);if(s){n=JSON.parse(s);if(TS.has_pri[p])TS.dir(p,n,"listWindows wins:");_.each(_.keys(n),function(e){i[e]=n[e];a=i[e];a.token=e;if("screenhero"!==a.windowType&&"calls"!==a.windowType)r=true;a.no_spinner=true;t(a)})}if(r){g();return}var o=TS.storage.fetchClientWindows();var l=Object.keys(o).length;if(!l)return;var d=3e3;setTimeout(function(){var e=function e(){_.forOwn(o,function(e){TS.client.windows.openWindow(e)})};TS.generic_dialog.start({unique:"reopen_windows",title:TS.i18n.t("You previously had {window_count} {window_count, plural, =1{window}other{windows}} open","client_window")({window_count:l}),body:TS.i18n.t("Would you like to re-open {window_count, plural, =1{it}other{them}}?","client_window")({window_count:l}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, re-open {window_count, plural, =1{it}other{them}} please","client_window")({window_count:l}),go_button_class:"btn_success",cancel_button_text:TS.i18n.t("No thanks","client_window")(),onGo:_.once(function(){setTimeout(e,1e3)}),onCancel:function e(){TS.storage.storeClientWindows({})}})},d)},openFileWindow:function e(i,t){if(!TS.model.supports_spaces_in_windows)return false;var n=TS.files.getFileById(i);if(!n)return TS.files.fetchFileInfo(i).then(function(e){return a(e,t)});return a(n,t)},openWindow:function e(t){if(isNaN(t.x)||isNaN(t.y)||isNaN(t.width)||isNaN(t.height)){var n={x:0,y:0,w:1024,h:768};var a=m();if(TS.has_pri[p])TS.dir(p,a,"sizer_win");if(a){n.x=a.x;n.y=a.y;n.w=a.width;n.h=a.height}if(isNaN(t.width)||isNaN(t.height)){t.width=n.w;t.height=n.h}if(isNaN(t.x)||isNaN(t.y)){t.x=n.x+22;t.y=n.y+22}}if(!t.no_spinner){if(!t.destination_url)if(t.url)t.destination_url=t.url;if(window.winssb)t.url="data:text/html;charset=utf-8,"+l(t)}if(TS.has_pri[p])TS.dir(p,t,"calling openWindow");var r=_.cloneDeep(t);r.url=r.url&&r.url.substr(0,100);TS.client.windows.open_log+="\n\n"+JSON.stringify(r,null,2);t.token=TSSSB.call("openWindow",t);i[t.token]=t;g(t.token);if(TS.has_pri[p])TS.log(p,"new window:"+t.token);window.last_win=t;return t.token},closeFileWindow:function e(i){var t=TS.client.windows.getWinByProp("file_id",i);if(!t)return;TSSSB.call("closeWindow",t.token)},getWinByToken:function e(t){return i[t]},getWinByProp:function e(t,n){if(!t)return null;var a=null;_.forOwn(i,function(e){if(e[t]==n){a=e;return false}});return a},distributeMsgToWins:function e(t){_.forOwn(i,function(e,i){if(!e)return;if("screenhero"!==e.windowType&&"calls"!==e.windowType)return;if(TS.utility.calls.isSupportedMessage(t.type))TS.ssb.distributeMsgToWin(i,t)})},closeAll:function e(){_.each(_.keys(i),function(e){TSSSB.call("closeWindow",e)})},windowWithTokenBecameKey:function e(i){if(TS.has_pri[p])TS.log(p,"windowWithTokenBecameKey token:"+i);var t=TS.client.windows.getWinByToken(i);if(!t){TS.error("windowWithTokenBecameKey: no win for token:"+i);return}g(t.token);TS.client.windows.win_became_key_sig.dispatch(i)},windowWithTokenResignedKey:function e(i){if(TS.has_pri[p])TS.log(p,"windowWithTokenResignedKey token:"+i);var t=TS.client.windows.getWinByToken(i);if(!t){TS.error("windowWithTokenResignedKey: no win for token:"+i);return}TS.client.windows.win_resigned_key_sig.dispatch(i)},windowWithTokenCrashed:function e(i){if(TS.has_pri[p])TS.log(p,"windowWithTokenCrashed token:"+i);TS.client.windows.win_crashed_sig.dispatch(i)},windowWithTokenWillClose:function e(t){if(TS.has_pri[p])TS.log(p,"windowWithTokenWillClose token:"+t);var n=TS.client.windows.getWinByToken(t);if(!n){TS.error("windowWithTokenWillClose: no win for token:"+t);return}delete i[t];g();TS.client.windows.win_will_close_sig.dispatch(t)},windowWithTokenBeganLoading:function e(i){if(TS.has_pri[p])TS.log(p,"windowWithTokenBeganLoading token:"+i);var t=TS.client.windows.getWinByToken(i);if(!t){TS.error("windowWithTokenBeganLoading: no win for token:"+i);return}TS.client.windows.win_began_loading_sig.dispatch(i)},windowWithTokenEstimatedProgressChanged:function e(i,t){if(TS.has_pri[p])TS.log(p,"windowWithTokenEstimatedProgressChanged token:"+i+" progress:"+t);var n=TS.client.windows.getWinByToken(i);if(!n){TS.error("windowWithTokenEstimatedProgressChanged: no win for token:"+i);return}TS.client.windows.win_estimated_progress_changed_sig.dispatch(i,t)},windowWithTokenDidChangeGeometry:function e(i){g(i)},windowWithTokenFinishedLoading:function e(i,n){if(TS.has_pri[p])TS.log(p,"windowWithTokenFinishedLoading token:"+i+" doc:"+n);var a=TS.client.windows.getWinByToken(i);if(!a){TS.error("windowWithTokenFinishedLoading: no win for token:"+i);return}if(a.document)TS.warn("windowWithTokenFinishedLoading: win already has document? token:"+i);var r=function e(){t(a,n);TS.client.windows.win_finished_loading_sig.dispatch(i,n)};if(a.no_spinner)r();else setTimeout(r,50)}});var e=true;var i={};var t=function e(i){n(i)};var n=function e(i){if(TS.has_pri[p])TS.log(p,"_setUpWindowForAtomSSB: win.token: "+i.token);TS.ssb.setUpAtomSSBWin(i)};var a=function i(t,n){if(!t&&!t.id)return;var a=t.id;if("space"!==t.mode&&"arugula"!==t.mode)return false;var r=TS.client.windows.getWinByProp("file_id",a);if(r){if(!TSSSB.call("focusWindow",r.token))TS.generic_dialog.alert("window already open; but you need to get a new build of the app. ask in #triage-mac-ssb ");return true}if(TS.boot_data&&TS.boot_data.feature_file_links_betterer&&TS.boot_data.page_needs_enterprise){var s=t.permalink.indexOf("?")>-1?"&":"?";n=(n?""+s+n.substr(1):s)+TS.getQsArgsForUrl()}else n=(n?"?"+n.substr(1):"?")+TS.getQsArgsForUrl();var o=TS.model.team&&TS.model.team.name;var l=_.unescape(t.title);var d=o?o+": "+l:l;r={file_id:a,title:d,destination_url:t.permalink+n,url:t.permalink+n,worth_saving:true};if(e)r.no_spinner=true;var c=TS.client.windows.openWindow(r);if(!c){TS.error("no window token!");return false}return c};var r=function e(i){var t=TS.client.windows.getWinByProp("window",i.currentTarget);if(!t){TS.warn("unknown win in _macSSBWinUnloaded");return}t.window=null;t.document=null};var s=function e(i){var t=TS.client.windows.getWinByProp("window",i.currentTarget);if(t)g(t.token);else{TS.warn("unknown win in _macSSBWinResized");g()}};var o=function e(){_.forOwn(i,function(e){if(!e.window)return;delete e.document.ssb_main.TS;e.window.removeEventListener("unload",r);e.window.removeEventListener("resize",s)});g()};var l=function e(i){var t="";var n="";var a;if(!i.skip_css)for(a=0;a<document.styleSheets.length;a+=1){if(!document.styleSheets[a])continue;if(document.styleSheets[a].cssRules)for(var r=0;r<document.styleSheets[a].cssRules.length;r+=1)t+=document.styleSheets[a].cssRules[r].cssText;else if(document.styleSheets[a].href)n+='<LINK href="'+document.styleSheets[a].href+'" rel="stylesheet" type="text/css">'}var s=i.destination_url?"document.location.href = '"+i.destination_url+"'":"";var o=TS.i18n.t("Loading...","client_window")();var l="data:image/gif;base64,R0lGODlhUABQAPdqAOn38njO398JXN4GWarg6////7Xk7fP7++mmGvjI2mnI27Di0v326P7///XXmEi9lzC0ieiiD94DV/POgPTSjD65kaHd6Du4kDK1iupck/jjt+mnHffdp2TH2uARYJTYwvOfv+H0+GvJ2+Msc+ijE////jW2jP/+/d8NXje3jfSpxlLAnOEeaYnU4/768W/LrTq4j/WzzeU4e//+/4DRt/LJdNnx9vzi7OmoIOT18PrV47/o8G/L3u/BX27K3OAVYzO1i+v49P7//vzq8fDEaef2+ehTjHfOsu+9VWzJ3OtlmfD69v/+++IkbeikFv76/J/cyOyzO/3w9v/8/edJhvzy3OZAgPCNtMbq8f74+t/z7WTHp++Fru22RKngztLv5tfx6crs4eqqJc/u9MLp3Pf8/HLN4H/Q4WbH2u35+7jl11rEoYnVvO5+qZbZ5ve90+uvM/StyfGVuP789/n9/f3+/vv+/eqsKu1zovrpxkC7kvvu0uEZZu65TPz+/mzK3P70+C6ziP/9/vCKseEVZc7x5eAQY+qrIGrH2DpraOGmILmbHiaaieEVaCmihTUON27G0WWKKza+kV6AEla6wfFMim/O5r4UWtdDfr65beL3/qU8bdEfEf2hw8qCojemnm24p+cVZS+jkPKzOGWCEx+XgF6DHDq8kWWFHOF7GBqSfGWvluqvHvOwMPT3827I1UwPPTWui+uxIecPYWjK4uaXGT22kM0NC9ikIuigH+2pINwSTuMVZNMPJz6/lGXF0z2cgskKVz6qpZ+TGj1WXmaPOSSggrJYgekVZfGqIDSoh4CMG23J2d0UVTqJd9QKWdLDetcRO12/yj7DluWFSOWnIFC2uTcxSdUUYHUQSNlMFGmfZKURU8+hHm3EyvCoGucKXtQxEnvKx+I1aqyrU9wHTpHgxbqSpvFclOmpFemSWtknQzrAk9k1djS8j6jGotufE+HCbGPUrvJTj5Tc8NnCzOqtJ32Jj+yqc+6rjNMHWOJcWLzx3/CfkQAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFFABqACwAAAAAUABQAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjyrwoREuYMABEHghho0iDkV9eVEiR4gGNIB6LWAigQAGPFjZCkqkA5EKFChcwrMjBMUSADiJ8iEWjAMtHAA9SXF1bAcILji0UiJ3rQwSPIh0bQIHAti+YjA1ChKU7twMBjy9M9F2LwYvGHWgIz1XQwuMWtYupfnjcQbJYyh6PAMlcobHGMXI9d7CQdwHfxRcu/M1Y5kxquklERO24ZIXivhBo/DwNlq6IDgZAhnmAweoFGBC2LNn4E4uZDmjQdAiwQ6QWGg+srv+AcqCExzQ7CFjAcmA4yAZCloDR0j5kA/cz8+vfz7+///8ABijggAQWaOCBCCao4IIMNujggxBGKOGEFFbYoBQ3DCGSCxpMMAEHDIyUQAYjsNCEETF8pEEUJLRIghgOhBTDDxJ4YKMAAnDRkQYbOIHDjzggEAEFH93QBAo/JJmkBwOocIJGLkThI5A/boBDFeZxdMUASnaJggxPZHSCBiRQSSUJRHZkhABdtqmDRhOUaeaPTvTgERVstrlkAnDKOacTSHikBJd6JvlmRhz4aSYJNXikAqFtCmDFkxlVIYaVf2rg0RRUSNAmCk1yNEEEc0Zgp0cnDEHFADgKIEETIHQ4xEQNLSKAgBOmuhBSFiooQYURXNwAkgZEdBFFDxwwMdIMM5h0grIWRivttNRWa+212Gar7bYVBQQAIfkEBQUAAAAsDgARADQAMgAACP8AAQgcSLCgwYMICR4YI1BEwocQIwpscMBCgA4SER7JCPHAmQ5JfHAseEFPjpEI3XTwIRIlQSALhLgkGIIly5kDTbzAORDLyps8S57kuQONTYgFvAA5WKECEDU8AYwxevRhDj0VDDbF4EUmzgMBRNhsmfCFiaYAmqp9GhXAjg5/xvpQgHABBrVpmwptC8CAiA4K0HTg4WbHwSAPUqhVG+gDX4EhCLgpXKRBQjJ6MFyocCEFhCNlLD8G0EA0RDBHHlTQs8aLndE4l4DJQacE7Nu4c+vezbu379/AgwsfTry48ePIkytfzry58+fG52igMIEDgxPH83RxQoJEhDsUbCennHIjgY4ssPOIcYKjPQ4EESYg1HHFCh8UP2TImcKXSR/27rW3AQ57GETFDwOg4MEPP6AwgBLi8ZQHgAG2RwIFBXkwAIMcciiBHG05QIJ7BOHgRB8RHtQhCiOgx5MDEbSH0B4FPNThDzpEpQF7bTHoQQJRMQAHAlH5yMcNUZVABF8/CEAFXxoU2aQHb/AlJJEueSDAADJUidwALBgBAiDJZQDicjMgFxAAIfkEBQIADAAsDwARADIAMgAACP8AGQgcSLCgwYMIC7pJyLChQ4EHsAhEg+ZhwRcWE4awEKCiiIwEK8D4ArLgmD8dRPgoWRDDhwIsGRw4o2BlTIIw1vhh2QBLBx9ALZpAKJIkSwtogNpsuIChy5hIlT4E8AAGwhRr6LA08FNqwwZHElZIYRRkCJVKlzL4U9EgkIMVKmCA0oAlgQ5/0to0w0AiTIIXDMYFwiamHwIiOlDswKNvmr8Fj5iIyyCu5bl1Y4YgYMHCjjQMMh9Ug4Gy5bhkbw5sIJphmTVATseFEFY1SzArIMC4cCEFhC1BbMcEwGZFBT0roBwoITxmiQNatJRpTr269evYs2vfzr279+/gw4vyH0++vPnzGV1ooEBBgwvzGqKQmB8BDofxJTQgcIKjPw4EEdwXngtw8OdffwiIUUVDJUihww1PqFYCByQceCAJDiBUwBAqZNAEIXzIcEUWN9VQYX8E4eAEEswRNEQcHgoggAc/eICCBEZIEZOJKB604EBKNCHjQD8UWaQEeJzAkgMVJuQAEwL9wIAHBxnpAR86sLQHDhswBFlCRv4ggAox9YEAdUUOAEJMTDKUoUNGChCDICxVIUaXqlnJwhA3IeGEbUV6IAEXqr150w83snCFkjdVwWVJiE5pxSA3MDqeB1ZwoQOd5RnRRgJ0zjBDeV+OFxAAIfkEBQIASAAsDwARADIAMgAACP8AkQgcSLCgwYMIC1pAoiChw4cQkYwR2KFDxIJHLiI8MFEgGo0FYTwAAHJgEQsB0HwsaRDIApYhAnQQ4YPlQRMvCoCk0wKNj5oggSC8oCcHyDEdfgK96MWhS40NCCT9CTKHngoIceq8aMEnVY0FXiQkajRiHQNTlxr00TCol60QbShQ+nVgQx5IdiBpMLBsVrEX61hIq7ShmRY7ivA1CPggWSEXy7jpgEaBgqQtkBQpANfgAqEHKzzV6GeMmxZuDGyOCOABDIMVKmD4YHPv4ohCjpiIzZs3hqa1S6rBEBtJ7wopvgQH2SDIgxTHK0BovFyjGhO7Y1+AsMJv9Yh8yaz/gYFdDw2S31naAaOGTI4Gt9PLn0+/vv37+PPr38+/v80qFPTQwwR5+FeQA2JE4IQTJDhRwxwGIsEBCQjgYKGFEdRQgn8M3FHhhRZugEMV/k0IIogkOHBCfxOQcCFBODjRh0ZT6PBGAkPMUBIFLuJgkIh7PHSCDldY8YMAKLCAxxAanaCBEz4iRAFCMxBJxQ8DoPDDlh5IIMMQK0bU4QYJ9dEZElZiicQPa27p5gAZaFQCEQ8FOdCVA6x5kJtb6qCRBg9RsJUHeibE5wAqaMQAHAg4tKFGbgoAAkhEkJAQmSBF+oacTzo0JaQ/oDCCFCAt2uh3W6IgaUkFVJqeAAOMNRBDmCB1WpsHsCJhBAik2uQCoyXhigQfuyJxJktTYnoRH1TIccMMOlb3KEhX3BAhQifQ6l9AACH5BAUCABAALA8AEQAzADIAAAj/ACEIHEiwoMGDCAu6gSAiocOHEAViEYgGTUSDLy5G7KDRYAUYYDoKPDBGJEQMHzqGsBCgokmHKbbUuWjDTAcRPl5CMIHw45eIZc4o8JHz5YKHKSFiQUO06MsHMBCmWOMHIgGmRHUKOZLQJ0QLWJ06tCgSJUQDHZpCNANhYkEAMNfQeRgCp9qDPBamKYCQa08YPx8S6PCnaVYIPASmadAgoRA1Ds06bEDHgoIOFdO22KHz4NQyEW0QcOPGQJECfDXyBfI3zEXGnQWyPlhBcuyIqS94rACExu2OXCsMrECcN5vfFwuoAVK8eW3IyCMeWGHCeQUTa8qUiB4xjB4gF4hf/8DwIDD3iGBeXK/+Qsv5jkK0kCGjpfH7+/jzD9xDoUcPClXo9xAFG0TghBMR4ECBgAeVQEEEG+AgIQ4bkLAggwTtQeGEEyIgBgMnYAiBgwlyOCEJDogoEBEkTFiQE0ikxmAJLEp4kBgqQuBAgg7J2NEQCegwxEUabpAQEh0VMEQcGTTxgyFNKHFDRH044VAVIfa4pBJNQCCABx784MEATegAkQMkJBRBiggVIEUcXAowgAcC/WCnnQNYkcVDexziEBJZEiRFDHFCQKdBd/4wQBwPFVBlQn4WpMQIAhgKEZ54nPmQAzMM9IOlEd05QKYOnVAFhT3qJCoXgR5pJUI4dGd2JwoJQFQAmg6xKZKdHkigxEVViGFkQtt19OkAfLSx50VIvHrbpxD8QIUcN7R6ZpqyohCtFVfoIIggnXYU7LDGauuBFVzoMMVtE0AQa0ceyMBFAoL4qJO9F7WRwBMQoJajQf7+C0FAACH5BAUCAAQALA4AEQA0ADEAAAj/AAkIHEiwoMGDCA1aCKAgocOHEAeOEdihQ8SDR4Rc3MiR4AU9WjqK5OilQYGTKFOmPDBx5EaVME+GWIgGjcuBQCro3Knzo5aYKcfw6CDCx00CGh9CAXoyDUMfRo8K1MOzqoktTAsY6AA16tECLxyCZNpCQdezaNP6aDhyacwGZbtu5OFmxwGYOR5ifesGjdyHXh2GTVgBDNCtaA9GLVLgYYEFSoGWOeMXrYIOPFoYkGpwb8wQZzooEHH5TwuBJrO+PWKialXDQA8YaHFGc4gGnB1CSc10Bm/VqgE4vJo099EKF74AX768+MEKJtwynw40yIMLrnUCYUO9e0zW2StA/5DuvbyanNlNhPnNvIoDIkQo7Jm+ZEXrqkC21PHuQEwEEiREgAAFJzBHRgVAYIccBCv81J0DTiCAw4Q4bBDBBNN98QJ0JuhBQw7dncDAHRJSOOEGYlQxnR9akBEGiOU5QIKJJpLgQHcNsEddDTPSOKETSJQnZAE1OOHjiSmWMCR1J3Awo3FSVSHGBg4VuCR1SDiREA6cTaFDDDHoIEhWHECkpHcn6DCIFT8IIMAPVCTAlJQO9dHdDDpcQcUPA6Dww59t8vEGUz2Q4NB8y+W55wBvAuooCiNIERMTZR51gxyL+unopn8OoIKVKlVhT51npnTCpVQQwiinrP4pAB6EOnrEpUFGqNpoq62+CqpKlSZEQWMDeTAArsR2egVQJYz4UAmc/enBDzpk1YNDVDaLwgBtqNYrQhRIJcAATYAAnLIOAcuRBwKxYAQIki43LZQC8bHuDd1te9O3fFAhB73ljYiAS9/Cue8J8HL0gxVXRHsCwQVfNIiYDT8UEAAh+QQFAgAaACwPABEAMwAxAAAI/wA1CBxIsKDBgwgLutEgIqHDhxAFYhGIBk3EghheNLjIsePACim+eBzJ8UMBkigdrrHz8MCYgR1S0khYAUaYhCEsBLCYcqAahxg+HGwwRkQHET56DgTw4ALCFGvKGCzCQ4GPpEoHHgGS0KZBAh2uYu34h2fBnw7ZGGyB9CrHJBbNaJhYMMjDqAVbWHUbEQ2PuQ6POExxk6AbNGIh8liYRsPJhGpMJASiluCOsIkPyt2RZmNEu04PwlghdSCdFpjFYk26Q0MJj0JocEVoorDABmlQo1GgIKzAIo9RSkZIObhAOljctHBjIIRxlEs0wEA4+gDCBp6zCpSdsLYQ7Q/rkP8ZfhBCZY4lqlAgQsQBg4vRu6448DpiCQobIpAgEeEOByYRcXdQBSaQwdEEEWyAw4I4IEACBxGNh1AFGJz3UB4bKMjgggjA8V5E0xVUAYEvRDQDghtu+GCAJowo0IgjAkHDdxAh4QSDBOHgRA8RAlGBBjDCCMECF9m44EF3fOiQH1tgEOSIJqwQH0QUkIBDQv9BBMYDGFww4gVA6CHSRXkgcKVSORyhRwom6PGCFtlBxEQXCCR0h2P2ARBGGDmMVMAED0EI3kN7mOnQcyg9kYAcV8QxREElnNBFQjiIkVUCbcjgwQADCMCCHCcUVOVDiEIkSAJcaDoAChr84KoHErTUQdAJeyiYEBIdTYGqFR4Y5OqrKCQgyECS1omQGFVANIUGXPCqAasH/frDAEoQVAAFDpHg0Ak6DOJsRL+iYEVBe5yJEBLPFaDDFVb88CxH4VJhUB8OIVsQFe5C29Gv1IZKELYOOTDorwLEUFAB5TqErnb5SoBHfQXRS2kVEKPUqwAjgDDsQQAnJHBPAmigRBxSOFSFuYMK1EQGjkL0msRZ9aoBCxmoMIS/F32ckswsGAGCBoLM4FF6OGwwksx8+JyyR4RQIccNQZe69EFX4DmD0FMfFBAAIfkEBQIAEwAsDgARADQAMQAACP8AJwgcSLCgwYMIDVpIyLChQ4JlxjxkCGFCgYkHywxUgAYjwgpgPArUKHIilAYTSU5QUPLhFiENVU7o2FLgEYYXQmaUeGZmTYINFlCEYrAIgQBoaP4smENPwxkEbQTooMDH0oMlJphImHPggTNofFit6YPlQaEMPww00EHsWI9lJ/CYsGMCyoENADCEMcGOXTdhxYrsYKZF3Z8XvghsUVXwRB8tJhR5uABIQgxqGwB269CqgSIXJ+pNmGJNHbodknA+mGSCAbslCxzZihDGlwZfA7sdK0JgiLs/LSPE7HuqAhEiOojo2Rd4FQc1iDiogjHIhAsIS9Oxe4BAiwAtCIT/8NMA+AQHYiKQWC/GAcbZCfmGnjCDjp3y5s9HQICjPw4EEbjnUANqCHcQcQ6VUIUY/PnXHwJ3MPCQdaStQcd8CVFAgoMOksDBCQ/dFF8YDxGxYX8E4eAEEhOpkcJVE5iIYkEbiEHdQw9UKBNCGuKAUAQeGVhQBSmQ2NAeOGyQEIsPqUGbQRUAoVZDJfTBkI0PLfEAdkNGSQOM52GYEA1AVFCBQGaaCQQbDyGp5FVkYJDmnFGSkVVDBfThREJiPFQCHWuYQGcFGGyxnUMnCJiQog198QAGF5h5AQQr6ESQIDqoAMIbgKT4JkJ3OqTFEXqkAIMeNORA0Ak6XGHFDwII/4DCCCpYlGdCn2KUQxhhUGhRq1T8MAEKPxT7AwoDXCEQo2AOVIAOcgQ7gQAEGfuDBx4kMEMVSSZkpUfPRisstQdZOwAeFiGxJ0I+gtjQCTdEy8e0DhkrABUTlMBsQUAyVEC8RsxL7kPGokAFiDd6exC8IAQ8rQciGTuAEgMxeVB/exjksAAQtyRxDAPtWxAFB3X807ESUDzQggx92+wEHggwQBNXTFGQxQjtIWZNMrOQgQpDHCQyQSRfNQALRoAwhLsI9fmyQMJOwEfSNzh0Ec5XRf0DFXLcIAhUE3EA47ETbC2HDgXsjOcETpdE9g9WXIH20x55YAUXOpygNt0JcQiRgCC28o1QQAAh+QQFAgAEACwOABEANAAxAAAI/wAJCBxIsKDBgwgNuknIsKFDggewPJxIseCBgWg6VDyY4stGAhc/PvxQYGJIAmhEOlxjp+FJAhpVCjSREMYXIQdDBoApc2AJNQwxfLA4xkLPhAAewGBIR6ANCwHQoBFx9GADAkBqhpmxI6MIH0f/SD2oBkPDEAq+glWZROrOMQRKbmyhwIfdijx4iCUQwA2WlxtTSDNjd21DHpYsSbVE7+/VhkATAhFG+O5hAqu2LSMXbw/FIAxhMGLGozBDWpC2LYL3LVkEBBRKUMx6UI8xSpUNF+RBYEefCN906cKBY0MEBxRp1o4lrHRhuwoI+GhBoEgBDk50bSDOHcEdBg4bLP8hsPRgBVs80ChY3yEJAQPWCxQoQYQE9/s4SHCYSIP2wQtqGNDCGW4YEEID8slFQB9OcEcQDk708JCCCJnAhkANZIgQg8QZtAFF49W0wgGyMTSBfQxRmBANDKVAhkN5IIBDQhI+RIZyB2U1Q0NzdOFEQt+d8NAKIgJ20AQMkVCRWRW+2FAe29FYIkMNOLmiQyd00RB4Q5ZnEAwrhGhiQxwwcVQFJliJ0I4yVkVACghVAAQbODHEhJZVHbCClwNVUEEKWxz0RAJXtCGHDgSkk1AE+z3EBgZ+CuSnnya8UCcBg7YhAwoDdNqIESQckqKNJkxqqpzmECBIApp6MAAKP8T/+oMHAoSDgKg90bFGqZPq4cs0etTDhRUeGCTrD41Eo40suMoUhh5AVPArDMAQswkyBKCAkKyG7BLOjAghQREY8rgDTCLXPMINCsUyFCshhvRSS7MFiRGXQwXowMUm3GTDDTahPCQrH9HMi5CSDM2gwxVU/CAAOLPMgkzAAsdqyDiH0FsQElMOlC/DPwgUMgGE8MILRbJKcEWNB31YhUENi3zUD5waIQgBETDkQMcyH+WqACPI8UQJe4DrJkUCEKBEDFIQ1EdDVQjppgBNEBDHQVLrfHQGKtybkNFHE9AuCwIN4ZBsT4ctEB9GgBBXATPs6BByVSXNh0A3yAT2RkkTEUCFHGp/FPIVXgdeEaKGNxQQACH5BAUCAAYALA4AEQA0ADEAAAj/AA0IHEiwoMGDCA1aSMiwocOCYx5KnFiwzEAFaCgavFABjEYDFj8+hDIxpAEFIh1uKdDQpIGMKQUCSdiRpUGTGGMObLCgIUmCLnUezKHnQsItDUBGPCmRBw+KBV6YSKiHDIEALx/ysGTJKdeCPgx0OLhg6kE9yoTRShLWoVNQ24oV2waqqw8FHZ5iMZB0YIEcCPUAUcXIx1O3kLaRIoVqsalttJ7uSNNwZkE9xlSpmshDMWNUpkyhWpYpjZ++CXsatFVKs0RLoBiHRmVgWDcErRg8BGAABkE9rF0fZmhp26TRw3DpMpBMFwkOE80ODK5ZWsOM22zrSmYAh0AcTnpM/7Q8ELPmzWaGCxRhQMQZA5qQfPvWveAGA1UcFghiwGj5WOcxkgQPPvjA3h9nEBBCHQJREIF3Qh1hEFrnUcJDBwokaIMfBe2xAYQIleCQEAZI919mwrRAgA102FQQEw7l5xB/Z+lhwhpluIgQBQ7N8JCECV3whUN74HAfQkhIpAZDGHyAGkIF9MGQGFXoeFBSDySUwhp0OMRjQk44MJ6WYRBpZEJIWHlQAUsmBMEH+knJkIwOPeDfQTiKyJCYe6qp0QUplMlQCVXIIsshQpXYkJ8CCaIDCPukUsshiB6kZ0INLMEQDCsEZUABOhhgxQ8D9HLLLdpsUOlAJPDpEA00Bf9K4qc6XEHFDwag8AMhzZx6SziUGnQppgxV4I45oMpxqwECEPTDD6aemoosKS2xgm8DVSCQL8Dcs2yzCfnKyZEFDZsQDUBou60BiVzzSDbgNMSruJMWJKdDZLgzjS8EPeJvNrPwwtCuBviay6rf7THiAau06+/D/mIjsLwF/ypSATeAMA83EEPMDTIPzYsqtQbdS9AJQ4BgBAu5IsMNLBDD8rFEhBjyq6oIKVxQBiwb4MFAyPDCDTfZXIINyA55IIAAI+xzcEIUqPmzQaEgY3UoEzPUbBMZxAEIA/YkhIAB5iZqwAAsZKDCEAQlydAejH6EthEgIAQdQ1+mhKsBfNBLfUNDYphd0N58UCHH34saIJ7gA/1geKifxk3Q3UKhYMAPVlyhg48alcDAHWOLZLkHVgxigCA6lT3Rz22czrhIbSQwxQwnnPA6QwEBACH5BAUCAAAALA4AEQAzADEAAAj/AAEIHEiwoMGDCBEqSMiwocOCHTo8LIgBQIOJBw8MjIjRYAUTXzoK1Cjy4QchE0kCQFPS4Ro6DVUCkNgSAA2GKcIgVMlyIA9Llnj8tPSwgBqGQNgQvMiQB4BV24oV2+YtqMMgDxLCWFOmBE+EPCAVI0UWFSlUq8w4FEIDyEE9ekx4eSh0LKq7d8muIirwz0qDRw3qieVI1ScAIhpaWnUWL15SkV7xQINGLYAyBZcAgEFQjzJVqgQicmjJLl4AeCftBYBFZkEaJgYOBh0aAKWGPJgVc5yxQIGEQsjEFqjHGO2JTu0WXITrGwAXDjVfEGir1HHRirdNMiVwUTeBunA4/9FQwmFb6tZBD7zNkBaoZQJxGCRB5KFw9NcBHPZRcOGfFgDkEAUAyRyEABwMRLcCZ8XlB8BoAi0kQgsGWCRQDSQwpMFDNwEQF221ETQhACHUUVAeTiREn0MFkCFbLCCGdphAfhxUwhxRIIDQgQnGtCBxJjhSypDG6JGGQxNE0NBvDNWhlGx6yJaCiwyVkAcC8h20okNUIgQEDUwmhKOOCN3RY0JeraDVCppVOUFDHDz0JEImkIESQ1dmeVAPa4WRQkIYdMjQHF2QeZCZDh3wI0IPLBEmQm/KIqmkhxAUp0NzegRAYAkxsQcOqWgjaioAsDIQnw75yRAN5SH0RAJtcP9yy6yzclJLpQAgylABmCV0wQNBGDQFrDJ4AEA0AtE6660CXdoQG27RqQaTw3JR7ECN7DKQsuHIIlAPjx5UgKoISULDCQBwYYWxKDCkLLMAnJlQGWv8qWkimMwCQLsOKZuKtwA4yxAbFQ1UAUGPcINMQ9omS2sqpgKAxENhnJLQI9l4QAhDPxBEay64moluQiNfDAsAvDDUSC8O36JNxABEIPBBV1SSDUKPPAJLyhPVWosYBCERriA3yEFFyuBwkzPCOWO8cEPt3sKJNtXgOpAYVRRkRMcAdMxLKLA0LXbOl4QyUSq1yAIzQQ4YxLVAvCBzydhNK9yQEjFIscchVhd05ITQDsmdjdiwcIPNQQIIFEdBfTCE9UNmcyO54aFsXFAGKohLQUNtT4RMKI3wkrKxArAg0BCClFzQpyrWNJARIGDUuOsM3SCIIDNMtDntBFEhBwDhPjRDFThs4HrHVwAwQ+41Bd8RFwCozntJ0APv2/QPBQQAIfkEBQIAAQAsDwARADMAMgAACP8AAwgcSLCgwYMID4pIyLChw4Jo0DwsCCFAgYkHywxUIBGjQRhgPAZoQEfgGVq0RDK86BHUtmLFtnnjwUNlQRgB/DTUKPDXNlKTTKEiRWqVpZoNj5hIeOELQp4BFAT4s20SKVRYsRZFynABQwwfCLI0aGnV1axaSUWCxBVhjgA4D6bIWQCq1IKWfp7FGgBVgKKWGjZQmtCWV4Y0i50t6HebwQ4GDw/Uo8fWQGEOeRTja9CvN4GQBR4YGwBAgAsC9cRyVIpgEsR5rz5Mk/BIamWqVIm0BMpvQnIjGzBUA0R1bt0imSEcNpCBQ9MBSh03uNDjMFwCkwUgwYE0wiOBjiP/tylQl0EnPR6qwT29IGaErwOE6CIQh8ENdwKUaBjElviGC/1xhkB+CDdBQxw8dMR/CSkwoA3BEYRAQuh5d5AaxjBI0HsMMUEfQvg9tMQDGYqXm0APBDCDQyQ0tB9DDdBggjKlSFeKI7FYBkMYDZ2wR0PpPVRcALakYAtlA7HhkIdOJCRGFYKNmJoeBx3QkIUFtfgQDQ5hSdCPDCHhUB1kLJWQkgyVcEIATQZwiCyyHMJKnAFA2dCIqCG0wgEvJkRBm7mkok044aRSSzoBrNkQlwyRcWUAuQh0y6SUcpLKRGUyxEYdCQHyhhIGUTrppUzcyRAMKyxhkKd4jICCAAhR/xqOA1s2RIZwAbDqKkHNHCRqFII4lOlBp7jDxhMJtPqqBxNReqlDB6wQV2rTEOkMMe2gEACzHjlLq5ACVRvAteQRNCknEWAkibXEHITMDypNqg0rONiZkBBZANNuQtg0REg0BU0aTi6HkPDtQVMkwIUMDT3CTSjdWurmQIoOVIDCVjA7S8PZIONRKjiwQpB9BWUsgLYBhAJvQo/AAvFB2qLA8MR0GlTqQLASBG82CD3ySDa8GDQACiPgkcAMDMjCUB8OIXOJzwT57HPHBRX9RhYqztAnQjiA2RAsUoft8yUbCzCCEm8AYlAJB5cbytNi+8wNOE0oEYMUBRSwokFViFJBoX5NXwK21LBwg04cUkwkZrkDIeNBMNxwc4wKQ+TtpUFt2+QBrCwYAcIQdXDq0UV+q7S5AHx4fkPejJPHBxUgrN4643LcsObes5N3QsW5TxQQACH5BAUCAAAALA4AEQA0ADIAAAj/AAEIHEiwoMGDCBEqSMiwocE5Gogg6UGBQYMyWAR26ODwIAYADToKZICEBIlvJCIsemdJZMMUYUS66EMimaJFw1CZmgSqpcuEbEQ6gIdTpylUqEgV88Hj58EUAMowDImFHClTR5ECQEqqZ0c2HxHCDGnwwMBfWJGiMrjNUtOpZEwkBBJ0IFmCf5gVI7W2INJirzouWZEQxgqpZgWiKWhpG9++BkF1LEADiEE9Ak14aWgJFF+RSQAsNkgGqkDMA40B+NSQB6RICZW++iM6gIUxZe4CKHFgBQw9emwBUE0QEUMfHUEFADAmMcKgsYyVckqQFMNMAAoU0G0wjCNVqqgP/3x9cJEiAKPmdMRSCjzCUsZ/LgKQDIAuAE40OPTT4lN48aINtAguB5FQg0NFmEHJfwixhhByO+QwCgA4HIQAHC4UwJANfyDCiEsL+dACAEVoB8CBCeXXUBF/mCFMQ9YIlEQLBhTRgIkC6ZeQgQ35cQYPCzLEmgEhcCdQAXNEkdCFLjSERQceMliQIxVk11ANTqSogYYJ1WEALf6BJ2WVKZDR0Ax5ZIlQBChOZYM4qpRSiiOxVEkQDQ4liQBCTJbQUAFlrCDXUwAs0dAJDanY0QdhHQSEGg6ladAhrMiSTg1MOFRAGDDMhWdDeg7ECoWpaGOqHDc4ZMcaph30wBJcJv80AQmjVggAJ7fkeks5LKgww1SMJmQCpAxlCkAttxaUay+GCBBHQ1+0ehANQiQ0RQJchMPQLT+gMIIUDNHBakIPBGHQFDpwYYUhA/SybTSNCBBDQx8w9CiXgugwiBUeELRLQ700MoAc0HZ6EGY0FKDDFVb8MAAKTt3iwQAg9LhGQRX4AoAewCSCCS8AQIyQuwndEo0hCQhCb1gac5yIS41se0svVKgMLTsA+NLxQf0CqGsCxiZUAB2rvIzQIw41QrKynGgTgY4IFXCDHJUASFDMBmmTSi6W9uBnQSfcAIIRfAAAziUOheKStrkAwMohAt3BgEFkDyBAv7yAzNAjlyDOwzMAAowgELIIcRCrQAP0LJDee3PjN0ECCNBEBnEMsQfcCfVgNUGPZEPQACxkoMIQ2RVwQhd7IiT31wnxonZCj8DyDOhGgEC6QRQ0xEFHyHBzdOy1pyrQrwXtYWuBRIh0ySNID8T8NYmAYqRBJfSx+UC8ZMP884kAcwo7hYiU+/XdBvMI9MDoMc0pGEAhEqLHO9Vt4lYMksAR7KQARAorqFGtSKyjDgqs0AYdCKIBfgCAFtSwgDA453oOaUMCnjCDEyAKguKZwQxwhEGXBAQAIfkEBQIAAQAsDAAOADgANwAACP8AAwgcSLCgwYMEmbhwgbChw4cQA7ig0AUOnB4aImrcaHBPlAhOECAg4aTGiYINynBcWdBFFCc4YsbcEIHCQJUBzohgyfKEgwgyZer61srVmJwK0PAkCCFAgYhIYMbUlSyZogDDQNFaivACGIgnoiCgGqCawGUCt3FtCEUIxD7frgpEFcCUwEje1ho0scVtwwINMg1Di3AVyyMmGsL48tSgSgJnQE2C6GNjgQVAHH4g+NQG0gC0XjkkFQnSyhwPGqZYMyMAHc9nFLA0zFEIYoMVBNpSk1MvwcodHi7AMDD3QEcBhEFkVowUQlSovPFQ0IGHGywH/gJ4cEFgd+S/fa//shRgRxqNRzKDNygtIt2G5NI0aND4YRFxqvT6KHZwGK4ArTCwERY8tOcQI0msNEwAugSQTAAkcBBRAzaIkIQZEBmI0FYCDdPNQU70oFELClRmzUPKGbTTTgaE0IWDB21wBwMlODRDGjz44AMPv5Ty0E4C7SQbASHYMd8EDkUIkQ1J6FjZJw9RIpACZxBggx0CNSBQHhs0FCJEITjpgxknOqSclXQgdEIXTiAko4AO0aGTjjz6iJAxqUFEAQkNRVhjQzPs0IGTGCJkSwAXhPEQE3t0iZATSEDkhwUdlEhmAPkZE8ChBLEBERNsuilGFfUhFOgZPOToiDKcFgRDADg1/1SCTX1KGJEfaRThBw2JIZRCGH41tAcCB8kSQC3UKEEFFXjoIAhEavSKkKeL9tGmQLKwkotAnNxSDgooSODBIBAtwV1DKxzwZ0M2GbutQdE08sMPHgwgx0MF0JBZQ4o+VEUAqThEyLw/oNDEEA+RIe1BbJRaECBv4MHJQ80MPK8AMZzU0BIrvIpQugZBjMcIAgQQTUQE2wsRDQ6ZQMZAWUQ8AgoBeCBQMxAR/MMAIECkMEKnSMLGEwngIQPNNq9U8bwe6FDuCgXpMc2mzhBz9EMnPySvBEZEVAcbmekhUAVVb0QIzg+hMAAVN2hEhiQBkE3MQcj4Ng4IWWgkRBbAzP+NECwQEZI1Qqk4oNEUOrRhRUR1N0RIQ4cEwEofDheEOBdW2DwLNxA1HpE2AeAgi7ECibGHQ5kHgMIPAYTC+kPY8HIQzQHIINC7Bzmg8UECvC6Q7zyNoMQbgDAgCw4N9eHbQaEMJEATSsQAiEAzlBBVQzjsUXlDP2Dz0CMBPK9EHFLk7lAEhq+UjUOPHBMHwk5VXoUYXorIETKcN6QMtQ4VEOnyAuHFDwBXkFhMYxqSWIOWHpI+AHoAHOsTiDKm5osKVCAFW4DIU+jnm5L9oBKeUIYvpuELPVjQghhgmQaXx7p7NYAOWzDBCU94ARP0C4AOGYQOSlCAHgYgDDCQIQ0xA/GBOuDwL5XTEhlWgIEmYqACUPDDEZdyADV8gA1e0MJ8priU+fTwi2AMoxjHOMaAAAAh+QQFBQAhACwKAAsAPQA9AAAI/wBDCBxIsKDBgwWZuGBSAqHDhxAjEizBYEIXOFGI5JHIsSPEPHciOEGAgAQCBx5TqqxyxwmOly83RNCgsqbEGhFg6nTShaHNnwVLzImCQKdOBBsJFjgAtCaDOxteFsRBYsJApm4CNFXpAk5RhKOWCAyAZmtBDCEaRCRCAgfEDmYPpggD8YQGlwMVCUQVNyKbAhBdtCpoKgTfEMVe9TWYYg2dhyXK7HUIqikNIA7nImRqIcSqxQaFkDHxkE3BA2NCaIULKdLhg4mBLlmRAiGMFZJRqy6bsrJBBRwbXDaoR6AJL6r7igiB5kzH0QOLDzQW4lPE1q8LkioG6Q8aNAEs2P8oA1ji7IG2QlAniGgrqDMWxpRpoNYjGwjqEVKSSMrhsExMlddRA2XYYNYrkRB02CKKIDCKCyk1YIMFASgA10OltOcRg8mEoEsITtDkkQUdlOWDRPsh5N1AHBpEQg0eGdCBDzQKlKJD1v0WAg9u7ADAKB4ehAAcLgj4UBpmiFCjQIgwApGGIQDnQ49pFGAljA6FyNEYMy4pkDAQWSOQDy3sUEQBapWnAQIOkUAERzug4aWNEH3ihgFnIjQUm0ISKREWctJ4IpNOIuRICEFEVIMTWYoIURE+JCEoQWAeVEEIJpAB0Qx58HmQmxyRKOiSNx4q3UA0RLQnQkMyINEBbnT/oEASSYjQgQhnxBLLpYyFINZDJ1jVaAhPJNBGBka0kYBBdBjQghlmnEGADQV88BAQahh5UB6MTsUKiOoMIgMKAwggwAAo4DGFQX4ckMZjaYVRm0OpQrRqCDiwIksItQw0QAg/BCywBHhIRMca8x70wBLaGmTVt26FEA5CAv/ggQfLQlTHB2g5pAZEJeyBQL8TH9TIQBUPwIVEYcDwEA1COCSIDlyU7FDAKAcsgBISlYEwQhc8kGhBM+gwiBUn9+KRwAMULBHHDmE7UNFXUPFDCCh0dLJATIMgSERCfOHyQXq4Q0MBOshhdQgCAKVzE0NwZMfPA1XgSwi+AJMIJnyw/+2Q0hL9gIIETbzRUbVo8Zp3IlrvEpEhWMvQxg0pfXEK3nof5AEhTY2ARwJZqNQAHaswjtAjETUCOGgF3ADCPBKF8tDWB+XCSjo9eNQ6CEawEAI4l0Qk+82QCzSx7d8O5CpHGfgugAch8CLRJchoLtAIAvWLr0EcMMHRANAPJL1NAzSRQRxD7HHIIQiRkDtoBcGCzPgDsJCBCkOcEIKVfTwkRhU/4cX4HAKLYISABUYAwQ0EoT+CUOAhJOAA/AqyiU5QziF7iNin9mcT6QXPIY44gkT6N0GBDJAgwCiOL/SQg4g8sIQnDEEKCVIBDCygLtsDTdY8YAUZ2uJuvBJIBXpM8IKINESHMuBCAqbwtYTVrQJB+1UJD6KsJxAEChgIYggqwMXbSHGKU5tBaLQARS5ycYtD3AIYPfICIJjxjRC44Ro5ooUHuNGMF4CACOfYETBswQQYAAIGLsCGMhyRj0akQxg+wAYvgAGRolNLA6xEyUpa8pKYxGRAAAAh+QQFMgAgACwGAAgAQwBDAAAI/wBBCBxIsKDBgwhLzGGCsKHDhxAhunDQB06XGntORNzIsWOVKCScIEAQAYGDjihTGnQBEodLlxtIcFBJEyWFCC9zIogyp6ZPiH2c5MzpRMPPowddwEHgsiAOEjWQSh3IpIvQgwjguCgw1WCDHF++LNlYgAgJHAiLGiwDIkQarjXBHNEDAwYINmMhariKsEYJgWwtgPAhAoSbmmH0YBgIA8KaIA//QnSF8E8HEWNSLllhwiCEI0IgRoWIJslBBWbShN5Yx4vDL5EbLuNoAOWRxQg/RBxVEBUIUyBQRYLkEI0bPxyFvOjc0I7DAs67bsR90C5CtgRAgArukIfD7B3VAP9piEE3wTI2QJwBgQYEIhCkGg5HKOJPCJQAHlg3mGINHRBsqQdCB0gVtkMDKR1xUAUCpbCAegpI9ceAAWBBk3gDMTiQIyAIA9ErDgnnjXcdmOEGFgfUFMQDBXFIUGE/rWLJiW/BVRMNArkoHQizvYUUHfchVQxBwAmECwitMPDTfwSs98tDjKQ0DC66gICWTDWF0CQaBILgXU0+RCjQMN0c5AQRNO0gwmUFWfOQhwgl0YIBIUQBQjIHbXCHkihhgYYIPvhgUCkcFabAnCHUAQITEziEZUd0nKFAoAd98hAlAilwhgE2IIegQHk40ZATPXTUgA2TUmqQmw+1QIANdnz/SlAJDDWkJ58b+RmooAcRipAxtqT40AQkNCSTjRCNgQalvBZkaUMwhPEQsmaWetAJGhVUhA9/7HoQqwNdUBAbij5kFUJ6gpAtCEPEoYQVVigRA0ENWNDBrviypwAPoihjS3UgCNsQtQalM5MUMSjRhAACoIDCAAIoAchAB7RwWaAioIFGABaMUQcbGOiBkAlkRISAQYfIAkIt1OCxsAAe/CDzzBIocR4BARAWwIkHICgEGczRVEBVA6UsUCoDlWOIQTP/4EECBZURQggCD7TZfgatsJETKuciECcQNT0AFx2xMV5DJT8HQi5Ig30QIQfNPAAeHQE9bUNZvIGH2w01/9MI0zIP0AZHJRywAtYG5UXQE3rLgIIA0ag0swDzlu1Q0CBkkQAejhO0C0RwFySzBFZk0VEBdh90yl1TJNBG5ygc9cPDVuiQkuFY6zENCLY4Q0w7HkgQO0KRczSAB1bI8QRNZoMgsvO+cxT6Q7EjD4IO66oUhiQgMEjMQbz88NM4gwsCwgwz1FTAE8B8XxMhxe9YkCA6cGFFRMg4NP1BKiMhmUr0G4QVxLeR/DWEEMMDgTYEIguVDaQKNaGC+FBAQGxABBu8+IkDCAaRN/ABBAQ8igBAIC9AVIEVo+pDSobgk2yETyACaAII4iCFgpwMIWjJHkTkcEALOuQR+hBIBv9UMIQCIIuDBTlJRzLwk2Owq1wHgSBaEEKE/0XECA35QSgiIiuVkMBaHRlhFhGyO3Y8AABdPIgSETIBK0KkcgjxgEF8UZCzqU0MDckDSmaARYT8gAoCOcXuDgKaaVEABBswCJpQwhUsDmAgyBuEDqCzBofoIQcQKcEERCUQEpBgkSqZwryMkAEu2I4g5lkQEB4UkTxEpQtEMIpPjGhEbBGkAF+AgYYKUgETKCgiJXCj/ATihzWkYEH9ic4wafIBDOyyexWoAAzWAMVlpgQMuoymNqOJARxZkyYNeIEzt1mBC5hAWt+kiRYeMM5owiAQH1hNOlUChi2YAAMYAIIeoJAdxnmihA5hgAIUFgAAfyKlAQ2gpUIXytCGOpSWAQEAIfkEBQUAAAAsBgAIAEMAQwAACP8ACwgcSLCgwYMImQBYyLChw4cQI0qcKJEBhYVRiORByLGjx48c90SJwJCEEwogU6pUySBiBA4nKMqcSZOmkyguVurcSbALAhxAgwIlUbOo0aNIkyqdeIKn05Q1JhJ9+LRqwTwUiQz0k6ZIGasfZc6JEhHHt1YuQhhoYYZHAAtFwAr0A4ZMmCADZzoRiiNZMhzdFprpoODPHxEdeIwBG2bLhRQmHrBZAjLPz75/AwNAJVFBgDRVF0CuQBpGoDV4Pc5ZCHjYsoakAHiD2MFAA6da9MAgzbsChCMgoblGZcrUw1UQFbR4ygZDb94XLoBB2EBtCwDFjSp3KmRLColQClb/X/unAy1mxSjOdojGjVM6a75H3HK7jvXyCooiZ79YIFITEtlCxg4t4LfUQkl0YEFoEFVggiOlLJSfRD4Ug8qFGGbIGUM8EFBHVTk0VAEQyjjkw0Q81NTCDgcydIQJsZQIkTQzbRgROS0uVABXOaYI0TDdfJNjA0WsxQONFPlIkXEMaZZMi0W24ANhPpghE5IR0eIQDhD14JQBU054IGIinGGADX3I1JRKDWDRQRIQ/SITnA2VSUAIfjTQwEU5MnRAACIohSUABNhgRwF6CrTHBhSVsNIYaCwlzBkL0ZFQH05MVMVKLE4k50QPHDDDbRzxOdEMKmGBlDGx2FIBDF94/1TCHjgwGhESCAkiiEEh+HCiTKosZEtDGHwgxEdpSiTGpg2pkIEMMmQQxxQEuRERna840pAevaWwhqUemfqQrQAMEUcGLAzAkAADZCDFQGlQylASaKBhhhtY0EGDCc91G8ZHtJILkRIAqCvRmgUcsJAIIlgJAGgCqTERBB+AhKlDtSx0y0wovFHQASGEkAZED1ww0VfhpsNKQxsX1cZKNEyUwr8eVcFQy0YJQHCfALDRESBv7EwRIRPhweYSE8GwAsoDlQC0EiMIkKMKOsUs0czHFgA0HlEL4MFCzcj0w9hkkz2ADIDwrAcA5jzxBtdS5+gBuzIghTRFI3gwwNctsv/LhxEgAMJTHQxVMM00wxoV9kyEGCHHDVaRIawzESFT9uVjE02RFY9Ta5UQaU8Ey1LhAFCLAycg7NQUCbRRN88YcwlAskkJpIIMes/CDeymsyLLIQzhsEdVcggQNwA/UDR6RCgMgIIVCx0iy8oPoeSUDj94UDZSKBgvQxsJFOCCLAI7hKtTbRjc0O4UWd49CiPgkQAggqBaAhJ78QWUE304utMJRhDA5UKRPNE9QwDxewMgUlcQB0iEBF5yChWOZxQFzgBVB2GAGC7DFxJw4ClKGADmkME+h1zjGs4IhM8+QoEIbIAvEUCC6nQSAwpOhHILOcUDKCOrCTiBBAhAgBOrItAHBvjPKRmQAEViMQ2HmEANIDlBHojQhSgggQNzAAsglNA8dg2ABeg4BxMP1y8gWI0iBShBCZiQRTXKpQAJ4IIS8ACCG2wrIjt8I1hq8kQ9vrEBYUhBv3iDARr48Y10SNoamHbIpzRgIib4ViPB8gVBDhIIRyDVJKuyBSBckgybBAsY9MAv6KgwlHL5whqAgIFW6uEDfuCdLAFABiiwYQE5OCIqwaLJXQYEACH5BAUCAA4ALAoACwA8AD0AAAj/AB0IHEiwoMGDCAcWSMiwocOHAhFEYQKxosWHCPJc3Mix4IQCIEOKHEmypMmTIOdEQZAwyhyUMGPKLECEoZM8M3PqBMmhYY2dQGMygINQl4NRrjSFOBC06ciaBI06ULRIoKUkASykcepUgxMcUqk6QGWKoIgOAUJwDeqi1dSqqATGFfhqIJoWdJz60UKGTI6ZdjKNNWVqLkFQBDuMaQrmxQUTJvQc0XKyzBgLZ1ZNMnzQko/PHQg02CkkTAUMFypUuIDhAZiRdC6fUaCA1qtIqHLr3h0Jkl0LQJesMKG6eAUgW+wUsIwZDRoRFhEL7LBjtE4vEBCa8EJg9vOOAhUE/9i684iJgrZiOVL1iVYShpBw757fm5YCLEFfpNCjJ72jgtAl5ANEZywWFBsQqIcQJQ+RwlAmB1inEx02gEeQbwctgstRLkxoA2YK/OIQIg9NMpCGAumCgxMazBQCiN89xGBCaBCEi1QFETGTCGi8RxAlqgQp5JDsHaRABz60sEMOoySEABwMLMQRiQ1R6cCRSbRgQBENjFZDQxpY6NCMImgZQh0jaYAADmy22SYJUHUEJJFEftICAWeapNKabrb5pAvgIcIIQ7YIBNMEETQkpZgDORJLBXrAQIZDefDZJ5twWjhnKQJVQBAQNMS0Z0J3RBmSFDEo0VCAAYgSy0DGVf8AwwpLwHTCBGAWAEiqIwiQEI9oZDVGCWykEKtxQKgRU6U4IJQoHr06JGwZIJVm7LGqmRAqTHN0wRJBuQjEiUAePBShhAUcsAIMCT1Q66EkyELQuIwKxEZDyqJUwh7f0mtQI+CFkQJDNJRwUhYJ4OGQBz9wVEIZayR0wQNBkIQwHjKgMEC9DN2bkAn5FvBEAm1kPAAKAu3iEMAdCYxtBadIQoMgJGfM8Q8oPwTxwAT54kAFwDiAySwn16uxBzLIIZMQH2AAqc8OBG2Ryg0ZIgAKMrSRwBQ5FXLKz1IbxPAPZJdtdsMNjaD1EzudcMAqDD2yci+31G133eOm4kBTOlT/8lAoHKUSrgM/AZUACxJc4hDgD93igOCssCIQnEA9YYWvDslNyNlkeyCAACMIVIsshxziJgkTGKxTDAL8wAtHngvQRAZxSLEHK6ZfehNQXGws0CWPBC/88I/A4gAvng/AQgYqDCESERFcGoGOOwnSxgBkv+5QMMpnAILzJLnQQwROIIAACST00CFQckhg0Sad3GArBz1EEUUPHDDB9w/l/k688A5IhCOOoJM5vGQtbZBA/w6SiJ4BAF1rkckT2qAxzA0EGHooCBAWEEGgzIBkRnCAJ4BxAQf44lgmeEEHudKALVwLW3r4ywqbAgWGYMALHAMPGFLzshTOsCktZMgKH5TzQ6DUECE8y2FHwOCphBQxKHV4gRKnKJAvUBEhAQEAIfkEBQIAAQAsCgALADwAPQAACP8AAwgcSLCgwYMIB55IyLChw4cCnURxAbGixYckNFzcyLFgjQIgQ4ocSbKkyZMgmXRxkhAOA5QwY8o8MYFhRpk4c47Mg4AhEZ1Acc6JghBHADgugipFOYEEjqdPkyXDgQueBiZLs+5EEHVqt2HLUJEKYKCM1rMqA+D4uszUQFQBvLVI0+BsVmhgTek1uIpWi7p2c9YJYaAFqL0M0YwJHNMP4RZJOtBKUowUqsuYL4/11oEA4wM5ctARObiwiA4KLPa1YBcAmxV69KzxQqdI4cgKfOjWzUMgXIa0DJwF8wDDBT0VAhj79EpB6oQ8KmeejsqbJq1L1qSoYKLgJzO7w+//7u3w3VkvgRJKe/j74LAeSxuE2PGp40BLCIcJvPMyp/zCPnTASEPkNeSWQPoJNBUJHOBkWwsB5lagesAR1M1BJMAnE24FWaPKhyCGqIowZvAg3mkinGGAJn0ktMEdVdj3i0M+DITiGQSEUEcDDVDQEAf2PbReAArgaIMfI+2BwwZQNYmDEz0s1JGHIooojJGjlVRCH044CdWLMXb0SykMPVAGYCdRQEJDMwRpkDEB2ILcFzEpyaSXTyIRJJWqCGQLQRh8gOZJXCYkRhUiDaFCBg0lIdArjigzEHIVVJrCGnQ45MCPBQwRRwZNMJQEGmiY4cYYdNBgQqWstgpDGHUu/4lQLQEo0cQAD7mBxQEF1KXGqq22CsQHMhVKEK0B3CKQIQ+lQdISD1wQLKuX0lECTJsWpKybA9HA0KsOVZGLQNsaRIh9ZAA7bQUYsIESIG8o4VAz527UwBIrJFQtSfAqMYIAAnDbkLf6wgoSvHj8K4AHAjXj0A8dNZDuuhXo4Y45T7yRMMDmchTwQ/jCUNA009jiDDEycCywAAMQQgUIONEARKXTCOSMRY043BAKA3hAxRU66JRuyTcfhMwPSCet9A/1JtSLFYPocAJQJRywQtEHwfJQNAzhc9Y9DiHDC0eHsJLHtUtJsUnYDRnSyy2cCISDLKxEUAPaS6kgQUOwYMfDy9JIoyAACiPgkU8u6bBCAgkITDCHVnW0AY59hb+RxQwFVEFBDz1MsAfeWeEBDjcNZXO0QAKMoMQbgMyAuZagLyUHONg49IwATSgRgxSMyXQDC7M4dMzuU/eO0xWjI0RMAMq4azxQcvBxkDK+CLTCEs/rNMMN9xCzvDI1F0RG9tqHIQk7JE8LBA2Dko9SCWWsoe/17uf0AQQUc6eGwEGGkQJDNKgfTuggP4TsS4AwacAH+MdAg3zhfw2MYAG2EMEKgqGCCAkIACH5BAUCAA4ALAoACwA8ADsAAAj/AB0IHEiwoMGDCAcWSMiwocOHBOdAnEjxoZM8Jypq3DjQCcePCKMgSBhlTgmQKAsQYTgSpUsNJBjWcImSAZyECKLQREnE40BdQHXh8Lhw50YNHnUJVOQAV7VkJGoUKGqUootWDhQtcoCq67JhG0a5mEq1qkM7mbgKRCXQlKllTjSQNduwzBgLZ1ZNQmhqWI0SU+ketItXgQIHryLxRYVrbFmQZMsSPoMGjQiIphbJfbwx8ty7ASpfJuhDICmEkxZJ5VzRsx0bBAIosMwQUiS2BjO3YsB6Ilk6NixAktaBB4/SCZEffIuDhAaUdmN/KiWQkTBExx2eJmgKVTddJFZq/2wAHO8faYwMMvrlENLBbslwIIDjgmL5M7P/+BCFUFSSh3sJtMhTOODgQFwZORRCYbT5YIY1DFHC0GEC4pLMQeI5dNloAjkoDEOfOKCcQIfx0MIOAIzigFIGzccARz7wECJDiAw0mw8nFkHWTAn59NGHEf4hYgsG6FhQHk4YeFB4ve1EZAislTCHSAi5+FGNCTmixwEzNDSBQ01u5IgDFTiQAhkO5YGAkgf1QBN1ZBIEBA1hOjBlSwfd8eJAUsSAR0OXJRGAMrGUGedAMKywREMlfIkQm4D4OYIDAyB0mQJnWGBDAWwwZAIZQjSkJpsFkaAOHiOgMAAKDGU6Bh0OLP+EZkIY0MAoE13gKVAuAnFCURkGHbACDAjB8MASdU7gBCsE+bpTpwkBMStDe2zQK0KNfBRGCtHS0EBCTyTwp0PZalQAsAldcKxBUyTQhgweCFYQG0AkZIIaA4X7rgerCrQLudpye1AFktCZABfwVlrQDw1F0wjDBLH6ELoEVeALmcAk0g4vCm8UDSEQs+qBDHJAxAYGAlnsCzAUEfJvQs0QIhAKMrSRwBQThQFDBRVMo8xBhjRU7kHRrCoDHglkoVEZa6QwDTDXGPSIQ4Q00otBvYyAxxuAgPQBBL4Qk1AoEB/0Q9W7XN3LOhlwPUNgHDUQxiksj83QDx4IIEATSsS4IAVgc31UAB1rOJPQ1DIbFO/efUshyNuRQVZAA+YkotEATWQQxxALeQa35IUYfvdAA7CQgQqc9/a54AXYsULUCD0SjAMsGAHCDTN0KS9BZFXO0Cad3FCnYFMVMo3lBUXtyBG7P9T6GuzEkojYDtTtwAM5NN/QVB8A4Ysv0xy0gPbbg3EBz4YSZMILw+9egO4IVaBH9uQ3ZAKtXtSfUAnmM/SC/gmpwxbud5BE2QGACIECAjfSv/oFBAAh+QQFAgAAACwKAAsAOwA7AAAI/wABCBxIsKDBgwgHnkjIsKHDhwNdQJxI8aGGAhUzahRIYqPHjHAkfhxZg6GTkSgBIGBIJKVHF1EYwnHpsUbHgThy4hhYgqZHHLp06czppKXPinNGAcChSJGuZDoRwGFwdGKJOtAALEO1bNmioDlvVm3oJwSBFqAGmlo7rJpQEkbHGixroEUSNAKLEWQLVSpVuQLpthDRAW9DXEJPMhkrOEkHBRBNLYIK92idEAbO/HnMkFkxUnu/4thwx+XluiIAKPChUTJUgRw+nh782Idt2w9RqV3mlGiPjAUaYLZb2wcPM2Z43G7ITC2AyTkBkP77UDhqzraRI5ImTURy3BCh7//kyAFjwyJ1N0MGcNvML2GlSgFgJAyRGdYIaQ0cJjD6QCe/OZSEagVlJw0jBjHyS0KpGRBCFwmRBkBPGRmHCIIHiaKcQIRBRkAIdjQAwAQMiVWhGdY0xINqZxBgQx0GbZAQgBv5YMYnDrnox0EFMAEhQhJqZJwoCRnzQBrmfUQhTbYAAEMYDc2wh4wImfiRMQA0SRAbDvl4EkJiVEHQECpkwNCACrwiijJaHlSGQxQ8NEQcGTQBgAAHDYhGAG6M4QcNAOiBUApQNrQHQ7VQo0QTAgjgQUJ8YnGAQDAyBASXDvXx5UC1CHTLRGkYtMQDFyS0wgFLIkQBCbKMBWhCKTj/hFEunh5FhgkMsVHpQYC8oURDvRDyg0ZLMATDqQYBEgMeI6DgUDSNDKvRqwmRMVCvzDo7UDMM7SKsRgXcitApALAhyBvZ4lkQIdEgBO0P0mY0qUEV+AKAM8QAMAsAjx4Eb7sF9QIvvAX9YMVDMwAAxEAVVDCNMxMN3EwvFPeySyPCEsyvFVzoIAhEZMQKQMO+AFMQMg3BSwjGPzQS7Q/aAsAFAB9TdMAKMDRc7zUEweLQwECjMAAKMrSRwBMesYEBySYbhDJDA3sw9AhGZzGSEACk0PA0iRz0NENT4/FGFoIkjNLNOT+MEC8MjQDAG4AUkGRKBbABRL0QQyTACErEmQAIYACEobUeFfBsUCgDCdCEEnFIAbhAJdDhpMN5F/TMAE1kEMcQcj++5d2UGz7QMQAM4TlCgjeshy+xOJNIvgBQe7pBb2qtui++TAOAvUHMfhDWS+vcMEFq+H6Q4AkBcYTxBkme0AUP9M58QRgkr4aI0wNQQBgwMLR89oGt0T1Ca7wJfgEfJIQr+AN9MT5CDcgt//z0119/QAAh+QQFAgAAACwKAAsAPgA8AAAI/wABCBxIsKDBgwgHFkjIsKHDhwW7MIFIsSJFBHksatx4cALHjwjnNIzCZCHIkwBKEGGIEaVLDk4YenR5kgEchlFE0gS5MiFGkzs1niCIA0fBCDODbnRxE0DRogRzllCq0U48eDiSPYUKwElGqhDp2BhIatmiarq2CqwBFOxBsQTOKOgAwFskU6aWoX0qMKdbg3DlohFx0NSwtHwB5Bn6N7ACAIQb4kJsFEANt3ABPI6MEFIkVABMLaIMAEEUF0EdQ7YoWitXBBpcquZMkVTo0YlJXP44W6CP3z4ges67t3Lp0xp7+wbOnOIi1wWdxKYYIu7mgsyzB0/4GMBzrgR1V/8kTHtgdh5mzPAAjjD4DlejEBgniACOi7YbmaNHJE3ar/TbaQZAcAYUUUAJJeyGkHQoAWcGIsIwIlApn/z3WBItGBACfhogkJBujH30mxm/SFhQKdIAoGEdIUXhk30n/caDKAmV4VANMS04nYhmUHJQBQCkQIZDeXiYUE88CiOQIwAASRANDs0RhZEG1ccAR4Sh0YI1AFxwUAoALNHQCUkhtCMALAzQEGcWpAQFBk4aBIQa+BmUR44IqSOQmg4lAYAFY9iYUhhgJgRlQ1JSaVA0AnhA0QGArVHoQQ8sUWdBE+Ap0C0DRdPIDyAJ8QEGCZmgBpEMeUAIqCAVMulBNAj/kZAUAq2DkKc/sMqbpAhd8EAQBU31hhIACDCAAL0sumquKI2a0JwHCdAoAD8QQsguvWTbSzOf5qorR0J8AQNCFWBwqEDGGpSrtdU20i2z0VZkB68FAckOMJgI4JC3/H47kL6EUAECADM8VICzBFVQgS/KVNSvtwZRcQXBBVP0hZcDKVzBNMQI5Oi+zMLrsRWD6DBFxRUVUAe9TVagRywCPfKRB1YAoIMgzQIhkMa+AENQKBChIJAMAglSwAwoc1TAxTsr3PPPDaGgLwBtJPBEAZd+5AevGuthC0GXIHOQ0ELjkYBASe9UwpstK8zxQ3i8kQXSfwkEhpdAOm3LNQLBioIMLwONAEAMgNBdt0AFCLEFmBovrEzHsAQDDgBKxEDr4Qix3bbLPTtzzhuYO3R3012f4o48oTvUwBYmZNy4lzmkzlABUDCEwQKyMwRGBRgbZMILuSdUAOsJ6RF78AfVnhAGXmQtuxBa8J4Q8MgbNHzrCK1gR/UGKf8l9wdpoUfv1oNPUAMvkJp6QAAh+QQFAgAUACwKAAsAPgA8AAAI/wApCBxIsKDBgwgHlkjIsKHDhwWjzIFIsSJFJxosatx4sAbHjwiZNITjAqTJgQUcZjx5cmVCjyxBnijJkGRMkzARYrz5cSFDEjl5ckSQ0KZQiwVK1CBBAQdCl0cdNqDToIAGJziyOi1IJGrDOhQMtDjTgoCWUQi0bh1o1CtBPyEotBDRAY0IBR0oZCKh1qAGn17rxG2RhIICg7QoLErWd6CTrlEFG6DwB42CPwl/LVO7ViAcBjzhyhVh2CEPgd10aS3IlKVkCkksY67YbcNqroA1NgghljTHPyJwfbtN8LNGyXNLf0RDbwLWzgQ5WBRb+LBJBT405UmbEDLE6g59iP/30TCAjQZzoiTccAf0zfHwyRf0nabqiQk/pceMH580aQIUNFBQHk4k5EQPKZ0UHw9mmOGDZWcQYIMfB+V2EHvumTQeg79II80rBoRAh0MTtHYQCRwk+NGGv3zCiEAPsLGEigjReJATQXFEFw+/iKJMCgJdAMEKWjzURYEn1mAjBUpQpEAAFoyxBpAFYbCFHQ0tSRAJDqioRBMUDFDRAQWQYUJCZDy0wQYGsUJBHjEIJICYDZHmBgUHCFRAAWxg8NGeNURw0D4jCKBbQQUccSZCKzw0h0duCsRJLxII0MgPJvHZUJpZAtIPBZP2Uk4jl/6AqUmcMqSlQIBQgMcIhsT/Gmuppp5UwgErwIBQCissgahAeAzkAamkmmrsTWwAAdETA6FAJwXGRlvrTWFQmdCeOlBBgQAeHFTrsQ2hMGauCMHwwAFDyPAsSOJ6IIMcFKxqULIHVVCBCfzgIQFLKMjARQKCyHtQtfVW4A4oI8zCUbf9tpHAEwInVAa5BNlbwQPAfITCCHgkkMUMJrFhkMW+ZIwMRN1SwPEbWVBrrUAWnwIBBQoz1K2hSrzRqlBljGzxNMQ8w8tBNzehRJzxRuXHBz5XcIoym4BzkNFxSLGnWwIRXLHFkoAyjwcDiNlEBioMcTXWA9GxRtMXB6EDCHLEMQTaCTHdNBALnE03QjMUR6KrzyYcsbdDar9sEAACDl43Q8oqztAXMFTg+EZ2TJnQA5PX3fhBeGduUAGQS8654J4XVIflpVNkd+oQgRE56w8VsMXmdAcEACH5BAUCABQALAoACwA7ADwAAAj/ACkIHEiwoMGDCAcWSMiwocOHArswgUixokMEeSxq3DgwwgSOIAvOaRhlZMiTDjOiBMmh4YQTKzcWYEDSZEyNRBhiLHHTIsyeQB9GobAwqEOeORMiMOqwgFOBJBjWYHrQzwE6TguUcAGH4VCqAunYoHAmwBk3NrJObVgUqFiyaCiImItGgQGtGpzgQEhi7U2xBCgo6CDCR8E/HbAU4Lo0oYuVb88okMtQxBk/J2qQ2HvQyUnAggkbfhiiQF7OB/1WBCx5o4i0jBk+hsh6sgiOPIo41cxQA0QCrW+D7OAma96Enh/eFh4SjZnSTmcjRADHxU+wAs9AX1hAtUEnvqlO/za84wCFBgQ1ND5IwgHPmD7iD/bRwoDug235OsgPUn6HJC0IxF9qyOVxHUgidKBAfSHU8dRDTmzwnUQDWmSZASHY0UBWDzLUXQQSDhRhHiVUmEFDHZBFgA1+NLBhCWUcIERWTX1Ewo0kRJEHjQOdKIAACCl4xop0EOVUA2S8sMIKW0BxwHseFlCFAzVMoIELJZQ4BAUnUgBkQmdYYEORChVgBw0YmAADDCZAsEYOD3GYZQlSxKFEExSVMaBTHwRiEAZbkBmlU1LEcOePHvwQUgFa6HHBQUCoAZGhTSD6g6InFbAABgxBiZASXgqQ6KUr8cnpQRc8EIRBT1AAqpcUXP9Kak9QUOTUDVT8iB1RFMCQkAlHCFgAIFYMsOtAdKyRAkKPBpGVHBKs9IMVDzXwwamQquFUCbmG5AG1OlD0ha8IAesUICN4YBEKA3FBgSAW2aEssw8AUMATI7BbkQxtUPBEhQ9di1AFQCzgVAZfQpTAux1qNO7AQBxRwAkxGIvQAOziQUEWN9nBUKr2FoCHBPoSNAIFbxgFsEAVmGCwU3LkSwEKJ8cACFhfPFruETOem0AMb0jhKVMr90pByDweKxAUECTEKXpKF9QAGDoj9ELUB9VhNEJ65FA0drVibREYFYhdUQFbJFSBHmYXBAW2f3rR9kBk/3r13ESljbdDYe8NzZAWFVTtt0FC3I1dQAAh+QQFAgA3ACwKAAsAOwA8AAAI/wBvCBxIsKDBgwgHlkjIsKHDhwKjzIFIsaJDJxosatw4kESNAiBDihxJsqTJkwWYNITjAqXLly9P1GCIEabNmyI1kGA4k6NPhS5WtsRJ9GVPhDWLKjX5s2nFDQlZllhKVeTRgzudNnXCkMjUqlVdRGEIhwFYmDNIam1ax4aBFi3cGDgw8kSehkTOjvQTgkALER0UKEDT4YwNkREbmj3L18AZwAoMogmQZqRDDlUbn0kSmGEHAg1E3u2qlK9fERQVnKETMjHCDXcWwzT9F42CPxSTBDgQOuQEhyodvk1ie6OI1SJL5EGQkMQEmJzR/PzcO+TE5s8LrE2ogDLJE78Rkv/QoH07wjMhTO5BALWgE6nlzUMWSLfk1AkR2gt0klR+h+MG2OBHdSdRIEYEJCQIhwYntLbWGQQISOBLVThQwwQcMPBVfBzZBqENrFVVwoYgHRSHEg1Jd4MFIOqlVkExoMgQGpNZMEZBLpIkRYwPBWBjGTmetKMSI1BUn0sNHLBEHUoBEgMeRa4Vkh8LbLHCCltAASRMUrwBpQADoLAdSAccAYEJMMBgAgRbAIDSFF4KFKZ5AoFEAwQV5KknBC9MGNIQGYBJJ45fwJAQGX4+QYUEgxrUABR46ikpEDSUJAejjeLIBgaSSgrDCktMSIUAP3kgg1YpDBQSICOIqREKMrTXkcAUNoVhQqeT0kAiqx5A1KtAeCSQBU4llLGCoQktIdIJRpDK0K8j4PEGIFSxAQRDaoykwgAJCeDstGeFkQKueppQp0hKSPCrQN6OoEQMUjSol7EwkFsBDA8oK9ITXLDgrQBNvCtFkCGxwRAQ2ZI0RAwgxDAEwSOFUa+9QBwB8U3FMnTBA0FcfNMHB6shhMcwicuQxSS/RMcaqSL0gJspo9QAyJlq9UXLCB0xcswnrZwQvjDzbBLNCS0g9EmFnny0SX6sgWzNPxENtU+FVjC1TwVscfUNAQEAIfkEBQIADgAsCQALADoAPAAACP8AHQgcSLCgwYMICRZIyLChw4cOupSASLFiww17JlrcyDEChQIgQ4ocSbKkyZNzGDrpwuSky5cwQZYgwhBHnpg4c4bk4IQhhRk6g75koJKl0KMmaSZEcBOpU5AnHE54SpUBHAQJu8yh+lQpQqYcwx4kwXAqV6RWGUZpedZlWLBiGZZp4LKEhoZm29KxIfBMCwJp6II0CEft1qcN9hI4g0agCAUdzIwxGZUhU6eKGXcQ4aOzZwU8ipi8y5CD0MwKHHawILJgYYQkTONEvdmz7ds+RJwpY7LG0j0nXjYIsRgyZ9zIO4sIcGA0CRzQo+Mg0afEwoYiaiffnvsMnZNEImz/kO7E5uC4DTsQOFliTg0EJOKTiNL0OnqEHc40f7mHQo0aHMxhXUj3GYRGBy2IFlMJA7ZW4ECQ+dDCDt899WCELRigIFX3QfZHhiG05ZAKGTDUgQIg1vFgQ3GUmNBmZxgQgh0NrJhQHA4lcQYBNvjRgGBtjVSZA00IMIBDdgR5khQOKGGjQE9N8YaTDgjggY1PSZHBAANc+aQDIy2xRJIxZSDBlwOF1AAZLzzwwBofBPHSGwKgCSVIfrABgQkwwJACBCuAcdIJeBxpJ5gFQBHIBRU02qgJaxzQ4EhG1GlnAQ0A8AAMjnYKgUEhnZCBpRVxoZMaGHTaqQlHnDSIoQ+1t5HAE0FBgQFDAJh0AwsoHNTrQAlkAZRQC9ya0AInqeABqQ7A6kAWBcwwrFBgqKoqEAeJ9AYVfKDw6xuABLlFCtY2esEDObgkiA5vJIAmFA0hq6ROWlTAaLkmvDBvUFuYkJAe6e6LExTYHntoQ0JooccFCekrME5bMATwwzDV4UVDXlAMk8IMI+SwxifV8YIJ5TaqhxYgu+TFpwllnLJJHDf88kkjHyxWA14UbDNHOeixs1gvGGtnQAAh+QQFAgASACwKAAwAPAA7AAAI/wAlCBxIsKDBgwgFRpmTsKHDhxAHOslzIqLFixAnFNjIsaPHjyBDitzIpCGChSVGqlzJ0iECDSxjyvSogUTDGgUw6tw58KQLnkAPOknoBObMoytLPMSJtKnInw3hQA1K1WHRqlWHJqyR0qlXjiWmIpSKtaxQo1/TPnSQdmbDDQhJOOjatkERA25auNlRJmnDonXvtvCBRoHhDmdCrMxj06CThV+L7BjcQYGPy5jRBEgzsgSTGhHg9nzpVDJlNJhTY+5AoIHKORMQkJhNAo4GujHTGKBsWbVvHyLO0FFZosQeCkRqcGCAOybh3r9/J9ncNqaI6Nh9TO/r1GzCDha+ev8/qMBMEaTjEYroEMDGxvRA1ys4QyANfJ4iCp+xYIPO/Z1ooLHfGP79VxALAzQUYAAWjMFddSINEUcGEInA4BgHQChSCVLEMZAAER3QgGsafgSIQE0IkKCBF210gxUrsojRRlNQESOLTcVx431fKQGigV/NYIQAPxRp5JFIFvmjRR0JsUQQw8WUAZFJVqkiH1SAgJQfC2zxwANrfLDESjPIsSNCP1Ahhw5NlXEEBCZccEEKEKyhxUpDjEAlkigM8IMVV+gwg1dsBFLBoYgCsUaUI72BoAeQCuSBFVzoIEhaWsiJ6KYYqCHESjooMQIfLMjARQInQOgFBptuaoJDHQl2IsUNNzxRYgEfYNAQADKdUJGMBHV6K1JfwFBBQkd8OqxMdqyRQquIwvAAr8vKlCus1cZU7LHA7uTHGjAk9EC3CeHaEAYLZBsTGBdwS+5FMzjbUA7qsgRFQ0C8e1AD7LqrL0QNbJHCvxdBoSvBEbGLsEVb5CtjQAAh+QQFAgABACwKAAwAPAA7AAAI/wADCBxIsKDBgwgDkEBSIKHDhxAjCtyAY09DiRgzPiThoIDHjyBDihxJsqTHOQ6d9DHJsqXLAiUcbhBj8aXNmwU4OHHo4ITGn0AHqrwYtGhBEjiSKk1KsSbOpyWZQKQAtSpJBin7xDTKFWLFrl2RLl3qRIPVsyCxJiRhFizXCGOZVkRLt4QGsWMX0t3LBAlcsjQ/ug1QByqDHk5IKCYRJc9ej3RsEGhxxs0OOjhP5JlApAYHF3sjEziDRqAINB1apHlaokRoyaQ7iPBBu3ZqzI9thhitQHbt37Z35LYpwjfw4z7QuBn+Mgny5wpagBw8WLlg6m47YLmOnWsHN7i7c/9VgKbFAY/ig/b20QKLH6LpMa5vYaAI/PgBlDQRkLD3H/r2MTeSFDEoIdAADv1nQAiFCSjSGz816GBIU+CBIH5AfdSGBBhm6NENfHjQ4U8eCQLChSNmpCGKKUYE0iAD/CDjjDTSiEJRZ70hQI08ojCABzLIMaFJU1DBYkEoyNBGAlMMyZIOI0jgwQ8eeDBAkngkkMVeDSwBQBlQ3aDflCPg8QYguanxwgMPrMCGFlANoYMOaA7HBgYmXHBBChA8EMZTM8wgIBQQGGTCA0s04KRLSzwAA0ILLOoSGSYk9IKkLDWwABAIXaBHDpiaRAanDgkR6kgN5KDHBS2S+EIKCek60epBmpJ6EBBenEoSAI7OquILlSYEp64iLRDsQRh40YCvBPHKKrMuHnEstKWqYSu1DjmLLURHFNphQAAh+QQFAgAAACwJAAsAPAA8AAAI/wABCBxIsKDBgwgJlkjIsKHDhwKdRJkDsaJFhzic5DlxsaNHgjU+ijTIhCGCKC5GqgRQgCEOBBpWqtRAgmGNljJzFtwAJ6XOj04Qvtz48yJOhg6KdvSJkASHo0ofngh5cAOAPVCjOszjxGrBCD0KZNXKsMCECAgIRoBTRSzZigUc3CFBFwGStm7fOhRbgIEGBw72nOCrFyLfEiX4Ev6Z16hixTofL4YrWWaDIgbcuCFgowFkx5Yxt/CBRoGCDmjcHPhceGAB0T4AKDDYwY3nxq0Fkp6dsAOWybkBiHCYGnhwhwpaGD/OsPZy5gg7GHgOvSCaM2VwVzc4/EwR7dsFiv8ofYbAgeAZWAxIOP66BRt0CmcBkAHAAAEMRZyxMCZ+4QJSGLEeROe1xpcSEoRX1gk6eKBgQnzJMeCDBSnWxoQUEsTXFRhmKJBYMySAgocV8mVEggbh94MV1Sl2gxUSoOCBgwB4YMUgOizUIl9SDCJDE01YwYUOU8jEmkWPPTHEEFOcwNFKko310JFGRillQ+BBaSV1wSkGBhtbbHGEGnRceRxfUFyAQQopAAHBFkE8KFYDC0BwQUEYbOFfeAUs8QAMB2GghoIFCEEGEAgBcQSFUGCQ0ANyeuFoQgs8+MUFFZBoUB1rpMBQDg9+gGiilfJ5aaaaElTHFgytQYeOLX4RMKlBJmQIBqYJNUDhFqO+FRAAIfkEBQUAAQAsCQALAD0APAAACP8AAwgcSLCgwYMICRZIyLChw4cE+yyESLGiww049ky0yLHjQAoFQoocSbKkyZMoRc5h6ERiypcwYxYo0RBHFZk4c4rk4ASHz58/neQ54bGoRaEbjSoNQALoTwR3GOicGpNmBKc+SdSgyvVliR4RMP6M0MXFjK5oTc6ZIIaE2w1EpKadW7IKBwocNNLda7IE37+AAwseTLiw4cOIE4ukY4NAixYWbDRQ/LJBCAJnFAgUgUaBBTojlxoV0UGEj9OoO1gILdpjEtSwTycJIbK17YEdDNS+bRvN6pC8beeenDT4aBu7jRtVnVx5wThKHKJRDVrxGyVNBDBU0IFHizFCKA/PQjGA4esWO4pQDgligAeHRRrIX59FBgrnRUXOSHAff/6QcWjnn0civSHggByJNAQL7yFY0UiCtCGBgwmGBIgREqDggQfkeSDDFeullMUVMvDBhwxtJPBEiDBlcUMAK7IY01ky1mjjjTjmqKNJDdSxY0lafLDFGi9AcYBfOy6gBwQmpGACBGuAsSMZKcBQkAkrLJHjDGuYcBAEXuQIxgUUdlSAGl4mpAWOVCaEQZg35vAAmWVaVMALDK1gB44LAIFQCnUmBMADViKk4xEQIBgQACH5BAUUAAAALAkADAA9ADsAAAj/AAEIHEiwoMGDCAd2YZKwocOHEAfiQADgRMSLGCE64ZCxo0eDGj6KzLhBTJUCKFOqXMmypcuXKjWQwEGzJo4IRErA3MmzZ8oTNSJssEkCzkmfSJOuZDJBDImnCJAcVUpVaRUOFBzkOVG1q9evYMOKHUu2rNmzaNOqXcu2rdu3cOPKXVnEgAULBoqsHMm3oA80gDv4MKCyr2GDIjoQTnm4scAkPvSidOxYMWPKh9FYKIy5LxoClzvzRTNmLsopcTI47ODGNEolEhombnHA9ZXYCEWIOGOgjGspTVA0DEHHNco3wkWPVBlHgHK+Kd84fy4S5Qngyal3VDkIt/aMKqfgdBkgwIOH7xdVnohjZMQIK3KM8wQkRZD8+/jz69/Pv7///wAGWJUQdgQIBg1brPGCF7XxB0UFGKSQggkQrJGDEPkJoQYQF1TgoYdArNHgfQeskMKHKEKAnkMNhGHCih8tgAGMHqlBo0daVHDBjRgJ8QIQ3wUEACH5BAUFAAEALAcACABCAEMAAAj/AAsIHEiwoMGDCBMqXMiwocOHECNKnEix4kAmLpiUsMjRYQkGE7rAiUIkT8eTCfPcieAEAQISCBygnDmwyh0nOHLm3EBCA82ZNSLoHOqkz8afFkvMiYJgqNMqSDkyuLPBqU4neU5EpVjCBZymVnFg3WoRCU6rCO4wIFuRg1CrJGqwrViiR4SqOiN0cTFjLsU5E8SQGLyByFq/FqtwoMBhD+KZRx9Lnky5suXLmDNrLtBgDIEWLSzYaLBZoYUOHRSIQKPAAp3SBw108EG7dgcLsAumMSOitu8kIXIPHDPbt20DwgXuQGO8NhrcybEwb+6jgwHSwov4SEJdhI3kAk83/78NXuABN6mTJEFz+7XkBG0yGGmTYCEdAy3MmGkxRsjkQSgMIIAAA6CAxxQL+bHEAZWBMIAHP0QYoQR4lJeFDChIKKEHHtQn3AwJZKihhANwAV4cAowooQBKgPdGiir+MECFyQ3BAoQqDgCCIMkJ0oYEKgrQxBDlAWKEBChw6MEATbzRl4VXyMAHH03gcUN5BWVxgw5SYOnll2CGKeaYEdVRx5iF0LDFGkeoYYeXDXyQAgYppGACBC8sgSUUgVxQwZ9/4lleDnr4CSigQIQB3gIYHHooBmwkJ8QHjTr6pwkvgAcFBJZemqlwDZBhQqcVQPABeGWskIKlF1wARnlq1CN5KAwQQOElGStgoCsGD3jhH5YNLKHGB2wsAACZyCarLGUBAQAh+QQFAgAAACwKAAsAPQA8AAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpxI8SATFy4qamzogkIXOHB6aNhI0uCeKBGcIEBAwkmNEyVLuojiBIdNmxsiOIAZs+IJBxFuCkUAJ2PPikhqCr3pJA+ToxNPREGw9CYJB1Ap9lFalQSHrBNrkKiKYwOOPWAl5kFgdmmEHmknTohA9WYEOFXiTnRwh4RfBEjy6p3IQIMDB3t4Dp5YosTix5AjC5yRxoAbNwRsNJDcEAuPDgoUdEDj5gDnhA1siBDho3XrDm42nz7YQoHr2x2wzC5Imcft26R3F7SR5LdrBS2EEwxh3DVs5QPpnGFtvIMB6JN3dDCO5kwZ7AL9WP8A3VpEhzNFwA+cseOM7zMETKsn6CdNke+Ds6jIYIUKHh2CzFeAFEZIIAAKKAzgwSACKiHBDxBC6MEAcoB3gg4eRKghCk0MAZ4cA2iooQAxKCZcGyGKCCGF4F2RoooDgIDdDAmgoKKEOqhXoIoSGDHfDVZIgIIHHiRIxQ0CSjGIDE00YQUITwg40BNDDDGFlFhmqR4YbGyxxRFq0CElFBdgkEIKQECwRRDqNbAABBdUIKecGGxhB3hLPADDnHwCoQZ2QpABBJ990gAeFBgQOmcKa4DnRaKKVpDCFuB9kUKkFWBgKHZ1rGGCoheYEIZ6YcDw6ZwXBPJBHfORsQIGsCYWCoUfUh6gxgdseKFFA7IJyKuWwCoXEAAh+QQFAgAZACwMAA4AOAA3AAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpy4kIkLFxQzJizBYEKUO3B6aNBIcmAeOBEQbEBAwsmEkhk5wnGCo2bNDRE4wKQ4IYLNn06iMCmxEyKTLjR/2kSwpyhEF3AQKLVJQgMTpw7nRJE6FYeTkVgdEiHRdYOYKmEdaiA7NUKNtA9rpLSJMwoDoiQb1JlYgsIdEoA3EGFQ0oaFFmfc7KAjkYEGBxya4s1oAE0HBSIst0gD1yEWNH98iBbdoQXjzgrrtFAwunWHHagVFgndejQaN7ET2hBRe7SCFrkRzu4t+nbwg37OsO7dAcvxg1g6MHdz+nlBAmjQiMiMpsUB6wjHuP8JEKAFFj/gFdIpMyO9+/cOE7RRokTODfgDp+ARMEAA/yYqnIBfGxL8YKCBKAgQB3w38OHBgQeiMIIU7gkCwgAQQihADO+1gWGGBg4gx3uDfAjiACC894YAICKYgCDuTUGFiQcOYAWM7+kwggQPeuCBBCPoICCDSjRhYBNtDFHSFzRssQUNZFA0hA46KNleRnZ8kAIQKaSAgQk0lCHRDIIMSdIHgVxQwZprBkIDfFpUoCaba14AAxjvQYEBnXRiAIUQ7tEABJ9sAnHEe2wMSmgFhronhBqKEgoBFO8F8QAMhMKghxbweYEBpmzCAIEX+BWwwAMYAAEEBg940UADpQYQ4QUbbHgBQKm45qrrrgsFBAAh+QQFAgAAACwQABEAMQAwAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSjTIhIGLExMzEnRBocsdOH04YNQYsUSVKBGcIEDgJAKROSQhzulCAofNmxEmjIy5kAmHCDeDIhDDgGfDHjWD3iTBwSjDPk6U3nRCwelCJFGl4iDhIGIIAm5aWBjjpyEFoFoR5IG4Q0EHNArQdHBzoMHCPTg2SCWBBOIYNEl8CPaRZG4dhg5IIAhKAs6ehw1aoBlMuQOWhhyikNiMAEkVyEUoi0bjxqGLPA447Nnp0IYI0YMVtHhYQmOIwLB9kLaqkM4ZBbk77OCdsMGODrA7tKBDvLiFDgr+/HHbIk1zhQ2wtDDDo4UB5tcX1v9Jk8ZO+PPo06tf3xCQCiVUMsgZwn7gDSsSBKAQMKDJm/pTUDHADwQSiMIPCbAXx4AFFigAFewpIUCDBXrAxw2CpDeDERNSaGCCEQmxRBDgNZRBhx56AKJDfiywxQMPrPHBEgzNIAeDFKIwghQPlXEEBCZccEEKEKyhBUNDjIBigRK0McVDbARSwZRUArFGiQm9wcIAHnTJXwaAPKSFkFSWCYQaDemgxAh8sGCFCqwx5AUGZZpJg0OCSHHDDU9G9AGddU5pwhYQnRCnQ1AAGmgKL6z3RQqBTgkBFEKoJ8QWQAQKgx45sPeFHplSaUIKalS6XglabAEDEECksAYZ9Q0QVAcYCywQRhmx5qrrrgsFBAAh+QQFAgAAACwSABQALAAqAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjIpzDwMUJiRhPMJgQ5c4dJBxKYIS4B04EBBs2OCFRg0nEOmUaNGQAhwSOmzc3RKDwMISFFmdaEEgjMyGFCDiTIoDjQuRCLCI6KBChoIOZMQr7OEmalEQehiFEiPBBlqwCHkUQMomCgCtOEhxcKnTToazdDhYQltDq9ibchWXOjLVLVsSZMghr2HS7AUeVGQkbHAiQhHDhAAcQ5kHpNgIRhnQEW/ZhmI7Rk0kjRGHgVKGFupY7EFBYggOclTaJsG4YgocCwh3OZF7oIo8DDVWYlGi9cAwPqVQ7tEjL0OlyiUUInAm6w/RIiDJn2P/5Tr68+fPo06tfz179lARc8LSJAah9QSkZBAzYL8CKDkEQ1bHEEnU4lIEEPySY4ABN6OBQGV5s8cADW3hBB3MGvSGAghwOkAGGBwWxBQQmXHCBCYG8sERCJ+AxAIcKesDHDQy9AEEFOOYYyBEKGbEhjAmikACACZFhQo5IVpACGAidkB+QQSawEBtAJJkjBlAkNMiLQHrQxBAXJXTEkVZWAAQNCd3AAgpASqAEQzSQaSUQbCikggc//oCCBFbQSJsaGJRZAQZqLPQGFYSggMIIXNTH0BIPpGClCSscAGJBJ+jwRgJSQOaQGinIaWYFYdg3EBlrmIABBils8YUQpgoRVAIdYXjhxRfexarrrrxCFBAAIfkEBQIAKgAsFQAXACYAJAAACP8ACwgcSLCgwYMIEypcyBDhjIYQDxYh0KKFGwMHGs5hwIBJwzE+OihQgKbDGRsKXUzoIuZOFwdzFIbwIcKHTZtoAqRBWCVKBAQbNjiJgMRFQgsdbirtQKCBQSZ9SOCYSjUCEYRlztRUalPBGToGOUSgSjZolYMHAmzlmiTAAacEiUglS5WEg4Nl1HK1KeKrQSRO6NadgNANmr0hmxqUK3gqCQoHZ4QQsbarzoMOxjYmkSchFhEdRCRRYDIEQgZ3EAgm0YdJCYQNQrg5E+AMRoUcnASue2dPQzoH/DTU0AUBCRIbkFQ5ETEikzwcOOx53by69evYs2vfDvvAkjrcEfr2WbBlxYotUMqEJ3jgCAQTMGCYgLAFgEIpIJRkwBPjyUIaEFQg4IAQvICQIDqMMIAAAixIxQ0JfQHDgBRWYEIYBw2h4A8ccjiADFIwV1ADUARYoYAYfGDQDFxI0OGLEnCBEBsYnCigCUcIYZAVArzYIQoy+DfiBzXaiKNBUozggY8cetDEEAeRYYKNFUDgBXUDZaEkkz84GaJBZawwZYUpPGCfQRkMwKUAVCRExgVj3piCGgglgMKSPkoAgkJhrGECBhiYsAYZDhVwBYNLesAgHiImREcYXngRRhlYIhQDFXz8wAcVMaxnkCA3JHDDFJ4q9FCp1QUEACH5BAUCAA8ALBYAGAAkACIAAAj/AAsIHEiwAJ0DdgoqXMiwoA03ZwKcsVCkoUWGdXagQSOiYwceYy6KHGiDo4+TJ0X4KNJg5EU3aFDK7GDBpcUDAZLIRCniDJ2WCl0wYMDkYpqcO1MGOKCQQY0oYu50cVCUIZ0zCpL6UHAG6MA9cCIg2LDBSYQeLhpa6KC1gwGCJVxEIYGjrt0INRoW4ZF1ZosyBR1EsEt4wx0GJRiOMdNBgQI0HdykUYjECWHCTjhYTEOgRQs3WOx4HdjH8uW6JBzMuNhgNGXTp1PbbEhh8OkNCPbMXliiCg4Ep8/ubujACewNEeBU4X2A6WwNURCQoEuEgcIyXrasWPFCjR+bc/Jw8dBQpURiggC2QDABAwYQDEcAD1dY5wWECvjzB2IzX6EaDPkFeEEFOfRHEA1ABBggBgsYKFB9JiiYHwYfLJRFAoO0IYcOFx2RoIQVUOjaDVQIMMCJHighxQkMQXEfiECQUVAWVkjww403SkBFFgzloMeACpqwBh3nCSSHjTjiKMEVDXkBRAoBmqBHGAWVUGKSOKIgA4sMqbHCexiksMUXCgEyggdY3uhBE0OsxhwZUHgRBh0LPTECCmn+sOYQDgqUgQB5omBFnwWcEMMAeS5JqEB4SIDnjShIYASPixYgx50CoDCCHE9UOhAgCcTwhhQWBQQAIfkEBQIAAAAsFQAXACYAJQAACP8ACwgcSLBgAzoNCipcyHBhEQMtzrSwEKKhxYs2AnRAI0JBhz87LooseOAMGh8oUYpAM2akSwMdUspU0CKhS4sN3JyUKbPIzYstFPBMKcLGz4Y5dw714fMowx0dkgxF46aO04UNSipFKbTiwhMnnIbQqKBjhwA2bA4soYFIly5ENJS4mZVAiwAtDKRRK3AOERIkEDgBTGTO0Rl07DTgK7BGBByQI0eocZVhHgQbIkfesKGKwgZlysy9OYGEZs0kHIwu4GfBixUrXiywM7LE39ORSVAWuOQFBhMpYJiA8OLA6oaOcUPWPfAIhArQoweiMdKBaeUkOAgMkyK69wswwIj1ZCAGAW4EcBgUaPABg3fvGKBUj2A+smDtAo+YeB8dCPWRHNwBGGBw4CcQDUDwBx0GbNRWAgMcTDABBy4UtECCCmKwQGUKBfFAd++ZsMISHCqkBnDemQADGYwNAQIeSlyhQ1gjNVAHGSuYgMFva4RR0AlvNDGAAAIM4AEeWdB1ABlQQEFGGQrpQAgKP1T5gwcSKFFiQYJkMICVYAoQw5YDDcGCB2BaOYASx1U2gw5oplmlAFSQKZCUcs5JxQx2AiIDlXIOgIedAl0hgZweoJAAoQU8kYEEgP4gAApXMCrQE1eMkOgPVLxhKUFS6JDAjJ/+SKNLAQEAIfkEBQIAAAAsFAAWACgAJgAACP8ACwgcSLAgwTJpDhhcyLBhQRtuzpgJ4GaMw4sOG4xJgkZEEhFoFBDASLJgETOIfKhc2QFLyZcEOqycKeKMnZckW4iYybNIA5wXWyjguTKJDaAX3aAh6iOJmTRIHe6QSRSNm6gO6bSguhJNAKhYGTZIszUkmg4tioS9SAeLmxZusND5GbVBGTprSZbxsmXFmiNk1jJhwjDHFggmYMAAAoSNEKBMOPSI0oWIhoJ0tmCowLlzICiPS7pAQsIJAgQkSNQgLHDB5s6dYTwI8rJHBBy4c0eYMPAIENiwTZCpQ1IDidzIN9xhUELIlhTAO0OAQvJEjePIc5PgIPDF7+gVMFD1J4nESXbtvBt8eB09RZiSPcyfx0GCgkAwMC5EB7LlJkkK2J1HwmUCfQABDLABoccXL+2BwwbnORHFHAR58QAGGJqwBYM4URABAsiZRiBBQagBBRRh4IWUA3eklloUeTTUAF1YMcDBBBRo4EIJJQA1QxYJyHFFHEM4xGOPUelghQADDCAAC3KckNdCN4wwwA9Y/uCBBG1MaZASV2aJpQcoJCCIlwJJ0YQHYmY5gBJoCqRDm2KiYEWcBcxJJ5YoUIEnICOgsOebUsbZhgR7ChADngVIQYUEbPIpAR5I4jkEHnwIIAAKI4BwJqMCnXBDHCq8IQVSAQEAIfkEBQIAAAAsEwAVACoAKAAACP8ACwgcSLCgQYF1Dtg5yLChw4EhCJwJcMaCjYcYH47h0UFBEhEdd9TJSJJgmgAKfKhUCXJMyZcGOqycqaBFg5ckW6ScObMITowNdPJcKSLEzZ8NG7hBM9RHEh5pkD6M2bSDG6kPy5xhStOMT5x0Fj4McaajCAUdzhgtaUfNizVrjpB5eMBAizMtdhx4ueQFBBMpUgDBQEOswxkFGhzNKOQIhAqQI0Ngg9UhGSCRM1/Qk6PywTpsMGTOjGGB54MvTIyOjIHy6YJHVK+uAOQDViZMDkIRPRuImp8lNPSIEgUJh9wCheTQA2N1ihV7X86pQYIEAgROSCBxQXB388gmLszxxVkjAo7z6CP0KLjgAYb3QNaE+blnwwb0+BHkKRhEzQcoZBxQwk8UkIAffiRQcMJrBFF3IHokEMEgQRMY+CAOEQ444QkaWPhgBA5MOJALcDjxIAJ3MKChiBw4gUB+JHCwIkY3qNBGGyoMgVhDGsBRXXVwcPASCCwMYOQATYDgUAkuaEDBBBpwV1IMKKDww5U/oDAACAs2VMKAX5b0hAwCYIklCizcIKJACVhpJpYDyLHmCSqU+eaVA+CxZgFx2HlnnnvqcCecSu6ZgQR3oqnmnjeMIIEHV3oggAcq7DnQDUqwUOUPRiRgaUE3vPGGDp4FBAAh+QQFAgAAACwRABQALAAqAAAI/wALCBxIsKBBgw3KFElj56DDhxAJhrAQgAePMzvoRNwYcUYIHh1E+EiioIObMhxTGixzRoGPlzA7WFBJUyCWDjBzJuFRpKZKAjhzwkSDxWdKC2iEDt1hlKOBoEoV2GiQ0k4dlSFEKkXTws/GMl5erFlD40sJjkD/5HQ5NWKOLRBMwEiBIQWUjQ3oWCiJBk2HMza+rsFQoXDhCxC8pLRBwI0bLCg3eoFguHKKFZHxUlX5wkRly2GaQixRZg2Mz4aBKBb9UMiaFKgLY1jA+uEJNoRjw/hS+2EYz6iBbOn9sAGbQBcqA3kAhvhDPx/0YJhuYgsYIc4h5vDyAUoYjdk5NvoY73zOnPARmXBAEiVKDw5M0Bt00SOCEwQInJDo4UL+wBJERIDDgARGUIN/AuVBAoEMbrDBHv6dMMGCDBJIggMI9kBhhTiQcKB/RGxYYQQTIMiBgBx2yAFHgCQAAggJZLEREwzcgQCHCMDRX0RvyIDCAAOgIMMbG5Vw4o0E3qfBRgkQIsAPUP4gAAoxRHQWB3CQoKUTUSy5ERUDRBklCk0MwZELGlBAgQbnRSSIDh6IKeYAIHBUwlk0qfCknFAOgMcM/sWxJ59+Iggnn33KIYh8gILJZ5w6IFiADiyEOeYAV0g6wxQ6UPHjAALIEIekA83whItyvAEIcQEBACH5BAUCAEAALBEAEwAuACwAAAj/AAsIHEiwoMGDA+2kOdAAocOHEAUCIXAmQIAWWOpE3BgxRIAOIpKIQNPBAh2OKA3SaYHGh0uXfzoQSElT4JgOL3Mm4ZGmJsoGBHDmfNlhTMQDOXKcpGmh5VCXaHY8BMBmhR49a6As3VjHgNCnaGw4BPMAA4wKFVJAeHGgBEcbCp76UHCGTsOCJQ6sMIG2bwUINFDWsfDVpQIRYhF6geC37wU9OVCWcdMBjQIFHQKMaXDX4Au+jdGaWJDSzxg3LdwYOABxS4rQaDF88FmAc8TPsCtg8EKbIxQMuVN86b0xh56zjdcS56jGBOgKFyCsiLwcYkMya2A410MDQHWUdsCo/yGTw/b38+jTq1/Pvr379/BrzpnjNj5BDT3gROnjgH58JjWQ4AQCCDgRQRcMxDdBBDg06GAEfTDxXhU4bODghSRo8J4DJFyIYQ3vTdChhw06gQREN6jAxRVvPEETBSOS6EQP9R10BR8D5IiCFQmgNEMeTpDYYAQUOCSHBB78oOQPArDQI0dzRBGkhwiIUcVBM9zAQpJLKikAFSdwxEQeG0zZYIEOOATCAF12icKTG5WQRxdOkGAnHBw8hAebbXoJAkpuuZCHAxRo4AJEbfDZpwB/0lRCjRCpoGibb74nxQgCLCrDFPDF4EGmSw7AB5zvJWDFp5lmoEMBM8A3wwxTJAcQRxyrrhcQACH5BAUCAAEALBAAEgAwAC4AAAj/AAsIHEiwoMGDB9OEKEIHocOHEAnacGMmiY8zBspE3MhxjI8Of3z4UNChxQGOKBEeOKNApMuPFh6WOJAjSJ2UBRtg6fDSpcUiCLXQWKHnwRY1QnAOtICmp0s0WA6S0QMBxoULJiCwuamUqVORUA3meJCigtmzEKAoLWCA51cFNgyygXC2booVGnGGEPEVTQuDftaUrXs2xZekOAmAfInGTAiDS1bAIHwWg5q1fgiI6ICmQ8nHBukIpmzWBJkGawuEIGDBwpiGCGlgIH1BD4DUA1FDDJPiAmWtXHFz/ABhcIULgbYsEY5zwYoUQEzoYbOcecqZYdSQuW09dQPd3cOL/x9Pvrz58+jTq1/Pvr379/DjCyzhwoV8JhyQwIGDxMEc9y70EIETCCDgRARIMMDeCTVEgMODEEbQA3t5ILABhBg6kYdDgCSgQhw3CEeBgxhGSAFCcYzggQAC/JDBDSesVQMJJUJIAhElFDRDHCig8MOPHkgwQog4lTABjTXicKNBQ4zg449QDmCEIEppgGSNEThQ0AkqDADllz94kECRLsDhRI0IwKFgQW14CeaPA4CwlgZOnAlhnRrESNAMbb75owByzhmFEySQ4EQUGuRoEAhuvinAG7jNkYcDDmjw30EnDNHEk1+iMAIguJUgakQzgCAApz+cqkJ7JagwggADDBAggBWQvidFHFdc8UYW6QUEACH5BAUCACwALA8AEQAyADEAAAj/AAsIHEiwoMGDCAfSSZOGTsKHECMWaHCAwBkzPM4QOPCwDIAgdSSKPHCmg4g/f0R0OFPkIAA2Kx482LIgpMiHbjr42MmzQ4sGBb88gADjwgUTEGg4vHkwBM+nO9GMIRhkhYkKWLMG+sD0IBadUKMSIAgFQtazMB4sAdp14A40YaNaILjl6tmsJsi0JTgGbtwOOxSuSXE3KwYvbPceCCAirAgzaegSLlwByIK9BHd0+PNUBJrABD+YLWwUDGaCBlQqQNPBDJbEAsEYLQzhyOmCIQi4cWMg8kEoQCZXuABhTY7bBhvAPqhmRQogQCrQAIAc84EwC9TkELK8uvfv4MOL/x9Pvrz58+jTq1/Pvr379/Djy59Pv7598C5cMJGvAQmcO11QwIB7J9RAghMIbOBEBFHsgdANKsihgg7gURABDhhmSEIXLhSURRt8CDCAAD8oMQRyJzAgxgYZthgBBwXhIYEHP9TogQRWSFHCbRyQ0GKLJBCxo0BvkFjjkT9IgMdtJzhw4Y8YOtEHQXgMgOSRHjSh42kO+AglDlISRIWRV9aYwG17sPglCROIiUKZNp55Wx9etsiigwNVCWeWJ6IpRp04IECCAwUl4AGNV0qQgXd79CHogXDAaBAXM2IpwQg3fMfEHg44oEGHCMnRhAAilnhDCSd8NyREJUgRAwgT0gZ3QqrsBQQAIfkEBQIABgAsDQAQADUAMgAACP8ACwgceCDIkoEIEypcyFBgGhs20jTUQmPFgwcvyDTcyLFACDdmFCgw46aIQjJ6MMC4cAGIiQ8dYyIMEaDDHx8+kqAxEwKhFj0pKggVegHDApkyWyjAydQHmjN2BtKAMLRqijV1kG5sEEJE06YdxggsswJG1bNahGhtuAPNV6YdCBRoAODBhbNDTWhcy3BHh7c44wo8UBav0BRh+DIcsxRwBywNCgg5AsQwjAcHFSssc6ZxUwUBDgwkQxUvBDaaF3fwylRBErECGwhhE8gsUQhbRKdOGBmLmQ5ogp+xodAPlAcmgADRwybz7oVpdhAgMKYMwwZLyCxQk+M5xwbgI3v/H0++vPnz6NOrX8++vfv38OPLn0+/vv37+PPr38+/v///AAYo4AkuuMDERoAkEEMCUqh3Agd9wHFHFxS4sBAII3ggAApNcJHFeXMQEYETG2zgRARdVJHQIBKg8MOLHkhgxIfl1RABDjjmSEIfBwqkgwcevCjkDxJwUd4eOGyQ45IkaCCQIG0MMKSQKIzQ4HgOkLAkkzUMZIQAUwrpgQ6CjDeBllvi6AQSA1EBZpg/eJAAeRSgmaYTPQyEh5RhesDHDeTl4USaOEZAgUAnvPHmlAMYQV4JTHQx6JYI3MEAQnhIEKSQAvCRwAzl5YGDnTg44QQHBZSAaBZt/DDAqwJQITHneXn0gQAJJDgRhZML6SBHG1y88YR6TOTBgQN5WDhQQAAh+QQFAgBjACwNABAANQAzAAAI/wDHCBQoREuYMAAGKlzIsKHDMQdCjCnSwOGXFxVSpHhAI8jDjyCLWAggkEcLGw0rALlQocIFDCtygJzpUIRAH2MUYFEI4AHDChBe0Bz6UASPIgIbQHHYEgzRpwwJCCzwwoRDDF4KQN2qoMWYAgW2pHAI5MNWrl6/HgFy1cvZrRa0NlgAoeGFC07fDk0iAqXAJSusMqRRUe9MER0MDAQb5gGGC2MuwPhreGaHADsYFtBC4wHLFVAOlKj80QKWA4UZClkCRgtq0iDBwp5Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjwwYr+2EBKTeGaMVdwIWGCRM4MMnYvjBBhhEsmhiJQX52AQ1RSMgnIcZB+zExfkjwwF+AAC73VabBBk4ohEAEFJB3QxMoLOTBACqcMJsLURS40AY4VDFaAVc8JMMTsJ2gwUcU0PTDV731INwEHyExkBIO/fCDDrNxQIJDJNQwlQoDNCSAFRKSVkAVYmzAEA5OjCjQFFSMceJAKEAYoF4TRICDQjhEoCJ5Q1AxgH8CSNAECLYxUYN8CCAwhpYuMJSFCkpQYQQXN+SmARFdRNEDB0w4NMMMv53ABHXUBQQAOw==";var d;d='<img onload="'+s+'" src="'+l+'" alt="'+o+'" /><br />';var c=i.content_html?i.content_html:'<div class="loading_hash_animation">'+d+o+"</div>";var _='<base href="https://'+document.location.hostname+'" target="_blank">\n<style>'+t+"</style>\n"+n+"\n"+c;TS.dir(439,i,"_getSpinnerHtml html: "+_);return _};var d=function e(i){if(TS.has_pri[p])TS.dir(p,i,"_storeLastWindowSize token: "+i.token);TS.prefs.setPrefLocal("ssb_space_window",JSON.stringify({token:i.token,x:i.x,y:i.y,width:i.width,height:i.height}));u()};var c=function e(){TS.prefs.setPrefByAPI({name:"ssb_space_window",value:TS.prefs.getPref("ssb_space_window")})};var u=function e(){c()};var m=function e(){return TS.utility.parseJSONOrElse(TS.prefs.getPref("ssb_space_window"),null)};var f=function e(i,t){h(i,t)};var h=function e(i,t){var n;try{n=TSSSB.call("getGeometryForWindow",i.token)}catch(e){TS.warn('TSSSB method getGeometryForWindow threw error with token of "'+i.token+'"',e)}if(n){i.x=n.x;i.y=n.y;i.height=n.height;i.width=n.width;setTimeout(t,0)}};var g=function e(t){var n={};if(!Object.keys(i).length){TS.storage.storeClientWindows(n);return}_.forOwn(i,function(e,a){if(!e.worth_saving)return;f(e,function(e){return function(){var a=i[e];if(!a)return;n[e]={token:e,x:a.x,y:a.y,width:a.width,height:a.height,file_id:a.file_id,title:a.title,destination_url:a.destination_url,url:a.url,no_spinner:a.no_spinner,worth_saving:a.worth_saving};if(TS.has_pri[p])TS.dir(p,n[e],"_storeWins LS_win token: "+e);TS.storage.storeClientWindows(n);if(e==t)d(n[e])}}(a))});if(!Object.keys(n).length)TS.storage.storeClientWindows("")};var p=438})()},4924:function(e,i){(function(){TS.registerModule("client.ui",{test:function e(){return{_getMemberSharedTeamsContext:D}},CLIENT_HEADER_OVERHANG:8,POSSIBLE_REBUILD_OMISSIONS:["channel_header","user_current_status","channel_pane_channels","channel_pane_apps","channel_pane_ims","channel_pane_starred"],$msgs_scroller_div:$("#msgs_scroller_div"),$msgs_div:$("#msgs_div"),$msg_input:$("#msg_input"),$msg_preview_msg:$("#msg_preview_msg"),$msg_preview:$("#msg_preview"),$emo_menu:null,$banner:$("#banner"),$msgs_unread_divider:null,file_dropped_sig:new signals.Signal,file_pasted_sig:new signals.Signal,did_rebuild_all_sig:new signals.Signal,did_rebuild_all_but_msgs_sig:new signals.Signal,msgs_scrolled_sig:new signals.Signal,onStart:function i(){K();TS.channels.data_updated_sig.add(p);TS.ui.window_focus_changed_sig.add(TS.client.ui.windowFocusChanged);TS.membership.membership_counts_need_refetch_sig.add(TS.client.ui.rebuildMemberListToggle);TS.channels.joined_sig.add(TS.client.ui.rebuildMemberListToggle);TS.channels.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.ims.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.groups.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.mpims.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.prefs.color_names_in_list_changed_sig.add(TS.client.ui.prefColorNamesInListChanged);TS.prefs.msg_preview_changed_sig.add(TS.client.ui.prefMsgPreviewChanged);TS.rooms.added_sig.add(v);TS.rooms.changed_name_sig.add(b);TS.rooms.changed_participants_sig.add(w);TS.rooms.changed_date_end_sig.add(y);TS.rooms.changed_channels_sig.add(A);TS.prefs.team_display_email_addresses_changed_sig.add(x);TS.prefs.team_allow_calls_changed_sig.add(C);TS.view.im.im_ui_updated_with_new_msg_sig.add(u);TS.view.channel.channel_ui_updated_with_new_msg_sig.add(u);TS.view.group.group_ui_updated_with_new_msg_sig.add(u);TS.view.mpim.mpim_ui_updated_with_new_msg_sig.add(u);TS.user_groups.updated_info_sig.add(TS.client.ui._displayUserGroup);setInterval(L,15e3);TS.client.ui.$msgs_scroller_div.bind("mousedown mouseup",function(){TS.client.msg_pane.checkUnreads()});var t=null;e=new TS.PresenceList;$("html").bind("mousedown",function(e){TS.model.ui.is_mouse_down=true;TS.client.ui.maybeTickleMS();t=$(e.target)});$("html").bind("dragend",function(){TS.model.ui.is_mouse_down=false});$("html").bind("mouseup",function(){TS.model.ui.is_mouse_down=false;setTimeout(function(){if(t&&t.closest(".monkey_scroll_handle").length)if(TS.model.archive_view_is_showing)TS.client.archives.maybeLoadScrollBackHistory();else if(!TS.model.showing_welcome_2)TS.client.ui.maybeLoadScrollBackHistory();t=null},10)});TS.client.ui.$msgs_scroller_div.scroll(TS.client.ui.onMsgsScroll);TS.client.login_sig.add(TS.client.ui.loggedIn,TS.ui);TS.client.msg_input.bind(TS.client.ui.$msg_input);function n(){TS.client.ui.enhanceComponents();TS.client.ui.bindCommentInput();$(window.document).keydown(TS.client.ui.onWindowKeyDown).keyup(TS.client.ui.onWindowKeyUp);$("#team_menu .notifications_menu_btn").bind("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.startWithNotificationsMenu(e)});$("#team_menu").bind("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;if($(e.target).closest(".notifications_menu_btn").length)return false;TS.menu.startWithTeamAndUser(e)});$("#file_comment_form").bind("submit",function(){TS.client.ui.files.submitFileComment();return false});$(window).on("click",g);if(!TS.qs_args.ignore_mm)$("#header, #footer, #col_channels, #client_body, #col_flex").on("mouseenter",g);var e="ontouchstart"in document.documentElement;if(e)$("html").addClass("touch");else $("html").addClass("no_touch");TS.client.archives.$scroller.scroll(function(){TS.model.ui.cached_archive_scroll_result=null});TS.client.ui.$msgs_scroller_div.scroll(function(){TS.model.ui.cached_msgs_scroll_result=null});var i=_.throttle(function(e){var i=$(e.target);if(!i.closest("body").length)return;var t=i.closest("button");var n=t.data("emoji");if(!n)return;n=n.toString();var a=i.closest(".rxn_panel").data("rxnKey");var r=TS.rxns.getExistingRxnsByKey(a);var s=_.find(r,{name:n});var o=s.users;var l={count:s.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(r,n),name:n,url:s.url,rxn_key:a,member_ids:o};TS.tips.updateTipTitle(t,TS.i18n.t("Loading members…","client")());TS.members.ensureMembersArePresent(o).then(function(){var e=TS.templates.builders.buildRxnTitle(l,true);TS.tips.updateTipTitle(t,e)}).catch(function(e){TS.console.logError(e,"couldnt_load_reactors","unknown_member_error",false);TS.tips.updateTipTitle(t,TS.i18n.t("Couldn’t load members","client")())})},300);$("BODY").delegate(".rxn_panel button","mouseover",i);$(window).on("copy cut",function(e){if(TS.utility.isFocusOnInput()){var i=document.activeElement;if(!TS.utility.contenteditable.isContenteditable(i))return}try{var t=window.getSelection();var n;var a=TS.format.formatSelection(t,{customFn:function e(i){if(i.hasAttribute("data-member-id"))return i.getAttribute("data-member-label")||i.getAttribute("data-member-id");else if(i.hasAttribute("data-user-group-id"))return i.getAttribute("data-stringify-text");else if(i.hasAttribute("data-broadcast-id"))return i.getAttribute("data-stringify-text")}});var r;r=TS.format.formatSelection(t,{customFn:function e(i){if(i.hasAttribute("data-member-id"))return"<@"+i.getAttribute("data-member-id")+"|"+i.getAttribute("data-member-label")+">";else if(i.hasAttribute("data-user-group-id"))return"<@"+i.getAttribute("data-user-group-id")+"|"+i.getAttribute("data-stringify-text")+">";else if(i.hasAttribute("data-broadcast-id"))return"<@"+i.getAttribute("data-broadcast-id")+"|"+i.getAttribute("data-stringify-text")+">"}});if($(e.target).closest(".ql-editor").length)n=TS.format.formatSelectionAsHTML(t);var s={};if(a)s={"text/plain":a,text:a,"public.utf8-plain-text":a,Text:a};if(n){s["text/html"]=n;s["slack/"+TS.model.team.id]=n}if(r)s["slack/plain"]=r;if(_.size(s)>0)TS.clipboard.writeTextFromEvent(e,s)}catch(e){TS.error("window copy handler error: "+e)}})}if(TS.has_pri[N])TS.log(N,"deferring UI bind until login_sig");TS.client.login_sig.add(n);TS.interop.setAppElementForReactModal();if(TS.useReactMessages())TS.interop.mountMessagePane(TS.boot_data.team_id,document.querySelector(".p-history_container"));q()},spaces_tooltip:{state:"hide",pending_change:null},loggedIn:function e(){if(TS.isPartiallyBooted()&&!TS.redux.socket.isConnected()){TS.redux.socket.connectedSig.addOnce(TS.client.ui.loggedIn);if(TS.model.ui_state.flex_name)TS.client.ui.flex.showFlex();$("#main_emo_menu").removeClass("hidden").bind("click.incremental_boot",function(e){e.preventDefault();TS.incremental_boot.userDidInteractWithUI()});return}TS.client.ui.flex.setFlexStateFromHistory(TS.model.ui_state.flex_name,TS.model.ui_state.flex_extra,true);if(TS.model.ui_state.flex_name){TS.client.flexDisplaySwitched(TS.model.ui_state.flex_name,TS.model.ui_state.flex_extra,true);TS.client.ui.flex.showFlex()}$("#main_emo_menu").removeClass("hidden").off("click.incremental_boot").bind("click.open_dialog",function(e){TS.client.msg_input.removePrecedingAtSign();TS.ui.react_emoji_menu.start({e:e,input_to_fill:TS.client.ui.$msg_input,offset_y:4});TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"emoji_menu_button"}}})});if(window.extraCmds)window.extraCmds();TS.shared.checkDisplayEmailAddressPref()},rebuildAllButMsgs:function e(a,r){a=a||{};if(r){TS.client.ui.POSSIBLE_REBUILD_OMISSIONS.forEach(function(e){if(!a[e])n[e]=false});t+=1;if(i)return;o(n);i=true;setTimeout(function(){i=false;if(t>1){o(n);TS.metrics.count("rebuild_all_but_msgs_throttles",t)}t=0;n={}},1e3)}else o(n)},rebuildAll:function e(i){if(i){if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_rebuild_throttled");r+=1;if(a)return;l();a=true;setTimeout(function(){a=false;if(r>1){l();TS.metrics.count("rebuild_all_throttles",r)}r=0},1e3)}else l()},windowFocusChanged:function e(i){if(i){TS.client.ui.startUnreadCheckingTimer();TS.client.ui.maybeTickleMS();if(TS.view)TS.view.updateTitleBarColor();TS.model.ui.is_mouse_down=false}else clearTimeout(TS.client.ui.unread_checking_tim)},cal_key_checker:{tim:null,tim_ms:200,prevent_enter:false,space_pressed_last:false,reset:function e(){clearTimeout(TS.client.ui.cal_key_checker.tim);TS.client.ui.cal_key_checker.space_pressed_last=false;TS.client.ui.cal_key_checker.prevent_enter=false},check:function e(i){if(TS.client.ui.cal_key_checker.space_pressed_last&&32!=i){TS.client.ui.cal_key_checker.reset();if(73==i){TS.client.ui.cal_key_checker.prevent_enter=true;TS.client.ui.cal_key_checker.tim=setTimeout(TS.client.ui.cal_key_checker.reset,TS.client.ui.cal_key_checker.tim_ms)}}else if(32==i){TS.client.ui.cal_key_checker.reset();TS.client.ui.cal_key_checker.space_pressed_last=true;TS.client.ui.cal_key_checker.tim=setTimeout(TS.client.ui.cal_key_checker.reset,TS.client.ui.cal_key_checker.tim_ms)}else TS.client.ui.cal_key_checker.reset()}},keyPressIsValidForFocusOnNextOrPreviousMessage:function e(i){if(!i)return false;var t=TS.utility.keymap;var n=-1!==[t.left_square_bracket,t.right_square_bracket,t.minus_sign,t.equals_sign].indexOf(i.which);var a=i.altKey&&TS.utility.cmdKey(i);return n&&a&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()},keyPressIsValidForGotoNextOpenChannelOrIM:function e(i){var t=TS.utility.keymap;if(!i)return false;if(!i.altKey)return false;if(i.which!=t.up&&i.which!=t.down)return false;if(!TS.client.ui.isUserAttentionOnChat())return false;if(TS.utility.isFocusOnInput()){var n=$(document.activeElement);var a=TS.utility.contenteditable.getLength(n);if(a){var r=TS.utility.contenteditable.isTextSelected(n);if(r)return false;var s=TS.utility.contenteditable.cursorPosition(n).start;if(i.which==t.up&&0!==s)return false;if(i.which==t.down&&s!=a)return false}}return true},page_scroll_dest:null,onWindowKeyDown:function e(i){if(TS.isPartiallyBooted()){if(TS.utility.cmdKey(i)){i.preventDefault();i.stopPropagation()}return}var t=Date.now();var n=TS.utility.keymap;var a=i.which==n.enter;TS.model.last_key_down_e=i;TS.client.ui.cal_key_checker.check(i.which);var r=TS.key_triggers.getFromCode(i.which);if(TS.client.ui.isUserAttentionOnChat()&&r&&(!r.isDisabled||!r.isDisabled(i))&&(i.metaKey&&(!i.ctrlKey||!TS.model.is_mac)||i.ctrlKey&&!i.altKey&&!TS.model.is_mac)&&(!r.no_shift&&(i.shiftKey||r.shift_optional)||r.no_shift&&!i.shiftKey)){i.preventDefault();i.stopPropagation();if(TS.model.ms_logged_in_once&&TS.prefs.prefs_loaded&&!$("body").hasClass("loading"))r.func(i)}else if(TS.boot_data.feature_a11y_keyboard_shortcuts&&TS.client.ui.keyPressIsValidForFocusOnNextOrPreviousMessage(i)){i.preventDefault();i.stopPropagation();switch(i.which){case n.left_square_bracket:TS.ui.a11y.focusOnPreviousMessage();break;case n.right_square_bracket:TS.ui.a11y.focusOnNextMessage();break;case n.minus_sign:TS.ui.a11y.focusOnOldestUnreadMessage();break;case n.equals_sign:TS.ui.a11y.focusOnMessageInput()}}else if(TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&!TS.utility.isFocusOnInput()&&TS.utility.cmdKey(i)&&!i.altKey&&i.which==n.up)TS.client.ui.maybeEditLast(i);else if(TS.client.ui.isUserAttentionOnChat()&&(i.which==n.left_square_bracket||i.which==n.right_square_bracket||i.which==n.left||i.which==n.right))f(i);else if((TS.client.ui.isUserAttentionOnChat()||TS.ui.shortcuts_dialog.showing||TS.ui.keyboard_shortcuts_prompt.showing)&&i.which==TS.i18n.keyCodeEquivalent(TS.utility.keymap.slash)&&!i.altKey&&!i.shiftKey&&TS.utility.cmdKey(i)){if(!TS.boot_data.feature_shortcuts_flexpane)if(TS.ui.shortcuts_dialog.showing)TS.ui.shortcuts_dialog.cancel();else TS.ui.shortcuts_dialog.start();else{if(TS.ui.keyboard_shortcuts_prompt.showing)TS.generic_dialog.cancel();TS.ui.react_keyboard_shortcuts.toggleShortcutsFlexpane()}i.preventDefault()}else if(TS.client.ui.isUserAttentionOnChat()&&i.which==TS.i18n.keyCodeEquivalent(TS.utility.keymap.period)&&!i.altKey&&TS.utility.cmdKey(i)){if("whats_new"===TS.model.ui_state.flex_name)TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"keyboard_cmd_dot",step:TS.client.whats_new.getNewestID()});TS.client.ui.flex.toggleFlex();i.preventDefault()}else if(TS.client.ui.isUserAttentionOnChat()&&TS.utility.cmdKey(i)&&i.shiftKey&&(75==i.which||84==i.which&&TS.model.is_our_app))if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.close();else{if(84==i.which)TS.client.threads.showThreadsView();else TS.ui.im_browser.start();i.preventDefault()}else if(i.which==n.space){if(TS.prefs.prefs_loaded&&TS.prefs.getPref("pagekeys_handled"))if(TS.utility.isFocusOnInput()){if(i.which==n.space&&i.shiftKey&&TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)&&TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input)){TS.client.ui.$msg_input.blur();i.preventDefault()}}else if(TS.model.is_FF)TS.client.ui.$msgs_scroller_div.focus()}else if(i.which==n.esc)TS.client.ui.onEscKey(i);else if(TS.utility.isPageKey(i.which)&&TS.prefs.prefs_loaded&&TS.prefs.getPref("pagekeys_handled")&&!i.shiftKey&&!i.ctrlKey&&!i.altKey&&!i.metaKey){if(TS.model.unread_view_is_showing||TS.model.threads_view_is_showing)return;var s=i.target;var o=$("#col_flex")[0].contains(s);var l=$(".client_channels_list_container")[0].contains(s);var d=TS.utility.contenteditable.isActiveElement(s);if((o||l)&&!d)return;if(TS.useReactMessages())return;var c=TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input);var _=!c&&TS.utility.isFocusOnInput();var u=TS.model.archive_view_is_showing;var m=u?TS.client.archives.$scroller:TS.client.ui.$msgs_scroller_div;var h=m[0].scrollTop;var g=m[0].scrollHeight;var p=m.height();t=h;if(null!==TS.client.ui.page_scroll_dest)t=TS.client.ui.page_scroll_dest;var S=true;var T=$(document.activeElement);var v=false;if(i.which==n.pageup)if(_)S=false;else if(v&&c&&T.val())S=false;else TS.client.ui.page_scroll_dest=t-p;else if(i.which==n.pagedown)if(_)S=false;else if(v&&c&&T.val())S=false;else TS.client.ui.page_scroll_dest=t+p;else if(i.which==n.home)if(_||c&&T.val()){if(TS.model.is_mac)if(i.shiftKey);else{T.setCursorPosition(0);i.preventDefault()}S=false}else TS.client.ui.page_scroll_dest=0;else if(i.which==n.end)if(_||c&&T.val()){if(TS.model.is_mac)if(i.shiftKey);else{T.setCursorPosition(1e6);i.preventDefault()}S=false}else TS.client.ui.page_scroll_dest=g;if(S){TS.client.ui.slowScrollMsgsToPosition(TS.client.ui.page_scroll_dest,true,function(){TS.client.ui.page_scroll_dest=null});i.preventDefault()}}else if(!TS.utility.isFocusOnInput()&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&!TS.utility.isArrowKey(i.which)&&!TS.utility.isPageKey(i.which)&&!i.metaKey&&!i.ctrlKey&&!i.altKey&&!TS.ui.react_emoji_menu.is_showing){if(i.keyCode==n.shift||i.which==n.tab)return;if($(i.target).hasClass("focus-ring")&&a){if("BUTTON"==i.target.tagName&&bowser&&bowser.msedge){i.preventDefault();i.target.click()}return}if(TS.model.archive_view_is_showing&&a){TS.client.archives.tryToJoin();return}if(a)i.preventDefault();if(TS.i18n.isLocaleCJK())setTimeout(TS.view.focusMessageInput,0);else TS.view.focusMessageInput()}else if(window.winssb&&!TS.utility.isFocusOnInput()&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&i.which==n.V&&!i.altKey&&TS.utility.cmdKey(i)){var b;var w;var y=window.winssb;if(y.clipboard&&y.clipboard.readString&&y.clipboard.readImage){b=y.clipboard.readString();if(b){TS.client.msg_input.populate(TS.utility.contenteditable.value(TS.client.ui.$msg_input)+b);i.preventDefault()}else{w=y.clipboard.readImage();if(w){TS.ui.paste.startUploadFromMacSSBReadImage(w,i.shiftKey);i.preventDefault()}}}TS.view.focusMessageInput()}else if(TS.model.archive_view_is_showing&&i.which==n.enter&&!i.metaKey&&!i.ctrlKey&&!i.altKey);if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("onWindowKeyDown",Date.now()-t);if(i.which==n.shift||i.shiftKey)TS.model.shift_key_pressed=true;if(i.which==n.insert)TS.model.insert_key_pressed=true;if(i.which==n.alt||i.altKey)TS.model.alt_key_pressed=true;if(i.shiftKey&&i.metaKey&&i.which!=n.V)TS.model.shift_key_pressed=false},onWindowKeyUp:function e(i){TS.model.last_key_down_e=null;var t=TS.utility.keymap;if(i.which==t.shift)TS.model.shift_key_pressed=false;if(i.which==t.insert)TS.model.insert_key_pressed=false;if(i.which==t.alt){TS.model.alt_key_pressed=false;if(!TS.utility.isFocusOnInput()&&!TS.selection.isAnyTextSelected()&&!TS.ui.fs_modal.is_showing)TS.view.focusMessageInput()}},onEscKey:function e(i){var t=i.shiftKey;try{i.stopPropagation()}catch(e){}try{i.preventDefault()}catch(e){}var n=$(i.target);if(n.hasClass("focus-ring"))n.removeClass("focus-ring");if(!TS.client.ui.isUserAttentionOnChat())return;if(TS.model.unread_view_is_showing&&!t)return;if(TS.model.archive_view_is_showing){TS.client.archives.userWantsToCancel();return}else if(TS.useReactMessages()){var a=TS.redux.getState();var r=TS.interop.redux.features.messagePane.getMessagePaneStartTs(a);var s=TS.shared.getActiveModelOb().id;var o=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(a,s,r);var l=!o.reachedEnd;if(l){TS.redux.dispatch(TS.interop.redux.features.messagePane.jumpToTimestamp({ts:null}));return}}if(TS.msg_edit.editing)return;if(TS.ui.react_emoji_menu.is_showing)return;if(t){var d=function e(){TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.esc_all,t);var i=TS.model.channels;var n=TS.model.groups;var a;var r=true;TS.redux.channels.clearAllShowInListEvenThoughUnreadsFlags();for(a=i.length-1;a>-1;a-=1)if(i[a].unread_cnt){TS.channels.markMostRecentReadMsg(i[a],TS.model.marked_reasons.esc_all,r);TS.channels.unread_changed_sig.dispatch(i[a],true)}for(a=n.length-1;a>-1;a-=1)if(n[a].unread_cnt){TS.groups.markMostRecentReadMsg(n[a],TS.model.marked_reasons.esc_all,r);TS.groups.unread_changed_sig.dispatch(n[a],true)}TS.replies.markAllThreads();if(TS.model.unread_view_is_showing)TS.client.unread.reload()};if(false===TS.prefs.getPref("confirm_clear_all_unreads")||0===TS.model.all_unread_cnt)d();else{var c='<p class="no_bottom_margin float_right"><label class="checkbox overlay_pref block"><input id="confirm_clear_all_unreads_cb" type="checkbox" /> '+TS.i18n.t("Don’t ask me again, please","client")()+"</label><p>";TS.generic_dialog.start({title:TS.i18n.t("Clear all unreads?","client")(),body:"<p>"+TS.i18n.t("<b>Shift+esc</b> will clear all unread messages and notifications. Are you sure you want to do this? It’s liberating … but there’s no going back.","client")()+"</p>"+c,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, clear all!","client")(),onGo:function e(){d();var i=!!$("#confirm_clear_all_unreads_cb").prop("checked");if(i)TS.prefs.setPrefByAPI({name:"confirm_clear_all_unreads",value:false})}})}}else if(!TS.client.activeChannelIsHidden())TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.esc,t);else if(TS.model.threads_view_is_showing)TS.client.threads.markAllNewThreads()},checkForEditing:function e(i){if(!TS.msg_edit.editing)return false;if(!i||!i.target||0===$(i.target).closest("#message_edit_form, #emoji_menu").length){if(!TS.msg_edit.editing_in_msg_pane)return false;if(TS.msg_edit.mousedown_active){TS.msg_edit.mousedown_active=false;return true}if(TS.msg_edit.cancelEditingINothingHasChanged())return false;TS.sounds.play("beep");TS.msg_edit.promptEdit()}return true},maybeTickleMS:function e(){var i="returning from client.ui.maybeTickleMS: ";TS.log(2017,"client.ui.maybeTickleMS called");if(!TS.model.user){TS.log(2017,i+" TS.model.user is falsy ("+TS.model.user+")");return}if(!TS.redux.socket.isConnected()){TS.log(2017,i+" TS.redux.socket.isConnected() is falsy ("+TS.ms.connected+")");return}if("away"===TS.model.user.manual_presence){TS.log(2017,i+" TS.model.user.manual_presence is set to AWAY");return}var t=Date.now()-TS.model.last_net_send;var n=2e4;if(t<n&&"active"===TS.model.user.presence){TS.log(2017,i+" TS.model.user.manual_presence is set to ACTIVE, and we haven't hit timeout yet.");return}TS.client.ui.tickleMS()},tickleMS:function e(){if(!TS.redux.socket.isConnected())return;TS.log(2017,"client.ui.tickleMS called");var i=Date.now();TS.model.last_net_send=i;TS.interop.SocketManager.send({type:"tickle"})},teamSelectionChanged:function e(){if(TS.isPartiallyBooted()){TS.ensureFullyBooted().then(function(){TS.client.ui.teamSelectionChanged()});return}if(!TS.utility.isFocusOnInput()&&TS.client.ui.isUserAttentionOnChat())TS.view.focusMessageInput();if(TS.boot_data.page_needs_enterprise){TS.utility.msgs.countAllUnreads();TS.ui.growls.updateTotalUnreadDisplaysSSB()}},forceMarkAllRead:function e(i,t){TS.client.msg_pane.dont_check_unreads_til_switch=false;TS.client.ui.markMostRecentReadMsgInActive(i,true);if(t){var n=TS.model.channels;var a=TS.model.ims;var r=TS.model.groups;var s=TS.model.mpims;var o;var l=true;for(o=n.length-1;o>-1;o-=1)if(n[o].unread_cnt)TS.channels.markMostRecentReadMsg(n[o],i,l);for(o=a.length-1;o>-1;o-=1)if(a[o].unread_cnt)TS.ims.markMostRecentReadMsg(a[o],i,l);for(o=r.length-1;o>-1;o-=1)if(r[o].unread_cnt)TS.groups.markMostRecentReadMsg(r[o],i,l);for(o=s.length-1;o>-1;o-=1)if(s[o].unread_cnt)TS.mpims.markMostRecentReadMsg(s[o],i,l)}TS.client.markLastReadsWithAPI()},enhanceComponents:function e(){$("#flexpane_tabs li a").on("shown",function(){TS.view.resizeManually("TS.client.ui.enhanceComponents")})},shouldEventTriggerMaybeEditLast:function e(i,t){return TS.utility.contenteditable.isEmpty(t)&&(TS.utility.cmdKey(i)||TS.prefs.prefs_loaded&&!TS.prefs.getPref("arrow_history"))&&!i.altKey&&i.which==TS.utility.keymap.up},maybeEditLast:function e(i){i.preventDefault();i.stopPropagation();var t=TS.shared.getActiveModelOb();var n;var a;if(t){if(TS.useReactMessages())a=TS.redux.messages.getMessagesByChannelId(t.id);else a=t.msgs;a=TS.utility.msgs.getDisplayedMsgs(a);n=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,a);if(n){TS.msg_edit.startEdit(n.ts,t,null,n);return true}}TS.sounds.play("beep");return false},bindCommentInput:function e(){$("#file_comment").on("focusin",function(){var e=$(this).closest(".flex_content_scroller")[0];if(e)e.scrollTop=e.scrollHeight})},showRepliesFromHistory:function e(i){var t=false;var n=true;TS.client.flexDisplaySwitched("convo",i,t,n)},showAppsFromHistory:function e(i){if(!i)return TS.client.ui.flex.hideFlex();var t=false;var n=true;var a;var r=null;var s=null;var o=i.charAt(0);if("B"===o)r=i;else if("A"===o)s=i;var l=TS.shared.getActiveModelOb().id;var d=TS.channels.getChannelById(l);if(TS.shared.isModelObOrgShared(d))return TS.client.ui.flex.hideFlex();a=_.get(TS.model.team,"id");TS.apps.promiseToGetFullAppProfile(r,a,s,true).then(function(e){TS.client.ui.app_profile.openWithApp(e,r,a);TS.client.flexDisplaySwitched("apps",i,t,n)}).catch(function(){return TS.client.ui.flex.hideFlex()})},showSearchFromHistory:function e(i){if(!i){TS.client.ui.flex.openFlexTab("mentions");return}i=TS.search.truncateQuery(i);i=i.replace(/%23/g,"#");i=i.replace(/%252F/g,"/");var t=TS.search.input;TS.utility.contenteditable.value(t,i);t.data("textchange_lastvalue",i);$("#header_search_form").submit();TS.client.flexDisplaySwitched("search",i,false,true)},showTeamFromHistory:function e(i,t){if(!i){TS.client.ui._displayTeamList();TS.client.flexDisplaySwitched("team",null,false,true);return}var n;if(TS.interop.utility.looksLikeMemberId(i)){n=TS.members.getMemberById(i);if(!n&&!t){TS.members.ensureMembersArePresent([i]).finally(function(){TS.client.ui.showTeamFromHistory(i,true)});return}}if(!n)n=TS.members.getMemberByName(i);var a=TS.user_groups.getUserGroupsById(i);if(n)TS.client.ui._displayMember(n.id).then(function(e){TS.client.flexDisplaySwitched("team",e,false,true)},_.noop);else if(a){TS.client.ui._displayUserGroup(a.id);TS.client.flexDisplaySwitched("team",a.id,false,true)}else{TS.client.ui._displayTeamList();TS.client.flexDisplaySwitched("team",null,true)}},showView:function e(i){switch(i){case"Vall_unreads":TS.client.unread.showUnreadView();return true;case"Vall_threads":TS.client.threads.showThreadsView();return true;case"Vapp_space":TS.ui.apps_browser.start();return true;case"Vapps_dashboard":if(TS.client.ui.apps_dashboard.isEnabled()){TS.client.ui.apps_dashboard.start();return true}return false;case"Vhome_screen":if(TS.boot_data.feature_sli_home){TS.client.ui.home_screen.start();return true}return false;default:TS.warn('Unknown view "'+i+'" passed to TS.client.ui.showView()');return false}},onSubmit:function e(i){try{var t=$.trim(i);if(!t)return;var n="/unarchive"===t||"/leave"===t||"/part"===t||"/close"===t;var a=TS.shared.getActiveModelOb();if(!n&&a&&a.is_archived){TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","client")());TS.client.msg_input.populate(t);return}TS.view.clearMessageInput();TS.utility.contenteditable.clearHistory(TS.client.msg_input.$input);if(TS.utility.msgs.shouldSendSlashCommand(i))TS.client.ui.sendSlashCommand(a,i);else TS.client.ui.sendMessage(a,i)}catch(e){TS.error(e)}},sendSlashCommand:function e(i,t,n){if("／"===t.substr(0,1))t=t.replace("／","/");TS.chat_history.add(t);var a=TS.cmd_handlers.parseArgs(t);var r=TS.utility.msgs.getEditLastShortcutCmd(t);if(TS.cmd_handlers[a.cmd]&&"client"===TS.cmd_handlers[a.cmd].type)setTimeout(function(){TS.cmd_handlers.runCommand(a,n,i)},10);else if(r){TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",i.id);TS.utility.msgs.tryToEditLastMsgFromShortcut(r)}else{if(n&&!TS.cmd_handlers.isCmdSupportedInThreads(a.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(a.cmd,a.original_txt,n,i);return}if("/me"===a.cmd&&TS.prefs.getPref("convert_emoticons")&&"as_text"!==TS.prefs.getPref("emoji_mode"))a.rest=TS.format.doEmoticonConversion(a.rest);var s=_.trim(a.original_txt.substr(a.cmd.length));var o=TS.format.texty.convertContentsStringForEncodedMembers(s);o=TS.emoji.maybeGetCanonicalEmojiString(o);var l={command:a.cmd,text:o,channel:i.id,disp:a.disp,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(n)l.thread_ts=n.ts;var c=function e(i,t,n){TS.client.ui.onAPICommand(i,t,n,a.original_txt)};TS.api.call("chat.command",l).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;c(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;c(a,i,t,n);return{data:i,args:t,request_id:n}})}d(i)},sendMessage:function e(i,t,n,a){TS.chat_history.add(t);var r=TS.shared.getControllerForModelOb(i);if(_.isFunction(r.sendMsg))r.sendMsg(i.id,t,n,a);else return;if(i.id===TS.model.active_cid)TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);d(i)},prefMsgPreviewChanged:function e(){if(!TS.prefs.getPref("msg_preview")&&TS.model.msg_preview_showing){TS.client.ui.$msg_preview.addClass("hidden");TS.model.msg_preview_showing=false}else if(TS.prefs.getPref("msg_preview")&&!TS.model.msg_preview_showing)TS.client.ui.$msg_input.trigger("textchange");if(TS.prefs.getPref("msg_preview")&&!TS.prefs.getPref("msg_preview_persistent")&&TS.model.msg_preview_showing)TS.client.ui.$msg_input.trigger("textchange");TS.view.resizeManually()},prefColorNamesInListChanged:function e(){if(TS.prefs.getPref("color_names_in_list"))$(".nuc").removeClass("nuc").addClass("user_colored");else $(".user_colored").removeClass("user_colored").addClass("nuc")},onAPICommand:function e(i,t,n,a){var r=TS.model.active_cid;var s;if(!i){if(n.channel&&n.thread_ts)TS.utility.populateThreadInputs(a,n.channel,n.thread_ts);else if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))TS.utility.populateInput(TS.client.ui.$msg_input,a);var o;var l=TS.format.texty.convertContentsStringToDisplayString(a);if(t.error&&"restricted_action"===t.error)o=TS.i18n.t("*{cmd_txt}* failed because you are not allowed to perform that action. Talk to your Workspace Owner.","client")({cmd_txt:l});else if(t.error&&"Unknown command"!==t.error&&"unknown_command"!==t.error)o=TS.i18n.t('*{cmd_txt}* failed with the error "{err_txt}"',"client")({cmd_txt:l,err_txt:t.error});else if(t.error)o=TS.i18n.t('*{cmd_txt}* is not a valid command. In Slack, all messages that start with the "/" character are interpreted as commands.\n\n If you are trying to send a message and not run a command, try preceding the "/" with an empty space.',"client")({cmd_txt:l});else o=TS.i18n.t("*{cmd_txt}* failed with an unknown error.","client")({cmd_txt:l});s={text:o,ephemeral_type:"temp_slash_cmd_feedback",channel:r,slackbot_feels:"sad_surprise"};if(n.channel&&n.thread_ts){s.channel=n.channel;s.thread_ts=n.thread_ts;s.ephemeral_type="threads_temp_slash_cmd_feedback"}TS.client.ui.addOrFlashEphemeralBotMsg(s)}if(t.response){if(t.open_url){var d="_"+Math.random();TS.info("gonna try to launch a new tab/window with target: "+d+" url: "+t.open_url);TS.utility.openInNewTab(t.open_url,d)}if(t.keep_input)if(n.channel&&n.thread_ts)TS.utility.populateThreadInputs(a,n.channel,n.thread_ts);else if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))TS.utility.populateInput(TS.client.ui.$msg_input,a);var c=r;if(n.channel&&n.channel!=c)if(TS.channels.getChannelById(n.channel))c=n.channel;else if(TS.ims.getImById(n.channel))c=n.channel;else if(TS.groups.getGroupById(n.channel))c=n.channel;if(t.is_temp){s={text:t.response,ephemeral_type:"temp_slash_cmd_feedback",channel:c};if(n.thread_ts){s.thread_ts=n.thread_ts;s.ephemeral_type="threads_temp_slash_cmd_feedback"}TS.client.ui.addOrFlashEphemeralBotMsg(s)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);if(n.channel&&n.thread_ts)TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.channel);else TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);s={text:t.response,channel:c,thread_ts:n.thread_ts};TS.client.ui.addEphemeralBotMsg(s)}}else if(i){if(n.channel&&n.thread_ts)TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.channel);else TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);if(t.keep_input)if(n.channel&&n.thread_ts)TS.utility.populateThreadInputs(a,n.channel,n.thread_ts);else if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))TS.utility.populateInput(TS.client.ui.$msg_input,a)}},checkInlineImgsAndIframesEverywhere:function e(i){TS.client.ui.checkInlineImgsAndIframes("main",i);TS.client.ui.checkInlineImgsAndIframes("search",i);TS.client.ui.checkInlineImgsAndIframes("archives",i);TS.client.ui.checkInlineImgsAndIframes("file_preview",i);TS.client.ui.checkInlineImgsAndIframes("file_list",i);TS.client.ui.checkInlineImgsAndIframes("replies",i);TS.client.ui.checkInlineImgsAndIframes("threads",i);TS.client.ui.checkInlineImgsAndIframes("unread",i)},checkInlineImgsAndIframesMain:function e(){TS.client.ui.checkInlineImgsAndIframes("main")},getCachedDimensionsRect:function e(i,t){var n;if(TS.model.ui[i])return TS.model.ui[i];if(!t||!t[0])return{top:0,bottom:0,left:0,right:0,width:0,height:0};n=t.dimensions_rect();if(n.width&&0!==n.width)TS.model.ui[i]=n;return n},checkInlineImgsAndIframes:function e(i,t){var n;var a;if("main"===i){n=TS.client.ui.$msgs_div;a=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div)}else if("search"===i){n=$("#search_results");a=TS.client.ui.getCachedDimensionsRect("cached_search_scroller_rect",n)}else if("archives"===i){n=TS.client.archives.$scroller;a=TS.client.ui.getCachedDimensionsRect("cached_archives_scroller_rect",n)}else if("file_preview"===i){n=$("#file_preview_container");a=TS.client.ui.getCachedDimensionsRect("cached_file_preview_scroller_rect",n)}else if("file_list"===i){n=$("#file_list");a=TS.client.ui.getCachedDimensionsRect("cached_file_list_scroller_rect",n)}else if("replies"===i){n=$("#convo_scroller");a=TS.client.ui.getCachedDimensionsRect("cached_convo_scroller_rect",n)}else if("unread"===i){n=TS.client.ui.unread.$scroller;a=TS.client.ui.getCachedDimensionsRect("cached_unread_scroller_rect",n)}else if("threads"===i){n=TS.client.ui.threads.$scroller;a=TS.client.ui.getCachedDimensionsRect("cached_threads_scroller_rect",n)}else{TS.info("unknown which in checkInlineImgsAndIframes(which)");return}if(t)TS.info("checkInlineImgsAndIframes which:"+i);var r=n.find(".msg_inline_holder:not(.hidden) .msg_inline_child.hidden, .msg_inline_file_preview_toggler:not(.collapsed) + .image_container .image_bg");var s;var o;var l;var d;var c="loaded_bg";r.each(function(){o=$(this);d=o.closest(".msg_inline_holder, .image_container");if(!d.length)return;if(d.data(c))return;s=d.dimensions_rect();if(t)TS.dir(0,s);if(t)TS.dir(0,a);if(TS.utility.doRectsOverlap(a,s)){if(t)TS.info("yes");if(o.data("real-background-image")){o.removeClass("hidden");o.css("background-image",'url("'+o.data("real-background-image")+'")');l=o.find("img")}else{l=o;l.removeClass("hidden")}l.attr("src",l.data("real-src"));l.error(function(){$(this).closest(".msg_inline_holder, .image_body").addClass("broken_image")});d.data(c,true)}else if(t)TS.warn("no");o=null;l=null;d=null})},logUnreads:function e(){var i=[];var t=TS.shared.getActiveModelOb();var n=t.unreads;if(!t)return;for(var a=0;a<n.length;a+=1)if(-1==TS.model.client.reads.indexOf(n[a]))i.push(n[a]);TS.info(i)},markMostRecentReadMsgInActive:function e(i,t){var n=TS.shared.getActiveModelOb();if(TS.has_pri[H]&&n.unread_cnt)TS.log(H,"TS.client.ui.markMostRecentReadMsgInActive, "+n.id+": reason = "+i+(t?", get_rid_of_line = "+t:""));var a=TS.shared.getControllerForModelOb(n);if(_.isFunction(a.markMostRecentReadMsg))a.markMostRecentReadMsg(n,i);if(t){if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.setGhostLastRead(null));else{if(TS.has_pri[H])TS.log(H,"markMostRecentReadMsgInActive, "+n.id+', reason = "'+i+'": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()');TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar(i)}TS.ui.pins.clearUnreadPinState(n)}if(n&&(n._temp_unread_cnt||n._temp_last_read)){if(TS.has_pri[R])TS.log(R,"markMostRecentReadMsgInActive: Nulling _temp_unread_cnt and _temp_last_read on "+n.id);n._temp_unread_cnt=null;n._temp_last_read=null}},isMsgInView:function e(i){var t=TS.shared.getActiveModelOb();if(t){var n=TS.utility.msgs.getMsg(i,t.msgs);if(n&&n._jl_rolled_up_in)i=n._jl_rolled_up_in}var a=TS.client.msg_pane.getCanonicalDivForMsg(i);if(!a.length)return false;if(a.hasClass("hidden"))return true;var r=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);return TS.client.ui.isElInView(a,5,r)},isUnreadDividerInView:function e(i){i=i||5;var t=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);return TS.client.ui.isElInView(TS.client.ui.$msgs_unread_divider,i,t)},isElInView:function e(i,t,n){if(!i||!i.length)return false;t=t||0;var a=i.dimensions_rect();if(a.height>n.height)return TS.utility.doesRectContainRect(a,n,t,true);else if(TS.utility.doesRectContainRect(n,a,t,true))return true;return false},onMsgsScrollThrottled:function e(){TS.client.ui.msgs_scrolled_sig.dispatch();TS.client.ui.markScrollTop();if(TS.client.ui.$msgs_unread_divider&&TS.shared.getActiveModelOb().unread_cnt){var i=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);var t=j(TS.client.ui.$msgs_unread_divider,5,i);var n=$("#messages_unread_status");var a="within"===t;var r="below"===t;var s=a&&!(TS.boot_data.feature_scrollback_half_measures&&TS.shared.lastReadIsOlderThanCurrentHistory());n.toggleClass("unreads_below",r);n.toggleClass("quiet no_jump",s);n.off("click mouseenter mouseleave");if(a)n.click(function(e){e.preventDefault();if(TS.boot_data.feature_scrollback_half_measures&&TS.shared.lastReadIsOlderThanCurrentHistory())TS.client.ui.$msgs_scroller_div.animate({scrollTop:0},75);else TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.clicked)});else{n.click(function(e){e.preventDefault();if(TS.boot_data.feature_scrollback_half_measures&&TS.shared.lastReadIsOlderThanCurrentHistory())TS.client.ui.$msgs_scroller_div.animate({scrollTop:0},200);else TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()});TS.client.msg_pane.showNewMsgsBar();TS.client.msg_pane.startNewMsgsTimer()}}if(TS.model.ui.msgs_are_auto_scrolling)return;TS.client.msg_pane.checkUnreads()},onMsgsScroll:function e(){TS.utility.throttle.method(TS.client.ui.onMsgsScrollThrottled,"ts_ui_on_msgs_scroll",250)},markScrollTop:function e(){var i;if(TS.client.ui.areMsgsScrolledToBottom())i=-1;else i=TS.client.ui.$msgs_scroller_div[0].scrollTop;var t=false;var n=TS.shared.getActiveModelOb();var a=TS.shared.getControllerForModelOb(n);if(_.isFunction(a.markScrollTop))t=a.markScrollTop(n.id,i);if(0===i&&TS.shared.getActiveModelOb()&&TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id&&TS.model.cancelled_welcome_2_this_session){TS.model.cancelled_welcome_2_this_session=false;TS.view.adjustForWelcomeSlideShow();return}if(t)TS.client.ui.maybeLoadScrollBackHistory()},maybeLoadScrollBackHistory:function e(){if(TS.client.ui.active_highlight_count||TS.model.ui.is_mouse_down)return;TS.client.ui.doLoadScrollBackHistory()},doLoadScrollBackHistory:function e(i){var t=TS.shared.getActiveModelOb();var n=TS.shared.getControllerForModelOb(t);if(_.isFunction(n.maybeLoadScrollBackHistory))n.maybeLoadScrollBackHistory(t.id,i)},areMsgsScrolledToBottom:function e(i,t){var n=TS.model.archive_view_is_showing?TS.model.ui.cached_archive_scroll_result:TS.model.ui.cached_msgs_scroll_result;if(null!==n&&!t)return n;i=!isNaN(i)?i:50;var a=TS.model.archive_view_is_showing?TS.client.archives.$scroller:TS.client.ui.$msgs_scroller_div;var r=a[0];if(!r)return;var s=parseInt(a.css("height"),10)+r.scrollTop+i>=r.scrollHeight;if(TS.model.archive_view_is_showing)TS.model.ui.cached_archive_scroll_result=s;else TS.model.ui.cached_msgs_scroll_result=s;return s},instaScrollMsgsToBottom:function e(i){if(TS.prefs.prefs_loaded&&TS.prefs.getPref("start_scroll_at_oldest")){var t=TS.shared.getActiveModelOb();if(t&&t.unread_cnt&&TS.model.ui.msgs_are_auto_scrolling){if(TS.model.ui.is_window_focused){if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToBottom: exiting early because unread_cnt = "+t.unread_cnt+", and TS.model.ui.msgs_are_auto_scrolling = true");return}if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToBottom: allowing scroll despite msgs_are_auto_scrolling = true and unread_cnt = "+t.unread_cnt+", because window is blurred.")}}if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToBottom: and_check = "+i);var n=TS.client.ui.$msgs_scroller_div[0].scrollHeight;if(TS.boot_data.feature_initial_scroll_position&&!n){if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToBottom: stopping because scrollHeight is 0");return}TS.client.ui.instaScrollMsgsToPosition(n,i,true)},slowScrollMsgsToBottom:function e(){var i=TS.model.archive_view_is_showing;if(i)TS.client.archives.$scroller.animate({scrollTop:TS.client.archives.$scroller[0].scrollHeight},"500");else TS.client.ui.$msgs_scroller_div.animate({scrollTop:TS.client.ui.$msgs_scroller_div[0].scrollHeight},"500")},instaScrollMsgsToPosition:function e(i,t,n){if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToPosition: scroll_top = "+i+", and_check = "+t+", set_btm_result = "+n);TS.model.ui.msgs_are_auto_scrolling=true;if(TS.client.ui.$msgs_scroller_div.length)TS.client.ui.$msgs_scroller_div[0].scrollTop=i;var a=TS.shared.getActiveModelOb();setTimeout(function(){if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToPosition -> timeout(): scroll_top = "+i+", set_btm_result = "+n+"... resetting msgs_are_auto_scrolling.");TS.model.ui.msgs_are_auto_scrolling=false;if(null!==n){var e=TS.shared.getActiveModelOb();if(a.id!==e.id){if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToPosition -> timeout(): active model_ob changed from "+a.id+" to "+e.id);if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToPosition -> timeout(): NOT setting TS.client.ui.cached_msgs_scroll_result = "+n);return}if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToPosition -> timeout(): set TS.client.ui.cached_msgs_scroll_result = "+n+", previously "+TS.client.ui.cached_msgs_scroll_result);TS.client.ui.cached_msgs_scroll_result=n}},100);if(t){if(TS.has_pri[Q])TS.log(Q,"instaScrollMsgsToPosition: and_check, so checking unreads as well.");TS.client.msg_pane.checkUnreads()}},slowScrollMsgsToPosition:function e(i,t,n){var a=TS.model.archive_view_is_showing;t=t&&!a;var r;if(a){TS.client.archives.msgs_are_auto_scrolling=true;r=TS.client.archives.$scroller}else{TS.model.ui.msgs_are_auto_scrolling=true;r=TS.client.ui.$msgs_scroller_div}r.stop().animate({scrollTop:i},"500",function(){setTimeout(function(){if(a)TS.client.archives.msgs_are_auto_scrolling=false;else TS.model.ui.msgs_are_auto_scrolling=false},100);if(t)TS.client.msg_pane.checkUnreads();if(n)n()})},scrollMsgsSoMsgIsInView:function e(i,t,n,a,r){a=isNaN(a)?1e3:a;var s;var o=TS.model.archive_view_is_showing;if(o)s=TS.client.msg_pane.getDivForArchiveMsg(i);else s=TS.client.msg_pane.getCanonicalDivForMsg(i);if(!s.length){if(!r)TS.utility.rAF(function(){r=true;TS.client.ui.scrollMsgsSoMsgIsInView(i,t,n,a,r)});return}var l;if(t){l=s.prevAll().slice(0,20);l.css("opacity",0);s.next().scrollintoview({duration:0,offset:"top"})}var d=2500;if(!o&&n)TS.client.ui.active_highlight_count+=1;if(o)TS.client.archives.msgs_are_auto_scrolling=true;else TS.model.ui.msgs_are_auto_scrolling=true;TS.model.ui.scrolled_to_msg_ts=i;clearTimeout(I);I=setTimeout(function(){TS.model.ui.scrolled_to_msg_ts=null},1e4);s.scrollintoview({duration:a,offset:"center_vertical",complete:function e(){if(n){s.highlight(d,"msg_highlighter");if(!o)setTimeout(function(){TS.client.ui.active_highlight_count-=1},d)}setTimeout(function(){if(t&&l)l.transition({opacity:1},300)},100);if(o){TS.client.archives.msgs_are_auto_scrolling=false;TS.client.archives.onMsgsScroll()}else{TS.model.ui.msgs_are_auto_scrolling=false;TS.client.ui.onMsgsScroll()}}})},active_highlight_count:0,scrollMsgsSoFirstUnreadMsgIsInView:function e(i){var t=false;if(t){TS.info("scrollMsgsSoFirstUnreadMsgIsInView called");TS.info("TS.client.ui.$msgs_unread_divider="+TS.client.ui.$msgs_unread_divider)}if(!TS.client.ui.$msgs_unread_divider)return;if(t)TS.info("TS.client.ui.$msgs_unread_divider.length="+TS.client.ui.$msgs_unread_divider.length);var n=TS.client.ui.$msgs_unread_divider;TS.model.ui.msgs_are_auto_scrolling=true;n.scrollintoview({duration:200,offset:"top",px_offset:50,complete:function e(){setTimeout(function(){if(t)TS.info("scrollMsgsSoFirstUnreadMsgIsInView animation complete");TS.model.ui.msgs_are_auto_scrolling=false;TS.client.ui.onMsgsScroll();if(i)i()},1)}})},afterHistoryFetch:function e(i){var t;var n=false;if(TS.boot_data.feature_initial_scroll_position){if(TS.model.ui.last_top_msg)t=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);if(TS.boot_data.feature_scrollback_half_measures&&t&&t.length){t=G(t);TS.ui.utility.preventElementFromScrolling(t,function(){TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(i?i.id:"unspecified"),n)},function(){var e=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);if(!e.length)if(TS.utility.msgs.isMsgRolledUp(TS.model.ui.last_top_msg))e=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg._jl_rolled_up_in);e=G(e);return e});if(TS.prefs.getPref("start_scroll_at_oldest")&&TS.client.ui.$msgs_unread_divider&&i.unread_cnt&&!TS.client.msg_pane.dont_check_unreads_til_switch&&TS.client.ui.isUserAttentionOnChat())TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}else{TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(i?i.id:"unspecified"),n);TS.client.msg_pane.setInitialScrollPosition(-1)}}else if(TS.boot_data.feature_scrollback_half_measures&&i.scroll_top>0&&TS.model.ui.last_top_msg){t=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);TS.ui.utility.preventElementFromScrolling(t,function(){TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(i?i.id:"unspecified"),n)},function(){return TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts)})}else TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(i?i.id:"unspecified"),n);var a=!!TS.boot_data.feature_initial_scroll_position;TS.view.resizeManually("TS.client.ui.afterHistoryFetch",a);if(TS.client.ui.record_content_visible_metric_after_fetching_model_ob==i.id){TS.metrics.mark("content_visible");TS.metrics.measure("client_content_visible_4","start_nav","content_visible");delete TS.client.ui.record_content_visible_metric_after_fetching_model_ob}if(0!==i.scroll_top)return;if(!TS.model.ui.last_top_msg)return;if(!TS.boot_data.feature_initial_scroll_position)TS.client.ui.scrollMsgsSoMsgIsInView(TS.model.ui.last_top_msg.ts,true);TS.model.ui.last_top_msg=null;setTimeout(function(){if(0===i.scroll_top){TS.info("TS.client.ui.afterHistoryFetch: we're still scrolled to the top, so we'll try to fetch more messages now");TS.client.ui.maybeLoadScrollBackHistory()}},1e3)},rebuildMemberListToggle:function e(){var i;var t;if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id){var n=TS.shared.getActiveModelOb();if(TS.channels.backfills.isBackfilling(n.id)){t=false;F(t,i);return}var a=TS.membership.getMembershipCounts(n);if(a.promise)if(!s){s=true;a.promise.then(function(){if(TS.shared.getActiveModelOb().id!==n.id)return;t=true;var e=_.get(a,"counts.member_count");if(n.is_mpim&&TS.shared.isModelObShared(n)&&TS.teams.getTeamNameById(n.shared_team_ids[0])){O(t,e,n);return}F(t,e)}).catch(function(e){var i=n.id;var t=1e4;TS.warn("Fetching membership counts for "+i+" failed; trying again in "+t+" ms");TS.logError(e);setTimeout(function(){var e=TS.shared.getActiveModelOb();if(!e)return;if(e.id!==i)return;TS.client.ui.rebuildMemberListToggle()},t)}).finally(function(){s=false})}t=_.has(a,"counts.member_count");i=_.get(a,"counts.member_count");if(n.is_mpim&&TS.shared.isModelObShared(n)&&TS.teams.getTeamNameById(n.shared_team_ids[0])){O(t,i,n);return}F(t,i)}else $("#channel_members_toggle").addClass("hidden")},maybePromptForClosingGroup:function e(i){var t=TS.groups.getGroupById(i);if(t.unread_cnt){var n=TS.model.group_prefix+t.name;TS.generic_dialog.start({title:TS.i18n.t("You have unread messages","client")(),body:TS.i18n.t("You have unread messages in the {group_name} private channel. Are you sure you want to close it?","client")({group_name:n}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes","client")(),cancel_button_text:TS.i18n.t("No","client")(),onGo:function e(){TS.groups.markMostRecentReadMsg(t,TS.model.marked_reasons.closed);TS.client.markLastReadsWithAPI();TS.shared.closeArchivedChannel(t.id)}})}else TS.shared.closeArchivedChannel(t.id)},maybePromptForClosingIm:function e(i){var t=TS.ims.getImById(i);if(t.unread_cnt)TS.generic_dialog.start({title:TS.i18n.t("You have unread messages","client")(),body:TS.i18n.t("You have unread messages from {im_name}. Are you sure you want to close the DM?","client")({im_name:t.name}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes","client")(),cancel_button_text:TS.i18n.t("No","client")(),onGo:function e(){TS.ims.markMostRecentReadMsg(t,TS.model.marked_reasons.closed);TS.client.markLastReadsWithAPI();TS.ims.closeIm(t.id)}});else TS.ims.closeIm(t.id)},unread_checking_tim:0,channelOrImOrGroupDisplaySwitched:function e(){TS.client.msg_pane.dont_check_unreads_til_switch=false;TS.model.client.reads.length=0;TS.client.msg_pane.hideNewMsgsBar();TS.client.ui.startUnreadCheckingTimer();TS.client.ui.rebuildMemberListToggle();if(!TS.useReactMessages())TS.shared.maybeFetchHistoryAndThenCheckConsistency(TS.shared.getActiveModelOb());if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if("files"===TS.model.ui_state.flex_name||"convo"===TS.model.ui_state.flex_name){if(!TS.model.ui_state.flex_extra)return;var i;if("files"===TS.model.ui_state.flex_name){var t=$("#back_from_file_preview");i=t.data("origin");if("channel_page"===i||"group_page"===i||"im_page"===i)TS.client.ui.files._rebuildBackFromFilePreview("")}else if("convo"===TS.model.ui_state.flex_name){i=TS.ui.replies.activeConvoOrigin();if("channel_page"===i||"group_page"===i||"im_page"===i){var n=false;TS.ui.replies.toggleBackButton(n)}}}},startUnreadCheckingTimer:function e(){if(TS.client.ui.unread_checking_tim)window.clearTimeout(TS.client.ui.unread_checking_tim);var i=0;var t=1e3;var n=t;if(TS.prefs.prefs_loaded&&TS.prefs.getPref("mark_msgs_read_immediately"))n=i;TS.client.ui.unread_checking_tim=setTimeout(TS.client.msg_pane.checkUnreads,n)},isUserAttentionOnChat:function e(){if(!TS.model.ui.is_window_focused)return false;if(TS.model.dialog_is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.coachmark_is_showing)return false;if(TS.model.overlay_is_showing)return false;if(TS.ui.fs_modal.is_showing)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;if(document.hidden){if(TS.has_pri[H])TS.log(H,"isUserAttentionOnChat(): document.hidden = true. exiting.");return false}if("hidden"===document.visibilityState){if(TS.has_pri[H])TS.log(H,"isUserAttentionOnChat(): document.visibilityState = hidden. exiting.");return false}if(TS.model.is_our_app&&window.desktop&&desktop.reduxHelper&&_.isFunction(desktop.reduxHelper.isSelectedTeam))if(!desktop.reduxHelper.isSelectedTeam()){if(TS.has_pri[H])TS.log(H,"isUserAttentionOnChat(): App isSelectedTeam() returned false. exiting.");return false}return true},startSearch:function e(i){if(TS.boot_data.feature_focus_mode&&i&&i.altKey)TS.ui.focus_mode.start();else{if(!TS.client.ui.isUserAttentionOnChat())return false;TS.clog.track("SEARCH_OPEN",{open_method:"key",search_session_id:TS.search.getSearchSessionId(),client_request_id:TS.search.getQuerySessionId()});var t="";var n=TSSSB&&TSSSB.getSelectedInputTxt&&TSSSB.getSelectedInputTxt();if(!TS.client.activeChannelIsHidden()){var a=TS.shared.getActiveModelOb();if(a.is_im)t="in:"+TS.format.texty.getMemberAsContentsString(TS.members.getMemberById(a.user))+" ";else t="in:"+a.name+" "}if(n)t+=n;TS.search.setInputVal(t)}},previewMember:function e(i,t){return TS.client.ui._displayMember(i,t).then(function(e){TS.client.flexDisplaySwitched("team",e)},_.noop)},_displayMember:function e(i,t){return new Promise(function(e,n){var a=TS.members.getPotentiallyUnknownMemberById(i);if(!a)return void n(new Error("wtf: no member to display"));if(!TS.client.ui.flex._displayFlexTab("team"))return void n(new Error("wtf: failed to open team tab"));var r=function i(){B(a,t);e(a.id)};if(a.profile&&a.profile.fields)TS.team.ensureTeamProfileFields().then(r);else r()})},showTeamList:function e(){var i=true;if(!TS.client.ui._displayTeamList(i))return;TS.client.flexDisplaySwitched("team")},_displayTeamList:function e(i){if(!TS.client.ui.flex._displayFlexTab("team"))return false;TS.model.previewed_member_name="";TS.model.previewed_member_id="";TS.model.previewed_user_group_id="";$("#user_group_preview_container").hideWithRememberedScrollTop();$("#member_preview_container").hideWithRememberedScrollTop();$("#team_list_container").unhideWithRememberedScrollTop();TS.view.resizeManually("TS.client.ui._displayTeamList");var t=TS.SearchableMemberList.get("team_directory");if(!t){var n=new TS.SearchableMemberList({$container:$("#team_list_container"),id:"team_directory",triggered_by_user_action:i});n.showInitial()}else t.maybeRerenderLongListView();return true},showGroupsList:function e(){if(!TS.client.ui._displayGroupsList())return;TS.client.flexDisplaySwitched("groups")},_displayGroupsList:function e(){if(!TS.client.ui.flex._displayFlexTab("groups"))return false;$("#user_groups_container").unhideWithRememberedScrollTop();return true},previewUserGroup:function e(i,t){if(!t)t="groups";if(!TS.client.ui._displayUserGroup(i,t))return;var n=TS.user_groups.getUserGroupsById(i);TS.client.flexDisplaySwitched("groups",n.id)},_displayUserGroup:function e(i,t){if(M)return;M=true;var n=TS.user_groups.getUserGroupsById(i);if(!n)return false;if(!TS.client.ui.flex._displayFlexTab("groups"))return false;if(TS.view.user_groups_members_list_lazyload){TS.view.user_groups_members_list_lazyload.detachEvents();TS.view.user_groups_members_list_lazyload=null}TS.model.previewed_user_group_id=n.id;TS.info("TS.model.previewed_user_group_id:"+TS.model.previewed_user_group_id);$("#user_groups_container").hideWithRememberedScrollTop();var a;var r;var s=function e(){$("#user_group_preview_container").unhideWithRememberedScrollTop();r=n.users;TS.members.ensureMembersArePresent(r).then(function(){var e=[];for(a=0;a<r.length;a+=1)e.push(TS.members.getMemberById(r[a]));e.sort(function(e,i){var t=e._real_name_lc||e._name_lc;var n=i._real_name_lc||i._name_lc;if(t>n)return 1;if(n>t)return-1;return 0});var i=n.prefs.channels;var s=[];for(a=0;a<i.length;a+=1)s.push(TS.channels.getChannelById(i[a]));var o=n.prefs.groups;var l=[];for(a=0;a<o.length;a+=1)l.push(TS.groups.getGroupById(o[a]));s=s.concat(l);s=_.reject(s,_.isNull);var d=-1===n.date_delete;var c=TS.permissions.members.canEditUserGroups()||TS.permissions.members.canCreateAndDeleteUserGroups();var u=TS.templates.user_group_preview({user_group:n,members:e,channels:s,show_user_groups_edit:c,is_user_group_deleted:d});var m=$("#user_group_preview_scroller");m.html(u);TS.utility.makeSureAllLinksHaveTargets(m);$("#user_group_menu_toggle").on("click",function(e){TS.menu.startWithUserGroupMenu(e,n.id)});$("#edit_default_channels").on("click",function(){TS.ui.admin_user_groups.editInfo(n)});TS.ui.tabs.create($("#user_group_tabs"));if(TS.model.last_previewed_user_group_id!=TS.model.previewed_user_group_id)if(m.length)m[0].scrollTop=0;TS.model.last_previewed_user_group_id=n.id;var f=$("#user_group_members");f.bind("click.view",TS.view.onMemberListClick);f.on("click.toggle_list_item",".team_list_item",TS.members.view.onTeamDirectoryItemClick);TS.utility.makeSureAllLinksHaveTargets(f);if(!TS.environment.supports_custom_scrollbar)m.find(".user_group_member_list").monkeyScroll();TS.view.user_groups_members_list_lazyload=f.find(".lazy").lazyload({container:$(".user_group_member_list"),ignore_when_hidden_element:$("#user_group_members"),all_images_same_size:true});$(".user_group_member_list").trigger("resize-immediate");var h=$("#back_from_user_group_preview");T(t,h);TS.client.flex_pane.stopLocalTimeInterval();TS.view.resizeManually("TS.client.ui._displayUserGroup");M=false;return true})};if(TS.user_groups.needsToFetchMembership(n))TS.user_groups.getUserGroupMembers(i,function(e){if(e&&e.users){n=e;return s()}});else s();return true},tryToJump:function e(i,t,n){var a=TS.shared.getModelObById(i);if(!a){TS.error("NO CHANNEL NO IM GROUP");return false}if(!t){TS.client.displayModelOb(a);return true}var r;if(TS.useReactMessages())r=TS.utility.msgs.findMsg(t,a.id);else r=TS.utility.msgs.getMsg(t,a.msgs);if(r&&TS.utility.msgs.isMsgReply(r)){TS.ui.replies.openConversation(a,r.thread_ts,r.ts);return true}if(!r&&n){TS.ui.replies.openConversation(a,n,t);return true}TS.view.displayMsgInModelOb(a,t);return true},sendChannelMsgThroughSlackBot:function e(i,t,n,a){var r=TS.channels.getChannelById(i);if(!r)return;var s=n.split(",");if(!s.length)return;var o;if(TS.useReactMessages())o=TS.utility.msgs.findMsg(t,r.id);else o=TS.utility.msgs.getMsg(t,r.msgs);if(!o){TS.client.ui.addEphemeralBotMsg({channel:r.id,text:TS.i18n.t("Darn, it looks like that message no longer exists.","client")(),slackbot_feels:"sad_surprise"});return}var l=TS.i18n.t("<p>Would you like to have slackbot send {names_text} your message?</p>","client")({names_text:E(s)});l+=TS.templates.builders.msgs.buildHTML({msg:o,model_ob:r,standalone:true});TS.generic_dialog.start({title:TS.i18n.t("Send message to users not in #{channel_name}","client")({channel_name:r.name}),body:l,go_button_text:TS.i18n.t("Yes, send it","client")(),onGo:function e(){for(var t=0;t<s.length;t+=1)TS.api.call("chat.sendMention",{channel:i,user:s[t],ts:o.ts});if(a){var n;if(TS.useReactMessages())n=TS.utility.msgs.findMsg(a,r.id);else n=TS.utility.msgs.getMsg(a,r.msgs);if("C"===i.charAt(0))TS.channels.removeMsg(i,n);else if("G"===i.charAt(0))TS.groups.removeMsg(i,n)}}})},promptForGroupOrChannelInvite:function e(i,t,n){var a=TS.groups.getGroupById(i)||TS.channels.getChannelById(i);if(!a)return;var r=t.split(",");if(!r.length)return;if(a.is_private||a.is_group){TS.ui.invite.showInviteMembersPreSelected(i,r,n);return}TS.generic_dialog.start({title:TS.i18n.t("Invite new members to #{channel_name}","client")({channel_name:a.name}),body:TS.i18n.t("<p>Would you like to invite {names_text} to #{channel_name}?</p>","client")({names_text:E(r),channel_name:a.name}),go_button_text:TS.i18n.t("Yes, invite them","client")(),onGo:function e(){TS.api.call("conversations.invite",{channel:i,users:t});if(n){var r;if(TS.useReactMessages())r=TS.utility.msgs.findMsg(n,a.id);else r=TS.utility.msgs.getMsg(n,a.msgs);TS.channels.removeMsg(i,r)}}})},addEphemeralBotMsg:function e(i){var t=i.channel||TS.shared.getActiveModelOb().id;var n=i.text;if(!n)return;var a;if(i.username)a={type:"message",subtype:"bot_message",icons:i.icons||null,is_ephemeral:true,username:i.username,ts:i.ts,text:n};else a={type:"message",user:"USLACKBOT",is_ephemeral:true,ts:i.ts,text:n};if(i.slackbot_feels)a.slackbot_feels=i.slackbot_feels;if(i.thread_ts)a.thread_ts=i.thread_ts;if(TS.useReactMessages()&&i.ephemeral_type&&!i.thread_ts)a._ephemeral_type=i.ephemeral_type;var r=m(t,a,i.ephemeral_type);TS.info(r)},addOrFlashEphemeralBotMsg:function e(i){var t=i.channel||TS.shared.getActiveModelOb().id;var n=i.ephemeral_type;var a=n?TS.utility.msgs.getEphemeralMsgsByCidAndType(t,n):null;if(i.thread_ts)a=_.filter(a,function(e){return e.thread_ts===i.thread_ts});if(a&&a.length){var r=TS.shared.getModelObById(t);var s=a[0];if(TS.useReactMessages()&&!s.thread_ts)s=_.assign({},a[0]);s.text=TS.format.cleanInternalMsg(i.text);if(TS.boot_data.feature_parsed_mrkdwn)TS.utility.msgs.clearCachedFormatting(s);if(TS.useReactMessages()&&!s.thread_ts)TS.redux.messages.replaceMessage(s);else if(r.is_im)TS.ims.message_changed_sig.dispatch(r,s);else if(r.is_mpim)TS.mpims.message_changed_sig.dispatch(r,s);else if(r.is_channel)TS.channels.message_changed_sig.dispatch(r,s);else if(r.is_group)TS.groups.message_changed_sig.dispatch(r,s)}else TS.client.ui.addEphemeralBotMsg(i)},maybeHandleReactionCmd:function e(i,t,n){if(!i)return false;var a=t.match(/:/g)&&t.match(/:/g).length;if(a<2)return false;var r=":[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?";if(TS.boot_data.feature_localization){if(TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)t=TS.emoji.maybeGetCanonicalEmojiString(t);r=_.get(TSF,"emoji_rx.r.source")||r}var s=new RegExp("^(\\+|＋|-|－) {0,1}("+r+")\\s*$");var o=t.match(s);if(!o)return false;var l=o[1];var d=o[2];if("+"!==l&&"＋"!==l&&"-"!==l&&"－"!==l)return false;var c=TS.rxns.getRxnKeyByMsgType(i);if(!c){TS.sounds.play("beep");return true}var u="+"===l||"＋"===l;if(!S(i)||!TS.emoji.isValidName(d)||TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(c),d)==u){TS.sounds.play("beep");return true}TS.rxns.changeRxnsFromUserAction(c,d,u);if(n)n();return true},sendMsgFromUserFromSSB:function e(i,t,n){if(!i)return false;if(!t)return false;var a=false;var r=TS.shared.getModelObById(i);var s;if(TS.useReactMessages())s=TS.utility.msgs.findMsg(n,r.id);else s=r&&TS.utility.msgs.getMsg(n,r.msgs);if(s&&TS.client.ui.maybeHandleReactionCmd(s,t))return true;if(s&&!s.thread_ts)s=null;if(0==i.indexOf("C")&&TS.channels.getChannelById(i))a=TS.channels.sendMsg(i,t,s);else if(0==i.indexOf("G")&&TS.groups.getGroupById(i))a=TS.groups.sendMsg(i,t,s);else if(0==i.indexOf("G")&&TS.mpims.getMpimById(i))a=TS.mpims.sendMsg(i,t,s);else if(TS.ims.getImById(i))a=TS.ims.sendMsg(i,t,s);if(!a){TSSSB.warn("TSSSB.sendMsgFromUser failed, invalid c_id or possible permission failure");return false}return true},shouldIgnoreClick:function e(i){if(TS.isPartiallyBooted()){i.preventDefault();TS.incremental_boot.userDidInteractWithUI();return true}if(TS.onboarding.inOnboarding()&&!TS.prefs.getPref("lessons_enabled"))return true;return false},maintainMessagePanePosition:function e(i){var t;var n;if(TS.model.archive_view_is_showing){if(TS.useReactMessages()){i();return}n=TS.client.archives.$scroller}else if(TS.model.unread_view_is_showing)n=TS.client.ui.unread.$scroller;else if(TS.model.threads_view_is_showing)n=TS.client.ui.threads.$scroller;else{if(TS.useReactMessages()){i();return}n=TS.client.ui.$msgs_scroller_div}t=n.find("ts-message");if(!TS.client.activeChannelIsHidden()&&TS.client.ui.areMsgsScrolledToBottom())i();else{var a=n.offset().top;var r=_.find(t.toArray(),function(e){var i=$(e).offset().top;return i-a>=0});TS.ui.utility.preventElementFromScrolling($(r),function(){i()})}}});var e;var i=false;var t=0;var n={};var a=false;var r=0;var s=false;var o=function e(i){TS.metrics.mark("_rebuildAllButMsgsForReal");i=i||{};TS.client.msg_pane.rebuildChannelMembersList();if(!i.channel_header){TS.client.msg_pane.displayTitle();TS.client.msg_pane.updateEndMarker()}if(!i.user_current_status)TS.view.members.updateUserCurrentStatus();TS.client.ui.did_rebuild_all_but_msgs_sig.dispatch();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_ui_rebuild_all_but_msgs","_rebuildAllButMsgsForReal")};var l=function e(){if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_rebuild");var i=false;var t=null;var n="rebuildAll";TS.metrics.mark("client_ui_rebuild_all");TS.client.ui.rebuildAllButMsgs(t,i);TS.client.msg_pane.rebuildMsgsWithReason(n,i);TS.client.ui.did_rebuild_all_sig.dispatch();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_ui_rebuild_all","_rebuildAllButMsgsForReal")};var d=function e(i){if(i!==TS.model.active_cid)return;if(TS.client.ui.isUnreadDividerInView())TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.sent);if(TS.model.overlay_is_showing)TS.view.overlay.cancelFromSendingMessage();if(TS.model.showing_welcome_2){TS.model.cancelled_welcome_2_this_session=true;TS.view.unAdjustForWelcomeSlideShow();TS.client.ui.instaScrollMsgsToBottom(true)}};var c=function e(i){var t=$(i).closest(".member_details");if(t.hasClass("cropped_preview")){t.removeClass("cropped_preview");TS.model.ui_state.expand_member_images_in_flexpane=true}else{t.addClass("cropped_preview");TS.model.ui_state.expand_member_images_in_flexpane=false}TS.storage.storeUIState(TS.model.ui_state);TS.view.resizeManually("TS.client.ui._displayMember")};var u=function e(i){if(TS.prefs.getPref("seen_single_emoji_msg"))return;if(!(TS.model.user.id===i.user))return;var t=TS.shared.getActiveModelOb();var n=i.text;if(!S(i))return;var a=n.match(/:/g)&&n.match(/:/g).length;if(a<2)return;var r=n.match(/^\s*(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)\s*$/);if(!r)return;var s=TS.emoji.isValidName(r[1]);if(!s)return;var o=TS.rxns.getRxnKeyByMsgType(i);if(!o)return;if(TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(o),s))return;if(t.is_slackbot_im)return;var l=TS.model.is_mac?"cmd":"ctrl";TS.client.ui.addEphemeralBotMsg({channel:t.id,ts:TS.interop.datetime.makeTsStamp(),text:TS.i18n.t("Hey! Looks like you just posted an emoji response. Did you know you can also react to messages directly with emojis? Click *Add reaction ...* on any message to try it. You can also type `+:emoji_name:` or `{cmd_key}+shift+\\` to react without leaving the comfort of your keyboard. Enjoy! :sparkles:","client")({cmd_key:l}),thread_ts:i.thread_ts});TS.prefs.setPrefLocal("seen_single_emoji_msg",true);TS.prefs.setPrefByAPI({name:"seen_single_emoji_msg",value:true})};var m=function e(i,t,n){t.text=TS.format.cleanInternalMsg(t.text);t.ts=t.ts||TS.interop.datetime.makeTsStamp();var a=TS.utility.msgs.processImsg(t,i);var r=TS.shared.getModelObById(i);var s=TS.shared.getControllerForModelOb(r);if(_.isFunction(s.addMsg))s.addMsg(i,a);if(TS.useReactMessages()&&!t.thread_ts)return t.ts;var o={c_id:i,ephemeral_type:n};if(t.thread_ts)o.thread_ts=t.thread_ts;TS.utility.msgs.ephemeral_msgs_map[t.ts]=o;return t.ts};var f=function e(i){var t=TS.model.mac_ssb_version||TS.model.win_ssb_version&&TS.model.is_mac;var n=TS.model.win_ssb_version&&TS.model.is_win||TS.model.lin_ssb_version&&TS.model.is_lin;var a=TS.model.win_ssb_version&&TS.model.win_ssb_version>2||2===TS.model.win_ssb_version&&TS.model.win_ssb_version_minor>=4;var r=TS.model.lin_ssb_version&&TS.model.lin_ssb_version>2||2===TS.model.lin_ssb_version&&TS.model.lin_ssb_version_minor>=4;var s=TS.model.mac_ssb_version||a||r;var o=i.metaKey&&!i.shiftKey&&!i.altKey;var l=!i.metaKey&&!i.shiftKey&&i.altKey;var d=TS.utility.keymap;var c=i.which==d.left_square_bracket||i.which==d.right_square_bracket;var _=i.which==d.left||i.which==d.right;var u=o&&_;if(t&&!s&&o&&c)h(i.which,d.left_square_bracket,d.right_square_bracket,u,i);else if(n&&!s&&l&&_)h(i.which,d.left,d.right,u,i);else if(o&&_)h(i.which,d.left,d.right,u,i);else if(o&&c)TS.clog.track("HISTORY_NAV_ACTION",{trigger:"keyboard_shortcut",action:"nav_prev_next"})};var h=function e(i,t,n,a,r){var s=TS.utility.contenteditable.isEmpty(document.activeElement);if(TS.utility.isFocusOnInput()&&(s||!a)||document.activeElement==document.body){TS.clog.track("HISTORY_NAV_ACTION",{trigger:"keyboard_shortcut",action:"nav_prev_next"});if(i===t)window.history.go(-1);else if(i===n)window.history.go(1);if(r)r.preventDefault()}};var g=function e(){TS.model.client.last_user_active_timestamp=new Date};var p=function e(i){if(i.id!=TS.model.active_cid)return;TS.client.msg_pane.displayTitle();TS.client.msg_pane.rebuildChannelMembersList()};var S=function e(i){return i&&!TS.utility.msgs.isTempMsg(i)&&!i.is_ephemeral};var T=function e(i,t){t.unbind();if("file_list"===i||"file_preview"===i)t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Files","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("files");if(TS.model.ui_state.flex_extra)TS.client.ui.files.previewFile(TS.model.ui_state.flex_extra)});else if("search_results"===i)t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Search Results","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("search")});else if("im_page"===i)t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Conversation Details","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")});else if("groups"===i)t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("User Groups","client")()).bind("click.back",function(){TS.client.ui.showGroupsList()});else t.html(TS.templates.builders.filePreviewBackIcon()+(TS.boot_data.page_needs_enterprise?TS.i18n.t("Organization Directory","client")():TS.i18n.t("Workspace Directory","client")())).bind("click.back",function(){TS.client.ui.showTeamList()})};var v=function e(i){k(i)};var b=function e(i){k(i)};var w=function e(i){k(i)};var y=function e(i){k(i)};var A=function e(i){k(i)};var k=function e(i){var t=$("."+TS.templates.makeSHRoomClass(i.id));if(!t.length)return;t.replaceWith(TS.templates.builders.buildSHRoomAttachment(i))};var C=function e(){if("team"===TS.model.ui.active_tab_id&&TS.model.previewed_member_id)TS.client.ui._displayMember(TS.model.previewed_member_id)};var M;var I=null;var x=function e(){TS.shared.onDisplayEmailAddressesPrefChanged()};var E=function e(i){var t=i.map(function(e){return TS.members.getPrefCompliantMemberName(TS.members.getPotentiallyUnknownMemberById(e),true)});return TS.i18n.listify(t,{strong:true}).join("")};var B=function i(t,n){var a=$("#member_preview_container");var r=TS.model.previewed_member_id===t.id&&!a.find(".cropped_preview").length||"menu_member_header"===n||TS.model.ui_state.expand_member_images_in_flexpane;TS.model.previewed_member_name=t.name;TS.model.previewed_member_id=t.id;TS.info("TS.model.previewed_member_id:"+TS.model.previewed_member_id);var s;var o=t.is_bot&&TS.model.user.is_admin;var l;if(o){l="/services/"+t.profile.bot_id;l=TS.bots.configureUrl(t)}var d={member:t,show_bot_configuration:o,hide_more_menu:false,bot_configure_url:l,show_call_action:TS.utility.calls.isEnabled()&&!t.is_bot&&"USLACKBOT"!==t.id,team_name:TS.model.team.name,show_admin_info:t.is_admin&&t.team_id===TS.model.user.team_id,lazy_load_profile_fields:true,lazy_load_shared_teams:true};e.clear();e.add(t.id);if(TS.boot_data.page_needs_enterprise){var _=TS.model.team;if(_&&_.id!==t.team_id)d.show_call_action=false;if(!t.is_self){d.shared_teams=TS.teams.getSharedTeamsForMember(t);TS.teams.ensureSharedTeamsForMember(t).then(function(){U(t)})}}s=TS.templates.team_member_preview(d);$("#user_group_preview_container").hideWithRememberedScrollTop();$("#team_list_container").hideWithRememberedScrollTop();a.unhideWithRememberedScrollTop();var u=$("#member_preview_scroller");u.html(s);TS.utility.makeSureAllLinksHaveTargets(u);if(t.deleted)$("#member_deleted_view_archives_btn").removeClass("hidden");if(TS.model.last_previewed_member_id!=TS.model.previewed_member_id){var m=$("#member_preview_scroller");if(m.length)m.get(0).scrollTop=0}TS.model.last_previewed_member_id=t.id;var f=$("#back_from_member_preview");T(n,f);TS.view.resizeManually("TS.client.ui._displayMember");u.find(".member_details .member_image").click(function(){c(this);TS.clog.track("USER_PROFILE_CLICK");return false});u.find(".member_preview_menu_target").click(function(e){TS.menu.member.startWithMemberPreview(e,t.id,false,true)});if(r)c(a.find(".member_image"));if(t.is_self)TS.client.ui.flex.registerCurrentStatusInput();TS.members.fetchMemberObjectsForUserProfileFields(t).then(function(){if(t.is_restricted||t.is_external&&!t.is_stranger){var e=t.is_restricted?["channels"]:["shared_channels"];return TS.members.fetchMemberProfileExtras(t.id,e)}return Promise.resolve()}).then(function(e){var i=e&&e.shared_channels;var n=e&&e.channels;P(t,i,n)})};var P=function e(i,t,n){if(TS.model.previewed_member_id===i.id){var a=TS.team.getVisibleTeamProfileFieldsForMember(i);$("#member_data_table_team_fields").html(TS.templates.team_profile_fields({fields:a}));if(i.is_restricted)$("#member_data_table_guest_fields").html(TS.templates.guest_profile_fields({member:i,guest_channels:n}));if(i.is_external&&!i.is_stranger)$("#member_data_table_shared_channels").html(TS.templates.shared_channels_profile_field({shared_channels:t}))}};var D=function e(i){return{shared_teams:TS.teams.getSharedTeamsForMember(i)}};var U=function e(i){if(TS.model.previewed_member_id!==i.id)return;$("#member_data_table_shared_teams").html(TS.templates.member_shared_teams(D(i)))};var F=function e(i,t){var n="–";var a=i?TS.i18n.number(t,"client"):n;$("#channel_members_toggle_count_count").text(a);$("#channel_members_toggle_count").removeClass("hidden")};var O=function e(i,t,n){t=i?TS.i18n.number(t,"client"):"–";var a=_(n.members).map(TS.members.getMemberById).compact().filter(TS.utility.teams.isMemberExternal).value().length;var r=TS.teams.getTeamNameById(n.shared_team_ids[0]);var s=t+" ("+TS.i18n.number(a,"client")+TS.i18n.t(" from ","client")()+r+")";$("#channel_members_toggle_count_count").text(s);$("#channel_members_toggle_count").removeClass("hidden")};var R=58;var N=82;var H=142;var Q=888;var L=function e(){var i=$("#presence");if(1==i.css("opacity"))i.css("opacity",.98);else i.css("opacity",1)};var G=function e(i){if(!i||!i.length||!i.is("ts-message"))return i;var t=i.find(".comment");if(t.length)return t;var n=i.find(".message_body");if(n.length)return n;return i};var j=function e(i,t,n){if(!i||!i.length||!n)return null;t=t||0;var a=i.dimensions_rect();if(n.top>a.top-t)return"above";if(n.bottom<a.bottom+t)return"below";return"within"};var K=function e(){var i=$('<div tabindex="0"></div>');$("body").prepend(i);i.on("focus",TS.view.focusMessageInput);i.on("blur",function(){i.remove()})};var W=function e(){var i=TS.model.user;if("away"!==i.manual_presence)return;if(TS.model.ui.is_window_focused)V();else TS.ui.window_focus_changed_sig.addOnce(V)};var V=function e(){if(!TS.prefs.getPref("confirm_user_marked_away"))return;var i=TS.model.user;var t='<p class="no_bottom_margin float_right"><label class="checkbox overlay_pref block"><input id="confirm_user_marked_away" type="checkbox" /> '+TS.i18n.t("Don’t ask me again, please","client")()+"</label><p>";setTimeout(function(){if("away"!==i.manual_presence)return;TS.generic_dialog.start({unique:"set_active_prompt",title:TS.i18n.t('You are marked as "away"',"client")(),body:"<p>"+TS.i18n.t("Would you like to switch to appear active?","client")()+"</p>"+t,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, set me to active","client")(),go_button_class:"btn_success",cancel_button_text:TS.i18n.t("No, still away","client")(),onGo:function e(){if("away"===i.manual_presence)TS.redux.presence.toggleUserPresence();var t=!!$("#confirm_user_marked_away").prop("checked");if(t)TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:false})},onCancel:function e(){var i=!!$("#confirm_user_marked_away").prop("checked");if(i)TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:false})}})},2e3)};var q=function e(){var i=3e5;var t=void 0;TS.redux.socket.disconnectedSig.add(function(){t=Date.now()});TS.redux.socket.connectedSig.add(function(e){if(e)return;if(t){var n=Date.now()-t;if(n<i)return}W()})}})()},4925:function(e,i){(function(){TS.registerModule("client.ui.files",{$file_btn:null,onStart:function e(){TS.files.team_file_comment_added_sig.add(TS.client.ui.files.teamFileCommentAdded);TS.files.team_file_comment_edited_sig.add(TS.client.ui.files.teamFileCommentEdited);TS.files.team_file_comment_deleted_sig.add(TS.client.ui.files.teamFileCommentDeleted);TS.files.team_file_changed_sig.add(TS.client.ui.files.teamFileChanged);TS.files.team_file_deleted_sig.add(TS.client.ui.files.teamFileDeleted);TS.view.members.unknown_resolution_rebuild_sig.add(TS.client.ui.files.memberChanged);function i(){TS.client.ui.files.bindUploadUI();TS.client.ui.files.bindFileUI();if(TS.useReactMessages())TS.files.media.bindVideoElements({container:".p-history_container",onError:p});else TS.files.media.bindVideoElements({container:"#msgs_div",onError:p})}if(TS.has_pri[82])TS.log(82,"deferring UI bind until login_sig");TS.client.login_sig.add(i)},preview_file_waiting_on:null,showFilesFromHistory:function e(i,t){if(!i){TS.client.ui.files._displayFileList();TS.client.flexDisplaySwitched("files",null,false,true);return}if(TS.boot_data.feature_deprecate_files){var n;if(TS.interop.utility.looksLikeMemberId(i))n=TS.members.ensureMembersArePresent([i]);else if("all"===i)n=Promise.resolve();if(n){n.then(function(){if(t){TS.client.ui.files.filterFileList(t);TS.view.files.setButtonState(t)}TS.client.ui.files.toggleFileList(i);TS.client.ui.files._displayFileList();TS.client.flexDisplaySwitched("files",null,false,true)});return}}var a=TS.files.getFileById(i);if(a){TS.client.ui.files._displayFile(a.ob_id);TS.client.flexDisplaySwitched("files",a.ob_id,false,true);TS.files.fetchFileInfo(i)}else{TS.client.ui.files.preview_file_waiting_on=i;TS.files.fetchFileInfo(i,function(e,i){if(e!=TS.client.ui.files.preview_file_waiting_on)return;TS.client.ui.files.preview_file_waiting_on=null;if(i){TS.client.ui.files._displayFile(i.id);TS.client.flexDisplaySwitched("files",i.id,false,true)}else{TS.client.ui.files._displayFileList();TS.client.flexDisplaySwitched("files",null,true)}})}},_displayFile:function t(n,s,o){var l=TS.files.getFileById(n);if(!l)return false;if(!TS.client.ui.flex._displayFlexTab("files"))return false;if(TS.boot_data.feature_file_threads){e=s;i=o}else TS.client.ui.files._rebuildBackFromFilePreview(s);TS.model.previewed_file_id=n;TS.view.files.hideList();$("#file_list_container").hideWithRememberedScrollTop();if(TS.boot_data.feature_share_mention_comment_cleanup)if(o)r(l,o);else a(l);else{$("#file_preview_container").unhideWithRememberedScrollTop();TS.client.ui.files.rebuildFilePreview(l);$("#file_preview_scroller").scrollTop(0)}$("#file_comment_form").css("visibility","");if(TS.files.isFileAuthorExternal(l)){$(".p-external_file_author_notice").removeClass("hidden");$("#file_comment_form").addClass("hidden")}else{$(".p-external_file_author_notice").addClass("hidden");$("#file_comment_form").removeClass("hidden")}TS.view.resizeManually("TS.client.ui.files._displayFileList");return true},_displayFileList:function e(){if(!TS.client.ui.flex._displayFlexTab("files",true))return false;TS.model.previewed_file_id="";$("#file_preview_container").hideWithRememberedScrollTop();$("#file_list_container").unhideWithRememberedScrollTop();TS.view.files.unHideList();TS.view.resizeManually("TS.client.ui.files._displayFileList");return true},rebuildFilePreview:function n(a){var r;if(a.user&&"USLACKBOT"===a.user&&a.bot_id){r=TS.bots.getBotById(a.bot_id);r.is_bot=true;r.is_service=true}else r=TS.members.getPotentiallyUnknownMemberById(a.user);var o=TS.files.getFileActions(a);o.file=a;o.member=r;o.user=TS.model.user;o.show_open_public_link=!TS.prefs.getTeamPref("disallow_public_file_urls");o.show_revoke_public_link=!TS.prefs.getTeamPref("disallow_public_file_urls")&&o.revoke_public_link;if(TS.boot_data.feature_file_threads){var l=g(a,e,i);var c=TS.shared.getModelObById(l);o.model_ob=c}if("email"===a.mode){o.to_more_count=a.to.length-1;o.cc_more_count=a.cc.length-1}if(a&&a.id)if("snippet"===a.mode||"post"===a.mode||"space"===a.mode)if(!a.content&&!a.content_html&&!a.content_highlight_html)TS.files.fetchFileInfo(a.id);$.extend(o,TS.files.getFileTemplateArguments(a));var _=$("#file_preview_scroller").find("#file_preview_head_section");if(o.video_height)o.video_height=TS.model.native_video_embed_height_flexpane;var u=TS.templates.file_preview_title(o);var m=TS.templates.file_preview_file(o);var f=TS.templates.file_preview_meta(o);var p=false;if(TS.files.fileIsHostedSupportedMedia(a)&&a.id===TS.model.previewed_file_id){var S;if(TS.files.fileIsSupportedAudio(a))S=_.find("audio");else if(TS.files.fileIsSupportedVideo(a))S=_.find("video");if(S.length){var T=S[0];var v=!T.paused;var b=0===T.currentTime;var w=T.currentTime===T.duration;if(v||!b&&!w)p=true}}if(p){_.find(".file_preview_title").replaceWith(u);_.find(".file_preview_meta").replaceWith(f)}else{var y=u+m+f;_.html(y)}TS.utility.makeSureAllLinksHaveTargets(_);if(TS.files.fileIsImage(a))_.find(".image_container .image_bg img").error(function(){$(this).closest(".image_body").addClass("broken_image")});else if(TS.files.fileIsSupportedVideo(a))TS.files.media.bindVideoElements({container:_,onError:function e(i){i.addClass("hidden")}});else if("space"===a.mode)TS.utility.attachments.unfurlPlaceholders(_);o={file:a};var A=$("#file_preview_scroller").find("#file_preview_comments_section");A.html(TS.templates.comments(o));TS.utility.makeSureAllLinksHaveTargets(A);if(TS.boot_data.feature_file_threads){d(a.id);h(a)}else if(a.id!=TS.model.last_previewed_file_id){var k=TS.storage.fetchLastCommentInput(a.id);if(k)TS.utility.contenteditable.value($("#file_comment_form #file_comment"),k);else TS.utility.contenteditable.clear($("#file_comment_form #file_comment"));TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment"))}if("email"===a.mode);TS.model.last_previewed_file_id=a.id;if(a.content&&"snippet"===a.mode){$("#truncated_message").addClass("hidden");var C=!!t;var M=$("#snippet_wrap");var I=$('#flex_contents .snippet_container[data-file-id="'+a.id+'"]');M.bind("change",function(){t=$(this).prop("checked");if(t)I.addClass("snippet_wrap");else I.removeClass("snippet_wrap")});if(C){M.prop("checked","checked");I.addClass("snippet_wrap")}}TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"));if(!TS.boot_data.feature_file_threads)s(a);if(TS.utility.contenteditable.hasFocus($("#file_comment"))||TS.utility.contenteditable.isActiveElement($("#file_comment")))$("#file_comment_submit_btn").scrollintoview({offset:"bottom",px_offset:-50,duration:0})},cleanFilePreview:function t(){$("#file_preview_head_section").empty();$("#file_preview_comments_section").empty();if(TS.boot_data.feature_file_threads){e=null;i=null}},_rebuildBackFromFilePreview:function e(i){var t=$("#back_from_file_preview");t.unbind();var n;if("member_preview"===i){n=TS.i18n.t("Member","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.client.ui.previewMember(TS.model.last_previewed_member_id)})}else if("starred_items"===i){n=TS.i18n.t("Starred Items","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("stars")})}else if("search_results"===i){n=TS.i18n.t("Search Results","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.search.view.showResults();TS.search.view.maybeRebuildResults()})}else if("channel_page"===i){n=TS.i18n.t("Channel Details","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")});t.data("origin",i)}else if("group_page"===i){n=TS.i18n.t("Channel Info","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")})}else if("im_page"===i){n=TS.i18n.t("Conversation Details","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")})}else{n=TS.i18n.t("Files","files")();t.html(TS.templates.builders.filePreviewBackIcon()+" "+n);t.bind("click.back",function(){TS.client.ui.files.showFileList();TS.client.flex_pane.maybeFetchFileList()})}t.data("origin",i)},previewFile:function e(i,t,n,a,r){var s=TS.files.getFileById(i);if(TS.model.ui_state.flex_visible&&TS.model.previewed_file_id===i&&!$("#file_preview_scroller").is(":hidden"))$("#file_preview_scroller").highlight(1500,"flex_highlight",false,0);if(!s){TS.client.ui.files.preview_file_waiting_on=i;TS.files.fetchFileInfo(i,function(e,i){if(e!=TS.client.ui.files.preview_file_waiting_on)return;TS.client.ui.files.preview_file_waiting_on=null;if(i)TS.client.ui.files.previewFile(i.id,t,true,r);else TS.generic_dialog.alert(TS.i18n.t("This file can’t be found.","files")(),TS.i18n.t("Sorry, that didn’t work","files")())});return}if(!TS.client.ui.files._displayFile(i,t,r))return;TS.client.flexDisplaySwitched("files",i);if(a)TS.utility.contenteditable.focus($("#file_comment"));if(!n)TS.files.fetchFileInfo(i)},teamFileCommentAdded:function e(i,t){if(n(i))TS.client.ui.files.appendFileComment(i,t);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(i)},teamFileCommentEdited:function e(i,t){if(n(i))TS.client.ui.files.updateFileComment(i,t);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(i)},teamFileCommentDeleted:function e(i,t){if(n(i))TS.ui.comments.removeFileComment(i,t,function(){if(TS.boot_data.feature_file_threads)h(i);TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))});if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(i)},teamFileChanged:function e(i){if("files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==i.id)TS.client.ui.files.rebuildFilePreview(i);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(i)},teamFileDeleted:function e(i){if("files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==i.id)TS.client.ui.files.showFileList();if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(i)},memberChanged:function e(i){var t=TS.files.getFileById(TS.model.previewed_file_id);if(!t||!n(t)||!i.id)return;_(t.comments).filter({user:i.id}).map(_.partial(TS.client.ui.files.updateFileComment,t)).value()},storeLastCommentInputForPreviewedFile:function e(i){if(!TS.model.previewed_file_id)return;TS.storage.storeLastCommentInput(TS.model.previewed_file_id,i)},bindFileUI:function e(){$("#file_list_heading").bind("click.show_menu",function(e){e.preventDefault();TS.menu.file.startWithFileFilter(e)});$("#file_list_clear_filter").bind("click.clear_filter",function(e){e.stopPropagation();TS.view.files.clearFilter()});$("#file_list_toggle_all").bind("click.toggleList",function(){TS.client.ui.files.toggleFileList("all")});$("#file_list_toggle_user").bind("click.toggleList",function(e){if(e.isDefaultPrevented())return;var i=$("#file_list").data("filter-user");if(i)TS.client.ui.files.toggleFileList(i);else TS.client.ui.files.toggleFileList(TS.model.user.id)});$("#file_list_toggle_users").bind("click.show_menu",function(e){e.preventDefault();TS.menu.file.startWithFileMemberPromiseFilter(e)})},showFileList:function e(){if(!TS.client.ui.files._displayFileList())return;$("#search_tabs").hide();TS.client.flexDisplaySwitched("files")},filterFileList:function e(i){if("all"===i){TS.model.active_file_list_filter=i;TS.view.files.clearFilter()}else if("user"===i){TS.view.files.clearFilter();TS.client.ui.files.toggleFileList(TS.model.user.id)}else if(TS.interop.utility.looksLikeMemberId(i))TS.client.ui.files.toggleFileList(i);else{TS.model.active_file_list_filter=i;TS.view.file_list_heading=TS.model.file_list_type_map[i];TS.model.file_list_types=[i];TS.view.files.filterSet();$("#file_list_clear_filter").removeClass("hidden")}},toggleFileList:function e(i){var t="all"===i;var n=!t&&TS.members.getMemberById(i);if(!t&&!n){TS.error(i+" is not valid?");return}var a=$("#file_list");if(a.data("list")==i)return;a.data("list",i);var r=TS.i18n.t("Just You","files")();var s=["all","user"];var o=t?"all":"user";s.forEach(function(e){var i=e==o;var t=$("#file_list_toggle_"+e);if(i)t.addClass("active");else t.removeClass("active");t.find(".tab").attr("aria-selected",i)});var l=s.reduce(function(e,i){if(e)return e;if(i===o)return"file_list_toggle_"+i;return null},null);$("#file_list_scroller").attr("aria-labelledby",l);var d=function(){if(t)return r;if(n){if(n.id==TS.model.user.id)return r;return TS.members.getPrefCompliantMemberName(n)}}();$("#file_list_toggle_user .tab_label").text(d);TS.model.active_file_list_member_filter=i;var c=function(){if(t)return TS.model.user.id;if(n)return i}();a.data("filter-user",c);var _=$("#file_list_toggle_users");if(t)_.removeClass("active");else _.addClass("active");TS.view.files.filterSet()},submitFileComment:function e(i){var t=$("#file_comment_form #file_comment");var n=TS.utility.contenteditable.value(t);n=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(n,{complete_member_specials:false});var a=TS.format.cleanMsg(n);if(!$.trim(a)){TS.sounds.play("beep");return}var r=TS.model.previewed_file_id;var s=t.closest("[data-model-ob-id]").attr("data-model-ob-id");if(TS.ui.fs_modal_file_viewer.is_showing)r=TS.ui.fs_modal_file_viewer.getCurrentFileId();var o=TS.files.getFileById(r);if(!o){TS.error("no file to submit comment");return}var l=TS.ui.needToBlockAtChannelKeyword(n,o);if(l){TS.generic_dialog.alert(TS.i18n.t("<p>A Team Owner has restricted the use of <strong>{keyword}</strong> messages.</p>","files")({keyword:_.escape(l)}));return}if(!i){var d=o.channels.concat(o.groups);var c=d.filter(function(e){return TS.ui.needToShowAtChannelWarning(e,n)});if(c.length>0){TS.ui.at_channel_warning_dialog.startInFlexPane(o,c,n);return}}TS.utility.contenteditable.clear($("#file_comment_form #file_comment"));TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment"));if(TS.ui.fs_modal_file_viewer.is_showing&&$("#file_comment").closest("#fs_modal").length)TS.clog.track("FILE_FULLSCREEN_COMMENT_ADD",{});TS.files.addComment(r,a,s,function(e,i,t){if(e){TS.storage.storeLastCommentInput(t.file,"");TS.utility.contenteditable.clogMentionCounts(n)}else{alert("error: comment not added to file");if(t.file==TS.model.last_previewed_file_id)TS.utility.contenteditable.value($("#file_comment_form #file_comment"),TS.storage.fetchLastCommentInput(t.file))}})},rebuildFilePreviewAndCommentsIncludingMember:function e(i){var t={member:i,for_message:true};$("#col_flex .message_current_status.color_"+i.id).replaceWith(TS.templates.current_status(t))},appendFileComment:function e(i,t){var n=$(".file_comments_"+i.id);var a=TS.members.getPotentiallyUnknownMemberById(t.user);n.append(TS.templates.builders.buildCommentHTML({file:i,comment:t,show_comment_actions:true,member:a}));TS.utility.makeSureAllLinksHaveTargets(n);if(t.user==TS.model.user.id){var r;if(TS.boot_data.feature_file_threads)r=$("#file_reply_container");else r=$(".file_comment_submit_btn");r.scrollintoview({offset:"bottom",px_offset:-50,duration:0})}if(TS.boot_data.feature_file_threads)h(i);var s;if(TS.boot_data.feature_share_mention_comment_cleanup)s=$(".file_comments_scroller");else s=$("#file_preview_scroller");TS.ui.utility.updateClosestMonkeyScroller(s)},updateFileComment:function e(i,t){var n=TS.members.getPotentiallyUnknownMemberById(t.user);var a=$('.comment[data-comment-id="'+t.id+'"]');if(!a.length)return;a.replaceWith(TS.templates.builders.buildCommentHTML({file:i,comment:t,show_comment_actions:true,member:n}));a.each(function(){TS.utility.makeSureAllLinksHaveTargets($(this))});TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))},validateFiles:function e(i,t,n){if(!i)return;t=!!t;var a=[];var r=0;var s=0;var o=false;var l=false;var d={};var c=[];function u(e){s=Math.max(0,s+e)}function m(){a=[];s=0;r=0;o=false;l=false}if(!TS.client.ui.resetFiles)TS.client.ui.resetFiles=m;function f(){if(!o)if(a.length){o=true;TS.client.ui.file_dropped_sig.dispatch(a,t)}}function h(){if(l)return false;if(r>0&&(a.length>=s||s<=0)){l=true;if(c.length)v(i,function(){if(n)n(a,f);else f()});else if(n)n(a,f);else f()}}function g(e){a.push(e)}function p(e){e.onerror=null;e.onload=null;return null}function S(e,i){var t;var n;n={isFile:null,isDirectory:null};if(e.size<16384&&window.FileReader){t=new FileReader;t.onload=function(e){t=p(e.currentTarget);n.isFile=true;i(n)};t.onerror=function(e){t=p(e.currentTarget);n.isDirectory=true;i(n)};try{t.readAsDataURL(e)}catch(e){t=p(t);n.isDirectory=true;i(n)}}else i(n)}function T(e,i,t){var n;var a;var r;var s;var o;a=false;o=e.name||i.name;if(!o)return false;r=o.lastIndexOf(".");if(-1!==r)s=o.substr(r);if(s)n=d[s]&&d[s].enabled?d[s]:null;if(i&&(i.isFile||i.isDirectory)){if(i.isDirectory||i.isFile&&n&&n.applyToFile){a=true;return t(a)}a=false;return t(a)}S(e,function(e){if(e.isDirectory)a=true;else if(n&&n.applyToFile)a=true;return t(a)})}function v(e,i){var t;var n;var a;var s;var o;var l;var d;var u;var m;if(c.length){a=[];d="";m="";for(t=0,n=c.length;t<n;t+=1)a.push("<li><strong>"+_.escape(c[t].name)+"</strong></li>");if(c.length>1){o=c.length===r?TS.i18n.t("All files unsupported","files")():TS.i18n.t("Some files unsupported","files")();d="<ul>"+a.join("\n")+"</ul>"}else if(1===c.length)o=TS.i18n.t("File unsupported","files")();s=r-c.length;if(c.length>1)u=TS.i18n.t("<p>Try uploading a .zip version of these files instead.","files")();else if(1===c.length)u=TS.i18n.t("<p>Try uploading a .zip version of this file instead.","files")();if(s>1)m=TS.i18n.t("<p>(Don’t worry, your other files are next.)</p>","files")();else if(1===s)m=TS.i18n.t("<p>(Don’t worry, your other file is next.)</p>","files")();if(1===c.length)l=TS.i18n.t("<p>Sorry, <strong>{excluded_file}</strong> is a type of file not supported by Slack</p>","files")({excluded_file:_.escape(c[0].name)});else if(c.length===r)l=TS.i18n.t("<p>Sorry, none of those file types are supported by Slack.</p>","files")();else l=TS.i18n.t("<p>Sorry, some of those file types are not supported by Slack.</p>","files")();TS.generic_dialog.start({title:o,body:l+d+u+m,show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();if(i)i()}})}return c.length}function b(e){r=e.length;u(e.length);var i;var t;var n;var a;for(var s=0;s<e.length;s+=1){i=e[s];n=i;a=i;if(i.isFile||i.isDirectory){t=i;a=i}if(i.getAsEntry){t=i.getAsEntry();a=t}else if(i.webkitGetAsEntry){t=i.webkitGetAsEntry();a=t}if("function"===typeof i.getAsFile)n=i.getAsFile();else if(File&&i instanceof File)n=i;if(!a||!n)u(-1);(function(e,i){T(e,i,function(t){if(t){if(i.name)c.push(i);else c.push(e);u(-1);h()}else{if(0===e.size)u(-1);else g(e);h()}})})(n,a)}}b(i);h()},bindUploadUI:function e(){if(!TS.client.ui.files.$upload)TS.client.ui.files.$upload=$("#file_upload");$(".file_upload_btn").bind("click.file_menu",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.file.startWithNewFileOptions(e,$(this));return false});TS.client.ui.files.$upload.bind("change",function(){if(window.desktop&&desktop.app&&desktop.app.focusWebView)desktop.app.focusWebView();if(!$(this).val())return;var e=$(this)[0].files;if(e){if(!e.length)return;TS.view.filesSelected(e);TS.client.ui.files.$upload.val("")}});$("body").bind("drop",function(e){var i;var t;window.focus();e.preventDefault();$("body").removeClass("drop-target");if(TS.boot_data.feature_take_profile_photo)if($("body").find("#edit_member_profile_container").length>0){t=e.originalEvent.dataTransfer;if(t)i=t.files||t.items;if(!i)return;TS.ui.edit_member_profile.handleDrop(i);return}if(TS.client.ui.checkForEditing(e))return;t=e.originalEvent.dataTransfer;if(!t)return;i=t.files||t.items;var n=t.getData("text/uri-list");if(!i.length&&!n)return;if("disable_all"===TS.prefs.getTeamPref("disable_file_uploads")){TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});return}var a=e&&e.shiftKey;var r=TS.shared.getActiveModelOb();if(r&&r.is_general&&!TS.permissions.members.canPostInGeneral(TS.model.user)){TS.generic_dialog.start({title:TS.i18n.t("Can’t share in #{channel_name}","files")({channel_name:r.name}),body:TS.i18n.t("To keep things tidy, your Workspace Owners have set limits on sharing files and sending messages in #<strong>{channel_name}</strong>.","files")({channel_name:r.name}),show_cancel_button:false,go_button_text:TS.i18n.t("OK","files")()});return false}if(r&&TS.shared.isModelObOrgShared(r)&&!TS.permissions.members.canPostInChannel(r)){TS.generic_dialog.start({title:TS.i18n.t('Cannot Post To #{channel_name}<ts-icon class="ts_icon_org_shared_channel"></ts-icon>',"files")({channel_name:r.name}),body:TS.i18n.t('An Owner of your workspace has limited who can post to <strong>#{channel_name}<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>. Nothing personal! You can share your file in another channel.',"files")({channel_name:r.name}),show_cancel_button:false,go_button_text:TS.i18n.t("Okay!","files")()});return false}if(TS.model.archive_view_is_showing&&TS.client.archives.getCurrentModelOb().is_archived)a=false;var s=!i.length&&window.desktop&&desktop.app&&"function"===typeof desktop.downloads.startTempDownload;if(TS.boot_data.feature_browser_dragndrop&&s){i=[];TS.files.file_uploading_sig.dispatch("dragged file...",false,false);var o=desktop.downloads.startTempDownload(n);o.then(function(e){var t=e.bits;var n=e.mimeType;var r=e.fileName;var s=new Blob([t],{type:n});var o=new File([s],r,{type:n});i.push(o);TS.files.file_queue_emptied_sig.dispatch();TS.client.ui.files.validateFiles(i,a)},function(){TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Verify your URL contains a valid file.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});TS.files.file_queue_emptied_sig.dispatch()});return}if(!i)return;TS.client.ui.files.validateFiles(i,a)});$("#drop-zone").unbind("click.dismiss").bind("click.dismiss",function(){$("body").removeClass("drop-target")});$(window).draghover().on({draghoverstart:function e(i,t,n){if(window.winssb)TS.info("draghoverstart winssb_file:"+n);if(TS.model.ui.is_mouse_down)return;var a=false;if(t&&t.originalEvent&&t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.types){var r=t.originalEvent.dataTransfer.types;for(var s=0;s<r.length;s+=1){var o="text/uri-list"===r[s].toLowerCase()&&TS.boot_data.feature_browser_dragndrop&&window.desktop&&desktop.app&&"function"===typeof desktop.downloads.startTempDownload;if("files"===r[s].toLowerCase()||o){a=true;break}}}if(!a)a=!!n;if(!a)return;if(TS.boot_data.feature_take_profile_photo)if($("body").find("#edit_member_profile_container").length>0){$("body").addClass("drop-target");TS.ui.edit_member_profile.handleDrag(true);return}if($("body").hasClass("file_snippet"))return;if("disable_all"===TS.prefs.getTeamPref("disable_file_uploads"))return;if(TS.msg_edit.editing)return false;var l=TS.shared.getActiveModelOb();if(l&&TS.channels.isChannelRequired(l)&&!TS.permissions.members.canPostInChannel(l))return false;$("body").addClass("drop-target");if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.deactivate()},draghoverend:function e(){$("body").removeClass("drop-target");if(TS.boot_data.feature_take_profile_photo)if($("body").find("#edit_member_profile_container").length>0){TS.ui.edit_member_profile.handleDrag(false);return}if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.activate()}})}});var e=null;var i=null;var t=true;Object.defineProperty(TS.client.ui.files,"$file_btn",{get:function e(){delete TS.client.ui.files.$file_btn;TS.client.ui.files.$file_btn=$("#primary_file_button");return TS.client.ui.files.$file_btn}});var n=function e(i){var t="files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==i.id;var n=i.id===TS.ui.fs_modal_file_viewer.getCurrentFileId();return t||n};var a=function e(i){$(".file_comments_container").hideWithRememberedScrollTop();$(".file_details_container").unhideWithRememberedScrollTop();o(i);$(".file_details_scroller").scrollTop(0)};var r=function e(i,t){$(".file_details_container").hideWithRememberedScrollTop();$(".file_comments_container").unhideWithRememberedScrollTop();l(i,t);$(".file_comments_scroller").scrollTop(0)};var s=function e(i){$(".file_comment_tip").html(TS.templates.builders.makeFileCommentHelpHTML(i))};var o=function e(i){var t=$.extend(TS.files.getFileDetailsMetaTemplateArguments(i),TS.files.getFileTemplateArguments(i));if(t.video_height)t.video_height=TS.model.native_video_embed_height_flexpane;var n=TS.templates.file_details_meta(t);var a=$(".file_details_scroller").find(".file_details_meta");a.html(n);TS.utility.makeSureAllLinksHaveTargets(a);if("space"===i.mode)TS.utility.attachments.unfurlPlaceholders(a);TS.files.createFileCommentsGroup(i);var r=TS.templates.file_details_share_to(i);var s=$(".file_details_scroller").find(".file_details_share_to");s.html(r);TS.utility.makeSureAllLinksHaveTargets(s);TS.model.last_previewed_file_id=i.id;TS.ui.utility.updateClosestMonkeyScroller($(".file_details_scroller"))};var l=function e(i,t){TS.files.createFileCommentsGroup(i);var n=jQuery.extend(true,{},i);var a=n._comments_grouped[t];n.comments=a.comments;var r={file:n,comment_group:a,c_id:t};$.extend(r,TS.files.getFileTemplateArguments(i));var s=$(".file_comments_scroller");var o=TS.templates.file_comments(r);var l=s.find(".file_comments");l.html(o);$(".back_from_file_comments").attr("data-file-id",n.id);s.attr("data-model-ob-id",t);var d=s.data("monkeyScroll");if(d)d.updateFunc()};var d=function e(i){var t=$("#file_reply_container");t.empty();t.append(TS.ui.replies.getReplyInputAvatarHTML());TS.ui.inline_msg_input.make(t,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:false,complete_cmds:true,in_thread:true,onSubmit:function e(t,n){if(!TS.redux.socket.isConnected())return;if(TS.utility.msgs.shouldSendSlashCommand(n));else{m("");TS.files.addComment(i,n,null,function(e){if(e){TS.storage.storeLastCommentInput(i,"");TS.utility.contenteditable.clogMentionCounts(n)}else u(n)})}},getMsgDivForEditing:function e(){},onTextChange:function e(n){var a=TS.ui.replies.getReplyInputValueForStorage(n);TS.storage.storeLastCommentInput(i,a);var r=$("#file_preview_scroller")[0];TS.ui.replies.maybeScrollReplyInputToBottomOfScroller(r);TS.ui.replies.checkReplyInputLengthAndUpdate(t)}});TS.ui.replies.bindReplyInputFocusEvents(t);c(i,t);var n=TS.storage.fetchLastCommentInput(i);if(n)u(n)};var c=function e(i,t){if(!i||0===t.length)return;var n=false;t.append(TS.templates.reply_broadcast_buttons({label_id:i,view:"convo",can_post_back_to_channel:n}));var a=t.find(".reply_broadcast_label_container, .reply_send");a.mousedown(function(e){e.preventDefault();f(t)}).click(function(){f(t)})};var u=function e(i,t){var n=$("#file_reply_container .message_input");TS.utility.populateInput(n,i,i.length);if(t)TS.storage.storeLastCommentInput(t,i)};var m=function e(i){u("",i);$("#file_reply_container .reply_broadcast_toggle").attr("checked",false)};var f=function e(i){var t=i.find(".message_input");TS.utility.contenteditable.focus(t)};var h=function e(i){var t=$("#file_preview_head_section .convo_flexpane_divider");var n=_.get(i,"comments.length")||0;TS.ui.replies.updateFlexpaneThreadDivider(t,n)};var g=function e(i,t,n){if(!TS.boot_data.feature_file_threads)return;var a;if("file_share_msg"===t&&n)a=n;else if(i.channels&&i.channels.length)a=_.first(i.channels);else if(i.groups&&i.groups.length)a=_.first(i.groups);return a};var p=function e(i){i.addClass("hidden")}})()},4926:function(e,i){(function(){TS.registerModule("client.ui.flex",{onStart:function e(){TS.client.login_sig.add(d);TS.client.flexpane_display_switched_sig.add(h);TS.channels.switched_sig.add(c);TS.groups.switched_sig.add(c);TS.ims.switched_sig.add(c);TS.mpims.switched_sig.add(c);function i(){TS.client.ui.flex.bindFlexUI()}if(TS.has_pri[T])TS.log(T,"deferring UI bind until login_sig");TS.client.login_sig.add(i)},bindFlexUI:function e(){var i=$("#client_header");$("#col_flex").delegate(".close_flexpane","click",function(){if(TS.model.ui_state.flex_visible){if("search"===TS.model.ui_state.flex_name){TS.clog.track("SEARCH_CLOSE",{search_session_id:TS.search.getSearchSessionId()});TS.search.searchSessionEnd()}else if("whats_new"===TS.model.ui_state.flex_name)TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"close_flexpane",step:TS.client.whats_new.getNewestID()});TS.client.ui.flex.hideFlex()}});i.delegate("#flex_menu_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.startWithFlexMenu(e);TS.client.downloads.maybeShowFlexMenuProgBar();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_flex_menu_button"}}})});i.delegate("#details_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;if("whats_new"===TS.model.ui_state.flex_name)TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"details_toggle",step:TS.client.whats_new.getNewestID()});u("details");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_details_button"}}})});i.delegate("#canvases_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;u("canvases")});i.delegate("#recent_mentions_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;u("mentions");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_activity_button"}}})});i.delegate("#stars_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;u("stars");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_stars_button"}}})});i.delegate("#channel_members_toggle_count","click",function(e){m(e);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_members_count_button"}}})});i.delegate("#pinned_item_count","click",function(e){TS.info("Pinned item count in channel header clicked");f(e);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_pins_count_button"}}})});i.delegate("#channel_share_info","click",function(){TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showAboutSection();$("#channel_page_scroller .channel_page_about").highlight(null,"channel_page_details_highlighter");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_share_info"}}})});i.delegate("#whats_new_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"whats_new_toggle",step:TS.client.whats_new.getNewestID()});$("#client-ui").removeClass("whats_new_showing");u("whats_new")})},cleanupFlexExcluding:function e(i){if("files"!==i){TS.view.files.cleanList();TS.client.ui.files.cleanFilePreview()}if("team"!==i){TS.client.ui.flex._unregisterCurrentStatusInput();var t=TS.SearchableMemberList.get("team_directory");if(t)t.destroy()}if("stars"!==i)TS.view.cleanStars();if("mentions"!==i)TS.view.cleanMentions();if("search"!==i)TS.search.view.cleanResults();if("groups"!==i){$("#user_groups_list_wrapper").longListView("setHidden",true);if(TS.view.user_groups_members_list_lazyload){TS.view.user_groups_members_list_lazyload.detachEvents();TS.view.user_groups_members_list_lazyload=null}}if("canvases"!==i)TS.client.ui.canvases_flexpane.stop()},toggleFlex:function e(){if(TS.model.ui_state.flex_visible)TS.client.ui.flex.hideFlex();else if(!TS.model.ui.active_tab_id){var i=TS.model.ui_state.prev_flex_name||TS.model.default_flex_name;var t=TS.model.ui_state.prev_flex_extra;TS.client.ui.flex.setFlexStateFromHistory(i,t)}else{var n="list"===TS.model.ui.active_tab_id;TS.client.ui.flex.showFlex(n);TS.client.flexDisplaySwitched(TS.model.ui.active_tab_id||"",TS.model.ui.last_flex_extra||"")}},hideFlex:function e(i,t){TS.client.ui.flex.cleanupFlexExcluding();if(TS.model.ui_state.flex_visible)if("details"===TS.model.ui_state.flex_name){if(!i)TS.model.ui_state.details_tab_active=false}else if(TS.model.ui_state.details_tab_active&&!TS.client.activeChannelIsHidden()){TS.client.ui.flex.openFlexTab("details",t);return}var n=function e(){$("#"+TS.model.ui_state.flex_name+"_tab").removeClass("active");TS.model.ui.last_flex_extra=TS.model.flex_extra_in_url;TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("flex_pane_showing")});TS.model.ui_state.flex_visible=false;TS.model.ui.active_tab_id=null;TS.view.resizeManually("TS.client.ui.flex.hideFlex");if(TS.model.ui.scrolled_to_msg_ts){TS.client.ui.scrollMsgsSoMsgIsInView(TS.model.ui.scrolled_to_msg_ts,false,true,200);TS.model.ui.scrolled_to_msg_ts=null}TS.client.flex_pane.stopLocalTimeInterval();$(".messages_banner").removeClass("flex_pane_showing");TS.client.flexDisplaySwitched("","",t,i);TS.client.ui.flex.adjustIFramesInSpecialFlexPanes();if(document.activeElement&&$(document.activeElement).closest("#col_flex").length>0)TS.view.focusMessageInput()};if("list"===TS.model.ui.active_tab_id)$("#flex_contents").transition({opacity:0},100,n);else n()},last_window_width_diff:392,last_window_width_diff_default:392,showFlex:function e(i,t){var n=TS.client.ui.areMsgsScrolledToBottom();if(TS.client.activeChannelIsHidden()||!n)TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("flex_pane_showing")});else $("#client-ui").addClass("flex_pane_showing");TS.model.ui_state.flex_visible=true;TS.storage.storeUIState(TS.model.ui_state);if(!t)TS.view.resizeManually("TS.client.ui.flex.showFlex");if(n)TS.client.ui.instaScrollMsgsToBottom(false);$(".messages_banner").addClass("flex_pane_showing");if(i)$("#flex_contents").css("opacity",0).transition({opacity:100},150);else $("#flex_contents").css("opacity",100);if("files"===TS.model.ui.active_tab_id&&""!==TS.model.ui.last_flex_extra)TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"),true);if("downloads"===TS.model.ui.active_tab_id)TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"),true);if("team"===TS.model.ui.active_tab_id&&!TS.model.previewed_member_id)TS.client.flex_pane.startLocalTimeInterval();if("files"===TS.model.ui.active_tab_id||!TS.model.ui.active_tab_id&&"files"===TS.model.default_flex_name)TS.view.files.maybeRebuildList();else if("search"===TS.model.ui.active_tab_id)TS.search.search_filter_set_sig.dispatch();if("team"===TS.model.ui.active_tab_id)window.setTimeout(function(){TS.view.maybeRebuildUserGroupList()},1);TS.client.ui.flex.adjustIFramesInSpecialFlexPanes()},_displayFlexTab:function e(n,r){var s=$("#"+n+"_tab");if(!s.length)return false;if(!TS.model.ui_state.flex_visible)TS.client.ui.flex.showFlex(false,true);if(TS.isPartiallyBooted()){i=n;t=r;a();return true}if("stars"===n)if(!TS.stars.fetched_once){$("#member_stars_list").html(l);TS.stars.fetchUserStarredItems()}else TS.view.rebuildStars(true);else if("downloads"===n)TS.client.downloads.maybeBuild();else if("mentions"===n)if(!TS.mentions.fetched_once){TS.view.rebuildMentionsLoading();TS.mentions.fetchMentions()}else TS.view.rebuildMentionsImmediately(true);else if("files"===n)TS.view.files.unHideList();else if("team"===n)TS.client.flex_pane.startLocalTimeInterval();else if("details"===n)TS.model.ui_state.details_tab_active=true;else if("groups"===n)$("#user_groups_list_wrapper").longListView("setHidden",false);else if("canvases"===n){var o=TS.shared.getActiveModelOb();TS.client.ui.canvases_flexpane.start(o.id)}if("team"!==n)TS.client.flex_pane.stopLocalTimeInterval();TS.client.ui.flex.cleanupFlexExcluding(n);$("#flex_contents > .panel").removeClass("active");s.addClass("active");if(!TS.utility.contenteditable.isActiveElement(TS.search.input))s.find(".heading").focus();TS.model.ui.active_tab_id=n;TS.model.ui.active_tab_ts=Date.now();if("search"===n)TS.ui.utility.updateClosestMonkeyScroller($("#search_results"));if(!r)TS.view.resizeManually("TS.client.ui.flex._displayFlexTab flex_name:"+n);TS.client.ui.flex.adjustIFramesInSpecialFlexPanes();return true},adjustIFramesInSpecialFlexPanes:function e(){if(!TS.boot_data.special_flex_panes)return;var i=TS.model.ui.active_tab_id;var t;var n;var a;_.forOwn(TS.boot_data.special_flex_panes,function(e){if(TS.has_pri[T])TS.log(T,"special_flex_pane: "+i);n=$("#"+e.flex_name+"_tab");if(!n.length)return;a=n.find("iframe");if(!a.length)return;t="about:blank";if(TS.model.ui_state.flex_visible&&e.flex_name===i)t=a.data("src");if(a.attr("src")===t)return;if(TS.has_pri[T])TS.log(T,"loading src: "+t);a.attr("src",t)})},openFlexTab:function e(i,t){if(!TS.client.ui.flex._displayFlexTab(i))return;var n;if("files"===i)n=TS.model.previewed_file_id;else if("team"===i){n=TS.model.previewed_member_name;if(!n)n=TS.model.previewed_user_group_id}else if("search"===i)n=TS.search.last_search_query;TS.client.flexDisplaySwitched(i,n,t)},setFlexStateFromHistory:function e(i,t,n){if(TS.isPartiallyBooted()){r=arguments;s();return}if(!i){if(TS.model.ui_state.flex_name||n)TS.client.ui.flex.hideFlex(true);return}t=t||"";var a=TS.model.ui_state.flex_extra||"";if(!n&&i==TS.model.ui_state.flex_name&&t==a)return;if("list"===i)i="files";if(!TS.client.ui.flex._displayFlexTab(i))return;if("files"===i){var o=TS.model.ui_state.flex_extra_type;TS.client.ui.files.showFilesFromHistory(t,o)}else if("team"===i)TS.client.ui.showTeamFromHistory(t);else if("search"===i)TS.client.ui.showSearchFromHistory(t);else if("convo"===i&&t)TS.client.ui.showRepliesFromHistory(t);else if("apps"===i)TS.client.ui.showAppsFromHistory(t);else TS.client.flexDisplaySwitched(i,null,false,true)},openConversationFlex:function e(i,t){var n=i.id+"-"+t;var a=!TS.model.ui_state.flex_visible||"convo"!==TS.model.ui_state.flex_name||TS.model.ui_state.flex_extra!=n;if(!a)return;TS.client.ui.flex._displayFlexTab("convo");TS.client.flexDisplaySwitched("convo",n)},openAppProfileFlex:function e(i){var t=i;TS.client.ui.flex._displayFlexTab("apps");TS.client.flexDisplaySwitched("apps",t)},rebuildMsgCurrentStatusIncludingMember:function e(i){var t=TS.model.ui_state.flex_name;if("mentions"===t||"stars"===t){var n=$("#col_flex");var a={member:i,for_message:true};_.each(TS.model.user[t],function(e){if(TS.utility.msgs.memberSentMessage(i,e.message)){var t=n.find('ts-message[data-ts="'+e.message.ts+'"] .message_current_status');t.replaceWith(TS.templates.current_status(a))}})}else if("files"===t)TS.client.ui.files.rebuildFilePreviewAndCommentsIncludingMember(i)},registerCurrentStatusInput:function e(){TS.client.ui.flex._unregisterCurrentStatusInput();TS.client.ui.flex._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#member_preview_container"),has_presets_menu:true,onEscape:S,onSave:S,onError:S});$(".current_status_cover").on("click.current_status",p);$(".current_status_clear_icon_cover").on("click.current_status",function(e){e.stopPropagation();if(TS.client.ui.flex._current_status_input)TS.client.ui.flex._current_status_input.clearCurrentStatus()})},_unregisterCurrentStatusInput:function e(){if(TS.client.ui.flex._current_status_input){TS.client.ui.flex._current_status_input.destroy();TS.client.ui.flex._current_status_input=null}$(".current_status_cover").off(".current_status");$(".current_status_clear_icon_cover").off(".current_status")}});var e=false;var i;var t;var n=function e(){i=void 0;t=void 0};var a=_.once(function(){var e=function e(){var a=i;var r=t;n();if(!TS.model.ui_state.flex_visible||!TS.model.ui_state.flex_name)return;if(!a)return;TS.client.ui.flex._displayFlexTab(a,r)};TS.redux.socket.connectedSig.addOnce(e)});var r;var s=_.once(function(){var e=function e(){var i=r;r=void 0;return TS.client.ui.flex.setFlexStateFromHistory.apply(window,i)};TS.redux.socket.connectedSig.addOnce(e)});var o=TS.i18n.t("Loading...","flexpane")();var l='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+o+'" /><br />'+o+"</div>";var d=function i(){e=true};var c=function i(){if(!e)return;var t=TS.shared.getActiveModelOb();if(!t)return;if(TS.client.ui.canvases_flexpane.isEnabled()&&TS.model.ui_state.flex_visible&&"canvases"===TS.model.ui_state.flex_name){TS.client.ui.flex.cleanupFlexExcluding("");TS.client.ui.flex.openFlexTab("canvases")}};var u=function e(i){if(TS.model.ui_state.flex_visible&&TS.model.ui_state.flex_name===i)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab(i)};var m=function e(i){if(TS.client.ui.shouldIgnoreClick(i))return false;TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showMembersSection();$("#channel_page_scroller .channel_page_members").highlight(null,"channel_page_members_highlighter")};var f=function e(i){if(TS.client.ui.shouldIgnoreClick(i))return false;TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showPinsSection();$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_members_highlighter")};var h=function e(){var i=TS.model.ui_state.flex_visible;var t=TS.model.ui_state.flex_name;var n=TS.shared.getActiveModelOb();g(n);if("team"!==t||!TS.model.ui_state.flex_extra){TS.model.previewed_member_id=null;TS.model.previewed_member_name=null;TS.model.previewed_user_group_id=null}if(!i)return;var a=$("#details_toggle");var r=a.find(".ts_tip_tip");var s=$("#recent_mentions_toggle");var o=$("#stars_toggle");var l=$("#canvases_toggle");if(n&&"details"===t){a.addClass("active");if(n.is_im||n.is_mpim)r.text(TS.i18n.t("Hide Conversation Details","flexpane")());else if(n.is_group||n.is_channel)r.text(TS.i18n.t("Hide Channel Details","flexpane")());if(!$("#client-ui").hasClass("details_showing"))TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("details_showing")})}else if("mentions"===t){s.addClass("active");s.find(".ts_tip_tip").text(TS.i18n.t("Hide Activity","flexpane")())}else if("stars"===t){o.addClass("active");o.find(".ts_tip_tip").text(TS.i18n.t("Hide Starred Items","flexpane")())}else if("canvases"===t&&TS.boot_data.feature_app_canvases&&TS.client.ui.canvases_flexpane.isEnabled()){l.addClass("active");l.find(".ts_tip_tip").text(TS.i18n.t("Hide Apps","flexpane")());if(!$("#client-ui").hasClass("canvases_flexpane_showing"))TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("canvases_flexpane_showing")})}};var g=function e(i){var t=$("#details_toggle .ts_tip_tip");if($("#client-ui").hasClass("details_showing"))TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("details_showing")});$(".channel_header_icon.active").removeClass("active");if(i)if(i.is_im||i.is_mpim)t.text(TS.i18n.t("Show Conversation Details","flexpane")());else t.text(TS.i18n.t("Show Channel Details","flexpane")());$("#recent_mentions_toggle .ts_tip_tip").text(TS.i18n.t("Show Activity","flexpane")());$("#stars_toggle .ts_tip_tip").text(TS.i18n.t("Show Starred Items","flexpane")());if($("#client-ui").hasClass("canvases_flexpane_showing"))TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("canvases_flexpane_showing")});if(TS.boot_data.feature_app_canvases)$("#canvases_toggle .ts_tip_tip").text(TS.i18n.t("Show Apps","flexpane")())};var p=function e(){$(".current_status_container").addClass("active");if(TS.client.ui.flex._current_status_input)TS.client.ui.flex._current_status_input.focus()};var S=function e(i){var t=i&&(i.text||i.emoji);if(t){$(".current_status_cover .current_status").html(TS.format.formatCurrentStatus(i.text,void 0,{stop_animations:true,prevent_copy_paste:false}));$(".current_status_cover .current_status_emoji_cover").html(TS.format.formatCurrentStatus(i.emoji,void 0,{stop_animations:true,transform_missing_emoji:true,ignore_emoji_mode_pref:"as_text"===TS.prefs.getPref("emoji_mode")}))}$(".current_status_container").toggleClass("with_status_set",!!t);$(".current_status_container").removeClass("active")};var T=82})()},4927:function(e,i){(function(){TS.registerModule("client.stats",{start_collecting_sig:new signals.Signal,stop_collecting_sig:new signals.Signal,initial_time_period_collection_finished_sig:new signals.Signal,onStart:function i(){TS.client.login_sig.addOnce(function(){S();if(TS.utility.enableFeatureForUser(e)||c||d){g();if(c||d);else setInterval(g,a)}if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1))_.each(TS.boot_data,function(e,i){if(0===i.indexOf("feature_"))TS.metrics.count(i+(e?"_on":"_off"))});if(window.PerformanceObserver)try{var i=new window.PerformanceObserver(function(e){_.each(e.getEntries(),function(e){if("longtask"===e.entryType){if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.store(e.entryType,e.duration);if(TS.utility.enableFeatureForUser(5))TS.clog.track("PERF_LONGTASKS",{elapsed_time:e.duration})}})});if(window.PerformanceLongTaskTiming)i.observe({entryTypes:["longtask"]})}catch(e){TS.console.logError(e,"perf_observer","client_error",true)}})},isEnabled:function e(){return c&&"1"===TS.qs_args.client_stats||!!o},isCollectingInitialTimePeriodStats:function e(){return!!s}});var e=50;var i=1;var t=1;var n=6e4;var a=6e5;var r=6e5;var s;var o;var l;var d=!!TS.has_pri[y];var c=TS.qs_args.hasOwnProperty("client_stats");var u="rb_all";var m="rb_all_but";var f="rb_msgs";var h="up_member";var g=function e(){var i=!!o;var a;if(c||d){a="1"==TS.qs_args.client_stats||d;if(TS.has_pri[y])TS.log(y,"client.stats: enabled? "+a+" set by "+(d?"user in debug prefs":"query parameter"))}else a=TS.utility.enableFeatureForUser(t);if(TS.has_pri[y])TS.log(y,"client.stats: enabled now? "+i+"; should be enabled? "+a);if(a===i)return;if(a){l={};l[u]=0;l[m]=0;l[f]=0;l[h]=0;o=setInterval(p,n);TS.client.ui.did_rebuild_all_sig.add(T);TS.client.ui.did_rebuild_all_but_msgs_sig.add(v);TS.client.msg_pane.did_rebuild_msgs_sig.add(b);TS.members.member_was_upserted_sig.add(w);TS.client.stats.start_collecting_sig.dispatch()}else{l=void 0;clearInterval(o);o=void 0;TS.client.ui.did_rebuild_all_sig.remove(T);TS.client.ui.did_rebuild_all_but_msgs_sig.remove(v);TS.client.msg_pane.did_rebuild_msgs_sig.remove(b);TS.members.member_was_upserted_sig.remove(w);TS.client.stats.stop_collecting_sig.dispatch()}};var p=function e(){_.each(l,function(e,i){if(TS.has_pri[y])TS.log(y,"client.stats: "+i+" = "+e);TS.metrics.store("cs_"+i,e,{allow_zero:true,is_count:true});l[i]=0})};var S=function e(){var t=TS.boot_data.feature_webapp_always_collect_initial_time_period_stats||TS.utility.enableFeatureForUser(i);if(!t)return;if(TS.has_pri[y])TS.log(y,"Will collect additional stats for the first "+_.round(r/6e4,1)+" minutes of this session");TS._count_bytes_received=true;TS._bytes_received=0;var n=0;var a=function e(){n+=1};TS.members.member_was_upserted_sig.add(a);s=setTimeout(function(){s=void 0;TS.info("Received "+TS._bytes_received+" bytes in the first "+_.round(r/6e4,2)+" minutes of the session");TS.metrics.count("client_session_bytes_received",TS._bytes_received);TS.metrics.count("client_total_members_loaded",_.filter(TS.model.members,function(e){return _.isUndefined(e.is_unknown)||!_.get(e,"is_unknown")}).length);TS.metrics.count("client_total_member_upserts",n);TS.metrics.count("initial_beachballs",TS.client.stats.responsiveness.getTotalBeachballCount());TS.metrics.count("initial_stutters",TS.client.stats.responsiveness.getTotalStutterCount());TS._count_bytes_received=false;TS.members.member_was_upserted_sig.remove(a);TS.client.stats.initial_time_period_collection_finished_sig.dispatch()},r)};var T=function e(){l[u]+=1};var v=function e(){l[m]+=1};var b=function e(){l[f]+=1};var w=function e(){l[h]+=1};var y=1991})()},4928:function(e,i){(function(){TS.registerModule("client.stats.responsiveness",{onStart:function i(){TS.client.login_sig.addOnce(function(){if(TS.client.isEnhancedDebuggingEnabled())return;if(!_.isFunction(window.requestAnimationFrame)){TS.warn("Unable to install beachball detector without requestAnimationFrame");return}if(!window.performance){TS.warn("Unable to install beachball detector without performance");return}TS.client.stats.start_collecting_sig.add(d);TS.client.stats.stop_collecting_sig.add(function(){c();u()});if(TS.client.stats.isEnabled()||TS.client.stats.isCollectingInitialTimePeriodStats()){d();TS.client.stats.initial_time_period_collection_finished_sig.add(function(){if(!TS.client.stats.isEnabled())u()})}window.addEventListener("sleep",function(){if(e)u()})})},isEnabled:function i(){return!!e},getTotalBeachballCount:function e(){return a},getTotalStutterCount:function e(){return r}});var e=false;var i;var t;var n;var a=0;var r=0;var s=100;var o=1e3;var l=300;function d(){e=true;t=0;i=[];n=0;var d=performance.now();var c=0;var _;var u=function u(){if(!e)return;var m=performance.now();var f=m-d;d=m;if(f>o){t+=1;a+=1}else if(f>s){n+=1;r+=1}if(0===c)_=m;c+=1;if(c===l){var h=(m-_)/1e3;var g=Math.floor(c/h);c=0;if(TS.debug_widget&&TS.debug_widget.isVisible())TS.debug_widget.setFrameRate(g);i.push(g)}requestAnimationFrame(u)};requestAnimationFrame(u)}function c(){TS.metrics.count("stutters",n);TS.metrics.count("beachballs",t);if(!_.isEmpty(i)){var e=_.min(i);var a;var r=i.sort();var s=Math.floor(r.length/2);if(r.length%2===1)a=r[s];else a=(r[s-1]+r[s])/2;TS.metrics.store("fps_min",e);TS.metrics.store("fps_median",a)}n=void 0;t=void 0;i=void 0}function u(){e=false}})()},4929:function(e,i){(function(){var e=10;var i=10;var t=100;var n=100;var a=33;var r=100;TS.registerComponent("SearchableMemberList",{_constructor:function e(i){this.id=i.id;this.triggered_by_user_action=i.triggered_by_user_action;this.$_container=i.$container;this.$_long_list_view;this.$_search_bar;this.$_search_input;this.$_clear_icon;this.$_filter_input;this._current_filter="everyone";this._current_query_for_display="";this._current_query_for_match="";this._next_marker="";this._have_all_members=false;this._members=[];this._model_ob_id=i.model_ob_id;this._filter_counts={};this._suppress_presence=i.suppress_presence||false;this._show_filter_bar=!_.isUndefined(i.show_filter_bar)?i.show_filter_bar:!this._model_ob_id;this._compact_results=!_.isUndefined(i.compact_results)?i.compact_results:!!this._model_ob_id;this._prevent_member_click_handler=i.prevent_member_click_handler||false;this._approx_item_height=this._compact_results?30:89;this._long_list_view_height=0;this._long_list_view_items_height=0;this._long_list_view_initial_height=null;this._fetch_page_p=null;if(!this._suppress_presence)this._presence_list=new TS.PresenceList;this._resize_sig_handler=null;this.member_clicked_sig=new signals.Signal},destroy:function e(){if(this._resize_sig_handler)TS.view.resize_sig.remove(this._resize_sig_handler);if(this._maybeSetupFilterInputDebounced){TS.members.joined_team_sig.remove(this._maybeSetupFilterInputDebounced,this);TS.members.changed_deleted_sig.remove(this._maybeSetupFilterInputDebounced,this)}this.$_container.off();if(this.$_long_list_view)this.$_long_list_view.off();if(this.$_search_input)this.$_search_input.off();if(this.$_clear_icon)this.$_clear_icon.off();if(this.$_filter_input)this.$_filter_input.off();if(this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView"))this.$_long_list_view.longListView("destroy");if(this.$_search_bar)this.$_search_bar.remove();if(!this._suppress_presence)this._presence_list.clear()},showInitial:function e(){var i=this;if(!this._prevent_member_click_handler)this.$_container.delegate(".team_list_item","click",TS.members.view.onTeamDirectoryItemClick);this.$_long_list_view=this.$_container.find(".searchable_member_list_scroller");this._showLoadingState();this._fetchPage().then(function(e){i._hideLoadingState();i._processPage(e);TS.utility.rAF(function(){i._updatePresenceListForVisibleMembers()});i._setupLongListView();i._maybeSetupSearchBar();return null});var t="channel_membership_dialog"===this.id?"channel_membership_dialog_scroller":"team_list_scroller";TS.metrics.count(t+"_initialized")},maybeRerenderLongListView:function e(){if(this.$_long_list_view&&this._members)this.$_long_list_view.longListView("setItems",this._members,true,true)},_fetchPage:function e(){if(this._fetch_page_p)return this._fetch_page_p;var i=this;var t=this._buildQueryParams();this._fetch_page_p=TS.members.fetchAndUpsertMembersWithQuery(t).then(function(e){i._fetch_page_p=null;i._next_marker=e.next_marker;if(!e.next_marker)i._have_all_members=true;return e.objects||e});return this._fetch_page_p},_buildQueryParams:function e(){var n={count:this._current_query_for_match?t:i,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name",locale:TS.i18n.locale()};var a=TS.interop.utility.looksLikeTeamId(this._current_filter);if(a)n.external_team=this._current_filter;else n.filter=this._current_filter;if(this._current_query_for_match){n.query=this._current_query_for_match;n.search_profile_fields=true}else n.marker=this._next_marker;if(this._model_ob_id)n.channels=[this._model_ob_id];else if(TS.model.user.is_restricted)n.channels=_.map(TS.shared.getAllModelObsForUser(),function(e){return e.is_im?e.user:e.id});return n},_processPage:function e(i){this._members=_.union(this._members,i)},_updatePresenceListForVisibleMembers:function e(){if(this._suppress_presence)return;if(this._presence_list&&this.$_long_list_view&&this.$_long_list_view.longListView){var i=this.$_long_list_view.longListView("getCurrentItemsInView")||[];var t=_.map(i,"id");if(t.length){this._presence_list.clear();this._presence_list.add(t)}}},_fetchProcessAndDisplayPage:function e(){var i=this;if(i._have_all_members)return;return this._fetchPage().then(function(e){i._processPage(e);i._maybeHideNoResultsState();if(i._members.length>0)i.$_long_list_view.longListView("setItems",i._members,true,true);else i._showNoResultsState();return null}).then(function(){TS.utility.rAF(function(){i._updatePresenceListForVisibleMembers();i._long_list_view_height=i.$_long_list_view.height();i._long_list_view_items_height=i.$_long_list_view.find(".list_items").height();i._recursivelyFillLongListViewToHeight()});return null})},_maybeSetupSearchBar:function i(){var t=this;if(this.$_search_bar)return;return TS.flannel.fetchMemberCounts().then(function(i){if(i.everyone>=e){t.$_long_list_view.before(TS.templates.team_search_bar());t.$_search_bar=t.$_container.find(".searchable_member_list_search_bar");t.$_search_input=t.$_search_bar.find(".searchable_member_list_input");t.$_filter_input=t.$_search_bar.find(".searchable_member_list_filter");t._setupSearchInput();t._maybeSetupFilterInput()}return null})},_setupSearchInput:function e(){var i=this;this.$_search_bar.find(".searchable_member_list_search.loading").replaceWith(TS.templates.team_search_bar_input(this._generateFilterSearchBarTemplateArgs()));this.$_search_input=this.$_search_bar.find(".searchable_member_list_input");this.$_clear_icon=this.$_container.find(".icon_close");this.$_search_input.bind("keyup.searchable_member_list",this._handleSearchKeyUp.bind(this));this.$_container.delegate(".searchable_member_list_filter","click",this._handleFilterSelect.bind(this));this.$_clear_icon.bind("click",function(){i._reset();Promise.resolve().then(function(){i.$_search_input.focus();return null})});if(this.triggered_by_user_action)this.$_search_input.focus()},_maybeSetupFilterInput:function e(){var i=this;if(!this.$_filter_input)return;if(!this._show_filter_bar){i.$_filter_input.remove();i.$_filter_input=null;return}return TS.flannel.fetchMemberCounts().then(function(e){i._filter_counts=e;i.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(i._generateFilterSearchBarTemplateArgs()));i.$_filter_input=i.$_search_bar.find(".searchable_member_list_filter");if(!i._maybeSetupFilterInputDebounced){var t=1e3;var n={trailing:true};i._maybeSetupFilterInputDebounced=_.debounce(function(){return i._maybeSetupFilterInput.apply(i,arguments)},t,n)}TS.members.joined_team_sig.add(i._maybeSetupFilterInputDebounced,i);TS.members.changed_deleted_sig.add(i._maybeSetupFilterInputDebounced,i)})},_maybeSetupFilterInputDebounced:null,_setupLongListView:function e(){var i=this;this.$_long_list_view.longListView({items:this._members,approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function e(i){return i.outerHeight()},makeElement:function e(){return $(TS.templates.team_list_item({is_channel_membership:i._model_ob_id,is_long_list_view:true}))},renderItem:function e(t,n){t.toggleClass("deleted",true===n.deleted).data("member-id",n.id).data("item",n);if(i._compact_results)t.html(TS.templates.channel_page_member_row({member:n,lazy:false,suppress_presence:i._suppress_presence}));else t.html(TS.templates.team_list_item_member_details({member:n,is_long_list_view:true}));TS.utility.makeSureAllLinksHaveTargets(t)}});this.$_long_list_view.delegate("li").on("click",function(e){if(i._prevent_member_click_handler)e.preventDefault();i.member_clicked_sig.dispatch(e,TS.members.getMemberById($(e.target).parents(".team_list_item").find("[data-member-id]").data("memberId")))});this._resize_sig_handler=_.throttle(function(){i._long_list_view_height=i.$_long_list_view.height();i._long_list_view_items_height=i.$_long_list_view.find(".list_items").height();if(!i._long_list_view_initial_height)i._long_list_view_initial_height=i._long_list_view_height},a);TS.view.resize_sig.add(this._resize_sig_handler);this.$_long_list_view.on("scroll",_.debounce(function(e){i._updatePresenceListForVisibleMembers();if(i._current_query_for_match)return;var t=i._long_list_view_items_height-($(e.target).scrollTop()+i._long_list_view_height);if(t<n)i._fetchProcessAndDisplayPage()},r));TS.utility.rAF(function(){TS.view.resizeManually("TS.SearchableMemberList.showInitial");i._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function e(){var i=this;if(this._current_query_for_match)return;if(this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_members)this._fetchProcessAndDisplayPage().then(function(){i._long_list_view_items_height=i.$_long_list_view.find(".list_items").height()})},_reset:function e(){this._members=[];this._current_query_for_match="";this._current_query_for_display="";this._current_filter="everyone";this._next_marker="";this.$_search_input.val("");this.$_clear_icon.addClass("hidden");this._have_all_members=false;this._maybeHideNoResultsState();this.$_long_list_view.scrollTop(0);if(this.$_filter_input){this.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(this._generateFilterSearchBarTemplateArgs()));this.$_filter_input=this.$_container.find(".searchable_member_list_filter")}this.$_long_list_view.height(this._long_list_view_initial_height);this._fetchProcessAndDisplayPage()},_showLoadingState:function e(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function e(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function e(){var i=this.$_container.find(".no_results");if(i.length>0)i.remove();var t=this;var n={query:this._current_query_for_display,everyone_filter_selected:"everyone"===this._current_filter,members_filter_selected:this._current_filter.match(/members/),admins_filter_selected:this._current_filter.match(/admins/),restricted_filter_selected:this._current_filter.match(/guests/),deactivated_filter_selected:"deactivated"===this._current_filter,free_team:!TS.model.team.plan,user_is_admin:TS.model.user.is_admin,bots_filter_selected:this._current_filter.match(/bots/)};var a=TS.templates.team_searchable_no_results(n);this.$_long_list_view.hide().before(a);if(TS.model.user.is_admin&&!TS.model.team.plan&&this._current_filter.match(/guests/))TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"team_directory",action:"impression"}}});this.$_container.delegate(".clear_members_filter","click",function(){t._reset()});if("everyone"!==this._current_filter&&""!==this._current_query_for_match){var r=this._current_filter;this._current_filter="everyone";this._fetchPage().then(function(e){t._current_filter=r;if(e.length>0){t.$_container.find(".no_results").after(TS.templates.team_other_matches_heading({query:t._current_query_for_display}));t.$_long_list_view.longListView("setItems",e,true,true);t.$_long_list_view.show();TS.utility.rAF(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})}return null})}},_maybeHideNoResultsState:function e(){var i=this.$_container.find(".no_results");if(0==i.length)return;var t=this.$_container.find(".other_matches");if(t)t.remove();i.remove();this.$_long_list_view.show()},_handleSearchKeyUp:function e(i){var t=$(i.target).val();if(t.trim().toLocaleLowerCase()!==this._current_query_for_match){if(this._fetch_page_p){this._fetch_page_p.cancel();this._fetch_page_p=null}if(!this._suppress_presence)this._presence_list.clear();this._members=[];this._next_marker="";this._have_all_members=false;this._current_query_for_display=t;this._current_query_for_match=t.trim().toLocaleLowerCase();this._fetchProcessAndDisplayPage();this.$_long_list_view.scrollTop(0);this.$_clear_icon.toggleClass("hidden",!t.trim())}},_handleFilterSelect:function e(i){i.preventDefault();var t=this;TS.menu.startWithSearchableMemberListFilter(i,this._filter_counts,function(e){var i=$(e.target).closest("[data-filter]");if(!i.length)return;if(t._fetch_page_p){t._fetch_page_p.cancel();t._fetch_page_p=null}if(!t._suppress_presence)t._presence_list.clear();t._have_all_members=false;t._members=[];t._next_marker="";t._current_filter=i.data("filter");t._fetchProcessAndDisplayPage();t.$_long_list_view.scrollTop(0);t.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(t._generateFilterSearchBarTemplateArgs()));t.$_filter_input=t.$_container.find(".searchable_member_list_filter")})},_generateFilterSearchBarTemplateArgs:function e(){var i=this._current_filter;var t={everyone_filter_selected:"everyone"===i,deactivated_filter_selected:"deactivated"===i};if(TS.boot_data.page_needs_enterprise)_.merge(t,{org_name:TS.model.team.enterprise_name,team_name:TS.model.team.name,org_members_filter_selected:"org_members"===i,org_admins_filter_selected:"org_admins"===i,org_restricted_filter_selected:"org_guests"===i,team_members_filter_selected:"members"===i,team_admins_filter_selected:"admins"===i,team_restricted_filter_selected:"guests"===i,org_bots_filter_selected:"org_bots"===i,team_bots_filter_selected:"bots"===i});else _.merge(t,{members_filter_selected:"members"===i,admins_filter_selected:"admins"===i,restricted_filter_selected:"guests"===i,bots_filter_selected:"bots"===i});_.each(this._filter_counts,function(e,i){t[i+"_count"]=e});t.bots_count=t.bots_count||0;t.org_bots_count=t.org_bots_count||0;var n=[];_.each(this._filter_counts.external_teams,function(e,t){n.push({external_team_filter_selected:i===t,external_team_count:e,external_team_name:TS.teams.getTeamNameById(t)})});_.merge(t,{ext_teams:n});return t},test:function n(){var a={};Object.defineProperty(a,"MINIMUM_MEMBERS_FOR_SEARCH",{get:function i(){return e},set:function i(t){e=t}});Object.defineProperty(a,"FETCH_PAGE_SIZE",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(a,"FETCH_PAGE_SIZE_SEARCH",{get:function e(){return t},set:function e(i){t=i}});return a}})})()},4930:function(e,i){(function(){TS.registerModule("client.ui.user_groups",{onStart:function i(){TS.client.login_sig.addOnce(e)},clearUserGroupFilter:function e(){var i=n.find("#user_group_filter");var a=i.find("input.member_filter");var r=i.find(".icon_close");t=void 0;TS.view.rebuildUserGroupList();setTimeout(function(){a.focus()},0);a.val("");r.addClass("hidden")},getUserGroupQuery:function e(){return t}});var e=function e(){n=$("#user_groups_container");n.html(TS.templates.user_groups_flexpane_tab({can_user_edit_user_groups:TS.permissions.members.canEditUserGroups(),can_user_create_and_delete_user_groups:TS.permissions.members.canCreateAndDeleteUserGroups()}));i()};var i=function e(){var i=n.find("#user_group_filter");var a=i.find("input.member_filter");var r=i.find(".icon_close");a.bind("keyup update-user-group-filter",function(){t=a.val().trim().toLocaleLowerCase();TS.view.rebuildUserGroupList();r.toggleClass("hidden",!t.trim())});n.delegate("#user_groups_list .clear_members_filter","click",function(){TS.client.ui.user_groups.clearUserGroupFilter()});r.bind("click",TS.client.ui.user_groups.clearUserGroupFilter)};var t;var n})()},4931:function(e,i){(function(){TS.registerModule("client.msg_input",{$input:$(),onStart:function a(){e=$("#snippet_prompt");i=e.find(".warning");t=e.find("#snippet_prompt_character_count");n=$("#notification_bar");if(TS.i18n.localeSupportsSendButton()){p=$("#msg_input_send");TS.prefs.msg_input_send_btn_changed_sig.add(T)}TS.channels.renamed_sig.add(TS.client.msg_input.setPlaceholder);TS.groups.renamed_sig.add(TS.client.msg_input.setPlaceholder);TS.members.changed_current_status_sig.add(TS.client.msg_input.setPlaceholder);TS.members.changed_name_sig.add(TS.client.msg_input.setPlaceholder);TS.members.changed_real_name_sig.add(TS.client.msg_input.setPlaceholder);TS.prefs.display_real_names_override_changed_sig.add(TS.client.msg_input.setPlaceholder);TS.prefs.team_display_real_names_changed_sig.add(TS.client.msg_input.setPlaceholder)},bind:function e(i){TS.client.msg_input.$input=i;if(TS.boot_data.feature_increase_msg_input_height&&TS.boot_data.experiment_assignments&&TS.boot_data.experiment_assignments.friends_of_messaging&&"friends_of_messaging"===TS.boot_data.experiment_assignments.friends_of_messaging.group){TS.client.msg_input.$input.addClass("feature_increase_msg_input_height");$("#primary_file_button,#main_emo_menu,.msg_mentions_button").addClass("feature_increase_msg_input_height")}var t=_.throttle(function(e){var t=TS.utility.contenteditable.value(i);c(t);f(t);h(t);if(TS.i18n.sendButtonEnabled())S(!!t.trim().length);if(TS.prefs.getPref("msg_preview"))y(t);if("silent"===e)return;if(t.trim())TS.client.msg_input.storeLastMsgForActiveModelOb(t);else TS.client.msg_input.storeLastMsgForActiveModelOb("")},100);var n={attributes:{tabindex:1},modules:{clipboard:{onPaste:function e(t){var n=false;if(TS.ui.paste.supportsUploadOnPaste())if(!(TS.model.is_FF&&bowser.version<50)&&t.clipboardData){n=TS.ui.paste.detectImageFromEvent(t);if(n)TS.utility.contenteditable.blur(i)}else n=true;if(!n){t.stopPropagation();return TS.utility.contenteditable.paste(i,t)}return n}},msginput:{onLeftWhenEmpty:function e(){TS.utility.contenteditable.blur(i);$("#primary_file_button").click()},onUpArrowCmd:function e(){b(s.up,true)},onUpArrow:function e(){b(s.up,false)},onDownArrow:function e(){b(s.down,false)}},tabcomplete:{appendMenu:function e(i){document.querySelector("#messages_container").appendChild(i)},positionMenu:function e(i){i.style.bottom=0;i.style.left="62px";i.style.right="20px";i.style.top="auto";TS.utility.rAF(function(){if(i.offsetTop<0)i.style.top=0;i=null})}}},placeholder:i.data("placeholder"),onEnter:function e(t){var n=TS.model.is_mac&&t.shiftKey&&t.metaKey||(TS.model.is_win||TS.model.is_lin)&&t.shiftKey&&t.ctrlKey;if(n){TS.client.msg_input.startSnippet();return false}if(TS.i18n.sendButtonEnabled()){if(t.metaKey||!TS.model.is_mac&&t.ctrlKey){x(i);return false}return true}if(!TS.client.ui.cal_key_checker.prevent_enter)x(i);return false},onTextChange:function e(i){d();D();t(i)},jumbomoji:!!TS.boot_data.pref_jumbomoji};TS.utility.contenteditable.create(i,n);$("#msg_form .msg_mentions_button").removeClass("hidden").on("click",o);TS.utility.contenteditable.enable(i)},setOffline:function e(){TS.client.msg_input.$input.addClass("offline");P();if(TS.i18n.sendButtonEnabled()){var i=TS.utility.contenteditable.value(TS.client.ui.$msg_input);S(!!i.trim().length)}},setOnline:function e(){TS.client.msg_input.$input.removeClass("offline");D();if(TS.i18n.sendButtonEnabled()){var i=TS.utility.contenteditable.value(TS.client.ui.$msg_input);S(!!i.trim().length)}},resized:function e(i,t){var n=Date.now();if(!TS.client.ui.$emo_menu)TS.client.ui.$emo_menu=$(".emo_menu");if(TS.boot_data.feature_initial_scroll_position){if(TS.client.ui.areMsgsScrolledToBottom(50))TS.client.ui.instaScrollMsgsToBottom()}else TS.view.resizeManually("TS.client.msg_input.resized original:"+i+" height:"+t);if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("inputResized "+i+" "+t,Date.now()-n)},storeLastMsgForActiveModelOb:function e(i){var t=TS.shared.getActiveModelOb();if(TS.model.input_history_index>-1)if(TS.model.input_history[TS.model.input_history_index]!=i)TS.chat_history.resetPosition("storeLastMsgInputForActive "+i);if(!t)return;if(t.last_msg_input==i)return;t.last_msg_input=i;t.has_draft=!!i;TS.storage.storeLastMsgInput(t.id,t.last_msg_input)},populate:function e(i){TS.utility.populateInput(TS.client.ui.$msg_input,i)},populateWithLast:function e(){var i=TS.shared.getActiveModelOb();if(!i)return;var t=TS.model.ms_logged_in_once||TS.format.hasOnlyValidMemberIds(i.last_msg_input);if(!t)return;TS.chat_history.resetPosition("populateChatInputWithLast");var n=TS.client.msg_input.$input;TS.utility.contenteditable.deserialize(n,i.last_msg_input);TS.utility.contenteditable.updateSpellCheck(n);if(TS.client.ui.isUserAttentionOnChat()){TS.utility.contenteditable.focus(n);TS.utility.contenteditable.setCursorAtEnd(n)}d()},startSnippet:function e(){var i=r;TS.ui.snippet_dialog.startCreate(TS.utility.contenteditable.value(TS.client.ui.$msg_input),i);TS.view.clearMessageInput();r=false},createSnippetFromPrompt:function e(){if(a){r=true;TS.client.msg_input.startSnippet()}},removePrecedingAtSign:function e(){var i=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);var t=i.start>0?TS.utility.contenteditable.getTextForRange(TS.client.msg_input.$input,i.start-1,1):"";if(TS.utility.contenteditable.getFormats(TS.client.msg_input.$input,i.start).slackmention)return;if("@"===t)TS.utility.contenteditable.deleteText(TS.client.msg_input.$input,i.start-1,1)},setPlaceholder:function e(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,I())},getInputElement:function e(){return TS.client.msg_input.$input[0]},test:function e(){return{_maybeHandleReactionCmdInMsgInput:A,_maybeShareFilesInMessage:k,_shareFiles:C,_shouldOnArrowKey:v}}});var e;var i;var t;var n;var a;var r=false;var s=TS.utility.keymap;var o=function e(){var i=TS.utility.contenteditable.getFormats(TS.client.msg_input.$input);var t=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);if(t.start>0&&i.slackmention&&t.start<TS.utility.contenteditable.getLength(TS.client.msg_input.$input)&&TS.utility.contenteditable.getFormats(TS.client.msg_input.$input,t.start+1).slackmention){TS.utility.contenteditable.focus(TS.client.msg_input.$input);return}var n=" @";var a=t.start>0?TS.utility.contenteditable.getTextForRange(TS.client.msg_input.$input,t.start-1,1):"";if("@"===a){n="@";TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input,t.start-1,1)}if(0===t.start||a.match(/\s/))n="@";TS.utility.contenteditable.focus(TS.client.msg_input.$input);TS.utility.contenteditable.insertTextAtCursor(TS.client.msg_input.$input,n,false);if("@"!==a)TS.clog.track("MSG_BTN_MENTIONS",{})};var l=0;var d=function e(){var i=TS.client.msg_input.$input.height();if(i!==l){TS.utility.rAF(function(){TS.client.ui.files.$file_btn.height(i);TS.client.ui.files.$file_btn.height("")});TS.client.msg_input.resized(l,i);l=i}};var c=function s(o){var l;var d=TS.format.cleanMsg(o);if(TS.boot_data.feature_message_input_byte_limit)l=TS.utility.msgs.charsOverLimit(d);else l=d.length-TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH;var c=l>0;t.text(TS.i18n.t("Your message is {diff_count, plural, =1{# character}other{# characters}} too long.","msg_input")({diff_count:l}));if(c&&!a){i.removeClass("hidden");e.removeClass("hidden");n.addClass("showing_snippet_prompt");a=true}else if(!c&&a){e.addClass("hidden");n.removeClass("showing_snippet_prompt");a=false;r=false}};var u;var m;var f=function e(i){if(!u)u=$("#special_formatting_text");var t=i.length>2;if(t&&!m){u.addClass("showing");m=true}else if(!t&&m){u.removeClass("showing");m=false}};var h=function e(i){var t=TS.shared.getActiveModelOb();if(i&&0!==i.indexOf("/")&&i.trim().length)TS.typing.userStarted(t);else TS.typing.userEnded(t)};var g=true;var p;var S=function e(i){if(g&&i&&TS.redux.socket.isConnected()){g=false;p.attr("disabled",false)}else if(!g&&(!i||!TS.redux.socket.isConnected())){g=true;p.attr("disabled",true)}};var T=function e(){p.toggleClass("hidden",!TS.prefs.getPref("msg_input_send_btn"));if(TS.prefs.getPref("msg_input_send_btn")){var i=TS.utility.contenteditable.value(TS.client.ui.$msg_input);S(!!i.trim().length)}else S(false)};var v=function e(i,t){if(i.shiftKey||i.altKey||i.metaKey||i.ctrlKey)return false;var n=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);if(0===n.length)if(i.which==s.up&&n.start<1)return true;else if(i.which==s.down&&n.end>=t.length)return true;return false};var b=function e(i,t){if(!TS.client.ui.isUserAttentionOnChat())return;var n=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:i});if(t)if(TS.model.is_mac)n.metaKey=true;else n.ctrlKey=true;var a=TS.client.msg_input.$input;var r=TS.utility.contenteditable.displayValue(a);if(TS.client.ui.shouldEventTriggerMaybeEditLast(n,a))TS.client.ui.maybeEditLast(n);else if(v(n,r))TS.chat_history.onArrowKey(n,a)};var w="";var y=function e(i){var t;if("/me "===i.substr(0,4)&&i.length>4)t="<i>"+TS.format.formatDefault(TS.format.cleanMsg(i.substr(3)))+"</i>";else if("/shrug "===i.substr(0,7))t=TS.format.formatDefault(TS.format.cleanMsg(i.substr(6)))+" ¯\\_(ツ)_/¯";else if("/"===i.substr(0,1))t="";else t=TS.format.formatDefault(TS.format.cleanMsg(i));t=t||(TS.prefs.getPref("msg_preview_persistent")?"&nbsp;":"");var n=t!=w;w=t;if(n)TS.client.ui.$msg_preview_msg.html(t);if(t&&!TS.model.msg_preview_showing){TS.model.msg_preview_showing=true;TS.client.ui.$msg_preview.removeClass("hidden")}else if(!t&&TS.model.msg_preview_showing){TS.model.msg_preview_showing=false;TS.client.ui.$msg_preview.addClass("hidden")}else if(!n)return;var a=TS.view.last_preview_height;TS.view.measureMsgPreview();var r=TS.view.last_preview_height;if(a!=r)if(TS.boot_data.feature_initial_scroll_position){if(TS.client.ui.areMsgsScrolledToBottom(50))TS.client.ui.instaScrollMsgsToBottom()}else TS.view.resizeManually()};var A=function e(i){var t;var n=TS.shared.getActiveModelOb();var a;if(TS.useReactMessages())a=TS.redux.messages.getRecentMessagesInChannel(n.id);else a=TS.utility.msgs.getDisplayedMsgs(n.msgs);if(a.length)t=_(a).take(5).find(function(e){return!e.is_ephemeral&&!e.no_display});var r=TS.client.ui.maybeHandleReactionCmd(t,i,function(){TS.chat_history.add($.trim(i));TS.view.clearMessageInput()});return r};var k=function e(i,t,n){var a=TS.interop.url.findUrlsInString(i);var r=a.map(TS.utility.getFileIDFromURL);var s=_.compact(r.map(TS.files.getFileById));var o=[];var l=[];s.forEach(function(e){if(TS.files.isFilePrivate(e)&&e.bot_id)o.push(e);else if(t&&t.is_im&&e.user===t.user)o.push(e);else if(TS.files.isFilePrivate(e)&&e.user===TS.model.user.id)o.push(e);else if(TS.files.isFilePrivate(e)&&e.user!==TS.model.user.id)l.push(e)});if(!o.length&&!l.length){n(false);return}if(o.length&&l.length)M(l,i,t,function(){C(o,i,t,n)});else if(o.length)C(o,i,t,n);else if(l.length)M(l,i,t,n)};var C=function e(i,t,n,a){var r=i[0];var s=i.slice(1);var o=true;var l="";TS.files.shareFile(r.id,n.id,l,o,function(){if(s.length>0)e(s,t,n,a);else a(true)})};var M=function e(i,t,n,a){TS.files.reShareConfirmation(i,function(){C(i,t,n,a)})};var I=function e(){var i=TS.shared.getActiveModelOb();if(!i||!TS.permissions.members.canPostInModelOb(TS.model.user,i)||!i.is_im&&!i.is_mpim&&!i.is_channel&&!i.is_group)return"";var t;var n;if(i.is_self_im)t=TS.i18n.t("Jot something down","msg_input")();else{var a;if(i.is_im){a=TS.members.getPrefCompliantMemberNameById(i.user,false,true);a=_.escape(a);n=TS.members.getMemberCurrentStatusForDisplay(i.user,{stop_animations:true});if(n)a+=" "+n}else if(i.is_mpim)a=TS.mpims.getDisplayName(i,false,false,3);else if(i.is_group)a=i.name;else if(i.is_channel)a="#"+i.name;if(!i.is_im)a=_.escape(a);t=TS.i18n.t("Message {msg}","msg_input")({msg:a})}return t};var x=function i(t,n){var a=TS.client.stats&&TS.client.stats.isEnabled();if(a)TS.metrics.mark("msg_input_try_to_submit");var r=TS.format.cleanMsg(TS.utility.contenteditable.value(t));var s;if(TS.boot_data.feature_message_input_byte_limit)s=TS.utility.msgs.charsOverLimit(r)>0;else s=r.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH;if(s){e.highlight(600,"",null,0);if(n)n.preventDefault();return}var o=function e(){var i=TS.utility.contenteditable.value(t);if(TS.view.submit()){TS.chat_history.resetPosition("enter key");TS.utility.contenteditable.clogMentionCounts(i)}else if(!TS.model.is_msg_rate_limited)TS.client.ui.addOrFlashEphemeralBotMsg({channel:TS.model.active_cid,icons:{emoji:":electric_plug:"},username:"connectbot",text:TS.i18n.t("Hmm, your computer seems to be *offline*, so sending messages won’t work at the moment.","msg_input")(),ephemeral_type:"disconnected_feedback"})};if(A(r))return;k(r,TS.shared.getActiveModelOb(),function(){o()})};var E;var B=1e4;var P=function e(){if(E)return;var i=TS.client.ui.$messages_input_container||TS.client.msg_input.$input;i.addClass("pretend-to-be-online");E=setTimeout(function(){i.removeClass("pretend-to-be-online")},B)};var D=function e(){if(!E)return;var i=TS.client.ui.$messages_input_container||TS.client.msg_input.$input;i.removeClass("pretend-to-be-online");clearTimeout(E);E=void 0}})()},4932:function(e,i){(function(){TS.registerModule("client.channel_pane",{onStart:function e(){var i=document.getElementById("col_channels_react_root");TS.interop.mountChannelSidebar(TS.boot_data.team_id,i,function(e){TS.interop.ChannelSidebar=e.getWrappedInstance()})},openChannelBrowser:function e(){if(!i())return TS.sounds.play("beep");TS.model.ui_state.channel_browser_show_which_channels="all";TS.ui.channel_browser.start()},openChannelBrowserToSharedChannels:function e(){if(!i())return TS.sounds.play("beep");TS.model.ui_state.channel_browser_show_which_channels="ext_shared";TS.ui.channel_browser.start()},openCreateChannelDialog:function e(){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;if(!i())return TS.sounds.play("beep");TS.ui.new_channel_modal.start()},openDMBrowser:function e(){if(!i())return TS.sounds.play("beep");TS.ui.im_browser.start()},openAppsBrowser:function e(){if(!i())return TS.sounds.play("beep");TS.ui.apps_browser.start()}});var e=function e(){if(!TS.redux.socket.isConnected()&&!TS.model.change_channels_when_offline)return false;return true};var i=function i(){if(!e())return false;return true}})()},4933:function(e,i){(function(){TS.registerModule("client.channel_header",{onStart:function e(){t=new TS.PresenceList;TS.members.presence_changed_sig.add(u);TS.members.changed_deleted_sig.add(c);TS.dnd.dnd_statuses_changed_sig.add(v);TS.prefs.muted_channels_changed_sig.add(y);TS.groups.member_left_sig.add(g);TS.groups.member_joined_sig.add(g);TS.groups.topic_changed_sig.add(C);TS.groups.converted_to_shared_sig.add(M);TS.channels.member_left_sig.add(g);TS.channels.member_joined_sig.add(g);TS.channels.member_joined_sig.add(H);TS.channels.topic_changed_sig.add(C);TS.channels.joined_sig.add(A);TS.channels.converted_to_shared_sig.add(M);TS.channels.unshared_sig.add(I);TS.pins.pinned_status_changed_sig.add(m);TS.pins.pinned_message_changed_sig.add(m);TS.pins.pinned_message_deleted_sig.add(m);TS.pins.pins_fetched_sig.add(m);TS.channels.joined_sig.add(b);TS.channels.left_sig.add(b);TS.stars.channel_unstarred_sig.add(w);TS.client.threads.reply_count_changed.add(F);i=$("#client_header .channel_header .messages_header");i.bind("mouseover mouseenter",function(e){$("#topic_inline_edit").toggleClass("inline_edit_hover",!!$(e.target).is("#topic_inline_edit"))});if(TS.boot_data.feature_global_nav)TS.client.login_sig.add(TS.client.channel_header.loggedIn)},loggedIn:function e(){if(TS.boot_data.feature_global_nav){$("#global_nav_user_menu_btn").html(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user,36,false,true)).on("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.startWithTeamAndUser(e);e.stopPropagation()});$("#global_nav_back").on("click",function(){window.history.go(-1)});$("#global_nav_forward").on("click",function(){window.history.go(1)})}},test:function e(){var t={_getHiddenChannelJoinAlertMessage:L};Object.defineProperty(t,"_$header",{get:function e(){return i},set:function e(t){i=t}});return t},start:function n(){e=TS.shared.getActiveModelOb();if(!e&&!TS.client.activeChannelIsHidden()){TS.warn("TS.client.channel_header.start cannot find channel, im, or group.");return}var a;var s;var d=false;var c=false;var u;var f=false;var h=false;var g=false;var T;var v;var w;var k;t.clear();if(e){if(e.is_im){T=e;v=TS.members.getMemberById(T.user);a=true;t.add(v.id)}else if(e.is_mpim){w=e;s=true;t.add(w.members)}else if(e.is_channel||e.is_group){g=true;if(TS.model.user.is_restricted&&(!e.topic||!e.topic.value))g=false}d=TS.shared.isModelObPendingShared(e);c=TS.shared.isModelObShared(e);u=e.shared_team_ids;if(d)u=_.concat(u,e.pending_shared);f=TS.shared.isModelObOrgShared(e);if(TS.apps.isAppSpaceEnabled()&&_.get(v,"is_bot"))h=true;k=e.name}var C={model_ob:e,is_shared:c,is_org_shared:f,name:k,member:v,is_dm_or_mpdm:a||s,show_topic:g,mpim:w,details_showing:$("#client-ui").hasClass("details_showing"),all_unreads:{is_showing:TS.model.unread_view_is_showing,has_new_messages:TS.model.unread_view_is_showing&&TS.client.unread.new_messages_in_channels.length,messages_loaded:TS.client.unread.messages_loaded,total_unread_count:TS.client.unread.getTotalMessagesCount(),sort_order:TS.client.unread.getSortOrder()},threads:{is_showing:TS.model.threads_view_is_showing},home_screen:{is_showing:TS.boot_data.feature_sli_home&&TS.model.home_screen_view_is_showing,name:_.get(TS.model.user,"profile.first_name")},apps_dashboard:{is_showing:TS.client.ui.apps_dashboard.isEnabled()&&TS.model.apps_dashboard_view_is_showing},is_app:h,shared_team_ids:u,canvases:{is_enabled:TS.client.ui.canvases_flexpane.isEnabled(),is_showing:$("#client-ui").hasClass("canvases_flexpane_showing")}};i.html(TS.templates.channel_header(C));if(TS.model.active_im_id)S();p();m();A();l();b();y();x();B();E();D();P();if(_.get(window,"desktop.app.updateDragRegion"))o();else i.one("mouseenter",r.bind(this))},updateChannelHeaderInfo:function e(t){i.find("#channel_header_info").html(t)},clearUnreadPinState:function e(){h(false);$("#pinned_item_count .pin_count_new_pin_message").empty()},setActiveTab:function e(t){if(!_.isString(t))return;var n=i.find('[data-target="'+t+'"]');i.find(".channel_header__tab").removeClass("--active");n.addClass("--active")},hideTab:function e(t){if(!_.isString(t))return;var n=i.find('[data-target="'+t+'"]');n.addClass("hidden")},calculateNoDragRegions:function e(){if(a)a()}});var e;var i;var t;var n=false;var a;var r=function e(){if(!TS.model.is_our_app||!TSSSB.nodrag.getIsRequired())return;var i=$("header button, #team_menu").toArray();var t=$("#edit_topic_container")[0]||null;i.push(t);function r(){if(TS.ui.fs_modal.is_showing)return;var n=TSSSB.nodrag.updateElements(i);if(t){var r=t.getBoundingClientRect();TSSSB.call("updateNoDragRegion",{id:"edit_topic_trigger",width:100,height:Math.round(r.height),top:Math.round(r.top),left:Math.round(r.right)})}var s=false;var o=["details_toggle","stars_toggle"];n.forEach(function(e){if(e&&o.indexOf(e.id)>-1&&e.width<3&&e.height<3)s=e});if(s)setTimeout(function(){e();a()},500)}var s=$("#recent_mentions_toggle, #stars_toggle, #search_terms .ql-editor");a=_.debounce(function(){window.requestIdleCallback(r,{timeout:200})},400);if(!n){var o={root:document.querySelector("#client_header"),threshold:1};var l=new IntersectionObserver(a,o);if(t)l.observe(t);n=true}s.off("click.setupNoDragH focus.setupNoDragH blur.setupNoDragH").on("click.setupNoDragH focus.setupNoDragH blur.setupNoDragH",a);$(window).off("resize.setupNoDragH").on("resize.setupNoDragH",a)};var s={};var o=function e(){if(!TS.model.is_our_app||!TSSSB.nodrag.getIsRequired())return;if(!window.ResizeObserver){TS.error("_setupDragRegions: ResizeObserver not defined!");return}var i='<div class="channel_header_drag_region" data-region="name"></div>';var t='<div class="channel_header_drag_region" data-region="info"></div>';$("#channel_name_container").append(i);if($("#channel_header_info .channel_topic_container")[0])$("#channel_header_info .channel_topic_container").append(t);else $("#channel_header_info").append(t);var n=function e(i){var t=i.getBoundingClientRect(),n=t.top,a=t.left,r=t.width,o=t.height;var l=i.getAttribute("data-region");s[l]={id:l,top:n,left:a,width:r,height:o}};var r=new window.ResizeObserver(_.debounce(function(e){var i=true;var t=false;var a=void 0;try{for(var r=e[Symbol.iterator](),o;!(i=(o=r.next()).done);i=true){var l=o.value;if(!l.contentRect.height&&!l.contentRect.width)continue;n(l.target)}}catch(e){t=true;a=e}finally{try{if(!i&&r.return)r.return()}finally{if(t)throw a}}var d=s.name,c=s.info,_=s.main;window.desktop.app.updateDragRegion([d,c,_])},300));$(".channel_header_drag_region").each(function(e,i){r.observe(i);n(i)});var o=s.name,l=s.info,d=s.main;window.desktop.app.updateDragRegion([o,l,d]);a=_.debounce(function(){$(".channel_header_drag_region").each(function(e,i){n(i)});var e=s.name,i=s.info,t=s.main;window.desktop.app.updateDragRegion([e,i,t])},300)};var l=function e(){TS.client.ui.rebuildMemberListToggle()};var d=function i(t,n){if(!TS.redux.socket.isConnected())return;if(!t)return;if(e){var a=TS.membership.getUserChannelMembershipStatus(t.id,e);var r=a.is_known&&!a.is_member;if(n&&!r)l()}T(t)};var c=function e(i){var t=true;d(i,t)};var u=function e(i){var t=false;d(i,t)};var m=function i(t){if(!t)t=e;if(!t)return;var n=$("#pinned_item_count");var a=n.closest(".channel_header_info_item");var r=$("#pinned_item_count_count");var s=t.pinned_items_count;if(!t.has_pins)if(t.is_channel)r.text(TS.i18n.number(0,"client"));else a.addClass("hidden");else if(!s)r.text("");else{r.text(TS.i18n.number(s,"client"));if(!t.is_channel)a.removeClass("hidden")}};var f=function e(i){var t=$("#channel_members_toggle_count .channel_members_icon");if(t.length)t.toggleClass("is_filled",i)};var h=function e(i){var t=$("#pinned_item_count .pinned_count_icon");if(0===t.length)return;t.toggleClass("is_filled",i)};var g=function i(t){if(!e||!t||e.id!==t.id)return;l()};var p=function i(){if(e.is_mpim||e.is_im)return;var t;if(e.is_group||e.is_private){t='<i class="ts_icon ts_icon_lock"></i>';$("#channel_title").prepend(t)}else if(e.is_channel){t="#";$("#channel_title").prepend(t)}};var S=function e(){var i=$("#channel_header_info .channel_header_member_status");var t=TS.ims.getImById(TS.model.active_im_id);var n=TS.members.getMemberById(t.user);var a=TS.templates.makeMemberPresenceStateClass(n);var r=TS.templates.makeMemberPresenceDomClass(n.id);var s=TS.templates.makeMemberDomId(n);i.addClass(a).addClass(r).addClass(s);T(n)};var T=function t(n){if(!TS.model.active_im_id)return;var a=TS.ims.getImById(TS.model.active_im_id);if(n!=TS.members.getMemberById(a.user))return;var r=false;var s;if(TS.shared.isModelObOrgShared(e)){r=true;s=i.find(".ts_icon_shared_channel");s.removeClass("away")}var o;var l=$("#im_title");l.removeClass("away");if("active"===n.presence)o=TS.i18n.t("active","client")();else if("away"===n.presence){o=TS.i18n.t("away","client")();l.addClass("away");if(r)s.addClass("away")}else o=n.presence;if(n.is_restricted)if(n.is_ultra_restricted)o=TS.i18n.t("Single-Channel Guest","client")();else o=TS.i18n.t("Multi-Channel Guest","client")();if(TS.dnd.isMemberInDnd(n))o=TS.i18n.t("notifications snoozed","client")();$("#header_status_message").html(o)};var v=function e(i){if(!i||!i.length)return;if(TS.model.active_im_id){var t=TS.ims.getImById(TS.model.active_im_id);var n=TS.members.getMemberById(t.user);var a=_.map(i,"id");var r=a.indexOf(n.id);if(r>-1)T(n)}};var b=function i(){if(!e)return;var t="";if(TS.model.active_im_id){var n=TS.ims.getImById(TS.model.active_im_id);if(n)t=TS.templates.builders.buildStarWithTip("im",n)}else if(TS.model.active_channel_id){var a=e.is_member||e.is_archived&&e.is_starred;if(a)t=TS.templates.builders.buildStarWithTip("channel",e)}else if(TS.model.active_group_id)t=TS.templates.builders.buildStarWithTip("group",e);else if(TS.model.active_mpim_id)t=TS.templates.builders.buildStarWithTip("mpim",e);$("#star_container").html(_.trim(t))};var w=function i(t){if(!e||!t||e.id!==t.id)return;if(e.is_archived)b()};var y=function i(){if(!e)return;if(TS.client.activeChannelIsHidden())return;if(TS.model.active_im_id)return;var t=['<button type="button" class="btn_unstyle mute_btn ts_tip ts_tip_bottom ts_tip_lazy"',' title="'+TS.i18n.t("Unmute","client")()+'"',">",'<i class="ts_icon ts_icon_bell_slash ts_icon_inherit muted_icon"></i>',"</button>"].join("");var n=$("#mute_container");var a="muted";var r=$("#channel_name");var s=TS.notifs.isCorGMuted(e.id);if(s){n.html(t);r.addClass(a);$(".mute_btn").bind("click",function(){TS.notifs.muteOrUnmuteCorG(e.id)})}else{n.empty();r.removeClass(a)}};var A=function t(){if(!e)return;var n=(e.is_member||e.is_group)&&!TS.model.user.is_ultra_restricted&&!TS.model.user.is_restricted&&(!TS.channels.isChannelRequired(e)||TS.permissions.members.canPostInGeneral(TS.model.user));var a=$("#channel_topic_text");var r=e.topic&&e.topic.value?TS.utility.formatTopicOrPurpose(e.topic.value,true):"";a.html(TS.utility.removeLinksFromTabFlow(r));if(n){$("#topic_inline_edit").addClass("inline_edit_editable");var s=e.is_group?"group-id":"channel-id";a.data(s,e.id);a.data("inline-edit-unformatted",e.topic.value)}k();if(!TS.environment.isSSBAndAtLeastVersion("3.0.0")){var o=i.find("#topic_inline_edit");o.on("click",function(){TSSSB.call("updateNoDragRegion",{id:"channel-topic",width:o.outerWidth(),height:o.outerHeight(),top:o.offset().top,left:o.offset().left})})}};var k=function e(){var i=TS.model;if(i.is_IE)$("#topic_inline_edit").addClass("in_ie")};var C=function e(){if(TS.ui.inline_edit.containsActiveElement(i))return;TS.client.channel_header.start()};var M=function e(){TS.client.channel_header.start()};var I=function e(i){var t=TS.shared.getActiveModelOb();if(i&&t&&i.id===t.id)TS.client.channel_header.start()};var x=function i(){if(!e)return;U();if(TS.model.active_im_id){var t=TS.ims.getImById(TS.model.active_im_id);var n=TS.members.getMemberById(t.user);TS.client.msg_pane.maybeSetupCalls(n)}else if(TS.model.active_channel_id||TS.model.active_group_id)TS.client.msg_pane.maybeSetupCalls();else if(TS.model.active_mpim_id){var a=TS.mpims.getMpimById(TS.model.active_mpim_id);TS.client.msg_pane.maybeSetupCalls(false,a)}$(".channel_calls_button").addClass("blue_on_hover")};var E=function e(){if(TS.model.unread_view_is_showing){$("#channel_header_unread_refresh").on("click",function(){TS.client.unread.reload()});if(TS.model.unread_view_is_showing)i.on("click",".channel_header_info_sort_order",TS.menu.startWithAllUnreadsSortOrderMenu)}};var B=function i(){if(TS.client.activeChannelIsHidden())return;if(TS.onboarding.inOnboarding())return false;var t=$("#channel_actions_toggle, #channel_name");if(e.is_im){var n=TS.ims.getImById(TS.model.active_im_id);t.on("click.channel_actions",function(e){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}});if(n)TS.menu.member.startWithMember(e,n.user,false,false,true)})}else if(e.is_channel||e.is_mpim)t.on("click.channel_actions",function(i){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}});TS.menu.channel.startWithChannel(i,e.id)});else if(e.is_group)t.on("click.channel_actions",function(i){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}});TS.menu.group.startWithGroup(i,e.id)})};var P=function e(){$("#edit_topic_trigger, #edit_topic_container").on("click keydown",function(e){if("keydown"===e.type&&!(e.which===TS.utility.keymap.enter||e.which===TS.utility.keymap.space))return;if("a"===e.target.tagName.toLowerCase())return;TS.ui.channel_topic_dialog.start()})};var D=function e(){if(!TS.apps.isAppSpaceEnabled())return;TS.client.ui.app_space.verifyTabs();$('[data-action="toggleAppSpaceView"]').on("click",function(){var e=$(this).data("target");TS.client.ui.app_space.toggleView(e)})};var U=function e(){$(".channel_calls_button").remove()};var F=function e(i){var t=$("#channel_header_info.threads_channel_header_info");var n;if(!i)n=TS.i18n.t("No new replies","threads")();else n=TS.i18n.t("{new_reply_count,plural,=1{{new_reply_count} new reply}other{{new_reply_count} new replies}}","threads")({new_reply_count:i});t.text(n)};var O=5e3;var R={};var N;var H=function e(i,t,n){if(n){R[i.id]=R[i.id]||[];R[i.id].push(t.name);Q()}};var Q=function e(){var i=$("#channel_members_toggle_count");var t=TS.model.active_channel_id;var n=R[t]||[];var a=0===n.length;var r=_.isEqual(n,[TS.model.user.name]);if(a||r)return;var s=L(n);TS.tips.updateTipTitle(i,s);if(N)clearTimeout(N);else f();N=setTimeout(function(){f();TS.client.ui.rebuildMemberListToggle();R={};N=null},O)};var L=function e(i){if(_.isEmpty(i))return"";var t=i.slice(0,3).map(function(e){return"@"+e});if(i.length>3)t.push("others");return TS.i18n.t("{num_member_names, plural, =1{{first_member_name} has joined the channel} =2{{first_member_name} and {second_member_name} have joined the channel} other{{members} have joined the channel}}","jobs")({num_member_names:t.length,first_member_name:t[0],second_member_name:t[1],members:TS.i18n.listify(t).join("")})}})()},4934:function(e,i){(function(){TS.registerModule("ui.channel_topic_dialog",{onStart:function e(){TS.channels.switched_sig.add(n)},start:function e(){var n='<div id="topic_dialog_input_container"></div>\n\t\t\t\t<label for="channel_topic_validation"></label>';TS.generic_dialog.start({backdrop_click_to_dismiss:true,body:n,dialog_class:"channel_topic_dialog",go_button_text:TS.i18n.t("Set Topic","channel_topic_dialog")(),onShow:i,onGo:t})},test:function e(){return{}}});var e="";var i=function i(){var t=$("#generic_dialog.channel_topic_dialog");var n=t.find("#topic_dialog_input_container");var a=["channels","emoji","members"];TS.ui.inline_msg_input.make(n,{aria_label:TS.i18n.t("Add a topic","channel_topic_dialog")(),complete_member_specials:false,no_emo:false,placeholder:TS.i18n.t("Add a topic","channel_topic_dialog")(),onEnter:TS.generic_dialog.go,onEscape:TS.generic_dialog.cancel,completers:a,autocomplete_below_input:true,onTextChange:function e(){TS.ui.validation.validate(n)}});var r=n.find(".message_input");var s=TS.shared.getActiveModelOb().topic.value;e=TS.utility.unformatTopicOrPurpose(s);TS.utility.contenteditable.value(r,e);r.attr("data-validation","maxlength=250");r.attr("data-validation-for","channel_topic_validation");r.addClass("no_validation_padding");TS.generic_dialog.div.on("shown",function e(){TS.generic_dialog.div.off("shown",e);TS.utility.contenteditable.focus(r);TS.utility.contenteditable.selectAll(r)})};var t=function i(){var t=$("#topic_dialog_input_container .message_input");if(!TS.ui.validation.validate(t))return false;var n=TS.shared.getActiveModelOb();var a=TS.utility.contenteditable.value(t);a=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(a,{complete_member_specials:false});if(a===e)return;if(n.is_channel)TS.channels.setTopic(n.id,a);else if(n.is_group)TS.groups.setTopic(n.id,a)};var n=function e(){var i=$("#topic_dialog_input_container .message_input");if(i.length)TS.generic_dialog.cancel()}})()},4935:function(e,i){(function(){TS.registerModule("client.flex_pane",{onStart:function e(){o.init();$("#flex_contents").delegate("div.file_list_item","dragstart",i)},startLocalTimeInterval:function e(){clearInterval(a);a=setInterval(r,6e4);r()},stopLocalTimeInterval:function e(){clearInterval(a)},maybeFetchFileList:function i(){if(!TS.model.team)return;if(!TS.model.ui_state||!TS.model.ui_state.flex_visible||"files"!==TS.model.ui_state.flex_name||TS.model.ui_state.flex_extra)return;var a=(_.isArray(TS.model.file_list_types)&&TS.model.file_list_types||["all"]).sort().join(",");var r=$("#file_list").data("list");var s;if("all"===r){s=t("team",a);if(!e[s]){e[s]=true;TS.files.fetchTeamFiles(a,n)}return}var o=$("#file_list").data("filter-user")||"";if(!o)return;s=t(o,a);if(!e[s]){e[s]=true;TS.files.fetchMemberFiles(o,a,n)}}});var e={};var i=function e(i){var t=false;if(TS.boot_data.feature_arugula){var n=i.target.dataset?i.target.dataset.dragMeta:null;if(i&&i.originalEvent.dataTransfer&&n){i.originalEvent.dataTransfer.effectAllowed="link";i.originalEvent.dataTransfer.setData("x-slack/file-drag-json",n);t=true}}if(!t)i.preventDefault()};var t=function e(i,t){i=i||"team";t=t||"all";return i+"_"+t};var n=function i(n,a,r){if(!n){delete e[t(r.user,r.types)];return}TS.view.files.throttledRebuildList()};var a;var r=function e(){TS.utility.throttle.method(s,"view_tz_labels",1e3)};var s=function e(){var i;var t=$(".timezone_label");var n=[];t.each(function(e,t){t=$(t);i=TS.members.getMemberById(t.data("member-id"));if(!i){n.push("");return}var a=i&&i.tz?i.tz:"America/Los_Angeles";var r=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[i.tz]&&TS.boot_data.dst_offsets[i.tz].tz_offset?TS.boot_data.dst_offsets[i.tz].tz_offset:-25200;n.push(TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:a,timeZoneOffset:r,do24hrTime:TS.utility.date.do24hrTime()}));i=null;t=null});t.each(function(e,i){i=$(i);i.find(".timezone_value").text(n[e]);i=null});t=null};var o=function(){var e;var i;var t;var n=500;var a=3e3;var r=400;var s=300;var o;var l=function i(a){TS.view.rebuildMentions();if(!a)return;clearTimeout(t);t=setTimeout(function(){if(e)return;c()},n)};var d=function e(){$(".flex_header").append('<div id="rxn_toast_div" class="hidden ts_tip ts_tip_bottom"></div>');o=$("#rxn_toast_div");o.on("click",function(){var e="mentions";if(!TS.model.ui_state.flex_visible||TS.model.ui_state.flex_name!==e)TS.client.ui.flex.openFlexTab(e);m()});o.on("mouseenter",function(){$("html").unbind("mousemove.rxn_toast");u()});o.on("mouseleave",function(){_()})};var c=function i(){var t=TS.rxns.getNextRxnRecordThatNeedsAlert();if(!t)return;if(!t.emoji)return TS.error("rxn_record.emoji missing");if(!Object.keys(t.emoji).length)return TS.error("rxn_record.emoji is empty");e=t;var n=TS.rxns.need_alerts[t.rxn_key];if(!n)TS.error("WTF no since");var a=0;var r;var l;Object.keys(t.emoji).forEach(function(e){t.emoji[e].forEach(function(i){if(i.was_toasted)return;if(i.when<n)return;i.rxn_source=t.source;a+=1;if(!r||i.when<r.when){r=i;l=e}})});if(!l){TS.error("WTF no emoji_name");TS.dir(0,t,"rxn_record")}if(r)r.was_toasted=true;else{TS.error("oldest_who_when is undefined.");return}if(1==a)delete TS.rxns.need_alerts[t.rxn_key];var d=TS.shared.getModelObById(r.rxn_source);var c;if(d.is_im)c=TS.i18n.t("Direct Message","flex_pane")();else if(d.is_group&&d.is_mpim)c=TS.mpims.getDisplayName(d,false);else if(d.is_group||d.is_private)c=d.name;else if(d.is_channel)c="#"+d.name;var u=TS.members.getPrefCompliantMemberNameById(r.id,true);var m='<span class="ts_tip_tip"><span>&nbsp;&nbsp;'+u+"&nbsp;&nbsp;</span><br><span>"+c+"</span></span>";var f=TS.emoji.graphicReplace(":"+l+":");if(t.url)f='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>';f+=m;var h=o.css("top");var g=-(50+o.height());var p=o.find(".ts_tip_tip").outerWidth()>150?"ts_tip_rightish":"";o.html(f).removeClass("hidden");o.addClass(p).css({opacity:0,top:g}).transition({opacity:1,top:h},s);_();$("#client-ui").addClass("rxn_toasting");$("html").bind("mousemove.rxn_toast",_)};var _=function e(){clearTimeout(i);i=setTimeout(m,a)};var u=function e(){clearTimeout(i);o.css("opacity",1)};var m=function e(){u();o.transition({opacity:0},r);$("html").unbind("mousemove.rxn_toast");i=setTimeout(function(){o.addClass("hidden");$("#client-ui").removeClass("rxn_toasting");f()},r+1)};var f=function i(){e=null;c()};return{init:function e(){d();TS.rxns.rxn_records_changed_sig.add(TS.utility.throttleFunc(l,100,true))}}}()})()},4936:function(e,i){(function(){TS.registerModule("client.msg_pane",{last_render_time:null,last_rendered_msg:null,last_in_stream_msg:null,dont_check_unreads_til_switch:false,date_change_timer:null,new_msgs_bar_showing:false,did_rebuild_msgs_sig:new signals.Signal,onStart:function e(){h=new TS.PresenceList;TS.team.team_email_domain_changed_sig.add(x,TS.client.msg_pane);TS.team.team_domain_changed_sig.add(x,TS.client.msg_pane);TS.team.team_name_changed_sig.add(x,TS.client.msg_pane);TS.prefs.team_auth_mode_changed_sig.add(x,TS.client.msg_pane);TS.prefs.team_allow_calls_changed_sig.add(O,TS.client.msg_pane);TS.prefs.team_calling_app_name_changed_sig.add(O,TS.client.msg_pane);TS.utility.calls.started_platform_call_sig.add(F,TS.client.msg_pane);TS.members.changed_admin_perms_sig.add(x,TS.client.msg_pane);TS.prefs.dtop_notif_changed_sig.add(L);TS.prefs.team_perms_pref_changed_sig.add(L);TS.prefs.muted_channels_changed_sig.add(L);TS.ui.growls.permission_changed_sig.add(L);TS.channels.converted_to_shared_sig.add(v);TS.groups.converted_to_shared_sig.add(v);TS.channels.shared_teams_updated_sig.add(b);TS.groups.shared_teams_updated_sig.add(b);TS.channels.shared_invite_pending_sig.add(TS.client.msg_pane.updateEndMarker);TS.channels.shared_invite_revoked_sig.add(TS.client.msg_pane.updateEndMarker);TS.channels.shared_invite_accepted_sig.add(TS.client.msg_pane.updateEndMarker);TS.channels.unshared_sig.add(TS.client.msg_pane.updateEndMarker);if(TS.client&&TS.client.highlights){TS.client.highlights.updated_sig.add(TS.client.msg_pane.maybeRenderHighlightedMessages);TS.client.highlights.feedback_submitted_sig.add(TS.client.msg_pane.maybeRenderHighlightedMessageFeedback)}TS.client.msg_pane.initDateChange();if(J)TS.channels.switched_sig.add(function(){ee={};ie=0;te=0});if(bowser&&bowser.msie&&bowser.version<11&&f)f+=" hidden"},initDateChange:function e(){var i=15;if(!TS.client.msg_pane.date_change_timer)TS.client.msg_pane.date_change_timer=window.setInterval(function(){TS.utility.throttle.method(TS.client.msg_pane.checkForDateChange,"date_change_check",1e3)},6e4*i)},checkForDateChange:function e(){if(TS.model&&TS.model.active_cid&&TS.client.msg_pane.last_render_time&&TS.client.msg_pane.last_render_time.getDay()!==(new Date).getDay())TS.client.msg_pane.rebuildMsgsWithReason("TS.client.msg_pane.checkForDateChange")},rebuildChannelMembersList:function e(){if(TS.members.is_in_bulk_upsert_mode){if(!n){n=true;TS.members.batch_upserted_sig.addOnce(function(){n=false;TS.client.msg_pane.rebuildChannelMembersList()})}return}TS.client.ui.rebuildMemberListToggle()},rebuildMsgsWithReason:function e(i,t){if(TS.useReactMessages())return;if(t){if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_msgs_rebuild_throttled");if(!_.isEmpty(p)&&i)p+=", ";p+=i;S+=1;if(g)return;A(p);g=true;setTimeout(function(){if(S>1){A(p);TS.metrics.count("rebuild_msgs_with_reason_throttles",S)}g=false;p="";S=0},1e3)}else A(i)},setInitialScrollPosition:function e(i){if(TS.useReactMessages())return;if(!TS.prefs.prefs_loaded)return;var t=TS.shared.getActiveModelOb();if(TS.prefs.getPref("start_scroll_at_oldest"))if(t.unread_cnt){TS.client.ui.instaScrollMsgsToBottom(false);TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}else if(i>0){if(TS.client.ui.$msgs_scroller_div.length)TS.client.ui.$msgs_scroller_div[0].scrollTop=i}else TS.client.ui.instaScrollMsgsToBottom(false);else TS.client.ui.instaScrollMsgsToBottom(false);t._has_auto_scrolled=true},displayTitle:function e(){TS.client.channel_header.start()},clearUnreadDivider:function e(){if(!TS.client.ui.$msgs_unread_divider)return;if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.clearUnreadDivider: removing TS.client.ui.$msgs_unread_divider");TS.client.ui.$msgs_unread_divider.remove();TS.client.ui.$msgs_unread_divider=null;$(".day_container.unread_day_container").removeClass("unread_day_container")},hideMessageContainer:function e(){if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.hideMessagePane());d.addClass("hidden");c.addClass("hidden")},showMessageContainer:function e(){d.removeClass("hidden");c.removeClass("hidden");if(TS.useReactMessages()){var i=TS.shared.getActiveModelOb();if(!i)return;TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannelIfNotActive({channelId:i.id}))}},hideCenterWorkspace:function e(){u.addClass("hidden")},showCenterWorkspace:function e(){u.removeClass("hidden")},maybeHideNewMsgsBar:function e(i){if(TS.useReactMessages())return;var t=true;TS.client.msg_pane.maybeClearNewMsgsTimer(null,t);if(!TS.prefs.getPref("mark_msgs_read_immediately")){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeHideNewMsgsBar: no mark_read_immediately pref - hiding now");TS.client.msg_pane.hideNewMsgsBar()}else{if(i&&("esc"===i||"clicked"===i)){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeHideNewMsgsBar: hiding immediately because reason = "+i);TS.client.msg_pane.hideNewMsgsBar();return}var n=TS.shared.getActiveModelOb();if(n&&!n._temp_unread_cnt&&!n.unread_cnt){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeHideNewMsgsBar: no _temp_ or unread_cnt - setting a timer to hide new msgs bar for "+n.id);TS.client.msg_pane.maybeStartNewMsgsTimer(n)}}},clearUnreadDividerAndHideNewMsgsBar:function e(i){TS.client.msg_pane.clearUnreadDivider();TS.client.msg_pane.maybeHideNewMsgsBar(i)},maybeClearUnreadDivider:function e(i,t){if(TS.useReactMessages())return;if(!i||!t)return;if(!i.unread_cnt&&t.user&&t.user==TS.model.user.id){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeClearUnreadDivider: clearing because you sent a message in "+i.id+" and unread_cnt = "+i.unread_cnt);TS.client.msg_pane.clearUnreadDivider();TS.utility.msgs.maybeClearPrevLastRead()}},assignLastReadMsgDiv:function e(i){if(TS.useReactMessages())return;var t;if(!i)return;if(!i.msgs.length)return;var n=i._prev_last_read||i.last_read;t=TS.utility.msgs.getMsg(n,i.msgs);if(t&&!TS.utility.msgs.isMsgHidden(t)&&!TS.utility.msgs.isMsgRolledUp(t)){s=TS.client.msg_pane.getCanonicalDivForMsg(n);return}var a=TS.utility.msgs.getOldestValidTs(i);if(n>a){t=TS.utility.msgs.getDisplayedMsgBeforeTS(n,i.msgs);if(t)s=TS.client.msg_pane.getCanonicalDivForMsg(t.ts);else{s=null;TS.error("nulling out _$last_read_msg_div because we could not find a message to use #1")}}else s=null},insertUnreadDivider:function e(){if(TS.client.ui.$msgs_unread_divider)return;var i=TS.shared.getActiveModelOb();if(!i){TS.error("insertUnreadDivider no channel, no im, no group");return}if(TS.model.seen_onboarding_this_session&&i.id==TS.model.welcome_model_ob.id||!TS.client.msg_pane.last_in_stream_msg){C();return}var t=false;var n;if(!TS.model.ui.is_window_focused)TS.client.msg_pane.clearUnreadDivider();if(TS.model.ui.is_window_focused)n=i._prev_last_read||i.last_read;else n=i.last_read;var a=TS.client.msg_pane.is_rebuilding;if(i.unread_cnt&&TS.client.msg_pane.last_in_stream_msg&&!TS.client.msg_pane.dont_check_unreads_til_switch)if(a||!TS.model.ui.is_window_focused){if(TS.has_pri[z])TS.log(z,"TS.view.addMsg() on "+i.id+": inserting red line because is_rebuild, or window not focused.")}else if(TS.model.ui.is_window_focused){var r=TS.client.ui.isMsgInView(TS.client.msg_pane.last_in_stream_msg.ts);if(r){if(i.is_im){if(TS.has_pri[z])TS.log(z,"TS.view.addMsg() on "+i.id+": clearing red line because new msg is in view.");TS.client.msg_pane.clearUnreadDivider()}TS.utility.msgs.maybeClearPrevLastRead();t=true}else if(TS.has_pri[z])TS.log(z,"TS.view.addMsg() on "+i.id+": inserting red line because new msg is out of view.")}if(TS.notifs.isCorGMuted(i.id)){if(TS.has_pri[z])TS.log(z,"insertUnreadDivider(): "+i.id+" is muted - exiting");return}if("0000000000.000000"===n){if(TS.has_pri[z])TS.log(z,"insertUnreadDivider(): "+i.id+" last_read is zero ("+n+") - not inserting.");t=true}if(s){var o=TS.client.msg_pane.getCanonicalDivForMsg(i.last_read);if(o){var l=o.nextAll();if(l.length>0){var d=_.every(l,function(e){return $(e).hasClass("hidden")});if(d)t=true}}}if((!t||TS.boot_data.feature_scrollback_half_measures)&&(i.unread_cnt&&n<TS.client.msg_pane.last_in_stream_msg.ts||n<TS.client.msg_pane.last_in_stream_msg.ts)){var c=TS.templates.messages_unread_divider();var u=false;if(TS.boot_data.feature_scrollback_half_measures&&t)u=true;if(s&&s.length)s.after(c);else{var m=TS.utility.msgs.getOldestValidTs(i);if(n>m){var f=TS.utility.msgs.getDisplayedMsgAfterTS(n,i.msgs);var h;if(f)h=TS.client.msg_pane.getCanonicalDivForMsg(f.ts);if(h&&h.length)h.before(c);else TS.client.ui.$msgs_div.find(".message").last().before(c)}else{TS.client.ui.$msgs_div.find(".message").first().before(c);if(TS.boot_data.feature_scrollback_half_measures)u=true}}TS.client.ui.$msgs_unread_divider=$("#msgs_unread_divider");TS.client.ui.$msgs_unread_divider.data("last_read_ts",n);if(u)TS.client.ui.$msgs_unread_divider.addClass("invisible");if(i.unread_cnt)$(".unread_divider").removeClass("no_unreads");else $(".unread_divider").addClass("no_unreads");if((TS.client.ui.$msgs_unread_divider.next(".day_divider").length||TS.client.ui.$msgs_unread_divider.is(":last-child"))&&!u){TS.client.ui.$msgs_unread_divider.addClass("adjacent_to_date");TS.client.ui.$msgs_unread_divider.closest(".day_container").next(".day_container").addClass("unread_day_container")}}var g=i._temp_unread_cnt||i.unread_cnt;var p=i._temp_last_read||i.last_read;if(p<TS.client.msg_pane.last_in_stream_msg.ts&&g){C();var S=$("#messages_unread_status");if(TS.client.ui.isUnreadDividerInView()){S.addClass("quiet no_jump");S.off("click mouseenter mouseleave");S.click(function(e){e.preventDefault();TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.clicked)})}else{S.removeClass("quiet no_jump");S.off("click mouseenter mouseleave");S.click(function(e){e.preventDefault();TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()})}TS.client.msg_pane.showNewMsgsBar();TS.client.msg_pane.startNewMsgsTimer();S=null}C()},updateEndMarker:function t(){if(TS.useReactMessages())return;var n=TS.shared.getActiveModelOb();if(!n){TS.error("updateEndMarker no channel, no im, no group");return}h.clear();var a=$("#end_display_meta");var r=$("#end_display_padder");var s=$("#end_display_div");var o=$("#end_display_msg_lim");var l=$("#end_display_msg_lim_bottom_margin");var d=$("#end_div");var c=$("#end_display_status");var u=$("#channel_meta");var m=$("#group_meta");var f=TS.boot_data.team_limit_ts>0;var g="";var p=false;var S;var T;if(n.history_fetch_failed)g=TS.i18n.t('Retrieving history failed. <a onclick="TS.client.ui.doLoadScrollBackHistory(true)">Try again?</a>',"client")();else if(n.history_is_being_fetched){g=TS.i18n.t("Retrieving history...","client")();if(J&&n.is_channel){var v=TS.console.getStackTrace();if(v&&v.indexOf("fetchHistory")>0){ne=true;ie+=1;te+=1;TS.metrics.mark("legacy_history_load_latency")}}}else{S=TS.utility.msgs.getOlderMsgsStatus(n);if(1==TS.qs_args.test_is_limited&&!S.more)S.is_limited=true;if(S.more){if(!(TS.model.seen_onboarding_this_session&&n.id==TS.model.welcome_model_ob.id))g='<a onclick="TS.client.ui.doLoadScrollBackHistory(true)">'+TS.i18n.t("And more...","client")()+"</a>"}else if(!TS.onboarding.shouldShowFirstWelcome())p=true}if(n.is_slackbot_im)T=35;else if(n.is_mpim||n.is_im)T=33;else if(n.is_channel||n.is_group)T=34;if(f&&S&&S.is_limited&&p&&!n.is_slackbot_im&&!e){i=true;var b;var w=$("#msg_lim_header_btn");$("#slackbot_meta").addClass("hidden");a.addClass("hidden");r.addClass("hidden");u.addClass("hidden");m.addClass("hidden");$("#im_meta").addClass("hidden");$(".not_limited_copy").addClass("hidden");$(".msg_lim_header_copy").addClass("hidden");if(n.is_im||n.is_mpim){$(".msg_lim_dm_h1").removeClass("hidden");$(".msg_lim_channel_h2").addClass("hidden");$(".msg_lim_dm_h2").removeClass("hidden")}else if(n.is_channel||n.is_group){var A=TS.templates.builders.makeChannelPrefix(n);$(".channel_name_msg_lim").html(A+n.name);$(".msg_lim_channel_h1").removeClass("hidden");$(".msg_lim_channel_h2").removeClass("hidden")}b=w.attr("href");b=TS.interop.url.setQueryStringValue(b,"ui_element",T);b=decodeURIComponent(b).substr(1);w.attr("href",b);w.data("data-clog-ui-element",T);l.css("min-height","30px");l.removeClass("hidden");s.addClass("msg_lim_styling");s.removeClass("not_msg_lim_styling");o.removeClass("hidden");d.addClass("end_div_msg_lim");d.css("margin-top","0");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:T}}})}else if(p){a.removeClass("hidden");o.addClass("hidden");d.removeClass("end_div_msg_lim");l.addClass("hidden");if(i){s.removeClass("msg_lim_styling");s.addClass("not_msg_lim_styling")}d.css("margin-top","auto");if(n.is_channel||n.is_group){var k=TS.interop.datetime.toCalendarDateOrNamedDay(n.created);var C=TS.interop.datetime.toDateObject(n.created);var M;if(TS.interop.datetime.isYesterday(C)||TS.interop.datetime.isToday(C))M=$.trim(k.toLowerCase());else M=TS.i18n.t("on {date}","client")({date:k});var I=TS.members.getPotentiallyUnknownMemberById(n.creator);var E;var B;var P;var D;var U;if(n.is_mpim){u.addClass("hidden");m.addClass("hidden");$("#im_meta").removeClass("hidden");$("#slackbot_meta").addClass("hidden");G(n)}else if(n.is_group){u.addClass("hidden");m.removeClass("hidden");$("#im_meta").addClass("hidden");$("#slackbot_meta").addClass("hidden");E=false;B=true;$(".group_meta_name").html(TS.templates.builders.makeGroupLink(n,{omit_prefix:E,show_tooltip:B}));$(".group_meta_name").find("a").addClass("ocean_teal").bind("click",function(e){e.preventDefault();TS.menu.group.startWithGroup(e,$(e.target).data("group-id"))});if(TS.boot_data.page_needs_enterprise){P=m.find(".end_action_integration").parent();if(n.is_org_shared){D=y(n);P.addClass("hidden")}else P.removeClass("hidden")}$("#group_created_meta").html(TS.templates.channel_created({creator:{is_self:I&&I.is_self,user:I?new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(I)):false},date:M,shared:D||false,private:true}));$("#group_meta_archived_parent").addClass("hidden");if(n.parent_group){var F=TS.groups.getGroupById(n.parent_group);if(F){$("#group_meta_archived_parent").removeClass("hidden");$("#group_meta_archived_parent_link").attr("href","/archives/"+F.id).text(F.name)}}if(n.purpose.value){$("#group_meta_purpose_container").removeClass("hidden");$("#group_meta_purpose").html(TS.utility.formatTopicOrPurpose(n.purpose.value));$("#group_meta_purpose_prompt").addClass("hidden");$(".end_action_purpose").closest("li").addClass("hidden")}else{$("#group_meta_purpose_container").addClass("hidden");$(".end_action_purpose").closest("li").removeClass("hidden")}}else if(n.is_channel){u.removeClass("hidden");m.addClass("hidden");$("#im_meta").addClass("hidden");$("#slackbot_meta").addClass("hidden");E=false;B=true;$(".channel_meta_name").html(TS.templates.builders.makeChannelLink(n,{omit_prefix:E,show_tooltip:B}));$(".channel_meta_name").find("a").bind("click",function(e){e.preventDefault();TS.menu.channel.startWithChannel(e,$(e.target).data("channel-id"))});if(TS.boot_data.page_needs_enterprise){P=u.find(".end_action_integration").parent();if(n.is_org_shared){D=y(n);P.addClass("hidden")}else P.removeClass("hidden")}if(TS.shared.isModelObShared(n)||TS.shared.isModelObPendingShared(n)){var O=TS.utility.teams.getTeamsForModelOb(n,{include_pending:true});O.unshift(TS.model.team);D={model_ob:n,ext_shared:true,shared_teams:O};if(TS.shared.isModelObPendingShared(n)){D.is_pending=true;D.pending_teams=_.filter(O,function(e){return _.indexOf(n.pending_shared,e.id)>-1})}TS.client.msg_pane.updateSharedChannelForeword()}else{$(".p-shared_team_icons").addClass("hidden");$(".channel_meta_name").removeClass("hidden");$(".channel_meta_end").removeClass("hidden")}$("#channel_created_meta").html(TS.templates.channel_created({creator:{is_self:I&&I.is_self,user:I?new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(I)):false},date:M,shared:D||false}));if(n.purpose.value){$("#channel_meta_purpose_container").removeClass("hidden");$("#channel_meta_purpose").html(TS.utility.formatTopicOrPurpose(n.purpose.value));$("#channel_meta_purpose_prompt").addClass("hidden");$(".end_action_purpose").closest("li").addClass("hidden")}else{$("#channel_meta_purpose_container").addClass("hidden");$(".end_action_purpose").closest("li").removeClass("hidden")}}$(".end_action_purpose").off("click").on("click.show_purpose_dialog",function(){TS.ui.purpose_dialog.start(n)});if(TS.apps.permissions.areXoxaAppsInstalled())$(".end_action_integration").off("click").on("click",function(e){e.preventDefault();TS.ui.apps_browser.startAddApps()});else $(".end_action_integration").attr("href","/apps/new?channel="+n.id);$(".end_action_invite").off("click").on("click.show_invite_dialog",function(){TS.ui.channel_invite_modal.startInviteToChannelModal(n.id)});$("#channel_created_meta").off("click","[data-channel-shared-teams]").on("click","[data-channel-shared-teams]",function(){TS.ui.enterprise_teams_dialog.show(TS.shared.getActiveModelOb())});x()}else if(n.is_slackbot_im){u.addClass("hidden");m.addClass("hidden");$("#im_meta").addClass("hidden");$("#slackbot_meta").removeClass("hidden");U=TS.members.getPotentiallyUnknownMemberById(n.user);var R=TS.prefs.getTeamPref("compliance_export_start")||0;var N=R&&!!TS.prefs.getTeamPref("compliance_export_start");$("#slackbot_meta").html(TS.templates.slackbot_badge({member:U,compliance_exports_enabled_for_team:N,compliance_export_start:R}))}else{u.addClass("hidden");m.addClass("hidden");$("#im_meta").removeClass("hidden");$("#slackbot_meta").addClass("hidden");U=TS.members.getPotentiallyUnknownMemberById(n.user);if(U){h.add(U.id);$("#im_meta").html(TS.templates.dm_badge({member:U,model_ob:n,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),compliance_export_start:TS.prefs.getTeamPref("compliance_export_start")||0,show_bot_about_link:TS.apps.isAppSpaceEnabled()&&U.is_bot}));$("[data-bot_about_link]").on("click",function(){TS.client.ui.app_space.toggleView("about");TS.clog.track("APP_SPACE_ABOUT_CLICKED",{about_clicked_from_bot_dm:true})})}}}else{a.addClass("hidden");o.addClass("hidden");d.removeClass("end_div_msg_lim");l.addClass("hidden")}if(f&&S&&S.is_limited&&n.is_slackbot_im&&e){i=true;var H=!!window.navigator.userAgent.match("Trident");if(H){l.css("min-height","55px");l.removeClass("hidden")}$("#slackbot_msg_lim").removeClass("hidden");$(".msg_lim_copy").removeClass("hidden");$(".not_limited_copy").addClass("hidden");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:T}}})}else{$(".msg_lim_copy").addClass("hidden");d.removeClass("wave");$(".not_limited_copy").removeClass("hidden")}if(n.is_channel&&TS.shared.isModelObShared(n))$(".not_limited_copy").addClass("hidden");if(g){c.removeClass("hidden");c.html(g)}else c.addClass("hidden")},clearBlueBarTimer:function i(){var t=TS.shared.getActiveModelOb();if(t)if(t.is_slackbot_im)e=true;else e=false;if(!l)return;if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.clearBlueBarTimer: clearing timer of "+l);clearTimeout(l);l=null},maybeClearNewMsgsTimer:function e(i,t){if(!o)return;var n=TS.shared.getActiveModelOb();if(!t&&i&&i.id!==n.id)return;if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeClearNewMsgsTimer: clearing _onNewMsgsTimer of "+o);clearTimeout(o);o=null},maybeStartNewMsgsTimer:function e(i){if(o){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeClearNewMsgsTimer: NOT clearing msgs timer because one already exists of "+o);return}var t=TS.shared.getActiveModelOb();if(i&&i.id!==t.id){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeClearNewMsgsTimer: NOT starting a new timer because related_model_ob "+i.id+" !== "+t.id);return}if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.maybeClearNewMsgsTimer: starting _onNewMsgsTimer while on "+t.id);TS.client.msg_pane.startNewMsgsTimer()},startNewMsgsTimer:function e(){if(o){if(TS.has_pri[Y])TS.log(Y,"startNewMsgsTimer: clearing _new_msgs_tim of "+o);clearTimeout(o);o=null}o=setTimeout(I,1500);if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.startNewMsgsTimer: set timer ID = "+o+" while on "+TS.shared.getActiveModelOb().id)},showNewMsgsBar:function e(){if(TS.client.activeChannelIsHidden())return;var i=TS.shared.getActiveModelOb();if(i&&TS.notifs.isCorGMuted(i.id)){if(TS.has_pri[Y])TS.log(Y,"insertUnreadDivider(): "+i.id+" is muted - exiting");return}if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.showNewMsgsBar");C();$("#messages_unread_status").removeClass(f);TS.client.msg_pane.new_msgs_bar_showing=true;TS.client.msg_pane.topMessagesBannerShown()},hideNewMsgsBar:function e(i){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.hideNewMsgsBar");TS.client.msg_pane.clearBlueBarTimer();if(!i&&TS.prefs.getPref("mark_msgs_read_immediately")){var t=TS.shared.getActiveModelOb();if(t&&(t._temp_unread_cnt||t.unread_cnt)){if(TS.has_pri[Y])TS.log(Y,"TS.client.msg_pane.hideNewMsgsBar: NOT hiding because read state pref is mark_msgs_read_immediately, and the model still has some unreads. _temp_unread_cnt = "+t._temp_unread_cnt+", unread_cnt = "+t.unread_cnt);TS.client.msg_pane.maybeStartNewMsgsTimer(t);return}}$("#messages_unread_status").addClass(f);TS.client.msg_pane.new_msgs_bar_showing=false;TS.client.msg_pane.topMessagesBannerHidden()},checkUnreads:function e(){if(TS.useReactMessages())return;if(!TS.client.ui.isUserAttentionOnChat()||TS.model.archive_view_is_showing||TS.client.activeChannelIsHidden())return;var i=TS.shared.getActiveModelOb();if(!i)return;if(!TS.prefs.prefs_loaded)return;if(!i.unread_cnt){if(s&&s.length)TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed);C();return}if(TS.client.msg_pane.dont_check_unreads_til_switch){C();return}var t;var n=true;var a=i.unreads;var r=false;var o=TS.notifs.isCorGMuted(i.id);var l=TS.prefs.getPref("mark_msgs_read_immediately");if(TS.boot_data.feature_scrollback_half_measures&&l&&TS.prefs.getPref("start_scroll_at_oldest")&&!i.is_limited)if(TS.shared.lastReadIsOlderThanCurrentHistory(i)){l=false;K(i)}if(l)n=true;else if(o)n=true;else if(r)for(var d=0;d<a.length;d+=1){t=a[d];if(TS.model.client.reads.indexOf(t)>-1);else if(TS.client.ui.isMsgInView(t))TS.model.client.reads.push(t);else{var c=TS.utility.msgs.getMsg(t,i.msgs);if(!c||TS.utility.msgs.isMsgHidden(c))TS.model.client.reads.push(t);else n=false}}else if(TS.shared.getOldestUnreadTsForId(i.id)){var _=TS.shared.getOldestUnreadTsForId(i.id);n=TS.client.ui.isMsgInView(_);if(TS.has_pri[q])TS.log(q,"checkUnreads "+i.id+": oldest_unread_ts = "+_+", isMsgInView (all_unreads_are_seen) = "+n)}else if(TS.has_pri[q])TS.log(q,"checkUnreads "+i.id+": no oldest_unread_ts?");if(!i.is_im&&!i.is_mpim){var u="checkUnreads "+i.id+": NOT MARKING most recent as read because ";if(!i._history_fetched_since_last_connect){if(TS.has_pri[q])TS.log(q,u+"!_history_fetched_since_last_connect.");n=false}else if(TS.shared.didDeferMessageHistoryById(i.id)){if(TS.has_pri[q])TS.log(q,u+"did_defer_initial_msg_history.");n=false}else if(i.history_is_being_fetched){if(TS.has_pri[q])TS.log(q,u+"history_is_being_fetched.");n=false}}if(TS.has_pri[q])TS.log(q,"checkUnreads "+i.id+": all_unreads_are_seen = "+n+", last_read_msg_div = "+(s&&s.length)+", last_read = "+i.last_read);if(n&&(s&&s.length||!parseInt(i.last_read,10)||l||o))if(!l){if(TS.has_pri[q])TS.log(q,"checkUnreads "+i.id+": All unreads are seen. Marking as viewed.");TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed)}else{if(TS.has_pri[q])TS.log(q,"Maybe marking most recent read msg in active because viewed: "+i.id);if(i.history_is_being_fetched){if(TS.has_pri[q])TS.log(q,"NOT MARKING most recent as read because history being fetched")}else if(TS.client.msg_pane.new_msgs_bar_showing){if(TS.has_pri[q])TS.log(q,"NOT MARKING most recent as read because new msgs bar is showing.");if(l){if(!i._mark_most_recent_read_timer){if(TS.has_pri[q])TS.log(q,"Setting a timer to mark "+i.id+" as read.");i._mark_most_recent_read_timer=window.setTimeout(function(){i._mark_most_recent_read_timer=null;k(i);i=null},500)}TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed);TS.client.msg_pane.maybeStartNewMsgsTimer(i)}}else{if(TS.has_pri[q])TS.log(q,"Marking most recent read msg in active because viewed: "+i.id);TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed)}}C()},getCanonicalDivForMsg:function e(i,t){var n=t?$("#archives_msgs_div"):TS.client.ui.$msgs_div;if(n.find("ts-conversation").length){var a=n.find('ts-message[data-ts="'+i+'"]').not("ts-relatives ts-message");if(1==a.length)return a;return a.filter(":not(ts-conversation) > ts-message")}return n.find("#"+TS.templates.makeMsgDomId(i))},getDivsForMsg:function e(i){if(TS.client.ui.$msgs_div.find("ts-conversation").length)return TS.client.ui.$msgs_div.find('ts-message[data-ts="'+i+'"]');return TS.client.msg_pane.getCanonicalDivForMsg(i)},getDivForArchiveMsg:function e(i){return TS.client.archives.$archives_msgs_div.find("#"+TS.templates.makeMsgDomId(i))},topMessagesBannerShown:function e(){if(d.hasClass("has_top_messages_banner"))return;d.toggleClass("has_top_messages_banner",T().length>0)},topMessagesBannerHidden:function e(){if(!d.hasClass("has_top_messages_banner"))return;d.toggleClass("has_top_messages_banner",T().length>0)},cleanMsgDiv:function e(){},addMaybeClick:function e(i,t){if(!i)return;t=_.isFunction(t)?t:_.noop;m[i]=t},maybeClick:function e(i){var t=_.isString(i)?i:$(i).data("maybe-click");if(m[t])m[t]()},areCallsEnabled:function e(){return TS.utility.calls.isEnabled()},maybeSetupCalls:function e(i,t){var n;var a;if(!t)t=TS.shared.getActiveModelOb();if(!TS.prefs.getTeamPref("allow_calls"))return;if(t.is_im){if(i&&!i.is_bot&&!i.is_slackbot&&!i.is_self&&TS.client.msg_pane.areCallsEnabled()){n={is_dm:true,id:TS.model.active_im_id};a={dm_member:i,name:TS.members.getPrefCompliantMemberName(i,false,true)};N(n,a)}}else if(t.is_mpim){if(TS.client.msg_pane.areCallsEnabled()){a={names:TS.mpims.getDisplayName(t)};n={is_dm:false,is_mpdm:true,id:TS.model.active_mpim_id};N(n,a)}}else if(t.is_channel||t.is_group){t=TS.shared.getActiveModelOb();var r=!TS.channels.isChannelRequired(t)||TS.permissions.members.canPostInChannel(TS.model.user);if(TS.client.msg_pane.areCallsEnabled()&&r){if(TS.model.active_channel_id)n={id:TS.model.active_channel_id};else n={id:TS.model.active_group_id};N(n)}}},setUnreadPoint:function e(i){var t=TS.shared.getActiveModelOb();var n=TS.utility.msgs.getMarkMsgTSForUnreadPoint(i,t.msgs,t);if(!n)return false;var a=TS.shared.getControllerForModelOb(t);if(_.isFunction(a.markReadMsg))a.markReadMsg(t.id,n,TS.model.marked_reasons.back);else return false;TS.model.client.reads.length=0;TS.client.markLastReadsWithAPI();if(TS.has_pri[Y])TS.log(Y,"setUnreadPoint for "+t.id+": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()");TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();if(TS.has_pri[q])TS.log(q,"setUnreadPoint for "+t.id+" - marking dont_check_unreads_til_switch = true.");TS.client.msg_pane.dont_check_unreads_til_switch=true;TS.utility.msgs.maybeClearPrevLastRead();TS.client.msg_pane.insertUnreadDivider();return true},maybeResetUnreadsCheck:function e(i){if(!TS.client.msg_pane.dont_check_unreads_til_switch)return;var t=TS.shared.getActiveModelOb();if(i&&t&&t.id==i.id){if(TS.has_pri[W])TS.log(W,"resetting dont_check_unreads_til_switch, so unread / banner fade work can be re-done on current model_ob.");TS.client.msg_pane.dont_check_unreads_til_switch=false}},maybeInsertUnreadDividerAndNewMsgsBar:function e(i){if(!i)return;var t=TS.shared.getActiveModelOb();if(!t||i.id!==t.id)return;if(TS.has_pri[V])TS.log(V,"channelUnreadCountChanged: "+i.id+" - unread count changed for active model_ob of "+t.id);if(!i.unread_cnt){if(TS.has_pri[V])TS.log(V,"channelUnreadCountChanged: "+i.id+" - unread_cnt is 0. Maybe starting new msgs timer.");TS.client.msg_pane.startNewMsgsTimer();return}if(!TS.model.ui.is_window_focused){if(TS.has_pri[V])TS.log(V,"channelUnreadCountChanged: "+i.id+" - window is not in focus, so removing and re-inserting unread divider so it can be updated.");TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();TS.utility.msgs.maybeClearPrevLastRead()}else if(TS.prefs.prefs_loaded&&!TS.prefs.getPref("mark_msgs_read_immediately")&&TS.client.ui.$msgs_unread_divider&&!TS.client.ui.isUnreadDividerInView()){if(TS.has_pri[V])TS.log(V,"channelUnreadCountChanged: "+i.id+" - window is in focus, BUT, unread divider is not in view - clearing existing state, will show in new position.");TS.client.msg_pane.clearUnreadDivider();TS.utility.msgs.maybeClearPrevLastRead()}TS.client.msg_pane.insertUnreadDivider();if(TS.model.ui.is_window_focused){if(TS.has_pri[V])TS.log(V,"channelUnreadCountChanged: "+i.id+" - NOT showing new msgs bar because window is in focus.")}else{if(TS.has_pri[V])TS.log(V,"channelUnreadCountChanged: "+i.id+" - showing new msgs bar.");TS.client.msg_pane.showNewMsgsBar()}},maybeResetAndAutoScroll:function e(i){},setCallButtonState:function e(i){var t=TS.utility.calls.isMultiPartyEnabled();if(TS.utility.calls.isEnabled()&&"Slack"!==TS.prefs.getTeamPref("calling_app_name"))t=true;var n=true;if(!t&&TS.utility.calls.isCurrentContextMultiParty())n=false;$(".call_icon").toggleClass("call_window_offline",!(i&&n))},maybeRenderHighlightedMessages:function e(i){var t=TS.shared.getActiveModelOb();if(i[t.id])_.each(i[t.id],function(e,i){var n=TS.utility.msgs.getMsgByProp("ts",i,t.msgs);if(!n)return;if(e.show_recap||e.is_leaving_feedback||e.left_feedback)TS.utility.msgs.replaceMsg(t,n,false,true)})},maybeRenderHighlightedMessageFeedback:function e(i){var t=TS.shared.getActiveModelOb();if(!t)return;if(i[t.id])_.each(i[t.id],function(e,i){var n=TS.utility.msgs.getMsgByProp("ts",i,t.msgs);if(!n)return;if("positive"===e.feedback)TS.client.ui.$msgs_div.find('ts-message[data-ts="'+n.ts+'"] .sli_briefing__feedback_controls').addClass("gave_positive_feedback");else if(e.is_leaving_feedback||e.left_feedback)TS.utility.msgs.replaceMsg(t,n,false,true)})},updateSharedChannelForeword:function e(){var i=TS.shared.getActiveModelOb();if(!i)return;var t=TS.utility.teams.getTeamsForModelOb(i,{include_pending:true});if(!t.length)return;$(".p-shared_team_icons").removeClass("hidden");var n=TS.templates.team_icon({team:TS.model.team,size:72,classes:"p-shared_team_icons__team_image"});t.forEach(function(e){var t="p-shared_team_icons__team_image";if(_.indexOf(i.pending_shared,e.id)>-1)t+=" p-shared_team_icons__team_image--pending";n+=TS.templates.team_icon({team:e,size:72,classes:t})});$(".p-shared_team_icons").html(n);$("p .channel_meta_name").addClass("hidden");$(".channel_meta_end").addClass("hidden")},determineWhetherToshowMsgLimitBanner:function e(){if(!TS.isPartiallyBooted())P()}});var e=false;var i=false;var t=0;var n=false;var a;var r;var s;var o;var l;var d=$("#messages_container");var c=$("#footer");var u=$("#center_workspace_container");var m={};var f="no_pointer_events no_opacity";var h;var g=false;var p="";var S=0;function T(){return d.find(".messages_banner:not(.messages_banner_bottom)").filter(":visible").filter(function(){var e=$(this);return!("hidden"===e.css("visibility")||e.hasClass("no_opacity"))})}var v=function e(){TS.client.msg_pane.updateEndMarker()};var b=function e(){TS.client.msg_pane.updateEndMarker()};var w=function e(i){};var y=function e(i){var t={model_ob:i};if(i.is_global_shared)t.all_teams=true;return t};var A=function i(t){TS.metrics.mark("_rebuildMsgs");if(TS.useReactMessages())return;var n=TS.shared.getActiveModelOb();if(n)if(n.is_slackbot_im)e=true;else e=false;if(!n)return;if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_msgs_rebuild");TS.client.msg_pane.is_rebuilding=true;var s;if(TS.msg_edit.editing&&TS.msg_edit.editing_in_msg_pane)s=TS.msg_edit.pauseEditing();if(TS.has_pri[z])TS.log(z,"rebuilding msgs for "+TS.model.active_cid);TS.model.ui.msgs_are_auto_scrolling=false;if(TS.has_pri[Y])TS.log(Y,"rebuildMsgs(), "+n.id+", reason: "+(t||"not specified"));if(TS.has_pri[Y])TS.log(Y,"rebuildMsgs(), "+n.id+": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()");TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();var o;var l=-1;var d="";TS.client.msg_pane.last_render_time=new Date;TS.client.msg_pane.last_rendered_msg=null;TS.client.msg_pane.last_in_stream_msg=null;l=n.scroll_top;o=n.msgs;var c;var u;var m;var f;var h=[];var g;if(TS.boot_data.feature_initial_scroll_position&&n.id===r)g=TS.client.ui.areMsgsScrolledToBottom(0);if(!TS.boot_data.feature_initial_scroll_position)TS.client.ui.$msgs_div.empty();if(!o)d="-";else{if(!o.length)d="";var p=[];var S=0;var T=_.reject(o,TS.utility.msgs.isMsgHidden);for(var v=T.length-1;v>-1;v-=1){if(!c||!TS.utility.msgs.isMsgHidden(c))u=c;c=T[v];if(TS.utility.msgs.isMsgHidden(c))continue;var b=TS.utility.msgs.msgRollUpWorker(v,c,T,p);if("continue"===b){c=u;continue}else if("swap"===b){c=p[0];p.length=0}S+=1;var w=Q(c,u);if(w){if(u)d+="</div></div>";d+='<div class="day_container">';d+=TS.templates.messages_day_divider({ts:c.ts});d+='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(c.ts)+'" data-ts="'+c.ts+'">'}if(TS.boot_data.feature_message_replies_inline&&(TS.utility.msgs.msgHasReplies(c)||TS.ui.thread.isMessageBeingConvertedToThread(n.id,c)))try{f=TS.ui.thread.makeInlineThread(n.id,c.ts);if(f){h.push(f);d+=TS.ui.thread.buildThreadHTML(f,{inline:true,expanded:TS.ui.thread.isThreadExpanded(n.id,c.ts)})}}catch(e){if(!e.message)e.message="";TS.warn("Problem building inline thread "+c.ts+": "+JSON.stringify(e.message))}else{if(J){ee[c.ts]=true;var y=_.keys(ee).length;if(_.startsWith(t,"afterHistoryFetch")){if(y%Z===0&&ie>0){TS.metrics.store("legacy_history_load_seen_per_84_messages",ie,{allow_zero:true});ie=0}if(y%X===0&&te>0){TS.metrics.store("legacy_history_load_seen_per_500_messages",te,{allow_zero:true});te=0}}}d+=TS.templates.builders.msgs.buildHTML({msg:c,model_ob:n,prev_msg:u,container_id:"msgs_div",enable_slack_action_links:true})}if(0===v)d+="</div></div>";if(!c.is_pending){TS.client.msg_pane.last_in_stream_msg=c;if(!TS.utility.msgs.isMsgHidden(c))TS.client.msg_pane.last_rendered_msg=c}}var A=20;var k=true;if(TS.boot_data.page_needs_enterprise)if(S&&S<A&&TS.has_pri[z])TS.log(z,"rebuildMsgs(): Enterprise case: Loading more history, message "+S+" < min_count of "+A);if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): "+o.length+" msgs, of which "+S+" were counted as visible.");if(!TS.isPartiallyBooted()&&o.length&&S<A&&k)if(a&&r==n.id);else{a=true;var C=function e(){a=false;TS.channels.switched_sig.remove(e);TS.groups.switched_sig.remove(e);TS.ims.switched_sig.remove(e);TS.mpims.switched_sig.remove(e)};TS.channels.switched_sig.addOnce(C);TS.groups.switched_sig.addOnce(C);TS.ims.switched_sig.addOnce(C);TS.mpims.switched_sig.addOnce(C);if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): loading more history because count is < "+A);if(TS.prefs.getPref("start_scroll_at_oldest")&&!n.is_im){if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): loading scrollback, AND, resetting _has_auto_scrolled so we scroll to oldest again when more history loads.");m=true}TS.client.ui.doLoadScrollBackHistory(true)}r=n.id}TS.client.ui.$msgs_div.html(d);if(TS.boot_data.feature_message_replies_inline)_.forEach(h,function(e){if(!TS.ui.thread.isThreadExpanded(n.id,e.root_msg.ts))return;var i=TS.client.ui.$msgs_div.find('ts-thread[data-ts="'+e.ts+'"]');TS.ui.thread.renderReplyInput(i,e)});TS.utility.makeSureAllLinksHaveTargets(TS.client.ui.$msgs_div);TS.client.msg_pane.assignLastReadMsgDiv(n);TS.client.msg_pane.insertUnreadDivider();if(!TS.isPartiallyBooted())P();TS.client.msg_pane.updateEndMarker();TS.attachment_actions.select.decorateNewElements();if(TS.boot_data.feature_initial_scroll_position){if(g)TS.client.ui.instaScrollMsgsToBottom(false)}else{TS.client.ui.instaScrollMsgsToBottom(false);if(-1==l||void 0===l||TS.prefs.prefs_loaded&&TS.prefs.getPref("start_scroll_at_oldest")&&n.unread_cnt){var I=TS.prefs.prefs_loaded&&TS.prefs.getPref("start_scroll_at_oldest");if(I&&n.unread_cnt&&TS.client.msg_pane.new_msgs_bar_showing&&!n._has_auto_scrolled){if(!TS.model.ui.is_window_focused){if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): NOT resetting and applying auto-scroll on "+n.id+", because window is not in focus.");return}if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): resetting has_auto_scrolled on "+n.id+" and forcing first unread to scroll into view, because new msgs bar is still up and unread_cnt = "+n.unread_cnt);l=-1;M(n)}if(!n._has_auto_scrolled||!TS.client.ui.isUserAttentionOnChat()||TS.client.activeChannelIsHidden()){if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): insta-scrolling to bottom(false) and then first unread into view because of last_scroll_top = -1 or undefined (actual: "+l+") OR (pref to scroll AND unread), where unread_cnt = "+n.unread_cnt);TS.client.ui.instaScrollMsgsToBottom(false);if(TS.prefs.prefs_loaded&&TS.prefs.getPref("start_scroll_at_oldest"))TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView(function(){});if(!n.is_im&&!m)(function(e){TS.utility.rAF(function(){var i=TS.shared.getActiveModelOb();if(!i||i.id!==e.id)return;if(TS.prefs.prefs_loaded&&TS.prefs.getPref("start_scroll_at_oldest")){TS.client.ui.instaScrollMsgsToBottom(false);TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView(function(){})}if(e.msgs.length){if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): marking has_auto_scrolled because !is_im and has msgs");e._has_auto_scrolled=true}else{if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): NOT marking has_auto_scrolled because no msgs yet");e._has_auto_scrolled=false}e=null})})(n)}}else{if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): insta-scrolling to last_scroll_top of "+l);TS.client.ui.instaScrollMsgsToPosition(l,false)}}if(!TS.boot_data.feature_initial_scroll_position&&m&&n._has_auto_scrolled){if(TS.has_pri[z])TS.log(z,"rebuildMsgs(): resetting scroll state due to pending history call");l=-1;M(n)}if(s)TS.msg_edit.resumeEditing(s);d=null;o=null;n=null;TS.client.msg_pane.is_rebuilding=false;TS.client.msg_pane.did_rebuild_msgs_sig.dispatch();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_msg_pane_rebuild_msgs","_rebuildMsgs");if(_.startsWith(t,"afterHistoryFetch")&&J&&ne){TS.metrics.measureAndClear("legacy_history_load_latency","legacy_history_load_latency");ne=false}};var k=function e(i){if(!i)return;if(!i._temp_unread_cnt&&!i._temp_last_read)return;if(TS.has_pri[W])TS.log(W,"_clearTempReadState: Nulling _temp_unread_cnt and _temp_last_read on "+i.id);i._temp_unread_cnt=null;i._temp_last_read=null};var C=function e(){if(!TS.client.ui.$msgs_unread_divider)return;var i=TS.shared.getActiveModelOb();TS.utility.msgs.maybeCalcUnreadCnts(i);if(TS.has_pri[Y])TS.log(Y,"_updateNewMsgsDisplay: "+i.id+", unread_cnt = "+i.unread_cnt);w(i);var t=i._temp_unread_cnt||i.unread_cnt;var n=i._temp_last_read||i.last_read;if(t){var a=TS.utility.msgs.getOldestValidTs(i);var r=t;var s="";if(n<a&&r>10){s="+";r=10*Math.floor(r/10)}var o;var l=TS.client.ui.$msgs_unread_divider.data("last_read_ts");if(!l){if(TS.has_pri[Y])TS.log(Y,"_updateNewMsgsDisplay: "+i.id+" - No last_read_ts - no unread divider? Trying _prev_last_read ("+i._prev_last_read+") || model_ob.last_read ("+i.last_read+")");l=i._prev_last_read||i.last_read;if(!l){if(TS.has_pri[Y])TS.log(Y,"_updateNewMsgsDisplay: "+i.id+" - Still no last_read_ts - exiting.");return}}var d=TS.utility.msgs.getDisplayedMsgAfterTS(l,i.msgs);if(d)o=d.ts;else o=l;var c={shortenMonth:false,excludeYear:true};var _=TS.interop.datetime.toCalendarDateOrNamedDay(o,c);var u=TS.interop.datetime.toDateObject(o);var m;var f;if(!TS.interop.datetime.isToday(u))if(TS.interop.datetime.isYesterday(u))m=TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time} {date_string}","client");else m=TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time} on {date_string}","client");else m=TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time}","client");f=m({unread_message_count:r,plus:s,time:TS.interop.datetime.toTime(o,{do24hrTime:TS.utility.date.do24hrTime()}),date_string:_});$("#new_msg_info").html(f);TS.ui.a11y.saveUnreadCountMessage(i,f)}else if(TS.client.msg_pane.new_msgs_bar_showing){if(TS.has_pri[Y])TS.log(Y,"_updateNewMsgsDisplay: "+i.id+", unread_cnt = "+t+" - maybe starting new msgs timer.");TS.client.msg_pane.maybeStartNewMsgsTimer()}};var M=function e(i){if(!i)return;if(!TS.prefs.prefs_loaded||!TS.prefs.getPref("start_scroll_at_oldest"))return;i._has_auto_scrolled=false;TS.model.ui.msgs_are_auto_scrolling=false;i.scroll_top=-1};var I=function e(){var i=TS.shared.getActiveModelOb();if(!i)return;if(TS.has_pri[Y])TS.log(Y,"_onNewMsgsTimer: current model is "+i.id+", unread_cnt = "+i.unread_cnt+", timer ID = "+o);o=null;if(!i.unread_cnt)if(TS.prefs.getPref("mark_msgs_read_immediately")&&!TS.prefs.getPref("start_scroll_at_oldest")&&!l){var t=1500;l=setTimeout(function(){if(TS.has_pri[Y])TS.log(Y,"_onNewMsgsTimer: calling TS.client.msg_pane.hideNewMsgsBar() after "+t+" msec");l=null;TS.client.msg_pane.hideNewMsgsBar();$(".unread_divider").addClass("no_unreads")},t)}else{if(i.history_is_being_fetched){if(TS.has_pri[Y])TS.log(Y,"_onNewMsgsTimer: not hiding new msgs bar because history is being fetched for current model_ob ("+i.id+")");return TS.client.msg_pane.startNewMsgsTimer()}if(TS.has_pri[Y])TS.log(Y,"_onNewMsgsTimer: calling TS.client.msg_pane.hideNewMsgsBar() immediately");TS.client.msg_pane.hideNewMsgsBar();$(".unread_divider").addClass("no_unreads")}else{if(TS.prefs.getPref("mark_msgs_read_immediately")&&!i.history_is_being_fetched){if(TS.has_pri[Y])TS.log(Y,"_onNewMsgsTimer: checking unreads (with intent to mark as read) and exiting, because not fetching history and unread_cnt = "+i.unread_cnt);TS.client.msg_pane.checkUnreads();return}if(TS.has_pri[Y])TS.log(Y,"_onNewMsgsTimer: re-starting new msgs timer because unread_cnt = "+i.unread_cnt);TS.client.msg_pane.startNewMsgsTimer()}};var x=function e(){var i=TS.shared.getActiveModelOb();if(!i){TS.error("updateEndMarker no channel, no im, no group");return}var t=$(".end_action_slack_invite");var n=t.parent();var a=$(".end_action_invite").parent();if(i.is_general){var r;if("normal"===TS.prefs.getTeamPref("auth_mode")&&TS.model.team.email_domain){var s=location.hostname.replace(/[^.]*/,_.escape(TS.model.team.domain));r=TS.i18n.t('<i class="ts_icon ts_icon_user ts_icon_inherit"></i> Send <a class="underline ts_tip ts_tip_top" href="https://{hostname}/signup">this link<span class="copied_ok ts_tip_tip hidden">Copied!</span></a> to invite people to your workspace',"client")({hostname:s});if(TS.clipboard.canWriteText())t.off("click").html(r).find("a").on("click",function(e){e.preventDefault();var i;var t=$(".copied_ok");var n="https://"+s+"/signup";TS.clipboard.writeText(n);t.removeClass("hidden");if(i)window.clearTimeout(i);i=window.setTimeout(function(){t.addClass("hidden")},2e3)})}else if(TS.model.user.is_admin){r=TS.i18n.t('<a><i class="ts_icon ts_icon_user ts_icon_inherit"></i> Invite people to <strong>{teamname}</strong></a>',"client")({teamname:_.escape(TS.model.team.name)});t.off("click").on("click.show_admin_invite_modal",TS.ui.admin_invites.start).html(r)}n.toggleClass("hidden",!r);a.toggleClass("hidden",!!r)}else{n.addClass("hidden");a.removeClass("hidden")}};var E=function e(i){var t;if("thirty_days_after_msg_limit_banner"===i){if(!TS.model.team.messages_count)return;t=TS.model.team.messages_count-1e4;t=D(t)}var n={approaching_msg_limit_banner:{emoji_attr:{src:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/231b.png",alt:"sand hourglass emoji"},h1_copy:TS.i18n.t("Your workspace is getting close to the 10k message limit","client")(),h2_copy:TS.i18n.t("All of your messages are saved in Slack, but on the Free plan you can only see and search the 10,000 most recent. For your full message history, upgrade to a paid plan.","client")(),step:63},just_reached_msg_limit_banner:{emoji_attr:{src:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f3c1.png",alt:"chequered flag emoji"},h1_copy:TS.i18n.t("You’ve just reached the 10k message limit","client")(),h2_copy:TS.i18n.t("Your workspace has over 10,000 messages in it! That’s a lot of conversation and history. Upgrade to a paid plan to make sure you can access all of it whenever you need it.","client")(),step:64},thirty_days_after_msg_limit_banner:{emoji_attr:{src:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f680.png",alt:"rocket emoji"},h1_copy:TS.i18n.t("Your workspace has {num_msgs_beyond_limit} messages more than the 10k limit","client")({num_msgs_beyond_limit:t}),h2_copy:TS.i18n.t("That’s more than {num_msgs_beyond_limit} messages you can’t see or search. Upgrade to a paid plan for access to your full history — plus features like guest accounts for contractors, group video calls, and unlimited apps.","client")({num_msgs_beyond_limit:t}),step:65}};var a=n[i];if(a){var r=Math.floor(Date.now()/1e3);var s=TS.prefs.getPref("growth_all_banners_prefs");if(!s)return;s=JSON.parse(s);s[i+"_cta_last_ts"]=r;s[i+"_cta_count"]+=1;s=JSON.stringify(s);var o=function e(){TS.clog.track("GROWTH_PRICING",{limit_meter_messages_count:TS.model.team.messages_count,contexts:{ui_context:{step:a.step,action:"click",ui_element:"pricing_button"}}});TS.prefs.setPrefByAPI({name:"growth_all_banners_prefs",value:s})};var l=function e(){TS.clog.track("GROWTH_PRICING",{limit_meter_messages_count:TS.model.team.messages_count,contexts:{ui_context:{step:a.step,action:"close",ui_element:"skip_for_now_button"}}});TS.prefs.setPrefByAPI({name:"growth_all_banners_prefs",value:s})};TS.generic_notification_banner.start({emoji_src:a.emoji_attr.src,emoji_alt:a.emoji_attr.alt,h1_copy:a.h1_copy,h2_copy:a.h2_copy,show_go_link_button:true,go_link_button_text:TS.i18n.t("Learn More","client")(),go_link_button_url:"/pricing?ui_element=11&ui_step="+a.step,onLinkGo:o,show_close_button:true,close_button_text:TS.i18n.t("Skip for Now","client")(),onClose:l});TS.clog.track("GROWTH_PRICING",{limit_meter_messages_count:TS.model.team.messages_count,contexts:{ui_context:{step:a.step,action:"impression"}}})}};var B=function e(i){var t=Math.floor(Date.now()/1e3);var n=TS.model.team.name;var a=TS.model.channels.length;var r=TS.i18n.number(TS.model.team.messages_count)||"";var s=TS.prefs.getPref("growth_all_banners_prefs");if(!s||!r)return;s=JSON.parse(s);var o={src:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f680.png",alt:"rocket emoji"};var l=TS.i18n.t("{name_of_workspace} is on a roll","client")({name_of_workspace:n});var d=TS.i18n.t("Your team’s now <b>{num_of_members} members</b> strong, with <b>{num_of_messages} messages</b> sent across <b>{num_of_channels} channels</b>. You can track your team’s progress via the main menu.","client")({num_of_messages:r,num_of_members:i,num_of_channels:a});var c=TS.i18n.t("Show Me","client")();var _=function e(n){var r;var o;var l=TS.model.user.is_admin;var d=TS.ui.admin_invites.canInvite();TS.menu.startWithTeamAndUser(n);$("body").append('<div id="overlay_except_team_menu" class="msg_lim_activation_banner_overlay"></div>');if(!l&&!d){r="non_admin_no_invite";o="bottom_non_admin_no_invite"}else if(!l&&d||l&&!d){r="non_admin_invite";o="bottom_non_admin_invite"}else if(l&&d){r="admin_invite";o="bottom_admin_invite"}$(".menu_content").append('<div class="msg_lim_activation_banner_menu_overlay top '+r+'"></div>');$(".menu_content").append('<div class="msg_lim_activation_banner_menu_overlay '+o+'"></div>');$("#menu_items_scroller").css("overflow-y","hidden");TS.clog.track("UPGRDEXP_MSG_LIM_ACTIVATION_BANNER",{limit_meter_messages_count:TS.model.team.messages_count,num_members_minus_bots:i,num_of_channels:a,contexts:{ui_context:{step:"banner_activation_msg_limit",action:"click",ui_element:"btn_show_me"}}});s.activation_msg_limit_banner_cta_last_ts=t;s.activation_msg_limit_banner_cta_count+=1;s=JSON.stringify(s);TS.prefs.setPrefByAPI({name:"growth_all_banners_prefs",value:s});var c=function e(){$("#overlay_except_team_menu").remove();$(".msg_lim_activation_banner_menu_overlay").remove();$("#menu_items_scroller").css("overflow-y","initial")};$(window.document).bind("keydown",c);$("html").bind("mousedown touchstart",c)};var u=function e(){TS.clog.track("UPGRDEXP_MSG_LIM_ACTIVATION_BANNER",{limit_meter_messages_count:TS.model.team.messages_count,num_members_minus_bots:i,num_of_channels:a,contexts:{ui_context:{step:"banner_activation_msg_limit",action:"close",ui_element:"btn_close"}}});s.activation_msg_limit_banner_cta_last_ts=t;s.activation_msg_limit_banner_cta_count+=1;s=JSON.stringify(s);TS.prefs.setPrefByAPI({name:"growth_all_banners_prefs",value:s})};TS.generic_notification_banner.start({emoji_src:o.src,emoji_alt:o.alt,h1_copy:l,h2_copy:d,show_go_button:true,go_button_text:c,onGo:_,show_close_x_icon:true,onXClose:u,show_go_link_button:false,show_close_button:false});TS.clog.track("UPGRDEXP_MSG_LIM_ACTIVATION_BANNER",{limit_meter_messages_count:TS.model.team.messages_count,num_members_minus_bots:i,num_of_channels:a,contexts:{ui_context:{step:"banner_activation_msg_limit",action:"impression"}}})};var P=function e(){if(t>0||TS.onboarding.inOnboarding())return;TS.api.call("promo.banner").then(function(e){if(e.data.message_pane)var i=e.data.message_pane.name;else return;if("i18n_japan_beta_send_btn_banner"===i)TS.i18n.autoEnableSendButton();else if("activation_msg_limit_banner"===i)TS.flannel.fetchMemberCounts().then(function(e){var i;if(e.bots)i=e.everyone-e.bots-1;else i=e.everyone-1;B(i)});else if(i)E(i)}).catch(function(){TS.error("A call to promo.banner failed likely because stats_cds is failing")});t+=1};var D=function e(i){if(i<=0)return i;else if(i>9&&i<100)return 10*Math.floor(i/10);else if(i>100&&i<=999999){i=100*Math.floor(i/100);return TS.i18n.number(i)}else if(i>999999)return TS.utility.number.formatNumberWithAbbreviation(i,{precision:3})};var U=false;var F=function e(i){U=i.is_loading;O()};var O=function e(){R();if(TS.prefs.getTeamPref("allow_calls"))TS.client.msg_pane.displayTitle()};var R=function e(){$(".channel_calls_button").remove()};var N=function e(i,t){t=t||{};var n=TS.shared.getActiveModelOb();if(!n)return;if(!TS.permissions.members.canPostInChannel(n))return;var a=TS.utility.calls.isCallWindowReady()||!TS.utility.calls.platformHasCallsCode();var r=TS.utility.calls.isMultiPartyEnabled();if(TS.utility.calls.isEnabled()&&"Slack"!==TS.prefs.getTeamPref("calling_app_name"))r=true;var s=n.is_channel&&!n.is_member;var o=true;if(!r&&TS.utility.calls.isCurrentContextMultiParty())o=false;var l=a&&o&&!s;var d="Slack"!==TS.prefs.getTeamPref("calling_app_name");var c=["call_icon"];if(!l)c.push("call_window_offline");if(t.is_dm_user_offline)c.push("away");if(i.is_dm)if(t.hasOwnProperty("dm_member"))c.push(TS.templates.makeMemberDomIdById(t.dm_member.id));if(TS.client.msg_pane.areCallsEnabled()){var _=$("#channel_calls_container");var u;var m;if(s)u=TS.i18n.t("Join this channel to start a call","client")();else if(o)if(i.is_dm||i.is_mpdm)if(t.is_dm_user_offline)u=TS.i18n.t("{name} is currently offline and unreachable","client")({name:t.name});else{if(i.is_mpdm)m=t.names;else m=t.name;if(d)u=TS.i18n.t("Call {call_name} with {calling_app_name}","client")({call_name:m,calling_app_name:TS.prefs.getTeamPref("calling_app_name")});else u=TS.i18n.t("Call {call_name}","client")({call_name:m})}else if(d)u=TS.i18n.t("Start a call with {calling_app_name}","client")({calling_app_name:TS.prefs.getTeamPref("calling_app_name")});else u=TS.i18n.t("Start a call","client")();else if(i.is_mpdm)u=TS.i18n.t("Only paid workspaces can call from group conversations.","client")();else u=TS.i18n.t("Only paid workspaces can start calls from channels.","client")();var f="";f+=TS.templates.menu_call_button({is_platform_call_loading:U,button_classes:"voice_call",tip_text:u,icon_classes:c.concat("ts_icon_phone").join(" ")});_.html(f);_.removeClass("hidden");if(i.id&&o)$(".channel_calls_button.voice_call").on("click.video_call",function(){if(s)return;var e="Slack"!==TS.prefs.getTeamPref("calling_app_name");TS.clog.track("CALLS_START_VOICE_BUTTON_CLICKED",{is_platform_call:e,calling_app_id:TS.prefs.getTeamPref("calling_app_id")});TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_calls_button"}}});if(e)TS.utility.calls.launchPlatformCalls(i);else TS.utility.calls.startCallInModelOb(i)});if(_.length&&l&&!d)H()}};var H=function e(){TS.experiment.loadUserAssignments().then(function(){if(TS.prefs.getPref("in_interactive_mas_migration_flow")&&TS.model.is_mac&&TS.utility.calls.isInteractiveScreenShareHostingSupported()){TS.coachmark.start(TS.coachmarks.coachmarks.calls_interactive_screen_share);TS.prefs.setPrefLocal("in_interactive_mas_migration_flow",false);TS.prefs.setPrefByAPI({name:"in_interactive_mas_migration_flow",value:false});TS.prefs.setPrefLocal("seen_calls_interactive_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_calls_interactive_coachmark",value:true});return}if("enabled"===TS.experiment.getGroup("calls_interactive_ss")){if(TS.prefs.getPref("shdep_promo_code_submitted")&&!TS.prefs.getPref("seen_shdep_slackbot_message")&&!TS.prefs.getPref("seen_calls_interactive_coachmark")&&TS.utility.calls.isPaidTeam()&&!TS.utility.calls.isInteractiveScreenShareHostingSupported()){TS.prefs.setPrefLocal("seen_shdep_slackbot_message",true);TS.prefs.setPrefByAPI({name:"seen_shdep_slackbot_message",value:true});TS.api.call("shdep.sendSlackbotMessage")}if(TS.prefs.getPref("shdep_promo_code_submitted")&&!TS.prefs.getPref("seen_calls_interactive_coachmark")&&TS.utility.calls.isPaidTeam()&&TS.utility.calls.isInteractiveScreenShareHostingSupported()){TS.coachmark.start(TS.coachmarks.coachmarks.calls_interactive_screen_share);TS.prefs.setPrefLocal("seen_calls_interactive_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_calls_interactive_coachmark",value:true})}}})};var Q=function e(i,t){if(!t)return true;return!TS.utility.msgs.areMsgsSameDay(i,t)};var L=function e(){var i=TS.shared.getActiveModelOb();if(!i.is_mpim)return;G(i)};var G=function e(i){var t=TS.notifs.isCorGMuted(i.id);var n=TS.notifs.getCalculatedCorGNotifySetting(i.id);var a=TS.ui.growls.checkPermission();var r=false===a&&TS.ui.growls.no_notifications;var s=false===a&&"denied"===TS.ui.growls.getPermissionLevel();var o=false===a&&TS.ui.growls.shouldShowPermissionButton();var l;var d={members:TS.mpims.getMembersInDisplayOrder(i),model_ob:i,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),compliance_export_start:TS.prefs.getTeamPref("compliance_export_start")||0,desktop_setting:n,is_muted:t,desktop_notifs_enabled:a,notifications_impossible:r,notifications_not_allowed:s,notifications_not_yet_allowed:o};$("#im_meta").html(TS.templates.dm_badge(d));l=$(".mpim_notif_prefs");l.find(".more_options").on("click",function(){TS.ui.channel_prefs_dialog.start(i.id)});l.find("#notifications_muted_cb").on("change",function(){if(TS.notifs.isCorGMuted(i.id))TS.notifs.muteOrUnmuteCorG(i.id)});l.find("#no_notifications_cb").on("change",function(){if(TS.prefs.getPref("all_channels_loud"))TS.notifs.makeCorGDTopEverything(i.id);else TS.notifs.makeCorGDTopMentions(i.id);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})});l.find("#all_notifications_rd").on("change",function(){TS.notifs.makeCorGDTopEverything(i.id);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})});l.find("#mentions_rd").on("change",function(){TS.notifs.makeCorGDTopMentions(i.id);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})})};var j=false;var K=function e(i){if(!i.is_channel)return;if(j)return;TS.metrics.count("banner_not_cleared");j=true;TS.channels.switched_sig.addOnce(function(){j=false})};var W=58;var V=99;var q=142;var z=888;var Y=999;var J=TS.utility.enableFeatureForUser(1);var Z=TS.model.subsequent_msgs_cnt;var X=500;var ee={};var ie=0;var te=0;var ne})()},4937:function(e,i){(function(){TS.registerModule("client.downloads",{onStart:function e(){TS.client.login_sig.add(g)},updateDownloadsView:function e(i){if(TS.useReactDownloads()&&TS.interop&&TS.interop.redux)TS.redux.dispatch(TS.interop.redux.features.downloads.syncDownloads(i))},startDownload:function e(i,t){if(!TS.model.supports_downloads)return false;if(!i)return false;if(!N(i))return false;var n=q(N(i));var a=t||!!n;var r=0;if(a){if("downloads"!==TS.model.ui.active_tab_id||!TS.model.ui_state.flex_visible)r=TS.model.ui_state.flex_visible?100:300;TS.client.ui.flex.openFlexTab("downloads")}if(TS.useReactDownloads()){TSSSB.call("startDownload",{id:i.id,url:N(i)});return true}if(n){if("canceled"===n.state||"failed"===n.state)w(n.token);setTimeout(V,r,n.token);return true}return S(i)},downloadWithTokenDidSelectFilepath:function e(i,t){var n=a[i];if(!n){TS.error("downloadWithTokenDidSelectFilepath: no download for token: "+i);return}n.file_path=t;O(n)},downloadWithTokenProgress:function e(i,t){var n=a[i];if(!n){TS.error("downloadWithTokenProgress: no download for token: "+i);return}var r=j(n);n.progress=t;var s=W(n.token);if(!s.length)TS.error("downloadWithTokenProgress: no $dl found for token: "+n.token);var o=Math.max(.02,Math.min(1,n.progress));s.find(".download_progress_bar").css("width",100*o+"%");s.find(".download_estimate").text(K(n));if(1==n.progress)O(n,"completed");else if(r&&n.progress>0){s.find(".partial_size").html(TS.utility.convertFilesize(n.progress*r.size)+" of "+TS.utility.convertFilesize(r.size));D()}else if(-1!=n.progress)TS.error("downloadWithTokenProgress: bad dl: ",n)},downloadWithTokenDidFinish:function e(i){var t=a[i];if(!t){TS.error("downloadWithTokenDidFinish: no download for token: "+i);return}O(t,"completed")},downloadWithTokenDidFailWithReasonAndCode:function e(i,t){var n=a[i];if(!n){TS.error("downloadWithTokenDidFailWithReasonAndCode: no download for token: "+i);return}TS.generic_dialog.alert(TS.i18n.t("Download failed: {reason}","downloads")({reason:t}));I()},downloadMetadataChanged:function i(){if(!e)return;e=false;I()},maybeBuild:function e(){if(!TS.model.supports_downloads)return;if(TS.useReactDownloads())TS.interop.mountDownloadsView(TS.boot_data.team_id,r[0],function(){var e=_.get(window,"desktop.downloads.update");if(e)e.call(window.desktop.downloads)});else{$("#downloads_scroller .monkey_scroll_hider").css("width","auto");if(i)return;i=true;if(TS.model.ms_logged_in_once)p()}},maybeShowFlexMenuProgBar:function e(){if(!TS.model.supports_downloads)return;H()},addIndividualDownload:function e(i,t){u=i;m=t;L(u)},removeIndividualDownload:function e(){u=$();m=""}});var e=false;var i=false;var t=false;var n=[];var a={};var r=$("#downloads_tab");var s=$("#downloads_scroller");var o=$("#downloads_empty");var l=$("#downloads_tab_clear");var d=$("#downloads_shift_hint");var c;var u=$();var m;var f=[];var h=20;var g=function e(){c=$(".flex_menu_download_circle");if(!TS.model.supports_downloads)return;if(i)p();L(c)};var p=function e(){if(!TS.model.supports_downloads)return;if(TS.useReactDownloads())throw new Error("Legacy _build called");if(t)return;t=true;o.html(TS.emoji.graphicReplace(o.html()));var i=function e(i){return $(i).closest(".download_item").data("token")};s.on("click.dl","a.download_cancel_link",function(e){e.stopPropagation();T(i(e.target))});s.on("click.dl",".download_item.completed",function(e){e.stopPropagation();var t=i(e.target);if(e.shiftKey)b(t);else v(t)});s.on("click.dl",".download_item.canceled, .download_item.failed",function(e){e.stopPropagation();w(i(e.target))});s.on("click.dl","i.download_remove_link",function(e){e.stopPropagation();y(i(e.target))});s.on("click",'[data-action="load_more"]',function(e){e.preventDefault();J()});$(document).on("keydown",function(e){if(e.which===TS.utility.keymap.shift)r.addClass("shift_key")});$(document).on("keyup",function(){r.removeClass("shift_key")});TS.ui.window_focus_changed_sig.add(function(){r.removeClass("shift_key")});l.on("click.dl",A);r.addClass("supports_open_file");M()};var S=function e(i){var t=TSSSB.call("startDownload",N(i));if(!t){TS.error('startDownload called with url: "'+N(i)+'" but I got no token');return false}a[t]={token:t,progress:0,state:"in_progress",href:N(i),http_status:null,file_path:N(i),file_exists:false,mime_type:"",start_ts:Date.now()/1e3,dl_start_ts:Date.now()/1e3,end_ts:0,base64_png:""};n.push(a[t]);k();U(a[t]);x();setTimeout(V,50,t);return true};var T=function e(i){var t=TSSSB.call("cancelDownloadWithToken",i);if(false===t){TS.error("_cancelDownload with token: "+i+" failed");return}F(i,"canceled")};var v=function e(i){var t=TSSSB.call("revealDownloadWithToken",i);if(false===t)TS.error("_showDownload with token: "+i+" failed")};var b=function e(i){var t=false;var n=a[i];if(n)t=TSSSB.call("openFileAtPath",n.file_path);if(false===t)TS.error("_openDownload with token: "+i+" failed")};var w=function e(i){var t=TSSSB.call("retryDownloadWithToken",i);if(false===t){TS.error("_retryDownload with token: "+i+" failed");return}var n=a[i];n.dl_start_ts=Date.now()/1e3;F(i,"in_progress")};var y=function i(t){var n=TSSSB.call("pruneTokensFromHistory",JSON.stringify([t]));if(false===n)TS.error("_removeDownload with token: "+t+" failed");if(window.winssb)e=true;else I()};var A=function i(t){if(!t&&z("in_progress")){TS.generic_dialog.start({title:TS.i18n.t("Clear all downloads","downloads")(),body:"<p>"+TS.i18n.t("You have an active download. Are you sure you want to clear them all?","downloads")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, clear them all","downloads")(),onGo:function e(){i(true)}});return}if(false===TSSSB.call("pruneTokensFromHistory",JSON.stringify(Object.keys(a))))TS.error("_removeAllDownloads with tokens: "+JSON.stringify(Object.keys(a))+" failed");if(window.winssb)e=true;else M()};var k=function e(){n.sort(function e(i,t){if(i.start_ts<t.start_ts)return 1;if(i.start_ts>t.start_ts)return-1;return 0})};var C=function e(){var i=TSSSB.call("metadataForDownloads");var t=_.cloneDeep(a);n.length=0;if(i){a=JSON.parse(i);_.forOwn(a,function(e,i){e.token=i;e.start_ts=parseFloat(e.start_ts);if(e.start_ts>9999999999)e.start_ts/=1e3;if(t[i]){if(!e.hasOwnProperty("progress"))e.progress=t[i].progress;e.dl_start_ts=t[i].dl_start_ts}else e.dl_start_ts=e.start_ts;n.push(e)})}k()};var M=function e(){if(TS.useReactDownloads())throw new Error("Legacy render called");C();x();E();H()};var I=function e(){if(TS.useReactDownloads())throw new Error("Legacy update called");C();x();P();H()};var x=function e(){if(n.length){s.removeClass("hidden");o.addClass("hidden");d.removeClass("hidden");l.toggleClass("hidden",n.length<2)}else{s.empty().addClass("hidden");o.removeClass("hidden");l.addClass("hidden");d.addClass("hidden")}};var E=function e(){var i=_.take(n,h);var t=B(i);if(i.length<n.length)t+=TS.templates.downloads_load_more();s.html(t);TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))};var B=function e(i){var t="";_.forEach(i,function(e){t+=R(e)});return t};var P=function e(){var i;if(!n.length){H();return}var t=n;var r=s.find(".download_item:last").attr("data-token");if(r){var o=_.findIndex(n,{token:r});if(o>=0)t=_.take(n,o+1)}_.forEach(t,function(e){i=W(e.token);if(i.length)O(e);else U(e)});var l=0;s.find(".download_item").each(function(e,t){l+=1;i=$(t);if(i.hasClass("hidden_with_fade_out_and_shrink"))return;if(a[i.data("token")])return;i.css("height",i.outerHeight()+"px");setTimeout(function(e){return function(){e.addClass("hidden_with_fade_out_and_shrink")}}(i),0)});if(l)setTimeout(function(){TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))},550)};var D=function e(){if(u.length&&m)Q();H()};var U=function e(i){if(!i){TS.error("_addDlDiv: no dl passed");return}s.prepend(R(i));TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"));D()};var F=function e(i,t){var n=a[i];if(!n){TS.error("_updateDownloadByToken: no download for token: "+i);return}O(n,t)};var O=function e(i,t){if(!i){TS.error("_updateDownload: no dl passed");return}if(t)i.state=t;if("completed"===i.state)i.progress=1;else if("in_progress"===i.state);else i.progress=0;D(t);var n=W(i.token);if(!n.length){TS.error("no $dl found for token: "+i.token);return}if(n.hasClass("hidden_with_fade_out_and_shrink"))return;n.replaceWith(R(i));TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))};var R=function e(i){var t=j(i);if(!t&&!i.tried_fetch){i.tried_fetch=true;var n=new RegExp(TS.utility.regexpEscape(TS.model.team.id)+"-F[A-Z0-9]+");var r=i.href.match(n);var s;var o;var l=_.isString(i.href)&&i.href.substr(0,i.href.lastIndexOf("/")||i.href.length)+"/[redacted]"||"[invalid]";if((!r||!r.length)&&TS.boot_data.page_needs_enterprise){var d=TS.redux.enterprise.getEnterpriseId();var c="T"+d.substr(1);n=new RegExp(TS.utility.regexpEscape(c)+"-F[A-Z0-9]+");r=i.href.match(n);if(r&&r.length)TS.warn("_buildItem: no file found matching TS.model.team.id of "+TS.model.team.id+", found with enterprise ID "+d+" + E->T ("+c+")")}if(r&&r.length){s=r[0];o=s.split("-")[1];TS.info("_buildItem: fetching file for dl.href: "+l);X(o,function(){i=a[i.token];if(!i)return;O(i)})}else TS.error("_buildItem: no file id found in dl.href: "+l+". TS.model.team.id = "+TS.model.team.id+(TS.boot_data.page_needs_enterprise?", enterprise_id = "+d:", no enterprise ID."))}var u="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";var m;var f;var h=0;var g=0;var p;if(t){u=t.thumb_160||t.thumb_80;m=t.filetype||null;f=t.pretty_type||null;p=t.name||null;h=t.size;if("in_progress"===i.state&&i.progress)g=i.progress*h}var S=i&&i.file_path&&i.file_path.split(/\/|\\/)&&i.file_path.split(/\/|\\/).reverse();var T=S&&S[0];if(!T)TS.warn("_buildItem: no file_path found in dl.file_path"+i.file_path);var v={item:i,img_src:u,filetype:m,pretty_type:f,name:T||p,size:h,partial_size:g,estimate:K(i),debug:JSON.stringify(a,null,2),perc:"completed"===i.state?100:100*Math.max(.02,i.progress)};if(!v.name)TS.warn("_buildItem: file name is empty or undefined in template_args.name"+v.name);return TS.templates.download_item(v)};var N=function e(i){return i.url_private_download};var H=function e(){var i=0;var t=0;_.forOwn(a,function(e){if("in_progress"!==e.state)return;if(isNaN(e.progress))return;if(e.progress>=1)return;var n=j(e);if(!n)return;if(!n.size)return;i+=n.size;t+=n.size*Math.max(0,e.progress)});if(i){var n=G(t,i);c.circleProgress({value:n}).addClass("shown_with_fade_in");$("#downloads_menu_progress").removeClass("hidden").find(".download_progress_bar").css("width",100*n+"%")}else{c.removeClass("shown_with_fade_in");$("#downloads_menu_progress").addClass("hidden")}};var Q=function e(){var i;var t=0;var n=0;_.forOwn(a,function(e){if("in_progress"!==e.state)return;if(isNaN(e.progress))return;if(e.progress>=1)return;i=j(e);if(!i)return;if(i.id===m){if(i.size){t+=i.size;n+=i.size*Math.max(0,e.progress)}return false}});if(t&&i){var r=G(n,i.size);u.circleProgress({value:r}).addClass("shown_with_fade_in")}else u.removeClass("shown_with_fade_in")};var L=function e(i){i.circleProgress({value:0,size:9,animation:false,fill:{gradient:["#50acf4","#41a6f5"]},emptyFill:"rgba(211,211,211,1)",thickness:2,lineCap:"round",startAngle:Math.PI/-2})};var G=function e(i,t){var n=i/t;return Math.max(.06,Math.min(1,n))};var j=function e(i){return TS.files.getFileByDownloadUrlPrivate(i.href)};var K=function e(i){if(!i)return"";if("in_progress"!==i.state)return"";if(i.progress>=1)return"";if(-1==i.progress)return"";if(!i.progress)return"";if(i.progress<.02)return"...";var t=Date.now()/1e3-i.dl_start_ts;var n=t*(1/i.progress);var a=n-t;return TS.i18n.t("{seconds}s remaining","downloads")({seconds:Math.ceil(a)})};var W=function e(i){return s.find('[data-token="'+i+'"]')};var V=function e(i){var t=W(i);t.scrollintoview({duration:100,offset:"center_vertical",complete:function e(){t.highlight(3e3,"download_item_highlighter",null,0)}})};var q=function e(i){return Y("href",i)};var z=function e(i){return Y("state",i)};var Y=function e(i,t){if(!i)return null;if(!t&&0!==t)return null;for(var a=0;a<n.length;a+=1)if(n[a][i]==t)return n[a];return null};var J=function e(){var i=s.find(".download_item:last");var t=i.attr("data-token");if(!i.length||!t){Z();return}var a=_.findIndex(n,{token:t});var r=_(n).drop(a+1).take(h).value();var o=B(r);i.after(o);var l=_.includes(r,_.last(n));if(l)Z()};var Z=function e(){s.find(".downloads_load_more").remove()};var X=function e(i,t){f.push({id:i,callback:t});ee()};var ee=_.debounce(function(){var e=f;f=[];if(!e||!e.length)return;if(1===e.length){var i=e[0];TS.files.fetchFileInfo(i.id,i.callback)}else{var t=_.map(e,"id");TS.files.fetchMultipleFiles(t,function(i){if(!i)return;_.forEach(e,function(e){var i=TS.files.getFileById(e.id);if(i)e.callback(e.id,i)})})}},10)})()},4938:function(e,i){(function(){TS.registerModule("client.whats_new",{onStart:function e(){TS.client.login_sig.add(l);TS.prefs.whats_new_read_changed_sig.add(g);TS.client.flexpane_display_switched_sig.add(u)},updateIcon:function e(){T()},getNewestID:function e(){return t}});var e=$("#whats_new_updates");var i=$("#what_new_read_cb");var t=-1;var n=0;var a;var r=false;var s=false;var o=Math.round(Date.now()/1e3);var l=function n(){r=true;e.find(".whats_new_content").each(function(){var e=$(this);if(!e.hasClass("html"))e.html(TS.format.formatNoHighlightsNoInlineImgs(e.html()))});t=e.children().first().data("whats-new-id")||t;g();i.bind("change",function(){c(!!$(this).prop("checked"))});d()};var d=function i(){e.find("a.whats_new_content").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"heading_link",page_url:$(this).attr("href"),step:t})});e.find("div.whats_new_description").find("a").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"description_link",page_url:$(this).attr("href"),step:t})});e.find("a.whats_new_more").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"read_more_link",page_url:$(this).attr("href"),step:t})})};var c=function e(i){var n=-1;if(i){n=t||Math.floor(Date.now()/1e3);TS.clog.track("WHATSNEW_ACTION",{action:"opt_in",step:t,trigger:"checkbox_whats_new"})}else TS.clog.track("WHATSNEW_ACTION",{action:"opt_out",step:t,trigger:"checkbox_whats_new"});TS.prefs.onPrefChanged({name:"whats_new_read",value:n});TS.prefs.setPrefByAPI({name:"whats_new_read",value:n});g()};var _=function e(){if(-1==TS.prefs.getPref("whats_new_read"))return;TS.prefs.onPrefChanged({name:"whats_new_read",value:t});TS.prefs.setPrefByAPI({name:"whats_new_read",value:t});n=0};var u=function e(){if(!r)return;var i=TS.model.ui_state.flex_name;if(!TS.model.ui_state.flex_visible||"whats_new"!==i){s=false;return}s=true;h();m()};var m=function e(){if(!s){clearTimeout(a);return}if(b())return;a=setTimeout(function(){_()},1e3)};var f=function i(){n=0;e.children().each(function(){var e=$(this);var i=e.data("whats-new-id");if(i&&TS.prefs.getPref("whats_new_read")<i)n+=1})};var h=function i(){e.children().each(function(){var e=$(this);var i=e.data("whats-new-id");if(i&&TS.prefs.getPref("whats_new_read")<i)e.find(".ts_icon_presence_online").removeClass("hidden");else e.find(".ts_icon_presence_online").addClass("hidden")})};var g=function e(){f();m();S();p();T()};var p=function e(){i.prop("checked",-1!==TS.prefs.getPref("whats_new_read"))};var S=function e(){if(b()||!v()||w())$("#client-ui").removeClass("whats_new_showing");else{var i=n>9?"9+":n;$("#whats_new_toggle").addClass("exp_expanding");if(n>1){$("#whats_new_toggle").find(".num_only").removeClass("hidden").text(i);$("#whats_new_toggle").find(".num_updates").removeClass("hidden").text(TS.i18n.t("{num_updates} Updates","whats_new")({num_updates:i}))}else{$("#whats_new_toggle").find(".num_only").addClass("hidden");$("#whats_new_toggle").find(".num_updates").addClass("hidden")}$("#client-ui").addClass("whats_new_showing");TS.clog.track("WHATSNEW_ACTION",{action:"do_badge",trigger:t,step:t})}};var T=function e(){var i=$("#whats_new_count");if(n&&v()){i.removeClass("hidden");i.text(n<10?n:"9+")}else i.addClass("hidden")};var v=function e(){return-1!==TS.prefs.getPref("whats_new_read")&&false!==TS.prefs.getTeamPref("whats_new_badges")};var b=function e(){return TS.prefs.getPref("whats_new_read")>=t};var w=function e(){var i=691200;return o-t>=i}})()},4939:function(e,i){(function(){TS.registerModule("client.history_prefetch",{addToHistoryFetchQueue:function i(t){if(!t)return;if(!e)e=[];if(-1!==e.indexOf(t))return false;e.push(t);return true},processHistoryFetchQueue:function i(){if(e._being_processed||!e.length)return false;r();s();o();l();if(TS.has_pri[c]){var t=[];_.each(e,function(e){t.push(e)});TS.log(c,"pre-loading history for "+e.length+(1===e.length?" item: ":" items: ")+t.join(", "))}e.being_processed=true;if(e.length>1)TS.api.callFuncWhenApiQisEmpty(function(){d();d()});else TS.api.callFuncWhenApiQisEmpty(d);return true},resetHistoryFetchQueue:function i(){e=[];n=[]}});var e=[];var i=20;var t=40;var n=[];var a;var r=function e(){if(n.length)return;if(TS.frecency&&!a){var i=TS.frecency.getExisting("jumper");a=i&&i.getMostCommon()}if(!a){TS.warn('WTF no TS.frecency module? or no "jumper" frecency?');return}n=a.filter(function(e){return e.score>=t}).map(function(e){return e.id})};var s=function i(){if(!n.length)return;var t;for(var a=n.length-1;a>=0;a-=1){t=e.indexOf(n[a]);if(-1!==t)e.unshift(e.splice(t,1)[0])}};var o=function i(){var t=_.filter(e,function(e){var i=TS.shared.getModelObById(e);return i&&(i.is_im||i.is_mpim)});t.reverse();_.each(t,function(i){var t=e.indexOf(i);e.unshift(e.splice(t,1)[0])})};var l=function t(){var n=0;for(var a=0,r=e.length;a<r;a+=1){var s=TS.shared.getModelObById(e[a]);if(s&&!s.is_im&&!s.is_mpim){n=a;if(TS.has_pri[c])TS.log(c,"queued "+n+" required IM/MPIM item(s) for pre-fetch: "+e.slice(0,a).join(", "));break}}var o=e.length;e.length=Math.min(e.length,i+n);if(o!==e.length&&TS.has_pri[c])TS.log(c,"truncated history fetch queue from "+o+" to "+e.length+(n?", including "+n+" required IM/MPIM item(s)":""))};var d=function i(){if(!e||!e.length){if(TS.has_pri[c])TS.log(c,"_processHistoryFetchQueue: done.");e.being_processed=false;return}var t=e.shift();var n=TS.shared.getModelObById(t);if(!n){TS.warn('_processHistoryFetchQueue: could not find model_ob for id "'+t+'"');return}var a=TS.shared.getControllerForModelOb(n);if(!a){TS.warn("_processHistoryFetchQueue: could not find controller for model_ob");return i()}TS.shared.maybeFetchHistory(n);if(n.history_is_being_fetched)a.history_fetched_sig.addOnce(function(e){if(TS.has_pri[c])TS.log(c,'fetched history for "'+e.id+'"');TS.api.callFuncWhenApiQisEmpty(function(){window.setTimeout(i,250+250*Math.random())})});else{if(TS.has_pri[c])TS.log(c,'_processHistoryFetchQueue: no history fetch started for "'+n.id+'" - assuming up to date.');i()}};var c=58})()},4940:function(e,i){var t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("client.traces",{onStart:function e(){TS.client.login_sig.add(l,TS.client.traces,1)},canTrace:function e(){return!!(TS.boot_data.feature_perfectrics&&_.get(window,"desktop.stats.startTraceRecord")&&_.get(window,"desktop.stats.stopTraceRecord"))},startTrace:function e(i,t){if(!TS.client.traces.canTrace())return T();if(h())return T(o);o=g(i,t);s=o.delay(f(i)).finally(function(){p()}).catch(_.noop);return T(o)},maybeTrace:function e(i,t){if(!TS.client.traces.canTrace())return T();if(!S())return T();if(h())return T(o);TS.storage.storeLastTraceTS();return TS.client.traces.startTrace(i,t)},stopTrace:function e(){if(!TS.client.traces.canTrace())return;if(!h())return;o.finally(function(){s.cancel()}).catch(_.noop)},test:function e(){var e={};Object.defineProperty(e,"_getTraceIdentifier",{get:function e(){return d},set:function e(i){d=i}});Object.defineProperty(e,"_getTraceEndpoint",{get:function e(){return c},set:function e(i){c=i}});Object.defineProperty(e,"_getTraceToken",{get:function e(){return u},set:function e(i){u=i}});Object.defineProperty(e,"_getSafeTraceMetadata",{get:function e(){return m},set:function e(i){m=i}});Object.defineProperty(e,"_getSafeTracePeriod",{get:function e(){return f},set:function e(i){f=i}});Object.defineProperty(e,"_traceInFlight",{get:function e(){return h},set:function e(i){h=i}});Object.defineProperty(e,"_promiseToStartTrace",{get:function e(){return g},set:function e(i){g=i}});Object.defineProperty(e,"_promiseToStopTrace",{get:function e(){return p},set:function e(i){p=i}});Object.defineProperty(e,"_longEnoughSinceLastAutomatedTrace",{get:function e(){return S},set:function e(i){S=i}});Object.defineProperty(e,"_getExternalPromise",{get:function e(){return T},set:function e(i){T=i}});Object.defineProperty(e,"_trace_p",{get:function e(){return s},set:function e(i){s=i}});Object.defineProperty(e,"_start_trace_p",{get:function e(){return o},set:function e(i){o=i}});return e}});var e=1e3;var i=1*e;var n=60*e;var a=20*e;var r=86400*e;var s;var o;var l=function e(){};var d=function e(){return[_.get(TS.model,"user.team_id")||_.get(TS.boot_data,"team_id"),_.get(TS.model,"user.id")||_.get(TS.boot_data,"user_id"),Date.now(),performance.now()].join("_")};var c=function e(){return _.get(TS.model,"async_api_url")+"profiling.addTrace"};var u=function e(){return _.get(TS.model,"api_token")};var m=function e(i){function n(e,i){_.each(e,function(a,r){if(r===i)delete e[r];else if(a===i)e[r]="(redacted)";else if("object"===("undefined"===typeof a?"undefined":t(a)))n(a,i)})}n(i,u());return i};var f=function t(r){r=parseInt(r,10);return _.isNaN(r)?a:_.clamp(r*e,i,n)};var h=function e(){return!!s&&s.isPending()};var g=function e(i,t){var n=d();return Promise.resolve(window.desktop.stats.startTraceRecord({identifier:n,endpoint:c(),token:u(),metadata:_.assign({},m(t),{identifier:n,duration:f(i)})}))};var p=function e(){return Promise.resolve(window.desktop.stats.stopTraceRecord())};var S=function e(){return Date.now()-TS.storage.fetchLastTraceTS()>r};var T=function e(i){if(!i)return Promise.resolve();return new Promise(function(e){i.then(function(i){return e(i)})})}})()},4941:function(e,i){(function(){TS.registerModule("key_triggers",{onStart:function i(){if(TS.boot_data.special_flex_panes)_.forOwn(TS.boot_data.special_flex_panes,function(i){if(i.keycode)(function(i,t){e[i.toString()]={func:function e(){TS.client.ui.flex.openFlexTab(t)}}})(i.keycode,i.flex_name)})},getFromCode:function i(t){t=TS.i18n.keyCodeEquivalentReverse(t).toString();return e[t]}});var e={220:{isDisabled:function e(i){var t=$(i.target).closest("#reply_container").length>0;var n=$(i.target).closest(".reply_input_container").length>0;var a=t||n;return!a&&TS.client.activeChannelIsHidden()},shift_optional:false,func:function e(i){var t=TS.shared.getActiveModelOb();if(!t)return;var n=$(i.target).closest("#reply_container.has_focus").length>0;var a=$(i.target).closest(".reply_input_container.has_focus").length>0;var r=$(".message--focus");var s;if(n){var o=_.clone(TS.ui.replies.getActiveMessages());s=_.reverse(o);i.target=$("#reply_container")}else if(a){var l=$(".reply_input_container.has_focus");var d=TS.client.ui.threads.getThreadFromEl(l);var c=d.replies&&d.replies.length?_.clone(d.replies):_.clone(d.root_msg);c=_.dropRightWhile(d.replies,function(e){return e.ts>d.max_visible_ts});s=_.reverse(c);i.target=l}else{if(TS.useReactMessages())s=TS.redux.messages.getRecentMessagesInChannel(t.id);else s=TS.utility.msgs.getDisplayedMsgs(t.msgs);i.target=TS.client.ui.$msg_input}if(r.length){r.find(".btn_msg_action.ts_icon_small_reaction").click();return}var u=_(s).take(5).find(function(e){return!e.is_ephemeral});if(!u)return;if(!TS.useReactMessages()&&u._jl_rolled_up_in){u=TS.utility.msgs.getMsg(u._jl_rolled_up_in,t.msgs);if(!u)return}var m=TS.rxns.getRxnKeyByMsgType(u);if(!m)return;var f=TS.utility.msgs.getMsgActions(u,t);if(!f||!f.add_rxn&&!f.add_file_rxn&&!f.add_file_comment_rxn){TS.sounds.play("beep");return}var h=function e(){var t=$(i.target).find("textarea").addBack();t.focus()};TS.ui.react_emoji_menu.start({e:i,rxn_key:m,callback:h})}},77:{isDisabled:function e(){return TS.model.is_chrome_desktop||TS.model.is_chrome_mobile},func:function e(){if(TS.model.ui_state.flex_visible&&"mentions"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab("mentions")}},83:{shift_optional:true,func:function e(i){if(TS.boot_data.feature_star_shortcut&&i.altKey)TS.stars.toggleStarForActiveModel();else if(i.shiftKey)if(TS.model.ui_state.flex_visible&&"stars"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab("stars")}},85:{isDisabled:function e(i){return!!i.altKey||TS.client.activeChannelIsHidden()},no_shift:true,func:function e(){TS.client.ui.files.$upload.trigger("click")}},69:{isDisabled:function e(){return!!TS.model.is_FF},func:function e(){if(TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else{TS.client.ui.flex.openFlexTab("team");TS.client.ui.showTeamList()}}},65:{isDisabled:function e(){if(!TS.client.unread.isEnabled())return true;return false},func:function e(){if(TS.model.unread_view_is_showing)TS.client.unread.reloadIfPendingMessages();else TS.client.unread.showUnreadView()}},73:{isDisabled:function e(i){if(!TS.model.is_our_app)return true;if(window.loadSettings&&window.loadSettings.devMode)return true;if(i.altKey)return true;if(TS.client.activeChannelIsHidden())return true;return false},func:function e(){if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab("details")}},70:{isDisabled:function e(i){return!(TS.model.is_our_app||TS.model&&TS.prefs.prefs_loaded&&TS.prefs.getPref("f_key_search")||TS.boot_data.feature_focus_mode&&i.altKey)},no_shift:true,func:function e(i){TS.client.ui.startSearch(i)}},74:{isDisabled:function e(){return!TS.environment.is_apple_webkit},no_shift:true,func:_.noop},75:{isDisabled:function e(i){return i.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model||!TS.model.is_our_app&&!TS.prefs.getPref("k_key_omnibox")},no_shift:true,func:function e(){i()}},76:{isDisabled:function e(i){if(!i.metaKey&&!i.altKey&&!i.shiftKey&&i.ctrlKey&&TS.model.is_mac){i.preventDefault();i.stopPropagation()}return i.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model},shift_optional:false,func:function e(){TS.ui.channel_browser.start()}},84:{isDisabled:function e(i){return i.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model||!TS.model.is_our_app},no_shift:true,func:function e(){i()}},188:{isDisabled:function e(){if(!TS.model.is_mac)return true;if(!TS.model.active_im_id)return false;return true},shift_optional:false,func:function e(){TS.ui.channel_prefs_dialog.start(TS.model.active_cid)}}};var i=function e(){if(TS.prefs.getPref("no_omnibox_in_channels")||!TS.prefs.getPref("show_sidebar_quickswitcher_button"))TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut_no_btn",action:"opened"});TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"opened"});var i=TS.prefs.getPref("k_key_omnibox_auto_hide_count");if(i<TS.ui.jumper.k_key_omnibox_auto_hide_count_max)TS.prefs.setPrefByAPI({name:"k_key_omnibox_auto_hide_count",value:i+1});TS.ui.jumper.start(true)}})()},4942:function(e,i){(function(){TS.registerModule("search.view",{latest_msg_search_results:null,added_to_history_last_ms:0,search_results_lazy_load:null,last_terms:"",filter_delay_ms:6e4,onStart:function e(){TS.search.search_filter_set_sig.add(TS.search.view.renderResults,TS.search.view);TS.search.search_filetype_filter_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_sort_set_sig.add(d);TS.prefs.messages_theme_changed_sig.add(TS.search.view.messagesThemeChanged,TS.search.view);TS.search.message_search_results_fetched_sig.add(o);TS.search.file_search_results_fetched_sig.add(l);if(TS.search.sliFileSearchIsEnabled())TS.search.all_search_results_fetched_sig.add(TS.search.view.renderResultsIfAllTab);if(TS.search.sliFileSearchIsEnabled())TS.search.search_dispatched_sig.add(TS.search.view.maybeDisplayLoadingState);if(TS.client){$("#flexpane_tabs a").bind("click.setSearchFilter",function(){if("files"===$(this).data("tab-id")||$(this).data("filetype"))TS.search.setFilter("files");else TS.search.setFilter("messages")});$("#search_results_items").bind("click.view",function(e){if(0===$(e.target).closest("A").length)return;if(1==$(e.target).closest(".file_list_item").length)TS.search.view.maybeLogSearchInteraction("files")});$("#search_tabs").html(TS.templates.search_tabs({messages_count:0,files_count:0,show_all_tab:TS.search.sliFileSearchIsEnabled()}));$("#search_clear").bind("click.switch_to_files",function(){if("files"===TS.search.filter&&TS.model.ui_state.flex_visible)setTimeout(function(){TS.search.view.switchBackToFiles()},50)});$("#search_results").scroll(function(){s();if(TS.menu.search_filter_is_showing)TS.menu.end()});if(TS.search.sliFileSearchIsEnabled())$("#search_tab").addClass("feature_sli_file_search");TS.client.login_sig.add(TS.search.view.loggedIn,TS.search.view)}if(TS.web){TS.web.login_sig.add(TS.search.view.loggedIn,TS.search.view);TS.search.all_search_results_fetched_sig.add(TS.search.view.updateHistory,TS.search.view);TS.search.search_filter_set_sig.add(TS.search.view.updateHistory,TS.search.view);$(window).bind("popstate",function(e){TS.search.view.onPopState(e.originalEvent)})}},loggedIn:function e(){if(TS.client)if("timestamp"===TS.search.sort)$("#search_sort_timestamp").addClass("active").attr("aria-checked",true);else if("model"===TS.search.sort&&$("#search_sort_model").length)$("#search_sort_model").addClass("active").attr("aria-checked",true);else $("#search_sort_score").addClass("active").attr("aria-checked",true);if(TS.web){if(TS.boot_data.filter)TS.search.setFilter(TS.boot_data.filter);if(TS.boot_data.query)TS.search.searchAll(TS.search.truncateQuery(TS.boot_data.query))}},pageMessagesForward:function e(){var i=TS.search.results[TS.search.query];if(!i.messages||TS.search.view.current_messages_page+1>i.messages.paging.pages)return;TS.search.view.current_messages_page+=1;TS.search.view.renderResults();if(TS.search.separateMessagesAndFiles()&&TS.search.view.current_messages_page<=i.messages.paging.page)return;$("#search_results_team").addClass("hidden");if(TS.search.view.current_messages_page<i.messages.paging.page)return;if(TS.search.separateMessagesAndFiles())TS.search.getNextPageOfMessageResults(TS.search.query,TS.search.query_string,TS.search.view.current_messages_page);else TS.search.getNextPageOfSearchResults(TS.search.query,TS.search.query_string,TS.search.view.current_messages_page+1)},pageMessagesBack:function e(){if(TS.search.view.current_messages_page-1<1)return;TS.search.view.current_messages_page-=1;TS.search.view.renderResults()},pageFilesForward:function e(){var i=TS.search.results[TS.search.query];if(!i.files||TS.search.view.current_files_page+1>i.files.paging.pages)return;TS.search.view.current_files_page+=1;TS.search.view.renderResults();if(TS.search.separateMessagesAndFiles()&&TS.search.view.current_files_page<=i.files.paging.page)return;$("#search_results_team").addClass("hidden");if(TS.search.view.current_files_page<i.files.paging.page)return;if(TS.search.separateMessagesAndFiles())TS.search.getNextPageOfFileResults(TS.search.query,TS.search.query_string,TS.search.view.current_files_page);else TS.search.getNextPageOfSearchResults(TS.search.query,TS.search.query_string,TS.search.view.current_files_page+1)},pageFilesBack:function e(){if(TS.search.view.current_files_page-1<1)return;TS.search.view.current_files_page-=1;TS.search.view.renderResults()},waiting_on_page:-1,waiting_on_messages_page:-1,waiting_on_files_page:-1,current_messages_page:1,current_files_page:1,renderResults:function a(s,o){if(n)return;if(s){if("messages"===TS.search.filter)e=null;if("all"===TS.search.filter)i=null}TS.search.view.updateOptions();if(!TS.search.results[TS.search.query]&&!TS.search.sliFileSearchIsEnabled())return;var l=TS.search.results[TS.search.query]||{};if(TS.search.sliFileSearchIsEnabled()&&!o&&TS.search.view.searchIsVisible()&&"messages"===TS.search.filter&&l.messages&&l.messages.matches&&l.messages.matches.length>10){TS.utility.rAF(function(){TS.utility.rAF(function(){return TS.search.view.renderResults(s,true)})});$("#search_results_items .search_message_result, #search_results_items .file_list_item, .sli_expert_search, #search_results_team").css("opacity",.4);return}if(TS.search.sliFileSearchIsEnabled()&&o)$("#search_results_team").css("opacity","");var d="";var u=[];var m;var f=false;var h=false;var g=false;var p=true;var T=TS.i18n.t("Loading","search")();var v=["all","messages","files"];var b=TS.boot_data.page_needs_enterprise&&!TS.prefs.getPref("search_only_current_team")?TS.model.team.enterprise_id:TS.model.team.id;v.forEach(function(e){var i=TS.search.filter===e;$("#filter_"+e).attr("aria-selected",i)});var w=v.reduce(function(e,i){if(e)return e;if(TS.search.filter===i)return"filter_"+i;return null},null);$("#search_results").attr("aria-labelledby",w);if("messages"===TS.search.filter){if(l.messages&&l.messages.matches){var y=l.messages.pages[TS.search.view.current_messages_page-1];if(y)u=l.messages.matches.slice(y.start,y.count)}if(!u.length)if(TS.search.separateMessagesAndFiles())TS.search.view.waiting_on_messages_page=TS.search.view.current_messages_page;else TS.search.view.waiting_on_page=TS.search.view.current_messages_page;if(!TS.search.sliFileSearchIsEnabled()){g=(_.get(l,"modules.channel_facets")||_.get(l,"modules.user_facets"))&&TS.sli_search_facets&&TS.sli_search_facets.isEnabled()&&1==TS.search.view.current_messages_page;if(g)d+=TS.sli_search_facets.render(l.modules.channel_facets,l.modules.user_facets);h=_.get(l,"modules.experts")&&1==TS.search.view.current_messages_page;if(h)d+=TS.sli_expert_search.render(TS.search.query,TS.search.query_string_for_display,l.modules.experts,l.modules.channels);f="timestamp"===TS.search.sort&&l.messages.modules&&l.messages.modules.score&&l.messages.modules.score.top_results&&1==TS.search.view.current_messages_page;if(f){var A=l.messages.modules.score.debug||{};d+=TS.templates.search_top_results_message_results({container_id:"search_module_results",results:l.messages.modules.score.top_results,page:l.messages.modules.score.top_results,module_name:"score_top_results",module_order:l.messages.modules.score.order,show_feedback:l.show_feedback,for_search_display:true,debug:A})}}else if(TS.boot_data.feature_sli_file_search){var k="";if("model"===TS.experiment.getGroup("search_feedback"))k="<a onclick=\"TS.search.debugQuery('"+b+"', '"+TS.boot_data.user_id+'\');">\n\t\t\t\t\t\t<ts-icon class="ts_icon_info sli_query_info ts_tip ts_tip_top ts_tip_float">\n\t\t\t\t\t\t\t<span class="ts_tip_tip">Query debugger</span>\n\t\t\t\t\t\t</ts-icon>\n\t\t\t\t\t</a>';d+='<div class="search_module_header small_right_padding">\n\t\t\t\t\t<div class="search_sort_container">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\trole="radio"\n\t\t\t\t\t\t\tid="search_sort_timestamp"\n\t\t\t\t\t\t\tclass="btn_unstyle search_segmented_control left '+("timestamp"===TS.search.sort?"active":"")+'"\n\t\t\t\t\t\t\t'+("timestamp"===TS.search.sort?"":"onclick=\"TS.search.view.setSort('timestamp');\"")+"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t"+TS.i18n.t("Recent","search")()+'\n\t\t\t\t\t\t</button><button\n\t\t\t\t\t\t\trole="radio"\n\t\t\t\t\t\t\tid="search_sort_score"\n\t\t\t\t\t\t\tclass="btn_unstyle search_segmented_control right '+("score"===TS.search.sort?"active":"")+'"\n\t\t\t\t\t\t\t'+("score"===TS.search.sort?"":"onclick=\"TS.search.view.setSort('score');\"")+"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t"+TS.i18n.t("Relevant","search")()+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"+k+"\n\t\t\t\t\t</div>\n\t\t\t\t\t<p>"+TS.i18n.t("{count, plural, =1 {# Message} other {# Messages}}","search")({count:l.messages&&l.messages.total||0})+"</p>\n\t\t\t\t</div>"}if(f||h)d+='<div class="search_module_header"><p><span>'+TS.i18n.t("All Results","search")()+"</span></p></div>";if(u.length)d+=TS.templates.search_message_results({results:l,page:u,current_page:TS.search.view.current_messages_page,paging_html:l.messages&&p?new Handlebars.SafeString(TS.templates.messages_search_paging({current_page:TS.search.view.current_messages_page,pages:l.messages.paging.pages})):"",module_order:l.messages.order||0,is_enterprise:TS.boot_data.page_needs_enterprise,search_global:!TS.prefs.getPref("search_only_current_team"),show_feedback:l.show_feedback});else if(!l.messages||l.messages.total>0){var C=TS.i18n.t("loading page {page_num}...","search")({page_num:TS.search.view.current_messages_page});if(TS.search.sliFileSearchIsEnabled())d+='<div class="very_large_top_margin">\n\t\t\t\t\t\t'+TS.templates.infinite_spinner({color:"blue",size:"medium"})+"\n\t\t\t\t\t</div>";else d+='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+T+'" /><br />'+C+"</div>"}else d+=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string_for_display),filter:"messages",error:l.error});$("#search_results_file_limit").addClass("hidden")}else if("files"===TS.search.filter){$("#search_tabs").slideDown(500);m=(TS.search.view.current_files_page-1)*TS.search.per_page;if(l.files&&l.files.matches)u=l.files.matches.slice(m,m+TS.search.per_page);if(!u.length)if(TS.search.separateMessagesAndFiles())TS.search.view.waiting_on_files_page=TS.search.view.current_files_page;else TS.search.view.waiting_on_page=TS.search.view.current_files_page;if(u.length){if(TS.search.sliFileSearchIsEnabled()&&TS.boot_data.feature_sli_file_search)d+='<div class="search_module_header small_right_padding">\n\t\t\t\t\t\t<div class="search_module__inline_filter float_right">\n\t\t\t\t\t\t\t'+TS.templates.search_files_heading({filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype],show_feedback:"model"===TS.experiment.getGroup("search_feedback"),user_id:TS.boot_data.user_id,team_id:b})+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p>"+TS.i18n.t("{count, plural, =1 {# File} other {# Files}}","search")({count:l.files&&l.files.total||0})+"</p>\n\t\t\t\t\t</div>";var M=p?TS.templates.files_search_paging({current_page:TS.search.view.current_files_page,pages:l.files&&l.files.paging&&l.files.paging.pages||[]}):"";var I={for_search:true,show_channel_name:true,is_enterprise:TS.boot_data.page_needs_enterprise};$.each(u,function(e,i){d+=TS.templates.builders.fileHTML(i,I)});d+=M}else if(!l.files||l.files.total>0){var x=TS.i18n.t("loading page {page_num}...","search")({page_num:TS.search.view.current_files_page});if(TS.search.sliFileSearchIsEnabled())d+='<div class="very_large_top_margin">\n\t\t\t\t\t\t'+TS.templates.infinite_spinner({color:"blue",size:"medium"})+"\n\t\t\t\t\t</div>";else d+='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+T+'" /><br />'+x+"</div>"}else{if(TS.search.sliFileSearchIsEnabled()&&TS.boot_data.feature_sli_file_search)d+='<div class="search_module_header small_right_padding">\n\t\t\t\t\t\t<div class="search_module__inline_filter float_right">\n\t\t\t\t\t\t\t'+TS.templates.search_files_heading({filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype],show_feedback:"model"===TS.experiment.getGroup("search_feedback"),user_id:TS.boot_data.user_id,team_id:b})+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p>"+TS.i18n.t("{count, plural, =1 {# File} other {# Files}}","search")({count:l.files.total||0})+"</p>\n\t\t\t\t\t</div>";d+=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string_for_display),filter:"files",error:l.error,filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype]})}$("#search_results_file_limit").removeClass("hidden");$("#search_results_message_limit").addClass("hidden")}else if(TS.search.sliFileSearchIsEnabled()&&"all"===TS.search.filter&&TS.boot_data.feature_sli_file_search){g=(_.get(l,"modules.channel_facets")||_.get(l,"modules.user_facets"))&&TS.sli_search_facets&&TS.sli_search_facets.isEnabled()&&1==TS.search.view.current_messages_page;if(g)d+=TS.sli_search_facets.render(l.modules.channel_facets,l.modules.user_facets);h=_.get(l,"modules.experts")&&1==TS.search.view.current_messages_page;if(h)d+=TS.sli_expert_search.render(TS.search.query,TS.search.query_string_for_display,l.modules.experts,l.modules.channels);var E=l.files&&l.files.matches&&_.filter(l.files.matches,function(e){return e.top_file}).length;if(E){d+='<div class="search_module_header">\n\t\t\t\t\t<p>'+TS.i18n.t("Top Files","search")()+"</p>\n\t\t\t\t</div>";var B=_.filter(l.files.matches,function(e){return e.top_file});_.each(B,function(e){d+=TS.templates.builders.fileHTML(e,{for_search:true,show_channel_name:true,is_enterprise:TS.boot_data.page_needs_enterprise})});if(l.files.total>2)d+='<div class="search_module_footer__more_link">\n\t\t\t\t\t\t<a href="#" onclick="TS.search.view.moreFiles(); return false;">\n\t\t\t\t\t\t\t'+TS.i18n.t("{count, plural, =1 {# more} other {# more}} ","search")({count:l.files.total-B.length})+' <ts-icon class="ts_icon_chevron_right"></ts-icon>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>'}f=l.messages&&l.messages.modules&&l.messages.modules.score&&l.messages.modules.score.top_results&&1==TS.search.view.current_messages_page||_.get(l,"messages.timestamp_messages");if(f){var P=l.messages.timestamp_messages||l.messages;d+='<div class="search_module_header">\n\t\t\t\t\t<p>'+TS.i18n.t("Top Messages","search")()+"</p>\n\t\t\t\t</div>";d+=TS.templates.search_top_results_message_results({container_id:"search_module_results",results:P.modules.score.top_results,page:P.modules.score.top_results,module_name:"score_top_results",module_order:P.modules.score.order,show_feedback:false,hide_footer:true,for_search_display:true,show_separated_messages:true,debug:P.modules.score.debug||{}});if(P.total-P.modules.score.top_results.length>0)d+='<div class="search_module_footer__more_link">\n\t\t\t\t\t\t<a href="#" onclick="TS.search.view.moreRelevantMessages(); return false;">\n\t\t\t\t\t\t\t'+TS.i18n.t("{count, plural, =1 {# more} other {# more}} ","search")({count:P.total-P.modules.score.top_results.length})+' <ts-icon class="ts_icon_chevron_right"></ts-icon>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>'}if(l.messages&&l.messages.matches.length)d+='<div class="search_module_header">\n\t\t\t\t\t<p>'+TS.i18n.t("{count, plural, =1 {# Result} other {# Results}}","search")({count:l.messages.total})+"</p>\n\t\t\t\t</div>\n\t\t\t\t"+TS.templates.search_message_results({results:l,page:_.take(l.messages.matches,r),current_page:1,paging_html:"",module_order:l.messages.order||0,is_enterprise:TS.boot_data.page_needs_enterprise,search_global:!TS.prefs.getPref("search_only_current_team"),show_feedback:false})+'\n\t\t\t\t<p class="search_module_footer__more_link">\n\t\t\t\t\t<a href="#" class="search_module_footer__more_link" onclick="TS.search.view.moreRecentMessages(); return false;">\n\t\t\t\t\t\t'+TS.i18n.t("View more","search")()+' <ts-icon class="ts_icon_chevron_right"></ts-icon>\n\t\t\t\t\t</a>\n\t\t\t\t</p>';if(!g&&!h&&!E&&!f&&!_.get(l,"messages.matches.length"))d=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string_for_display),filter:"all",error:l.error})}$("#search_results_items").find(".search_jump_maybe").tooltip("destroy");$("#search_results_items").html(d);if(TS.search.sliFileSearchIsEnabled())$("#search_results").removeClass("all messages files").addClass(TS.search.filter);if(TS.view)TS.utility.makeSureAllLinksHaveTargets($("#search_results_items"));else TS.utility.makeSureAllExternalLinksAreRefererSafe($("#search_results_items"));$("#search_results_items").find(".search_jump_maybe").tooltip({delay:{show:450,hide:150},container:"body",placement:"left"});if(TS.client){try{n=true;TS.search.view.showResults()}finally{n=false}$("#search_results").scrollTop(0);TS.client.ui.checkInlineImgsAndIframes("search")}if(TS.search.view.search_results_lazy_load&&TS.search.view.search_results_lazy_load.detachEvents)TS.search.view.search_results_lazy_load.detachEvents();$("#search_results_container").find(".lazy").lazyload({container:$("#search_results"),throttle:200});if("messages"===TS.search.filter||"all"===TS.search.filter){S();c(l);if("messages"===TS.search.filter&&e)$("#search_results").scrollTop(e);if("all"===TS.search.filter&&i)$("#search_results").scrollTop(i)}else if(t)$("#search_results").scrollTop(t)},showResults:function e(){var i=TS.model.ui.active_tab_id;var t=TS.model.previewed_file_id;if(!TS.model.ui_state.flex_visible||"search"!==TS.model.ui_state.flex_name){TS.client.ui.flex.openFlexTab("search");TS.clog.track("SEARCH_OPEN",{open_method:"search_box",click_module_name:TS.search.filter,click_module_position:0,click_module_sort:TS.search.getModuleSort(),request_id:TS.search.getLastRequestId(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})}if("messages"===TS.search.filter){$("#search_tabs").show();$(".search_sort_container").show()}else if("files"===TS.search.filter){$("#search_tabs").slideDown(500);$(".search_sort_container").hide();if("files"===i&&!t&&TS.model.active_file_list_filter!==TS.search.filetype)TS.search.setFiletypeFilter(TS.model.active_file_list_filter)}else if(TS.search.sliFileSearchIsEnabled()&&"all"===TS.search.filter)$(".search_sort_container").hide();if(TS.search.sliFileSearchIsEnabled()&&a&&TS.search.results[TS.search.query]){$("#search_results").removeClass("search_results--loading");a=false}},maybeRebuildResults:function e(){var i=$("#search_message_results");if(!i.length||!i.children().length)TS.search.search_filter_set_sig.dispatch()},cleanResults:function e(){if(TS.search.view.search_results_lazy_load&&TS.search.view.search_results_lazy_load.detachEvents)TS.search.view.search_results_lazy_load.detachEvents();$("#search_results_team").empty();$("#search_results_items").empty()},clearFiletypeFilter:function e(){TS.search.setFiletypeFilter("all")},maybeResetSearch:function e(){if(!TS.search.view.searchIsVisible()){TS.search.setSort("timestamp",true);TS.search.searchSessionEnd()}},searchIsVisible:function e(){return TS.model.ui_state.flex_visible&&"search"===TS.model.ui_state.flex_name},updateOptions:function e(){var i={search_filter:TS.search.filter,sort_filter:TS.search.sort,search_only_my_channels:TS.prefs.getPref("search_only_my_channels"),menu_is_showing:TS.menu.search_filter_is_showing};var t=TS.search.results[TS.search.query];var n=TS.i18n.t("everything","search")();var a=TS.prefs.getPref("search_only_my_channels");var r=TS.prefs.getPref("search_exclude_bots");var s=TS.prefs.getPref("search_only_current_team");var o=false;if(t&&t.ignored_exclude_bots_pref&&t.messages&&t.messages.total>0)o=true;var l="";if(o){var d=g(TS.search.query_string);l=TS.i18n.listify(d)}var c="messages"===TS.search.filter?"messages":"files";if(a&&r)if(o)if("messages"===c)n=TS.i18n.t("only channels I have joined, messages from {names}","search")({names:l});else n=TS.i18n.t("only channels I have joined, files from {names}","search")({names:l});else n=TS.i18n.t("only channels I have joined, no bots or integrations","search")();else if(a&&!r)if("messages"===c)n=TS.i18n.t("only messages from channels I have open","search")();else n=TS.i18n.t("only files from channels I have open","search")();else if(!a&&r)if(o)if("messages"===c)n=TS.i18n.t("messages from {names}","search")({names:l});else n=TS.i18n.t("files from {names}","search")({names:l});else if("messages"===c)n=TS.i18n.t("only messages from people","search")();else n=TS.i18n.t("only files from people","search");if(TS.boot_data.page_needs_enterprise){var _=TS.redux.enterprise.getEnterpriseOrgName();var u={org_bots_allchannels:TS.i18n.t("everything I can access in {org_name}","search")({org_name:_}),org_bots_openchannels:TS.i18n.t("only messages from channels I have open in {org_name}","search")({org_name:_}),org_nobots_allchannels:TS.i18n.t("only messages from people in {org_name}","search")({org_name:_}),org_nobots_openchannels:TS.i18n.t("messages from people in all channels I have open in {org_name}","search")({org_name:_}),noorg_bots_allchannels:TS.i18n.t("everything in this workspace","search")(),noorg_bots_openchannels:TS.i18n.t("only messages from channels I have open in this workspace","search")(),noorg_nobots_allchannels:TS.i18n.t("only messages from people in this workspace","search")(),noorg_nobots_openchannels:TS.i18n.t("messages from people, in only channels I have open, in this workspace","search")()};if(!s&&!a&&!r)n=u.org_bots_allchannels;else if(!s&&a&&!r)n=u.org_bots_openchannels;else if(!s&&!a&&r)n=u.org_nobots_allchannels;else if(!s&&a&&r)n=u.org_nobots_openchannels;else if(s&&!a&&!r)n=u.noorg_bots_allchannels;else if(s&&a&&!r)n=u.noorg_bots_openchannels;else if(s&&!a&&r)n=u.noorg_nobots_allchannels;else if(s&&a&&r)n=u.noorg_nobots_openchannels}i.include_text=n;var m=TS.templates.search_options(i);$("#search_options").html(m);if(TS.search.results[TS.search.query]){var f=t&&t.initial_messages_total?t.initial_messages_total:0;var h=t&&t.initial_files_total?t.initial_files_total:0;$("#search_tabs").html(TS.templates.search_tabs({messages_count:TS.i18n.number(f),files_count:TS.i18n.number(h),show_all_tab:TS.search.sliFileSearchIsEnabled()}))}if("files"===TS.search.filter&&!TS.search.sliFileSearchIsEnabled()){var p=TS.boot_data.page_needs_enterprise&&!TS.prefs.getPref("search_only_current_team")?TS.model.team.enterprise_id:TS.model.team.id;$("#search_heading").html(TS.templates.search_files_heading({filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype],show_feedback:"model"===TS.experiment.getGroup("search_feedback"),user_id:TS.boot_data.user_id,team_id:p}));$("#search_file_list_heading").bind("click.show_menu",function(e){e.preventDefault();TS.menu.file.startWithFileFilter(e,true)});$("#search_file_list_clear_filter").bind("click.clear_filter",function(e){e.stopPropagation();TS.search.view.clearFiletypeFilter()})}else if(!TS.search.sliFileSearchIsEnabled())$("#search_heading").html(TS.i18n.t("Search Results","search")());$(".search_filter_menu_target").click(TS.menu.startWithSearchFilter)},switchBackToFiles:function e(){if(TS.search.results[TS.search.query]){var i=(Date.now()-TS.search.results[TS.search.query]._time_of_search)/1e3;if(i<60){TS.client.ui.files.filterFileList(TS.search.filetype);if(TS.search.member)TS.client.ui.files.toggleFileList(TS.search.member.id);else TS.client.ui.files.toggleFileList("all")}else{TS.client.ui.files.filterFileList("all");TS.client.ui.files.toggleFileList("all")}}$("#search_tabs").slideUp(250,function(){setTimeout(function(){TS.client.ui.files.showFileList()},100)})},setTab:function e(i){TS.search.setFilter(i);TS.clog.track("SEARCH_OPEN",{open_method:"search_tab",click_module_name:i,click_module_sort:TS.search.getModuleSort(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})},moreTopResults:function e(){TS.search.sort="score";TS.search.switchToRelevant(true);TS.clog.track("SEARCH_OPEN",{open_method:"top_results_see_more",click_module_position:0,click_module_name:TS.search.filter,click_module_sort:TS.search.getModuleSort(),request_id:TS.search.getLastRequestId(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})},moreRelevantMessages:function e(){TS.search.setSort("score");TS.search.setFilter("messages");TS.clog.track("SEARCH_OPEN",{open_method:"top_messages_see_more",click_module_position:1,click_module_name:TS.search.filter,click_module_sort:TS.search.getModuleSort(),request_id:TS.search.getLastRequestId(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})},moreRecentMessages:function e(){TS.search.setSort("timestamp");TS.search.setFilter("messages");TS.clog.track("SEARCH_OPEN",{open_method:"recent_messages_see_more",click_module_position:2,click_module_name:TS.search.filter,click_module_sort:TS.search.getModuleSort(),request_id:TS.search.getLastRequestId(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})},moreFiles:function e(){TS.search.setFilter("files");TS.clog.track("SEARCH_OPEN",{open_method:"top_files_see_more",click_module_position:0,click_module_name:TS.search.filter,click_module_sort:TS.search.getModuleSort(),request_id:TS.search.getLastRequestId(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})},setSort:function e(i){TS.search.setSort(i);TS.clog.track("SEARCH_OPEN",{open_method:"set_sort_"+i,click_module_name:TS.search.filter,click_module_sort:TS.search.getModuleSort(),request_id:TS.search.getLastRequestId(),client_request_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()})},searchMembers:function e(){var i=$("#search_results_team");var t=new RegExp("\\b"+TS.utility.regexpEscape(TS.search.query_string_for_display)+"\\b","i");i.removeClass("hidden");var n=TS.search.query_string_for_display.toLowerCase();var a=TS.members.getMembersForUser();var r=$.grep(a,function(e){if(!e.deleted)return e._name_lc==n||e._display_name_lc==n||e.profile.real_name_normalized&&t.test(e.profile.real_name_normalized)||e._real_name_lc&&e._real_name_lc==n});if(0===r.length){var s=/from:<@([^>]+)>/gi;var o;var l;do{o=s.exec(TS.search.query);if(o&&o.length>1)for(l=0;l<a.length;l+=1)if(!a[l].deleted)if(a[l].id===o[1]){r.push(a[l]);break}}while(o)}if(r.length>0)i.html(TS.templates.search_team_results({matches:_.take(r,3)}));else i.empty()},updateHistory:function e(){var i={filter:TS.search.filter,query:TS.search.query,channel_id:null,member_id:null};if(TS.search.channel)i.channel_id=TS.search.channel.id;if(TS.search.group)i.group_id=TS.search.group.id;if(TS.search.member)i.member_id=TS.search.member.id;var t="/search/";t+=TS.search.filter;t+="?q="+encodeURIComponent(TS.search.query);if(TS.qs_args)for(var n in TS.qs_args)if(TS.qs_args.hasOwnProperty(n))if("q"!==n)t+="&"+n+"="+TS.qs_args[n];if(t===window.location.pathname+window.location.search)window.history.replaceState(i,null,t);else window.history.pushState(i,null,t)},onPopState:function e(i){var t=i.state;if(!t)return;if(t.filter)TS.search.setFilter(t.filter);if(t.channel_id)TS.search.channel=TS.channels.getChannelById(t.channel_id);else TS.search.channel=null;if(t.group_id)TS.search.group=TS.groups.getGroupById(t.group_id);else TS.search.group=null;if(t.member_id)TS.search.member=TS.members.getMemberById(t.member_id);else TS.search.member=null;TS.search.searchAll(t.query)},messageSearchResultsFetched:function e(i,t){TS.search.view.latest_msg_search_results=i;var n=Date.now();var a=n-TS.search.view.added_to_history_last_ms;var r=a<5e3;TS.search.view.added_to_history_last_ms=n;if(TS.client)TS.client.flexDisplaySwitched("search",t.query_string,r)},search_interactions_logged:{},maybeLogSearchInteraction:function e(i){var t=TS.search.last_search_query;if(!t)return;if(TS.search.view.search_interactions_logged[i+"__"+t])return;TS.search.view.search_interactions_logged[i+"__"+t]=true;TS.search.saveSearch({type:i,terms:t})},messagesThemeChanged:function e(){if("search"===TS.model.ui_state.flex_name)TS.search.view.renderResults()},msgHasExtracts:function e(i){if(i.extracts&&i.extracts.length>0)return true;var t;if(i.attachments)for(var n=0;n<i.attachments.length;n+=1){t=i.attachments[n];if(t.extracts&&Object.keys(t.extracts).length>0)return true}return false},resultHasExtracts:function e(i){return TS.search.view.msgHasExtracts(i)||i.previous&&TS.search.view.msgHasExtracts(i.previous)||i.previous_2&&TS.search.view.msgHasExtracts(i.previous_2)||i.next&&TS.search.view.msgHasExtracts(i.next)||i.next_2&&TS.search.view.msgHasExtracts(i.next_2)},determineMessageResultType:function e(i,t){if(TS.search.view.msgHasExtracts(i[t]))return"extract";if(t-1>=0)if(TS.search.view.msgHasExtracts(i[t-1]))return"context";if(t+1<i.length)if(TS.search.view.msgHasExtracts(i[t+1]))return"context";return"extra"},getMatchForSearchResult:function e(i){var t=i.closest(".search_message_result");if(!t.length)return null;var n=t.data("channel");var a=""+t.data("ts");var r;var s=t.data("module-name");if("score_top_results"===s)r=TS.search.getMatchByQueryAndChannelAndTsAndModule(true,TS.search.view.latest_msg_search_results.query,n,a,"score");else r=TS.search.getMatchByQueryAndChannelAndTs(TS.search.view.latest_msg_search_results.query,n,a);return r},firstResultWithExtracts:function e(i){return p(i)},toggleExtractsForMatch:function e(i,t){var n=$(i.target);var a=t.match;var r=n.closest(".search_message_result");var s=r.data("module-name")||"";var o=r.data("module-order")||0;var l=n.closest("ts-message");var d=l.data("iid")||"";var c={click_target_type:a.extracts_expanded?"collapse":"expand",click_position:t.index,click_user_id:a.user,click_channel_id:a.channel.id,click_timestamp:a.ts,click_module_name:s,click_module_position:o,click_sort:TS.search.sort,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};var _=n.closest("ts-message");if(_.length){c.click_target_user_id=_.data("memberId");c.click_target_timestamp=""+_.data("ts")}if(TS.search.last_request_id)c.request_id=TS.search.last_request_id;if(d)c.click_iid=d;TS.clog.track("SEARCH_CLICK",c);if(a.extracts_expanded)f(a,n.closest(".search_result_with_extract, .search_result_for_context, .search_result_for_extra_context"));else m(a,n.closest(".search_result_with_extract, .search_result_for_context, .search_result_for_extra_context"))},maybeDisplayLoadingState:function e(){if(TS.search.sliFileSearchIsEnabled()&&TS.search.view.searchIsVisible()){$("#search_results").scrollTop(0).addClass("search_results--loading");a=true}},isLoading:function e(){return!!a},renderResultsIfAllTab:function e(){if("all"===TS.search.filter)TS.search.view.renderResults()}});var e;var i;var t;var n=false;var a=false;var r=5;var s=function n(){if("search"!==TS.model.ui_state.flex_name)return;TS.client.ui.checkInlineImgsAndIframes("search");if("files"===TS.search.filter)t=$("#search_results").scrollTop();else if("messages"===TS.search.filter)e=$("#search_results").scrollTop();else i=$("#search_results").scrollTop()};s=_.debounce(s,250);var o=function t(n,a){e=null;i=null;if(1==a.page){TS.search.view.current_messages_page=1;TS.search.view.waiting_on_messages_page=-1;if("messages"===TS.search.filter||TS.search.sliFileSearchIsEnabled()&&"all"===TS.search.filter){TS.search.view.renderResults();TS.search.view.messageSearchResultsFetched(n,a);TS.search.view.searchMembers()}else TS.search.view.updateOptions()}else if(a.page==TS.search.view.waiting_on_messages_page)if("messages"===TS.search.filter)TS.search.view.renderResults();if("messages"==TS.search.filter)TS.metrics.measureAndClear("search_render_messages","start_dispatch_search_messages");else if("all"==TS.search.filter)TS.metrics.measureAndClear("search_render_all","start_dispatch_search_messages")};var l=function e(i,n){t=null;if(1==n.page){TS.search.view.current_files_page=1;TS.search.view.waiting_on_files_page=-1;if("files"===TS.search.filter){TS.search.view.renderResults();TS.search.view.messageSearchResultsFetched(i,n);TS.search.view.searchMembers()}else TS.search.view.updateOptions()}else if(n.page==TS.search.view.waiting_on_files_page)if("files"===TS.search.filter)TS.search.view.renderResults();if("files"==TS.search.filter)TS.metrics.measureAndClear("search_render_files","start_dispatch_search_files")};var d=function e(i){if("timestamp"===TS.search.sort){$("#search_sort_timestamp").addClass("active").attr("aria-checked",true);$("#search_sort_score").removeClass("flash active").attr("aria-checked",false);$("#search_sort_model").removeClass("active").attr("aria-checked",false)}else if("model"===TS.search.sort&&"model"===TS.experiment.getGroup("search_ranking")){$("#search_sort_timestamp").removeClass("active").attr("aria-checked",false);$("#search_sort_score").removeClass("flash active").attr("aria-checked",false);$("#search_sort_model").addClass("active").attr("aria-checked",false)}else{$("#search_sort_timestamp").removeClass("active").attr("aria-checked",false);$("#search_sort_score").addClass(i?"active flash":"active").attr("aria-checked",true);$("#search_sort_model").removeClass("active").attr("aria-checked",false)}};var c=function e(i){if(!i.messages)return;var t=[];i.messages.matches.forEach(function(e){e._dom_id=TS.templates.makeMsgDomIdInSearch(e.ts,e);t.push(e);["previous_2","previous","next","next_2"].forEach(function(i){if(e[i]){e[i].channel=e.channel;e[i]._main=e;e[i]._dom_id=TS.templates.makeMsgDomIdInSearch(e[i].ts,e);t.push(e[i])}})});if(_.has(i.messages,"modules.score.top_results"))_.forEach(i.messages.modules.score.top_results,function(e){e._dom_id=TS.templates.makeMsgDomIdInSearchTopResults(e.ts,e,"score_top_results");e._dom_container_id="search_module_results";t.push(e)});if(!TS.prefs.getPref("full_text_extracts")){var n={};t.forEach(function(e){if(TS.boot_data.page_needs_enterprise){var i=TS.utility.msgs.allUnknownUsersInMessage(e);if(i.length)i.forEach(function(i){if(!n[i])n[i]=e})}u(t,e,false)});if(_.keys(n).length)TS.members.ensureMembersArePresent(_.keys(n)).then(function(){_.keys(n).forEach(function(e){var i=n[e];u(t,i,true)})})}};var u=function e(i,t,n){if(_.isUndefined(n))n=false;var a;var r;if(!TS.search.view.msgHasExtracts(t))return;var s=t._dom_container_id?"#"+t._dom_container_id:"#search_message_results";if(t._main&&t._main.ts&&!t._dom_container_id)s+=' [data-ts="'+t._main.ts+'"]';s+=" #"+t._dom_id;a=$(s);if(0===a.length)return;r=TS.templates.search_message_extracts({message:t});if(n)a.find(".message_body.extract_content").replaceWith(r);else a.find(".message_body").before(r)};var m=function e(i,t){i.extracts_expanded=true;var n=t.closest(".search_message_result");var a=n.data("module-name");var r;if("score_top_results"===a)r=$("#search_results_items").find("#"+TS.templates.makeMSRDomIdWithModule(i,a));else r=$("#search_results_items").find("#"+TS.templates.makeMSRDomId(i));h(r,t)};var f=function e(i,t){i.extracts_expanded=false;var n=t.closest(".search_message_result");var a=n.data("module-name");var r;if("score_top_results"===a)r=$("#search_results_items").find("#"+TS.templates.makeMSRDomIdWithModule(i,a));else r=$("#search_results_items").find("#"+TS.templates.makeMSRDomId(i));var s=true;h(r,t,s)};var h=function e(i,t,n){TS.ui.utility.preventElementFromScrolling(t,function(){i.toggleClass("extracts_expanded",!n);i.find(".extract_expand_text").html(n?TS.i18n.t("Expand","template_builders")():TS.i18n.t("Collapse","template_builders")())})};var g=function e(i){var t=/from:<(@[^>]+)>/gi;var n=/bot:?(\S+)/gi;var a=[];var r;var s;do{r=t.exec(i);if(r&&r.length>1){var o=r[1].split("|");a.push(o[1])}}while(r);do{s=n.exec(i);if(s&&s.length>1)a.push(s[1])}while(s);return a};var p=function e(i){var t=[i.previous_2,i.previous,i,i.next,i.next_2];var n;for(var a=0;a<t.length;a+=1){n=t[a];if(!n)continue;if(n.extracts&&n.extracts.length)return n}return i};var S=function e(){var i=TS.boot_data.qa_messages_count||TS.model.team.messages_count;if(!TS.model.team.plan&&i>=10100){var t=$("#search_results_message_limit");t.removeClass("hidden");if("msg_lim_search_v3"==TS.experiment.getGroup("feat_msg_lim_search")){var n=i-1e4;n=n>1e5?TS.utility.number.formatNumberWithAbbreviation(n,{lowercase:true}):TS.i18n.number(n||"");t.html(TS.templates.search_results_message_limit({unsearchable_messages_count:n}))}$("#search_results_team").addClass("no_margin");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"search_pane",action:"impression",ui_element:"message_search_link_top"}}})}}})()},4943:function(e,i){(function(){TS.registerModule("search.autocomplete",{last_input_blur_logged:"",input_events:{},onStart:function e(){v();TS.search.search_dispatched_sig.add(TS.search.autocomplete.startSpinner,TS.search.autocomplete);TS.search.all_search_results_fetched_sig.add(u);TS.search.message_search_results_fetched_sig.add(L);TS.search.file_search_results_fetched_sig.add(G);if(TS.client){TS.search.search_channel_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete);TS.search.search_group_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete);TS.search.search_member_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete);TS.client.flexpane_display_switched_sig.add(j)}if(TS.web)TS.search.quick_search_results_fetched_sig.add(TS.search.autocomplete.stopSpinner,TS.search.autocomplete);TS.search.autosuggest_search_results_fetched_sig.add(c);TS.search.autocomplete.bindUI();d()},search:function t(n,a){TS.utility.contenteditable.value(e,n);TS.utility.contenteditable.focus(e);if(a)i.submit()},bindUI:function n(){i=$("#header_search_form");t=$("#search_container");e=$("#search_terms");TS.search.autocomplete.bindForm()},setUpMenu:_.once(function(){var i=w();e.autocomplete({append_to:"#header_search_form",data:i,registerInputEvents:function e(i){TS.search.autocomplete.input_events=i}})}),triggerInputEvent:function e(i,t){if(!i)return;if(!_.isFunction(TS.search.autocomplete.input_events[i])){TS.warn('TS.search.autocomplete: input event "'+i+'" not found');return}TS.search.autocomplete.input_events[i](t)},onInputFocus:function i(){if(!TS.utility.contenteditable.isEmpty(e,true)){if(TS.boot_data.feature_react_search)return;if("search"!==TS.model.ui_state.flex_name)K("preventMenuOnNextFocus");if(TS.search.searchSessionExpired())TS.search.view.maybeResetSearch();else{TS.search.view.showResults();TS.search.view.maybeRebuildResults()}}},bindForm:function t(){var n;if(TS.client)i.bind("submit",function(){n=!TS.utility.contenteditable.isEmpty(e,true);if(n)o(true);return false});e.find(".ql-editor").off("focus.setupNoDragSearch blur.setupNoDragSearch").on("focus.setupNoDragSearch blur.setupNoDragSearch",d);$(window).off("resize.setupNoDragSearch").on("resize.setupNoDragSearch",d);$("#search_clear").bind("click.clear_input",function(){TS.search.autocomplete.clearInput()}).bind("mousedown.clear_input",function(e){e.preventDefault()})},maybeLogSearchInputBlur:function e(){var i=TS.search.last_search_query;if(!i)return;if(TS.search.autocomplete.last_input_blur_logged==i)return;TS.search.autocomplete.last_input_blur_logged=i;TS.search.saveSearch({terms:i})},clearInput:function i(){l();TS.utility.contenteditable.clear(e);K("hide");K("preventMenuOnNextFocus");TS.utility.contenteditable.focus(e)},updateInput:function i(){if(TS.search.query)TS.utility.contenteditable.value(e,TS.search.query_string)},startSpinner:function e(){clearTimeout(a);a=setTimeout(function(){if(!$("#search_spinner").length){i.find(".icon_search").addClass("hidden");var e=$("#header_search_form .icon_search");var t=TS.templates.loading_indicator({id:"search_spinner"});e.after(t)}},200)},stopSpinner:function e(){clearTimeout(a);$("#search_spinner").remove();i.find(".icon_search").removeClass("hidden");if(n)n.stop()},calculateNoDragRegions:function e(){d()},unifiedAutocompleteIsEnabled:function e(){return TS.boot_data.feature_unified_autocomplete&&"unified"==TS.experiment.getGroup("unified_autocomplete")}});var e;var i;var t;var n;var a;var r;var s="";var o=function i(t){l();var n=TS.utility.contenteditable.value(e).trim();if(!t&&n===TS.search.query_string)return;if(s===n){TS.search.view.showResults();return}if(TS.boot_data.feature_react_search){TS.client.ui.search_in_react.open(n);return}if(""===n){if("files"===TS.search.filter)TS.search.view.switchBackToFiles()}else if(n.length>=2||t){s=n;TS.search.searchAll(n)}};var l=function e(){clearTimeout(TS.search.autocomplete.key_tim)};var d=_.debounce(function(){if(!t||!t[0]||!TS.model.is_mac||!TS.model.is_our_app)return;if(_.get(window,"desktop.app.updateDragRegion"))return;if(TS.ui.fs_modal.is_showing)return;TSSSB.nodrag.updateElement(t[0],"search")},250);var c=function e(i,t){var n=t.query;var a=i.suggestions;var s=r;if(!s)return;s(n,a)};var u=function e(){s=null;TS.search.autocomplete.stopSpinner()};var m=[TS.i18n.t("monday","search_menu")(),TS.i18n.t("tuesday","search_menu")(),TS.i18n.t("wednesday","search_menu")(),TS.i18n.t("thursday","search_menu")(),TS.i18n.t("friday","search_menu")(),TS.i18n.t("saturday","search_menu")(),TS.i18n.t("sunday","search_menu")(),TS.i18n.t("yesterday","search_menu")()];var f=[TS.i18n.t("january","search_menu")(),TS.i18n.t("february","search_menu")(),TS.i18n.t("march","search_menu")(),TS.i18n.t("april","search_menu")(),TS.i18n.t("may","search_menu")(),TS.i18n.t("june","search_menu")(),TS.i18n.t("july","search_menu")(),TS.i18n.t("august","search_menu")(),TS.i18n.t("september","search_menu")(),TS.i18n.t("october","search_menu")(),TS.i18n.t("november","search_menu")(),TS.i18n.t("december","search_menu")()];var h=[TS.i18n.t("today","search_menu")(),TS.i18n.t("week","search_menu")(),TS.i18n.t("month","search_menu")(),TS.i18n.t("year","search_menu")()];var g=m.concat(h,f);var p=function e(i){return Q(i)};var S=function e(i){return Q(i,true)};var T=[];var v=function e(){T=[{modifier:"after:",name:TS.i18n.t("after:","search")(),keywords:m.concat(f),dynamic_keywords:[p],keyword_placeholder:TS.i18n.t("a date","search")()},{modifier:"before:",name:TS.i18n.t("before:","search")(),keywords:g,dynamic_keywords:[S],keyword_placeholder:TS.i18n.t("a date","search")()},{modifier:"during:",name:TS.i18n.t("during:","search")(),keywords:g,dynamic_keywords:[p],keyword_placeholder:TS.i18n.t("a month or year","search")()},{modifier:"from:",name:TS.i18n.t("from:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("@member","search")()},{modifier:"to:",name:TS.i18n.t("to:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("a channel, group or direct message","search")()},{modifier:"has:",name:TS.i18n.t("has:","search")(),keywords:[TS.i18n.t("star","search")(),TS.i18n.t("pin","search")(),TS.i18n.t("link","search")(),TS.i18n.t("reaction","search")()],keyword_placeholder:TS.i18n.t("star, pin, link, or reaction","search")()},{modifier:"in:",name:TS.i18n.t("in:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("a channel, group or direct message","search")()},{modifier:"on:",name:TS.i18n.t("on:","search")(),keywords:g,dynamic_keywords:[p],keyword_placeholder:TS.i18n.t("a date","search")()}]};var b;var w=function e(){if(!b){b={modifiers:T,modifiers_by_name:{},users:function e(){return TS.members.getMembersForUser()},usersStarred:function e(){var i=[];var t;TS.model.ims.forEach(function(e){if(e.is_slackbot_im||!e.is_open)return;t=TS.members.getMemberById(e.user);if(!t||t.deleted||t.is_self)return;if(e.is_starred)i.push(e)});i.sort(y);return i.map(function(e){return TS.members.getMemberById(e.user)})},usersOpen:function e(){var i=[];var t;TS.model.ims.forEach(function(e){if(e.is_slackbot_im||!e.is_open)return;t=TS.members.getMemberById(e.user);if(!t||t.deleted||t.is_self)return;if(!e.is_starred)i.push(e)});i.sort(y);return i.map(function(e){return TS.members.getMemberById(e.user)})},channels:function e(){return TS.channels.getChannelsForUser()},channelsOpen:function e(){var i=TS.channels.getChannelsForUser();var t=[];var n;var a;for(n=0;n<i.length;n+=1){a=i[n];if(a.is_starred)continue;if(a.is_archived)continue;if(!a.is_member)continue;if(a.is_mpim)continue;t.push(a)}t.sort(A);return t},groups:function e(){return TS.model.groups},groupsOpen:function e(){var i=TS.model.groups;var t=[];var n;var a;for(a=0;a<i.length;a+=1){n=i[a];if(n.is_archived)continue;if(n.is_starred)continue;t.push(n)}t.sort(A);return t},conversationsStarred:function e(){var i=[];var t=b.usersStarred();var n=[];TS.channels.getChannelsForUser().forEach(function(e){if(!e.is_archived&&e.is_starred&&e.is_member&&!e.is_mpim)i.push(e)});TS.model.groups.forEach(function(e){if(!e.is_archived&&e.is_starred)n.push(e)});var a=i.concat(t,n);return a},history:function e(i,t){i=i||"";r=t;TS.search.searchSuggest(i)},deleteHistoryItem:function e(i){i=TS.format.texty.convertContentsStringForEncodedMembers(i);TS.api.call("search.delete",{terms:i,search_session_id:TS.search.getSearchSessionId(),client_request_id:TS.search.getQuerySessionId()})},triggerSearch:function e(){o(true)},triggerDelayedSearch:function e(i){TS.search.autocomplete.key_tim=setTimeout(function(){o()},i||3e3)},cancelSearch:function e(){l()},openProfile:function e(i){TS.client.ui.previewMember(i)},openBotProfile:function e(i,t){TS.apps.promiseToGetFullAppProfile(i,t).then(function(e){TS.client.ui.app_profile.openWithApp(e,i,t)})}};b.modifiers.forEach(function(e){e.keyword_testers=[];if(e.keywords.length>0){var i=new RegExp("^("+e.keywords.join("|")+")$","i");e.keyword_testers=[function(e){return i.test(e)}]}switch(e.modifier){case"from:":e.keyword_testers.push(k);e.keyword_testers.push(I);break;case"before:":e.keyword_testers.push(function(e){return Q(e,true)});break;case"after:":case"during:":case"on:":e.keyword_testers.push(Q);break;case"in:":case"to:":e.keyword_testers.push(k);e.keyword_testers.push(C);e.keyword_testers.push(M);e.keyword_testers.push(x);e.keyword_placeholder=TS.i18n.t("channel or direct message","search")()}b.modifiers_by_name[e.modifier]=e;b.modifiers_by_name[e.name]=e;b.modifiers_by_name[TS.interop.I18n.deburr(e.name)]=e})}return b};var y=function e(i,t){var n=TS.ims.getDisplayNameOfUserForImLowerCase(i);var a=TS.ims.getDisplayNameOfUserForImLowerCase(t);if(n>a)return 1;if(a>n)return-1;return 0};var A=function e(i,t){var n=i._name_lc;var a=t._name_lc;if(n<a)return-1;if(n>a)return 1;return 0};var k=function e(i){if("@"===i.charAt(0))i=i.substring(1);return TS.members.getMemberByName(i)};var C=function e(i){if("#"===i.charAt(0))i=i.substring(1);return TS.channels.getChannelByName(i)};var M=function e(i){return TS.groups.getGroupByName(i)};var I=function e(i){var t=P().name_map;i=_.toLower(i);return t[i]};var x=function e(i){if(-1===i.indexOf(","))return false;var t=i.split(",");return _.every(t,function(e){if("@"===e.charAt("0"))e=e.substring(1);return!!TS.members.getMemberByName(e)})};var E;var B=0;var P=function e(){if(Date.now()-B>3e4){var i={};var t=[];TS.model.bots.forEach(function(e){var n=_.toLower(e.name);if(!e.deleted&&!i[n]&&"slackbot"!==n){i[n]=true;t.push(e)}});E={bots:t,name_map:i}}return E};var D=/^(\d\d?)[-/](\d\d?)[-/](\d\d\d\d)$/;var U=/^(\d\d\d\d)[-/](\d\d?)[-/](\d\d?)$/;var F=/^(\d\d)[-/](\d\d?)[-/](\d\d?)$/;var O=/^\d\d\d\d$/;var R=/^(\d\d\d\d)[-/](\d\d?)$/;var N=1900;var H=2999;var Q=function e(i,t){var n;var a;var r;var s;var o=new Date;if(O.test(i)){n=parseInt(i,10);if(!t&&n>o.getFullYear())return false;if(n<N)return false;if(t&&n>H)return false;return true}s=D.exec(i);if(s){n=s[3];a=s[1];r=s[2]}s=!n&&U.exec(i);if(s){n=s[1];a=s[2];r=s[3]}s=!n&&F.exec(i);if(s){n=s[1];a=s[2];r=s[3]}s=!n&&R.exec(i);if(s){n=s[1];a=s[2];r="1"}if(!n)return false;n=parseInt(n,10);a=parseInt(a,10);r=parseInt(r,10);if(n<1||a<1||r<1)return false;if(n<100)n+=2e3;if(!t&&n>o.getFullYear())return false;if(n<N)return false;if(t&&n>H)return false;if(a>12)return false;if(!t&&n===o.getFullYear()&&a>o.getMonth()+1)return false;if(r>31)return false;if(!t&&n===o.getFullYear()&&a===o.getMonth()+1&&r>o.getDate())return false;if(r>30&&(4===a||6===a||9===a||11===a))return false;if(2===a&&r>29)return false;if(2===a&&29===r)if(n%4!==0)return false;else if(n%100!==0)return true;else if(n%400!==0)return false;return true};var L=function e(){if("messages"===TS.search.filter)TS.search.autocomplete.stopSpinner()};var G=function e(){if("files"===TS.search.filter)TS.search.autocomplete.stopSpinner()};var j=function e(){if(!TS.model.ui_state.flex_visible||"search"!==TS.model.ui_state.flex_name)l()};var K=function i(){TS.search.autocomplete.setUpMenu();e.autocomplete.apply(e,arguments)}})()},4944:function(e,i){(function(){TS.registerModule("ui.purpose_dialog",{div:null,showing:false,model_ob:null,onStart:function e(){},onKeydown:function e(i){if(i.which==TS.utility.keymap.enter){if(i.shiftKey)return;TS.ui.purpose_dialog.go();i.preventDefault()}else if(i.which==TS.utility.keymap.esc)TS.ui.purpose_dialog.cancel()},start:function e(i){if(TS.client.ui.checkForEditing())return;if(_.isString(i))i=TS.shared.getModelObById(i);TS.ui.purpose_dialog.model_ob=i;TS.ui.purpose_dialog.is_group=TS.ui.purpose_dialog.model_ob.is_group;if(!TS.ui.purpose_dialog.div)TS.ui.purpose_dialog.build();var t=TS.ui.purpose_dialog.div;var n=TS.templates.purpose_dialog({model_ob:TS.ui.purpose_dialog.model_ob,is_group:TS.ui.purpose_dialog.is_group});t.empty();t.html(n);var a=t.find("#purpose_input");TS.utility.contenteditable.create(a,{modules:{tabcomplete:{positionMenu:function e(i){i.style.width=a.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(i,a)},searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"]}},onEnter:function e(i){if(i.shiftKey)return true;TS.ui.purpose_dialog.go();return false},onEscape:function e(){TS.ui.purpose_dialog.cancel()},onTextChange:function e(){TS.client.channel_page.updatePurposeTooLongWarning(a)}});TS.utility.contenteditable.enable(a);TS.utility.contenteditable.value(a,TS.utility.unformatTopicOrPurpose(TS.ui.purpose_dialog.model_ob.purpose.value));t.find(".dialog_cancel").click(TS.ui.purpose_dialog.cancel);t.find(".dialog_go").click(TS.ui.purpose_dialog.go);t.modal("show")},go:function e(){if(!TS.ui.purpose_dialog.showing){TS.error("not showing?");return}var i=TS.ui.purpose_dialog.div;var t=i.find("#purpose_input");if(TS.client.channel_page.isPurposeTooLong(t))return;var n=_.trim(TS.utility.contenteditable.value(t));n=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(n,{complete_member_specials:false});if(TS.ui.purpose_dialog.is_group)TS.groups.setPurpose(TS.ui.purpose_dialog.model_ob.id,n);else TS.channels.setPurpose(TS.ui.purpose_dialog.model_ob.id,n);i.modal("hide")},cancel:function e(){TS.ui.purpose_dialog.div.modal("hide")},end:function e(){TS.model.dialog_is_showing=false;TS.ui.purpose_dialog.showing=false},build:function e(){$("body").append('<div id="purpose_dialog" class="modal hide fade"></div>');TS.ui.purpose_dialog.div=$("#purpose_dialog");var i=TS.ui.purpose_dialog.div;i.on("hide",function(e){if(e.target!=this)return;TS.ui.purpose_dialog.end();i.removeAttr("data-qa")});i.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.purpose_dialog.showing=true});i.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){TS.utility.contenteditable.focus(i.find("#purpose_input"));i.attr("data-qa","purpose_dialog_ready")},100)})}})})()},4945:function(e,i){(function(){TS.registerModule("ui.growls",{no_notifications:false,permission_changed_sig:new signals.Signal,onStart:function e(){TS.ui.growls.updateTotalUnreadDisplaysSSBThrottled=TS.utility.throttleFunc(TS.ui.growls.updateTotalUnreadDisplaysSSB,500,true);TS.channels.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.channels.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.groups.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.groups.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.ims.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.ims.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.mpims.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.mpims.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.redux.socket.connectedSig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.prefs.mac_ssb_bullet_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.client.threads.threads_unread_changed.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.ui.window_focus_changed_sig.add(TS.ui.growls.windowFocusChanged,TS.ui.growls);if(window.Notification||window.webkitNotifications);else if(window.winssb);else{TS.ui.growls.no_notifications=true;return}TS.channels.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls);TS.groups.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls);TS.mpims.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls);TS.ims.message_received_sig.add(TS.ui.growls.imMessageReceived,TS.ui.growls);if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.models.environment.setNotificationPermission(TS.ui.growls.getPermissionLevel()))},shouldShowPermissionButton:function e(){if(TS.ui.growls.no_notifications)return false;if(TS.ui.growls.checkPermission())return false;if("denied"===TS.ui.growls.getPermissionLevel())return false;return true},checkPermission:function e(){if(TS.ui.growls.no_notifications)return false;if(window.winssb)return true;return"granted"===TS.ui.growls.getPermissionLevel()},perm_map:{0:"granted",1:"default",2:"denied"},getPermissionLevel:function e(){if(TS.ui.growls.no_notifications)return"na";if(window.winssb)return"na";if(window.webkitNotifications&&window.webkitNotifications.checkPermission)return TS.ui.growls.perm_map[window.webkitNotifications.checkPermission()];else if(window.Notification)return window.Notification.permission},promptForPermission:function e(i){if(TS.ui.growls.no_notifications){if(i)i(false,-9999999);return}var t=function e(){if(i)i(TS.ui.growls.checkPermission(),TS.ui.growls.getPermissionLevel());TS.ui.growls.permission_changed_sig.dispatch(TS.ui.growls.checkPermission(),TS.ui.growls.getPermissionLevel());if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.models.environment.setNotificationPermission(TS.ui.growls.getPermissionLevel()))};if(window.webkitNotifications&&window.webkitNotifications.requestPermission&&window.webkitNotifications.checkPermission)window.webkitNotifications.requestPermission(t);else if(window.Notification)window.Notification.requestPermission(t)},show:function e(i,t,n,r){r=r||{};var s=r.msg;var o=r.channelId;var l=r.subtitle;var d=r.launchUri;var c=TS.sounds.filenameForSoundName(r.sound_name||"new_message");var _=r.imageUri;var u=r.avatarImage;if(TS.utility.calls.isScreenSharing()&&!r.is_call_notification)return;if(!TS.ui.growls.checkPermission())return;var m;if(window.winssb){m={title:i,subtitle:l,content:t,launchUri:d,imageUri:_,channel:o||"",msg:s&&s.ts||"",avatarImage:u,ssbFilename:c};if(!c&&TS.environment.isSSBAndAtLeastVersion("3.0.0"))m.silent=true;if(s&&s.thread_ts)m.thread_ts=s.thread_ts;TSSSB.call("notify",m);a(o,s)}else{var f;if(window.webkitNotifications)f=window.webkitNotifications.createNotification(TS.boot_data.img.app_icon,i,t);else if(window.Notification)f=new Notification(i,{body:t,icon:TS.boot_data.img.app_icon,tag:"tag_"+(s?s.id||s.ts||Date.now():Date.now())});if(!f)return;try{f.onclick=function(){window.focus();if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();if(n)n();if(this.cancel)this.cancel();else if(this.close)this.close()}}catch(e){}var h=function e(){setTimeout(function(){if(f.cancel)f.cancel();else if(f.close)f.close()},t&&t.length>80?1e4:5e3)};if(f)try{f.onshow=h;setTimeout(h,1e3)}catch(e){h()}if(f.show)f.show()}},updateTotalUnreadDisplays:function e(i,t){if(window.winssb)if(t&&true===t)TS.ui.growls.updateTotalUnreadDisplaysSSBThrottled();else TS.ui.growls.updateTotalUnreadDisplaysSSB();if(TS.model.all_unread_highlights_cnt)TS.view.changeUnreadStatus("mentions");else if(TS.model.all_unread_cnt)TS.view.changeUnreadStatus("unreads");else TS.view.changeUnreadStatus("")},updateTotalUnreadDisplaysSSBThrottled:_.noop,updateTotalUnreadDisplaysSSB:function e(){var i=TS.model.all_unread_highlights_cnt;var t=TS.model.all_unread_cnt;if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){if(TS.has_pri[f])TS.log(f,"updateTotalunreadDisplaysSSB: TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);i=Math.max(0,i-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){if(TS.has_pri[f])TS.log(f,"updateTotalunreadDisplaysSSB: TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);t=Math.max(0,t-TS.model.all_unread_cnt_to_exclude)}}if(TS.has_pri[f])TS.log(f,"TSSSB.call('setBadgeCount') - all_unread_highlights_cnt = "+i+", all_unread_cnt = "+t+", bullet = "+((window.winssb?!!TS.prefs.getPref("mac_ssb_bullet"):false)?"true":"false"));TSSSB.call("setBadgeCount",{all_unread_highlights_cnt:i,all_unread_cnt:t,bullet:window.winssb?!!TS.prefs.getPref("mac_ssb_bullet"):false})},getGrowlableTxtFromFile:function e(i){if(!i||!i.file)return;var t=true;return TS.templates.builders.msgs.buildFileShareMetaText(i,t)},getGrowlableTxtFromAttachments:function e(i){for(var t=0;t<i.length;t+=1){var n=i[t];if(n.fallback)return n.fallback;else if(n.text)return n.text;else if(n.pretext)return n.pretext;else if(n.footer)return n.footer}return null},no_growl_subtypes:["channel_leave","channel_join","group_leave","group_join"],channelOrGroupMessageReceived:function e(t,n){if(!n){TS.error("no msg?");return}h(n.ts);if(n.no_display)return;if(!t){TS.error("no channel/group?");return}if(TS.boot_data.feature_threads_api_stop_fe){TS.ui.growls.growlChannelOrGroupMessage(t,n,true);return}i(t,n).then(function(){TS.ui.growls.growlChannelOrGroupMessage(t,n,true)})},growlChannelOrGroupMessage:function e(i,t,n,a){if(!t){TS.error("no msg?");return}if(t.no_display)return;if(!i){TS.error("no channel/group?");return}var r=TS.notifs.canCorGHaveChannelMentions(i.id);var s;var o;var l=true;var c=false;if(TS.utility.msgs.isMsgReply(t)){if(TS.boot_data.feature_threads_api_stop_fe)return;var _=TS.replies.getSubscriptionState(i.id,t.thread_ts);l=_&&_.subscribed;c=!l}if(r){var u="away"===TS.model.user.presence;if(TS.utility.msgs.isMsgReply(t))u=u||!l;s=TS.utility.msgs.msgContainsMention(t,u,c);if(s)TS.mentions.maybeUpdateMentions()}else{o=TS.utility.msgs.getMsgMentionData(t,c);s=o.non_channel_mentions;if(o.mentions)TS.mentions.maybeUpdateMentions()}if(!a&&t.subtype&&-1!=TS.ui.growls.no_growl_subtypes.indexOf(t.subtype))return;var m=TS.notifs.isCorGMuted(i.id);var h=TS.utility.msgs.msgCanCountAsUnread(t);var g=t._hidden_reply;var p=(h||g)&&s;var S=TS.ui.growls.containsCmd(t.text);var T=TS.notifs.getCalculatedCorGNotifySetting(i.id);if(!a&&"bot_message"===t.subtype&&"everything"!==T&&!s)return;if(n&&h&&!TS.model.ui.is_window_focused)if(p&&-1==document.title.indexOf("!"))document.title="! "+document.title;else if(!m&&-1==document.title.indexOf("*"))document.title="* "+document.title;if(!a&&"nothing"===T)return;if(TS.utility.msgs.isMsgReply(t)&&!a&&"everything"===T&&!l)T="mentions";if(!TS.ui.growls.checkPermission())return;var v=(i.id==TS.model.active_channel_id||i.id==TS.model.active_group_id||i.id==TS.model.active_mpim_id)&&!g&&!TS.client.activeChannelIsHidden();var b=t.thread_ts&&i.id===TS.ui.replies.activeConvoModelId()&&t.thread_ts===TS.ui.replies.activeConvoThreadTs();var w=false;if(p)w=true;if(g&&l&&TS.notifs.getThreadsEverythingNotificationPref()&&"nothing"!==T)w=true;if("everything"===T)w=true;if(w&&(v||b)&&TS.model.ui.is_window_focused&&!S)w=false;if(w&&!r&&o&&o.mentions&&!o.non_channel_mentions)w=false;if(w&&(t.user==TS.model.user.id||t.comment&&t.comment.user==TS.model.user.id))w=false;if(w&&t.no_notifications)w=false;if(w&&m)if(TS.utility.msgs.isMsgReply(t)){if(!l)w=false}else w=false;if(w&&TS.dnd.isMemberInDnd(TS.model.user)&&!t._ignore_dnd)w=false;if(TS.shared.isModelObOrgShared(i)){var y=TS.shared.isRelevantTeamForSharedModelOb(i);if(!y){if(TS.has_pri[f]&&TS.model.is_our_app)TS.log(f,"Shared channel "+i.id+" is not relevant; suppressing notification.");w=false}else if(TS.pri)if(TS.model.is_our_app&&TS.has_pri[f])TS.log(f,"Shared channel "+i.id+" is relevant; allowing notification.")}if(TS.boot_data.feature_stop_loud_channel_mentions&&(w||a)){var A=TS.permissions.members.canMsgMentionChannelIfMention(t.text,i.id,t.user);if(!A){TS.log(67,"preventing over-size channel mention by "+t.user+" with ts = "+t.ts+" in "+i.id);return}}if(!w&&!a)return;var k=TS.ui.growls.extractFromNameFromCorGMessage(t);var C=TS.ui.growls.extractTxtFromMsg(t,true);C=C.replace(":simple_smile:",":)");var M="";if(k)M=TS.notifs.getNoTextInNotificationsPref()?TS.i18n.t("a message from {name}","growl")({name:k}):k+": ";M+=C;if(TS.boot_data.feature_threads_api_stop_fe){d(M,t,i);return}var I=function e(){if(t.thread_ts&&t.ts!=t.thread_ts){TS.ui.replies.openConversation(i,t.thread_ts,t.ts);return}if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();if(i.is_channel)TS.channels.displayChannel({id:i.id});else if(i.is_mpim)TS.mpims.displayMpim({id:i.id});else TS.groups.displayGroup({id:i.id})};TS.ui.growls.maybeBounceDockIcon();var x;var E;var B="#"+i.name;if(i.is_mpim)B=TS.mpims.getDisplayName(i);if(TS.getOtherAccountsCount()>0&&window.winssb)if(TS.model.supports_growl_subtitle){x=TS.model.team.name;E=B}else x=TS.i18n.t("[{team_domain}] in {channel}","growl")({team_domain:TS.model.team.domain,channel:B});else x=TS.i18n.t("New message in {channel}","growl")({channel:B});var P=TS.ui.growls.getProfileImageFromUserId(t.user);TS.utility.calls.getCallActive().then(function(e){var n="new_message";if(e)n="none";else if(!TSSSB.call("shouldAttachSoundToNotification")){TS.sounds.play("new_message");n="none"}TS.ui.growls.show(x,TS.format.formatNotification(M,t),I,{msg:t,channelId:i.id,subtitle:E,sound_name:n,launchUri:TS.ui.growls.getLaunchUriForChannel(i.id,t),imageUri:TS.ui.growls.getAttachmentUri(t),avatarImage:P})})},handleDesktopNotificationMessage:function i(t){if(!TS.boot_data.feature_threads_api_stop_fe)return;if(!t.msg||!t.channel)return;var n={ts:t.msg,thread_ts:t.thread_ts};var a=n.thread_ts&&n.thread_ts!=n.ts;if(!a)return;var r=TS.shared.getModelObById(t.channel);if(!r)return;if(TS.shared.isModelObOrgShared(r)){var s=TS.shared.isRelevantTeamForSharedModelOb(r);if(!s)return false}if(m(n.ts,r.id))return;u(n.ts,r.id);var o=r.id===TS.ui.replies.activeConvoModelId()&&n.thread_ts===TS.ui.replies.activeConvoThreadTs()&&TS.client.ui.isUserAttentionOnChat();if(o)return;if(!e||n.ts>e){TS.console.warn("Suppressing desktop_notification because "+n.ts+" is > than _max_ts ("+e+")");return}var l=TS.replies.getSubscriptionState(r.id,n.thread_ts);if(l&&l.last_read&&l.last_read>=n.ts){TS.console.warn("Suppressing desktop_notification because "+n.ts+" is <= to last_read ("+l.last_read+")");return}var c=t.content||"";d(c,n,r,{launch_uri:t.launchUri,image_uri:t.imageUri,avatar_image:t.avatarImage,skip_formatting:true})},getLaunchUriForChannel:function e(i,t){if(!i||!t||!t.ts)return null;var n=t.thread_ts?"&thread_ts="+t.thread_ts:"";return"slack://channel?id="+i+"&message="+t.ts+"&team="+TS.model.team.id+n},getAttachmentUri:function e(i){var t=i.attachments&&i.attachments.length>0&&i.attachments[0].image_url;return t&&TS.prefs.getPref("expand_inline_imgs")?i.attachments[0].image_url:null},imMessageReceived:function e(t,n){if(!n){TS.error("no msg?");return}h(n.ts);if(n.no_display)return;if(TS.boot_data.feature_threads_api_stop_fe){TS.ui.growls.growlImMessage(t,n,true);return}i(t,n).then(function(){TS.ui.growls.growlImMessage(t,n,true)})},growlImMessage:function e(i,t,n,a){if(!t){TS.error("no msg?");return}if(t.no_display)return;if(n&&!TS.model.ui.is_window_focused&&-1==document.title.indexOf("!"))document.title="! "+document.title;var r=TS.boot_data.feature_mpdm_default_fe?"nothing"!==TS.notifs.getGlobalNotificationSetting():TS.prefs.getPref("growls_enabled");if(!a&&!r)return;if(!TS.ui.growls.checkPermission())return;var s=false;var o=i.id===TS.model.active_im_id&&!TS.client.activeChannelIsHidden();var l=TS.utility.msgs.isMsgReply(t);var c=l&&i.id===TS.ui.replies.activeConvoModelId()&&t.thread_ts===TS.ui.replies.activeConvoThreadTs();var _=true;if(l){if(TS.boot_data.feature_threads_api_stop_fe)return;var u=TS.replies.getSubscriptionState(i.id,t.thread_ts);_=u&&u.subscribed}if(!TS.model.ui.is_window_focused)s=true;if(!s&&!o&&!c)s=true;if(!s&&o&&l&&!c)s=true;if(s&&l&&!_)s=false;if(t.user==TS.model.user.id||t.comment&&t.comment.user==TS.model.user.id)s=false;var m=TS.templates.builders.getBotName(t);if(t.no_notifications)s=false;if(s&&TS.dnd.isMemberInDnd(TS.model.user)&&!t._ignore_dnd)s=false;if(TS.shared.isModelObOrgShared(i)){var h=TS.shared.isRelevantTeamForSharedModelOb(i);if(!h){if(TS.has_pri[f])TS.log(f,"Shared channel "+i.id+" is not relevant; suppressing notification.");s=false}else if(TS.pri)if(TS.has_pri[f])TS.log(f,"Shared channel "+i.id+" is relevant; allowing notification.")}if(!s&&!a)return;var g=m||TS.ims.getDisplayNameOfUserForIm(i);var p=TS.ui.growls.extractTxtFromMsg(t,true);p=p.replace(":simple_smile:",":)");var S="";S+=p;if(TS.boot_data.feature_threads_api_stop_fe){d(S,t,i);return}var T=function e(){if(t.thread_ts&&t.ts!=t.thread_ts){TS.ui.replies.openConversation(i,t.thread_ts);return}if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();TS.ims.startImByMemberId(i.user)};TS.ui.growls.maybeBounceDockIcon();var v;var b;if(TS.getOtherAccountsCount()>0&&window.winssb)if(TS.model.supports_growl_subtitle){v=TS.model.team.name;b=g;if(t._ignore_dnd)b=TS.i18n.t("{name} is trying to reach you","growl")({name:g})}else if(t._ignore_dnd)v=TS.i18n.t("{name} is trying to reach you","growl")({name:g});else v=TS.i18n.t("[{team_domain}] from {name}","growl")({team_domain:TS.model.team.domain,name:g});else if(t._ignore_dnd)v=TS.i18n.t("{name} is trying to reach you","growl")({name:g});else v=TS.i18n.t("New message from {name}","growl")({name:g});var w=TS.ui.growls.getProfileImageFromUserId(i.user);TS.utility.calls.getCallActive().then(function(e){var n="new_message";if(e)n="none";else if(!TSSSB.call("shouldAttachSoundToNotification")){TS.sounds.play("new_message");n="none"}TS.ui.growls.show(v,TS.format.formatNotification(S,t),T,{msg:t,channelId:i.id,subtitle:b,sound_name:n,launchUri:TS.ui.growls.getLaunchUriForChannel(i.id,t),imageUri:TS.ui.growls.getAttachmentUri(t),avatarImage:w})})},extractFromNameFromCorGMessage:function e(i){var t=TS.members.getMemberById(i.user);return(t?TS.members.getPrefCompliantMemberName(t):i.user)||TS.templates.builders.getBotName(i)||""},getProfileImageFromUserId:function e(i){if(!i)return null;var t=TS.members.getMemberById(i);if(!t||!t.profile)return null;var n=t.profile.image_512||t.profile.image_192;if(n&&n.match(/^\//))n="https://"+window.location.hostname+n;return n},extractTxtFromMsg:function e(i,t){if(t&&TS.prefs.getPref("no_text_in_notifications"))return"";var n=i.type+" "+i.subtype+" "+TS.i18n.t("(message missing text)","growl")();if(i.file&&("file_share"===i.subtype||"file_mention"===i.subtype||"file_reaction"===i.subtype))n=TS.ui.growls.getGrowlableTxtFromFile(i);else if(i.text)n=i.text;else if(i.attachments&&i.attachments.length)n=TS.ui.growls.getGrowlableTxtFromAttachments(i.attachments)||n;return n},containsCmd:function e(i){var t=i&&TS.model.everyone_regex.test(i);var n=i&&TS.model.channel_regex.test(i);var a=i&&TS.model.group_regex.test(i);return t||n||a},windowFocusChanged:function e(i){if(i)if(("!"===document.title.charAt(0)||"*"===document.title.charAt(0))&&TS.model.active_cid)document.title=document.title.slice(2);if(!i&&TS.model.all_unread_highlights_cnt&&TS.prefs.prefs_loaded&&"long"===TS.prefs.getPref("mac_ssb_bounce"))setTimeout(TS.ui.growls.maybeBounceDockIcon,100)},maybeBounceDockIcon:function e(){var i;if(window.winssb&&TS.model.is_mac)i=window.winssb;if(!i)return;if(!i.dock)return;if(!TS.prefs.getPref("mac_ssb_bounce"))return;if("long"===TS.prefs.getPref("mac_ssb_bounce")){if(i.dock.bounceIndefinitely)i.dock.bounceIndefinitely()}else if(i.dock.bounceOnce)i.dock.bounceOnce()},maybeGetThreadTsForLastNotification:function e(i){if(!n()||!t)return null;var a=t.c_id;if(a===i)return t.thread_ts;return null},showTestNotification:function e(i,t,n,a){a=a||{};if(TSSSB.call("shouldAttachSoundToNotification")){var r=TS.sounds.soundForName("new_message");if(r){a.ssbFilename=r.ssbFilename;a.soundUrl=r.url}}else TS.sounds.play("new_message");if(TS.prefs.getPref("no_text_in_notifications"))t=null;TS.ui.growls.show(i,t,n,a)},growlMessageDebug:function e(i,t){var n=TS.shared.getModelObById(t);if(!n)return;var a=false;var r=true;if(n.is_im)TS.ui.growls.growlImMessage(n,i,a,r);else TS.ui.growls.growlChannelOrGroupMessage(n,i,a,r)}});var e="0";var i=function e(i,t){if(!TS.utility.msgs.isMsgReply(t))return Promise.resolve();var n=TS.replies.getSubscriptionState(i.id,t.thread_ts);if(n)return Promise.resolve();return TS.replies.promiseToGetSubscriptionState(i.id,t.thread_ts).then(function(){n=TS.replies.getSubscriptionState(i.id,t.thread_ts);if(!n)throw new Error("promiseToGetSubscriptionState resolved but subscription is missing for "+t.thread_ts)})};var t=null;var n=function e(){if(!TS.model.is_our_app||!TS.model.is_electron)return false;var i=TS.model.mac_ssb_version||TS.model.win_ssb_version;if(!i||i>=2.4)return false;return true};var a=function e(i,a){if(!n())return;if(!i||!a||!TS.utility.msgs.isMsgReply(a)){t=null;return}t={c_id:i,ts:a.ts,thread_ts:a.thread_ts}};var r=function e(i,t){if(i.thread_ts&&i.ts!=i.thread_ts){TS.ui.replies.openConversation(t,i.thread_ts,i.ts);return}if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();if(t.is_channel)TS.channels.displayChannel({id:t.id});else if(t.is_mpim)TS.mpims.displayMpim({id:t.id});else if(t.is_im)TS.ims.startImById(t.id);else TS.groups.displayGroup({id:t.id})};var s=function e(i,t){if(!i)return"";var n=l(i);if(TS.getOtherAccountsCount()>0&&window.winssb){if(TS.model.supports_growl_subtitle)return TS.model.team.name;if(i.is_im)return t?TS.i18n.t("{name} is trying to reach you","growl")({name:n}):TS.i18n.t("[{team_domain}] from {name}","growl")({team_domain:TS.model.team.domain,name:n});return TS.i18n.t("[{team_domain}] in {channel}","growl")({team_domain:TS.model.team.domain,channel:n})}if(i.is_im)return t?TS.i18n.t("{name} is trying to reach you","growl")({name:n}):TS.i18n.t("New message from {name}","growl")({name:n});return TS.i18n.t("New message in {channel}","growl")({channel:n})};var o=function e(i){if(!i)return"";if(!TS.model.supports_growl_subtitle||0==TS.getOtherAccountsCount()||!window.winssb)return"";return l(i)};var l=function e(i){if(!i)return"";if(i.is_im)return TS.ims.getDisplayNameOfUserForIm(i);else if(i.is_mpim)return TS.mpims.getDisplayName(i);return"#"+i.name};var d=function e(i,t,n,a){if(!TS.ui.growls.checkPermission())return;if(!t||!n)return;a=a||{};TS.ui.growls.maybeBounceDockIcon();var l=s(n,t._ignore_dnd);var d=o(n);TS.utility.calls.getCallActive().then(function(e){var s="new_message";if(e)s="none";else if(!TSSSB.call("shouldAttachSoundToNotification")){TS.sounds.play("new_message");s="none"}var o=a.skip_formatting?i:TS.format.formatNotification(i,t);TS.ui.growls.show(l,o,function(){r(t,n)},{msg:t,channelId:n.id,subtitle:d,sound_name:s,launchUri:a.launch_uri||TS.ui.growls.getLaunchUriForChannel(n.id,t),imageUri:a.image_uri||TS.ui.growls.getAttachmentUri(t),avatarImage:a.avatar_image||TS.ui.growls.getProfileImageFromUserId(t.user)})})};var c={};var u=function e(i,t){c[i+"_"+t]=true};var m=function e(i,t){if(c[i+"_"+t]){var n=true;TS.logError(new Error("Received a duplicate desktop_notification event for "+i),"replies_notification_error","threads",n);return true}return false};var f=67;var h=function i(t){if(!t)return;if(TS.utility.msgs.isTempTs(t))return;if(!e||t>e)e=t}})()},4946:function(e,i){(function(){TS.registerModule("chat_history",{onStart:function e(){TS.model.input_history=TS.storage.fetchInputHistory()},add:function e(i){if(TS.prefs.prefs_loaded&&!TS.prefs.getPref("arrow_history")&&(!i||0!==i.indexOf("/")))return;var t=TS.model.input_history;var n=t.indexOf(i);if(-1!=n)t.splice(n,1);if(t.length&&""===t[0])t.splice(0,1);t.unshift(i);TS.storage.storeInputHistory(t);if(TS.boot_data.feature_tinyspeck){TS.log(23,"(TS-ONLY log)",i);TS.dir(23,"(TS-ONLY log)",t)}},resetPosition:function e(){TS.model.input_history_index=-1},onArrowKey:function e(i,t){if(TS.prefs.prefs_loaded&&!TS.prefs.getPref("arrow_history"))return;if(!TS.model.input_history.length)return;var n=TS.utility.contenteditable.value(t);if(TS.model.input_history_index<0){TS.chat_history.add(n);TS.model.input_history_index+=1}if(i.which==TS.utility.keymap.up){TS.model.input_history_index+=1;if(TS.model.input_history_index>=TS.model.input_history.length){TS.model.input_history_index=TS.model.input_history.length-1;return}}else if(i.which==TS.utility.keymap.down){TS.model.input_history_index-=1;if(TS.model.input_history_index<0){TS.model.input_history_index=-1;return}}else return;var a=TS.model.input_history[TS.model.input_history_index];i.preventDefault();TS.utility.contenteditable.deserialize(TS.client.ui.$msg_input,a);if(i.which==TS.utility.keymap.up)TS.utility.contenteditable.cursorPosition(t,0)},getCommands:function e(){if(!_.isArray(TS.model.input_history))return;return TS.model.input_history.filter(function(e){return e&&0===e.indexOf("/")})}})})()},4947:function(e,i){(function(){TS.registerModule("ui.channel_prefs_dialog",{showing:false,onStart:function e(){TS.prefs.team_perms_pref_changed_sig.add(n);TS.prefs.muted_channels_changed_sig.add(o);if(TS.boot_data.feature_mpdm_default_fe)TS.prefs.all_notifications_prefs_changed_sig.add(f);else{TS.prefs.push_changed_sig.add(l);TS.prefs.dtop_notif_changed_sig.add(r)}},start:function i(t){if(TS.boot_data.feature_channel_notif_dialog_update){var n=$("<div>").appendTo("body");var a=function e(){n.remove()};TS.interop.mountChannelNotificationSettingsDialog(TS.boot_data.team_id,n[0],{channelId:t},a);return}if(!e)m();if(TS.ui.channel_prefs_dialog.showing)return;TS.ui.channel_prefs_dialog.renderOptions(e,t);e.modal("show");e.find(".dialog_cancel").click(c);e.find(".dialog_go").click(d)},renderOptions:function e(t,n,s){var d=TS.shared.getModelObById(n);if(!d||d.is_im){alert(n+" ???");return}var c="";var u="";var m=false;if(d.is_mpim){m=true;u=TS.mpims.getDisplayName(d)}else if(d.is_channel){c="channel";u=_.escape("#"+d.name);u+=TS.templates.builders.maybeMakeSharedIcon(d);u=new Handlebars.SafeString(u)}else if(d.is_group){c="group";u=d.name}i=n;var f=TS.templates.channel_prefs_dialog({c_or_g:c,is_mpim:m,display_name:u,show_one_suppressed_cb:true,show_two_suppressed_cbs:false,is_muted:TS.notifs.isCorGMuted(n),model_ob:d,embedded:s,feature_mpdm_default_fe:TS.boot_data.feature_mpdm_default_fe});t.html(f);l();r();a();o();$("#notifications_not_working").addClass("hidden");$("#notifications_impossible").addClass("hidden");$("#notifications_not_yet_allowed").addClass("hidden");$("#notifications_not_enabled").addClass("hidden");$("#notifications_not_allowed").addClass("hidden");$("#notifications_working").removeClass("hidden");if(TS.ui.growls.shouldShowPermissionButton()){$("#notifications_working").addClass("hidden");$("#notifications_not_working").removeClass("hidden");$("#notifications_not_yet_allowed").removeClass("hidden")}else if(!TS.ui.growls.checkPermission()){$("#notifications_working").addClass("hidden");$("#notifications_not_working").removeClass("hidden");if(TS.ui.growls.no_notifications)$("#notifications_impossible").removeClass("hidden");else if("denied"===TS.ui.growls.getPermissionLevel())$("#notifications_not_allowed").removeClass("hidden")}},showMainPrefs:function e(i){c();setTimeout(function(){TS.ui.prefs_dialog.start(i)},500)}});var e=null;var i=null;var t=function e(i){if(!TS.ui.channel_prefs_dialog.showing)return;if(i.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){d();i.preventDefault()}}else if(i.which==TS.utility.keymap.esc)c()};var n=function e(i){if("who_can_at_channel"!==i&&"who_can_at_everyone"!==i&&"who_can_post_general"!==i)return;r();l();a()};var a=function e(){if(!i)return;var t=$("#single_suppressed_cb");var n=$("#single_suppressed_label");var a=$("#single_suppressed_disabled_explain");var r=$("#single_suppressed_div");var o=$("#single_suppressed_disabled_explain_tip_link");var l=TS.notifs.hasUserSuppressedCorGChannelMentionsById(i)||TS.notifs.hasUserSuppressedCorGPushChannelMentions(i);var d=TS.notifs.getCalculatedCorGPushNotifySetting(i);var c=TS.notifs.getCalculatedCorGNotifySetting(i);var _="mentions"===d||"mentions"===c;s(l,"both",_,t,n,a,r,o);if(!_)return;if("mentions"===d&&"everything"===c){$("#single_suppressed_mobile_qualifier").removeClass("hidden");$("#single_suppressed_desktop_qualifier").addClass("hidden")}else if("mentions"===c&&"everything"===d){$("#single_suppressed_desktop_qualifier").removeClass("hidden");$("#single_suppressed_mobile_qualifier").addClass("hidden")}else{$("#single_suppressed_desktop_qualifier").addClass("hidden");$("#single_suppressed_mobile_qualifier").addClass("hidden")}if("mentions"===d)$("#single_suppressed_mobile_disclaimer").removeClass("hidden");else $("#single_suppressed_mobile_disclaimer").addClass("hidden")};var r=function e(){if(!i)return;var t=TS.notifs.getCalculatedCorGNotifySetting(i);$("#all_everything_default").addClass("hidden");$("#all_mentions_default").addClass("hidden");$("#all_nothing_default").addClass("hidden");if(TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud"))$("#all_everything_default").removeClass("hidden");else if(TS.prefs.getPref("growls_enabled"))$("#all_mentions_default").removeClass("hidden");else $("#all_nothing_default").removeClass("hidden");$('input:radio[name="channel_loud_rd"]').filter('[value="'+t+'"]').prop("checked",true);$('input:radio[name="channel_loud_rd"]').unbind("change").bind("change",function(){var t=$(this).val();if("everything"===t)TS.notifs.makeCorGDTopEverything(i);else if("mentions"===t)TS.notifs.makeCorGDTopMentions(i);else TS.notifs.makeCorGDTopNothing(i);if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-notification-table-header]"});if(TS.boot_data.feature_mpdm_default_fe){if("mentions"===t)t="mentions_dms";TS.redux.prefs.setChannelNotificationOverrideAndCallApi("desktop",t,i)}else TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")});e();a()});var n=$("#suppressed_cb");var r=$("#suppressed_label");var o=$("#suppressed_disabled_explain");var l=$("#suppressed_span");var d=$("#suppressed_disabled_explain_tip_link");var c="mentions"===t;s(TS.notifs.hasUserSuppressedCorGChannelMentionsById(i),"at_channel_suppressed_channels",c,n,r,o,l,d);a()};var s=function e(t,n,a,r,s,o,l,d){if(!i)return;if(a)l.removeClass("hidden");else l.addClass("hidden");var c=TS.channels.getChannelById(i)||TS.groups.getGroupById(i)||TS.mpims.getMpimById(i);var _=false;if("admin"===TS.prefs.getTeamPref("who_can_at_channel")||"owner"===TS.prefs.getTeamPref("who_can_at_channel"))_=true;else if(c.is_general&&("admin"===TS.prefs.getTeamPref("who_can_at_everyone")||"owner"===TS.prefs.getTeamPref("who_can_at_everyone")||"admin"===TS.prefs.getTeamPref("who_can_post_general")||"owner"===TS.prefs.getTeamPref("who_can_post_general")))_=true;if(_){s.addClass("subtle_silver");s.css("cursor","default");o.removeClass("hidden");$("#single_suppressed_mobile_disclaimer").addClass("hidden");r.prop("disabled",true);r.prop("checked",false);var u="C"===i.charAt(0)?"channel":"group";var m;if("group"===u)m=TS.i18n.t("A Workspace Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")});else if(c.is_general)m=TS.i18n.t("A Workspace Owner has restricted who can post to general and/or restricted the use of <b>{channel}</b> and/or <b>{everyone}</b> to admins and/or owners. These notifications can not be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel"),everyone:TS.templates.builders.atLabel("everyone")});else m=TS.i18n.t("A Workspace Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")});d.tooltip("destroy").attr("title",m).tooltip({html:true,container:"#channel_prefs_dialog"})}else{s.removeClass("subtle_silver");s.css("cursor","");o.addClass("hidden");r.prop("disabled",false);r.prop("checked",t);r.unbind("change").bind("change",function(){var e=!!$(this).prop("checked");if(TS.boot_data.feature_mpdm_default_fe)TS.redux.prefs.setChannelNotificationOverrideAndCallApi("suppress_at_channel",e,i);else{if("both"===n||"at_channel_suppressed_channels"===n){if(e)TS.notifs.makeCorGSuppressed(i);else TS.notifs.makeCorGNOTSuppressed(i);TS.prefs.setPrefByAPI({name:"at_channel_suppressed_channels",value:TS.model.at_channel_suppressed_channels.join(",")})}if("both"===n||"push_at_channel_suppressed_channels"===n){if(e)TS.notifs.makeCorGPushSuppressed(i);else TS.notifs.makeCorGNOTPushSuppressed(i);TS.prefs.setPrefByAPI({name:"push_at_channel_suppressed_channels",value:TS.model.push_at_channel_suppressed_channels.join(",")})}}if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-muting-options-header]"})})}};var o=function e(){if(!i)return;var t=TS.notifs.isCorGMuted(i);var n=$("#muting_cb");var a=$("#non_muting_prefs");var r=$("#muting_info");n.prop("checked",t);n.unbind("change").bind("change",function(){TS.notifs.muteOrUnmuteCorG(i);if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-muting-options-header]"})});if(t){a.slideUp(150);r.removeClass("hidden")}else{a.slideDown(150);r.addClass("hidden")}};var l=function e(){if(!i)return;var t=TS.notifs.getCalculatedCorGPushNotifySetting(i);$("#all_push_everything_default").addClass("hidden");$("#all_push_mentions_default").addClass("hidden");$("#all_push_nothing_default").addClass("hidden");if(TS.prefs.getPref("push_everything"))$("#all_push_everything_default").removeClass("hidden");else if(TS.prefs.getPref("push_mention_alert"))$("#all_push_mentions_default").removeClass("hidden");else $("#all_push_nothing_default").removeClass("hidden");$('input:radio[name="channel_push_loud_rd"]').filter('[value="'+t+'"]').prop("checked",true);$('input:radio[name="channel_push_loud_rd"]').unbind("change").bind("change",function(){var t=$(this).val();if("everything"===t)TS.notifs.makeCorGPushEverything(i);else if("mentions"===t)TS.notifs.makeCorGPushMentions(i);else TS.notifs.makeCorGPushNothing(i);if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-notification-table-header]"});if(TS.boot_data.feature_mpdm_default_fe){if("mentions"===t)t="mentions_dms";TS.redux.prefs.setChannelNotificationOverrideAndCallApi("mobile",t,i)}else TS.prefs.setMultiPrefsByAPI({push_loud_channels:TS.model.push_loud_channels.join(","),push_mention_channels:TS.model.push_mention_channels.join(","),push_loud_channels_set:TS.model.push_loud_channels_set.join(",")});e();a()});var n=$("#push_suppressed_cb");var r=$("#push_suppressed_label");var o=$("#push_suppressed_disabled_explain");var l=$("#push_suppressed_span");var d=$("#push_suppressed_disabled_explain_tip_link");var c="mentions"===t;s(TS.notifs.hasUserSuppressedCorGPushChannelMentions(i),"push_at_channel_suppressed_channels",c,n,r,o,l,d);a()};var d=function i(){if(!TS.ui.channel_prefs_dialog.showing){TS.error("not showing?");return}e.modal("hide")};var c=function i(){e.modal("hide")};var u=function e(){i=null;TS.model.dialog_is_showing=false;TS.ui.channel_prefs_dialog.showing=false;$(window.document).unbind("keydown",t)};var m=function i(){$("body").append('<div id="channel_prefs_dialog" class="modal hide fade"></div>');e=$("#channel_prefs_dialog");e.on("hide",function(e){if(e.target!=this)return;u()});e.on("hidden",function(i){if(i.target!=this)return;e.remove();e=null});e.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.channel_prefs_dialog.showing=true});e.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){$(window.document).bind("keydown",t)},100)})};var f=function e(){l();r()}})()},4948:function(e,i){(function(){TS.registerModule("ui.upload_dialog",{div:null,filesQ:[],file:null,showing:false,last_share_cb_checked:null,selection:null,onStart:function e(){},onKeydown:function e(i){if(!TS.ui.upload_dialog.showing)return;if(i.which==TS.utility.keymap.enter){if("TEXTAREA"!==TS.utility.getActiveElementProp("NODENAME")){if(a)TS.ui.upload_dialog.cancel();else TS.ui.upload_dialog.go();i.preventDefault()}}else if(i.which==TS.utility.keymap.esc)TS.ui.upload_dialog.cancel();else if(i.which==TS.utility.keymap.tab)if($(document.activeElement).hasClass("dialog_go")){i.preventDefault();TS.ui.upload_dialog.div.find(".title_input").focus()}},shouldShowConfirmation:function e(){return!a&&TS.utility.contenteditable.getDisplayValueLength(TS.ui.upload_dialog.div.find("#file_comment_textarea"))>400},showConfirmation:function e(){var i=TS.ui.upload_dialog.div;var t=i.find(".modal-footer-confirm");i.find(".upload_actions").addClass("hidden");t.removeClass("hidden");t.find(".dialog_cancel").focus();a=true},start:function e(i){if(!i||!i.length){TS.info("no files");return}var t=0;var n;for(var a=0;a<i.length;a+=1){n=i[a];if(n.size>TS.model.upload_file_size_limit_bytes)continue;t+=1;TS.ui.upload_dialog.filesQ.push(n)}if(t<i.length){var r="";if(1==i.length)r=TS.i18n.t("That file is too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)});else if(!t)r=TS.i18n.t("All of those file are too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)});else r=TS.i18n.t("We’ll upload what we can, but one or more of those files is too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)});alert(r)}if(!t)return;if(!TS.ui.upload_dialog.div)TS.ui.upload_dialog.build();if(!TS.ui.upload_dialog.showing)TS.ui.upload_dialog.pullFromQ(true)},startWithCommentFromChatInput:function t(n){e=TS.utility.contenteditable.value(TS.client.ui.$msg_input);i=TS.utility.contenteditable.getDisplayValueLength(TS.client.ui.$msg_input);TS.ui.upload_dialog.start(n);TS.view.clearMessageInput()},pullFromQ:function e(i){if(TS.ui.upload_dialog.filesQ.length){if(TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding())TS.lessons.file_upload_modal_sig.dispatch(true);TS.ui.upload_dialog._startWithFile(TS.ui.upload_dialog.filesQ.shift(),i);return true}if(TS.client.ui.resetFiles)TS.client.ui.resetFiles();else if(TS.console&&TS.console.warn)TS.warn(8675309,"TS.client.ui.resetFiles undefined");return false},_startWithFile:function e(i,t){n=false;TS.ui.upload_dialog.file=i;var a=TS.templates.file_upload_dialog({filename:TS.files.makeFileNameFromFile(i),title:s(i),has_name:!!i.name,sharing_html:TS.templates.builders.buildFileSharingControls(i,null,o(),null,TS.ui.upload_dialog.selection),over_storage_limit:TS.model.team.over_storage_limit,plan:TS.model.team.plan,more_in_queue:TS.ui.upload_dialog.filesQ.length>0,file_retention_type:parseInt(TS.prefs.getTeamPref("file_retention_type"),10),file_retention_duration:TS.interop.datetime.daysToYearsPretty(TS.prefs.getTeamPref("file_retention_duration"))});var d=TS.ui.upload_dialog.div;d.html(a);var c=function e(i){$("#upload_image_preview").removeClass("hidden").find("img").attr("src",i)};if("string"===typeof i)c("data:image/png;base64,"+i);else if(window.FileReader)try{if(EXIF){var _=new FileReader;_.onload=function(e){var i=EXIF.readFromBinaryFile(e.target.result);if(i.Orientation&&"number"===typeof i.Orientation&&1!==i.Orientation)$("#upload_image_preview").find("img").addClass("orientation_"+i.Orientation)};_.readAsArrayBuffer(i)}var u=new FileReader;u.onload=function(e){var i=e.target.result;if(0!==i.indexOf("data:image/"))return;c(i)};u.onloadstart=function(e){if(e.total>33554432){TS.info("skipping image preview for large file: "+e.total);u.abort()}};u.readAsDataURL(i)}catch(e){TS.info(e)}var m=$("#file_comment_textarea");TS.ui.comments.bindInput(m,TS.ui.upload_dialog.go);TS.utility.contenteditable.value(m,o());m=null;var f=TS.ui.upload_dialog.showing;d.modal("show");if(TS.ui.upload_dialog.filesQ.length)d.find(".file_count").text(TS.i18n.t(" (and {num_files_remaining, number} more…)","upload_dialog")({num_files_remaining:TS.ui.upload_dialog.filesQ.length}));if(t){var h=!TS.client.activeChannelIsHidden();d.find("#share_cb").prop("checked",h)}else d.find("#share_cb").prop("checked",true===TS.ui.upload_dialog.last_share_cb_checked);d.find(".modal-header > .close").click(l);d.find(".dialog_cancel_all").click(TS.ui.upload_dialog.cancelAll);d.find(".dialog_cancel").click(TS.ui.upload_dialog.cancel);d.find(".dialog_go").click(TS.ui.upload_dialog.go);var g=!t&&TS.ui.upload_dialog.selection?TS.ui.upload_dialog.selection:null;TS.ui.file_share.bindFileShareDropdowns(void 0,null,void 0,g);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField();var p="TS-lazyFilterSelect";d.find(".lfs_input_container").attr("tabindex","0");d.find("#select_share_channels").data(p).instance.onKeyDown=function(e){if(e.which==TS.utility.keymap.tab){e.preventDefault();if(e.shiftKey)d.find("#share_cb").focus();else TS.utility.contenteditable.focus(d.find("#file_comment_textarea"))}};if(f)r(d)},go:function e(){if(n){TS.info("TS.ui.upload_dialog.go stopped because already uploading");return false}if(!TS.ui.upload_dialog.showing){TS.error("not showing?");return}if(!TS.ui.upload_dialog.file){TS.error("no file?");return}if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var i=TS.ui.upload_dialog.div;var t=!!i.find("#share_cb").prop("checked");TS.ui.upload_dialog.last_share_cb_checked=!!t;TS.ui.upload_dialog.selection=$("#share_model_ob_id").val();var a=t?TS.ui.upload_dialog.selection:null;var r=TS.utility.contenteditable.value($("#file_comment_textarea"));r=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(r,{complete_member_specials:false});r=TS.format.cleanMsg(r);if(""===$.trim(r))r="";var s=i.find(".filename_input").val();var o=i.find(".title_input").val();if(TS.ui.upload_dialog.file.is_dropbox||TS.ui.upload_dialog.file.is_box){var l=TS.ui.upload_dialog.file.link;TS.shared.getShareModelObId(a,function(e){TS.files.upload({link:l,filename:s,title:o,channels:e,initial_comment:r,is_dropbox:TS.ui.upload_dialog.file.is_dropbox,is_box:TS.ui.upload_dialog.file.is_box});if(a)d(a)})}else{var c=TS.ui.upload_dialog.file;TS.shared.getShareModelObId(a,function(e){TS.files.upload({file:c,filename:s,title:o,channels:e,initial_comment:r});if(a)d(a)})}n=true;TS.ui.upload_dialog.maybeGoAway()},maybeGoAway:function t(){e="";i=0;if(!TS.ui.upload_dialog.pullFromQ()){TS.ui.upload_dialog.div.modal("hide");TS.ui.upload_dialog.selection=null;return true}return false},cancel:function i(){if(TS.ui.upload_dialog.shouldShowConfirmation()){TS.ui.upload_dialog.showConfirmation();return}TS.ui.upload_dialog.selection=$("#share_model_ob_id").val();var t=e;var n=TS.ui.upload_dialog.maybeGoAway();if(t)TS.client.msg_input.populate(t);if(n&&t)setTimeout(TS.view.focusMessageInput,10);a=false},cancelAll:function e(){TS.ui.upload_dialog.filesQ=[];TS.ui.upload_dialog.cancel()},end:function t(){TS.model.dialog_is_showing=false;TS.ui.upload_dialog.showing=false;TS.ui.upload_dialog.file=null;e="";i=0;a=false;TS.ui.upload_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.upload_dialog.onKeydown)},build:function e(){$("body").append('<div id="upload_dialog" class="modal hide fade" data-keyboard="false" data-backdrop="static"></div>');TS.ui.upload_dialog.div=$("#upload_dialog");var i=TS.ui.upload_dialog.div;i.on("hidden",function(e){if(e.target!=this)return;TS.ui.upload_dialog.end()});i.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.upload_dialog.showing=true});i.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){r(i);$(window.document).bind("keydown",TS.ui.upload_dialog.onKeydown)},100)})}});var e="";var i=0;var t=50;var n=false;var a=false;var r=function n(a){if(e&&i>t){TS.utility.contenteditable.focus(a.find("#file_comment_textarea"));TS.utility.contenteditable.cursorPosition(a.find("#file_comment_textarea"),0,1e5)}else a.find("#upload_file_title").focus().select()};var s=function n(a){if(e&&i<=t)return TS.format.texty.convertContentsStringToDisplayString(e);return TS.files.makeFileTitleFromFile(a)};var o=function n(){if(e&&i>t)return e;return""};var l=function e(i){i.preventDefault();TS.ui.upload_dialog.cancelAll()};var d=function e(i){if(TS.channels.getChannelById(i))TS.channels.displayChannel({id:i});else if(TS.ims.getImByMemberId(i))TS.ims.startImByMemberId(i);else if(TS.mpims.getMpimById(i))TS.mpims.displayMpim({id:i});else if(TS.groups.getGroupById(i))TS.groups.displayGroup({id:i});else TS.error("no valid shared channel/im/mpim/group to display")}})()},4949:function(e,i){(function(){TS.registerModule("ui.snippet_dialog",{editor:null,text_from_input:null,edit_file_id:null,div:null,showing:false,onStart:function e(){},startCreate:function e(i){if(TS.ui.snippet_dialog.showing)return;TS.ui.snippet_dialog.showing=true;TS.ui.snippet_dialog.text_from_input=i||null;TS.ui.snippet_dialog.edit_file_id=null;TS.ui.snippet_dialog.start(i,null,TS.prefs.getPref("last_snippet_type")||"text")},startEdit:function e(i){if(TS.ui.snippet_dialog.showing)return;var t=TS.files.getFileById(i);if(!t)return;TS.files.fetchFileInfo(i,function(e,t){TS.ui.snippet_dialog.edit_file_id=i;TS.ui.snippet_dialog.text_from_input=null;TS.ui.snippet_dialog.start(t.content,t.title,t.filetype)})},start:function r(s,o,l){t=s||"";i=o||"";n=l||"";if(!window.CodeMirror){if(e);else{e=true;TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror","/js/libs/codemirror.min.js")).done(function(){TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror_addon_simple","/js/libs/codemirror/addon/simple.js")).done(function(){TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror_load","/js/codemirror_load.js")).done(function(){TS.ui.snippet_dialog.start(s,o,l)})})})}return}if(!TS.ui.snippet_dialog.div)TS.ui.snippet_dialog.build();var d={codemirror_types:TS.boot_data.codemirror_types,wrap_lines:TS.prefs.getPref("snippet_editor_wrap_long_lines")};if(TS.ui.snippet_dialog.edit_file_id)d.is_edit=true;else{d.is_edit=false;d.sharing_html=TS.templates.builders.buildFileSharingControls()}var c=TS.templates.snippet_dialog(d);var u=TS.ui.snippet_dialog.div;u.html(c);u.modal("show");u.find(".modal-footer-action > .cancel, .modal-header > .close").click(TS.ui.snippet_dialog.cancelPrompt);u.find(".dialog_cancel").click(TS.ui.snippet_dialog.cancel);u.find(".dialog_cancel_decline").click(TS.ui.snippet_dialog.cancelDecline);u.find(".dialog_go").click(TS.ui.snippet_dialog.go);TS.ui.snippet_dialog.editor=CodeMirror.fromTextArea(document.getElementById("client_file_snippet_textarea"),{lineNumbers:true,matchBrackets:true,indentUnit:4,indentWithTabs:true,enterMode:"keep",tabMode:"shift",viewportMargin:10,autofocus:false,lineWrapping:TS.prefs.getPref("snippet_editor_wrap_long_lines")});$("#client_file_snippet_select").change(function(){CodeMirror.switchSlackMode(TS.ui.snippet_dialog.editor,$(this).val());TS.prefs.setPrefByAPI({name:"last_snippet_type",value:$(this).val()})}).change();$("#client_file_wrap_cb").bind("change",function(){var e=$(this).is(":checked");TS.ui.snippet_dialog.editor.setOption("lineWrapping",e);TS.prefs.setPrefByAPI({name:"snippet_editor_wrap_long_lines",value:e})});var m=false;if(TS.ui.snippet_dialog.edit_file_id){TS.ui.snippet_dialog.editor.setValue(s);if(o)o=TS.format.unFormatMsg(o);$("#client_file_snippet_title_input").val(o||"")}else{TS.ui.snippet_dialog.editor.setValue(s||"");$("#client_file_snippet_title_input").val("");TS.ui.file_share.bindFileShareDropdowns();TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField();m=!!s}var f=$("#file_comment_textarea");TS.ui.comments.bindInput(f,TS.ui.snippet_dialog.go);$("#client_file_snippet_select").val(l).trigger("change");setTimeout(function(){if(m)$("#client_file_snippet_title_input").focus();else TS.ui.snippet_dialog.editor.focus();TS.ui.snippet_dialog.editor.refresh()},350);$(window.document).on("keydown",TS.ui.snippet_dialog.onKeyDown);$(window.document).on("keyup",a);TS.ui.snippet_dialog.editor.on("change",a)},go:function e(){if(!TS.ui.snippet_dialog.showing){TS.error("not showing?");return}var i=TS.ui.snippet_dialog.editor.getValue();if(!$.trim(i))return;if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var t=TS.emoji.maybeGetCanonicalEmojiString($("#client_file_snippet_title_input").val());if(TS.ui.snippet_dialog.edit_file_id)TS.api.call("files.edit",{file:TS.ui.snippet_dialog.edit_file_id,title:t,content:i,filetype:$("#client_file_snippet_select").val()});else{var n=!!$("#share_cb").prop("checked");var a=n?$("#share_model_ob_id").val():null;var r=$("#client_file_snippet_select").val();var s=TS.utility.contenteditable.value($("#file_comment_textarea"));s=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(s,{complete_member_specials:false});s=TS.format.cleanMsg(s);if(""===$.trim(s))s="";TS.shared.getShareModelObId(a,function(e){TS.files.upload({text:i,title:t,filetype:r,channels:e,initial_comment:s});if(TS.client){var n=TS.shared.getModelObById(e);if(!n)return;TS.client.displayModelOb(n)}})}TS.ui.snippet_dialog.div.modal("hide");TS.ui.snippet_dialog.end()},cancelPrompt:function e(a){if(a){a.preventDefault();a.stopPropagation()}var r=TS.ui.snippet_dialog;var s=TS.emoji.maybeGetCanonicalEmojiString($("#client_file_snippet_title_input").val());var o=TS.ui.snippet_dialog.editor.getValue();var l=$("#client_file_snippet_select").val();if(TS.ui.snippet_dialog.edit_file_id){if(TS.emoji.maybeGetCanonicalEmojiString(i)===s&&t===o&&n===l)return r.cancel()}else if(!o&&!s)return r.cancel();var d=TS.ui.snippet_dialog.div;d.find(".modal-footer-confirm").removeClass("hidden");d.find(".modal-footer-action").addClass("hidden")},cancelDecline:function e(){var i=TS.ui.snippet_dialog.div;i.find(".modal-footer-confirm").addClass("hidden");i.find(".modal-footer-action").removeClass("hidden")},cancel:function e(i){if(i)i.preventDefault();if(TS.ui.snippet_dialog.text_from_input){TS.client.msg_input.populate(TS.ui.snippet_dialog.editor.getValue());TS.ui.snippet_dialog.text_from_input=""}setTimeout(TS.view.focusMessageInput,10);TS.ui.snippet_dialog.end();TS.ui.snippet_dialog.div.modal("hide")},end:function e(){$(window.document).off("keydown",TS.ui.snippet_dialog.onKeyDown);$(window.document).off("keyup",a);TS.model.dialog_is_showing=false;TS.ui.snippet_dialog.showing=false;if(TS.ui.snippet_dialog.editor&&TS.ui.snippet_dialog.editor.cleanup)TS.ui.snippet_dialog.editor.cleanup();TS.ui.snippet_dialog.editor=null;TS.ui.snippet_dialog.div.empty()},onKeyDown:function e(i){var t=TS.ui.snippet_dialog;if(i.which==TS.utility.keymap.esc){if(t.div.find(".modal-footer-confirm").is(":visible"))t.cancelDecline();else t.cancelPrompt();i.preventDefault()}else if(i.which==TS.utility.keymap.enter)if(!TS.utility.isFocusOnInput()||!document.activeElement||"client_file_snippet_title_input"===TS.utility.getActiveElementProp("id")){if(t.div.find(".modal-footer-confirm").is(":visible"))t.cancel();else t.go();i.preventDefault()}},build:function e(){$("body").append('<div id="snippet_dialog" class="modal hide fade" data-backdrop="static" data-keyboard="false"></div>');TS.ui.snippet_dialog.div=$("#snippet_dialog");var i=TS.ui.snippet_dialog.div;i.on("hidden",function(e){if(e.target!=this)return;TS.ui.snippet_dialog.end()});i.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.snippet_dialog.showing=true})}});var e=false;var i="";var t="";var n="";var a=function e(){var i=TS.ui.snippet_dialog;var t=i.editor.getValue();if($.trim(t))i.div.find(".ts_tip").addClass("ts_tip_hide");else i.div.find(".ts_tip").removeClass("ts_tip_hide")}})()},4950:function(e,i){(function(){TS.registerModule("view.overlay",{onStart:function i(){e=$("#msgs_overlay_div");$(window.document).keydown(function(e){if(!TS.model.overlay_is_showing)return;if(e.which==TS.utility.keymap.enter||e.which==TS.utility.keymap.esc)if(t)t();else o(true)})},cancelIfShowing:function e(){if(!TS.model.overlay_is_showing)return;o()},startWithJoinedChannel:function r(l){s();i=true;e.html(TS.templates.channel_join_overlay({invited:false,channel:l}));t=function e(){l.needs_joined_message=false;o(true);t=null};var c=$("#channel_joined");a(c);if(TS.shared.isModelObOrgShared(l))n(c);d(l.id,"joined")},startWithInvitedChannel:function r(l){s();i=true;var c={invited:true,channel:l};e.html(TS.templates.channel_join_overlay(c));t=function e(){l.needs_invited_message=false;o(true);t=null};var _=$("#channel_joined");a(_);if(TS.shared.isModelObOrgShared(l))n(_);d(l.id,"invited")},startWithCreatedChannel:function r(l){s();i=true;var c={channel:l,name_for_url:l.id};e.html(TS.templates.channel_create_overlay(c));t=function e(){l.needs_created_message=false;o(true);t=null};if(TS.boot_data.feature_lesson_onboarding&&TS.onboarding.inOnboarding())t();e.find("a.invite_link").bind("click.invite_and_clear_overlay",function(e){TS.ui.channel_invite_modal.startInviteToChannelModal(l.id);t(e)});var _=$("#channel_created");a(_);if(TS.shared.isModelObOrgShared(l))n(_);d(l.id,"created")},startWithInvitedGroup:function n(r){s();i=true;e.html(TS.templates.group_join_overlay({invited:true,group:r}));t=function e(){r.needs_invited_message=false;o(true);t=null};a($("#group_joined"));d(r.id,"invited")},startWithCreatedGroup:function n(r){s();i=true;e.html(TS.templates.group_create_overlay({group:r,name_for_url:r.id}));$(window).trigger("resize");t=function e(){r.needs_created_message=false;o(true);t=null};a($("#group_created"));d(r.id,"created")},startWithGrowlPromptDisplay:function t(){s();i=true;var n=e;n.html(TS.templates.growl_prompt_overlay({}));n.find(".prompt_allow").bind("click",r);n.find(".prompt_cancel_forever").bind("click",function(){window.createCookie("no_growl_prompt","1",3650);$("#growl_prompt_div").addClass("hidden");o()});n.find(".see-apps").bind("click",function(){window.createCookie("no_growl_prompt","1",.5);$("#growl_prompt_div").addClass("hidden");o()});n.find(".prompt_cancel").bind("click",function(){$("#growl_prompt_div").addClass("hidden");o()});n.find(".prompt_test").bind("click",function(){$("#growl_prompt_div").addClass("hidden");TS.sounds.play("new_message");TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("What do you know? It works.","prefs")())});if(TS.ui.growls.no_notifications)$("#growl_prompt_overlay_impossible").removeClass("hidden");else $("#growl_prompt_overlay_start").removeClass("hidden")},fadeInAndOut:function e(){s();o()},cancelFromSendingMessage:function e(){if(!TS.model.overlay_is_showing)return;if(t)t();else o(true)}});var e=null;var i=false;var t=null;var n=function e(i){if(!TS.boot_data.page_needs_enterprise)return;i.off("click","[data-channel-shared-teams]").on("click","[data-channel-shared-teams]",function(){TS.ui.enterprise_teams_dialog.show(TS.shared.getActiveModelOb())})};var a=function i(n){e.find("a.btn").bind("click.clear_overlay",t);n.wrap('<div id="overlay_wrapper">');$("#overlay_wrapper").monkeyScroll()};var r=function e(){$("#growl_prompt_overlay_start").addClass("hidden");$("#growl_prompt_overlay_tell_to_allow").removeClass("hidden");TS.ui.growls.promptForPermission(function(e,i){$("#growl_prompt_overlay_tell_to_allow").addClass("hidden");if("granted"===i&&e){$("#growl_prompt_overlay_success").removeClass("hidden");TS.prefs.setPrefByAPI({name:"growls_enabled",value:true})}else if("default"===i)$("#growl_prompt_overlay_start").removeClass("hidden");else if("denied"===i)$("#growl_prompt_overlay_disallowed").removeClass("hidden");else alert("huh allowed:"+e+" permission_level:"+i)})};var s=function i(t){if(TS.model.overlay_is_showing)return;e.stop();e.empty();e.removeClass("hidden");c();if(t){e.css("opacity",0);e.transition({opacity:1},250)}else e.css("opacity",1);TS.model.overlay_is_showing=true};var o=function t(n){var a=TS.model.overlay_is_showing;TS.model.overlay_is_showing=false;var r=e.find("#no_joined_overlays_cb");if(r.length&&r.prop("checked"))TS.prefs.setPrefByAPI({name:"no_joined_overlays",value:true});var s=e.find("#no_created_overlays_cb");if(s.length&&s.prop("checked"))TS.prefs.setPrefByAPI({name:"no_created_overlays",value:true});_();e.transition({opacity:0},250,function(){l()});if(i){i=false;TS.view.showInterstitialAfterChannelOrImShown()}if(a&&n)TS.client.msg_pane.checkUnreads()};var l=function i(){e.addClass("hidden");TS.model.overlay_is_showing=false};var d=function e(i,t){TS.clog.track("CHANNEL_OVERLAY_SHOWN",{channel_id:i,channel_type:i.charAt(0),join_action:t})};var c=function e(){if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.setOverlayVisible(true));else TS.client.ui.$msgs_div.addClass("hide_day_divider_labels")};var _=function e(){if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.setOverlayVisible(false));else TS.client.ui.$msgs_div.removeClass("hide_day_divider_labels")}})()},4951:function(e,i){(function(){TS.registerModule("ui.invite",{showInviteMembersPreSelected:function i(t,n,a){if(!n||!n.length){TS.warn("showInviteMembersPreSelected requires a non-empty array of preselected ids to invite to a group, ignoring...");return}e(t,n,a)},showInviteMemberToChannelDialog:function e(i){var t=TS.members.getMemberById(i);var n=TS.channels.getChannelsUserIsIn();var a=true;var r=true;var s=TS.members.getPrefCompliantMemberName(t,a);var o=TS.i18n.t("Add {name} to a channel","channel_invite")({name:s});if(TS.model.user.is_ultra_restricted)TS.generic_dialog.start({title:o,body:TS.i18n.t("You are not allowed to add other members to channels.","channel_invite")(),show_cancel_button:false});else if(t.is_ultra_restricted)TS.generic_dialog.start({title:o,body:TS.i18n.t("{name} cannot be added to any new channels.","channel_invite")({name:s}),show_cancel_button:false});else if(t.is_restricted&&!TS.model.user.is_admin)TS.generic_dialog.start({title:o,body:TS.i18n.t("Only a Workspace Admin can add {name} into new channels.","channel_invite")({name:s}),show_cancel_button:false});else{var l=n.sort(TS.i18n.mappedSorter("name"));TS.generic_dialog.start({title:o,body:TS.templates.channel_invite_list({channels:l,name:TS.members.getPrefCompliantMemberName(t,a,r)}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Add","channel_invite")(),ladda:true,onGo:function e(){var i=$("#select_invite_channels").lazyFilterSelect("value");if(!i[0])return false;var n=i[0].id;if(t.is_app_user){var a=TS.channels.getChannelById(n);TS.apps.permissions.addAppToResource(t,a)}else TS.api.call("conversations.invite",{channel:n,users:t.id})},onShow:function e(){var a={width:"230px",display:"inline-block"};$("#select_invite_channels").hide().lazyFilterSelect({filter:function e(i,t){if(!i||!i.name)return false;var n=i.name.toLowerCase();var a=t.toLowerCase();while("#"===a[0])a=a.slice(1,a.length);if(n.indexOf(a)>-1)return true;return false},onItemAdded:function e(n){TS.generic_dialog.div.find(".warning_already_member").addClass("hidden");if(!t.is_app_user){if(!_.get(n,"id"))return;TS.generic_dialog.startLadda();TS.membership.ensureChannelMembershipIsKnownForUsers(n.id,[i]).then(function(){var e=TS.membership.getUserChannelMembershipStatus(i,n).is_member;if(e){TS.generic_dialog.div.find(".warning_already_member").removeClass("hidden");TS.generic_dialog.stopLadda();TS.generic_dialog.div.find(".dialog_go").addClass("disabled")}else TS.generic_dialog.stopLadda()})}},placeholder_text:TS.i18n.t("Select a channel","channel_invite")(),css:a,classes:"select_invite_channels",data:n,template:function e(i){var t="#"+_.escape(i.name);t+=TS.templates.builders.maybeMakeSharedIcon(i);return new Handlebars.SafeString(t)}});$("#generic_dialog").find(".modal-body").css("overflow","visible")}})}}});var e=function e(i,t,n){var a=TS.groups.getGroupById(i);if(!a)return;var r;var s=function e(i){if(n){var r;if(TS.useReactMessages())r=TS.utility.msgs.findMsg(n,a.id);else r=TS.utility.msgs.getMsg(n,a.msgs);TS.groups.removeMsg(a.id,r)}if(i){_.chunk(t,30).forEach(function(e){TS.api.call("conversations.invite",{channel:a.id,force:true,users:e.join(",")})});return true}TS.groups.createChild(a.id,t,function(e,i){if(!e){var t=TS.i18n.t("Sorry! Something went wrong. Please try again.","channel_invite")();if(i&&"restricted_action"===i.error)t=TS.i18n.t("<p>You don’t have permission to create new private channels.</p><p>Talk to your Workspace Owner.</p>","channel_invite")();else TS.error(i.error+" error occurred during TS.groups.createChild");setTimeout(function(){TS.generic_dialog.alert(t)},500)}})};var o=_.map(t,function(e){return TS.members.getPrefCompliantMemberName(TS.members.getMemberById(e))});r=TS.i18n.listify(o,{no_escape:true}).join("");var l=TS.i18n.t("Invite {who} to {model_ob}","channel_invite")({who:r,model_ob:TS.model.group_prefix+a.name});TS.ui.fs_modal.start({title:new Handlebars.SafeString(_.escape(l)),body:TS.templates.group_member_invite_list(),show_cancel_button:false,show_go_button:true,go_button_text:TS.i18n.t("Yes, show channel history","channel_invite")(),show_secondary_go_button:true,secondary_go_button_text:TS.i18n.t("No, start a new channel","channel_invite")(),secondary_go_button_class:"btn_info",onGo:function e(){var i=true;return s(i)},onSecondaryGo:function e(){var i=false;return s(i)},onEnd:function e(){$(".modal-body").css("overflow-y","auto")}});$("#select_invite_group_members").hide().lazyFilterSelect();$("#select_invite_group_members_holder").css("min-height",235);$(".modal-body").css("overflow-y","visible")}})()},4952:function(e,i){(function(){TS.registerModule("ui.banner",{show_hide_sig:new signals.Signal,onStart:function e(){TS.client.login_sig.add(TS.ui.banner.loggedIn,TS.ui.banner);TS.ui.growls.permission_changed_sig.add(TS.ui.banner.growlsPermissionChanged,TS.ui.banner)},loggedIn:function e(){var i=false;_.forOwn(TS.qs_args,function(e,t){var n=/^show_([\w_]+)_banner$/;if(n.test(t)&&"1"===e){var a=t.replace(n,"$1");if($("#"+a+"_banner").length>0){TS.ui.banner.show(a);i=true;return false}}});if(i)return;var t="nothing"===TS.notifs.getGlobalNotificationSetting();var n=!TS.model.is_iOS&&!TS.ui.growls.no_notifications&&TS.ui.growls.shouldShowPermissionButton()&&"denied"!==TS.ui.growls.getPermissionLevel()&&"1"!=window.readCookie("no_growl_banner")&&!t;if(n){TS.ui.banner.show("notifications");return}var a=TS.model.mac_version&&TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8")<=0;var r=TS.model.is_our_app&&TS.model.is_mac&&a;var s=TS.model.is_mac&&!a&&!TS.model.mac_ssb_version&&!TS.prefs.getPref("no_macssb1_banner");var o=TS.model.is_win_7_plus&&!TS.model.win_ssb_version&&!TS.prefs.getPref("no_winssb1_banner");if(r){TS.ui.banner.show("macssb_osx_deprecated");return}if(s){TS.ui.banner.show("macssb1");return}if(o)TS.ui.banner.show("winssb1")},showSSBUpdateBanner:function e(t,n,a){if(i&&TS.utility.compareSemanticVersions(t,i)<=0)return;i=t;var r=$("#ssb_new_version_available_banner");if(!r.length)return;r.find(".old_version_number").text(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch);r.find(".new_version_number").text(t);r.find(".can_update").toggleClass("hidden",!n);r.find(".can_not_update").toggleClass("hidden",n);r.find(".update_link").off("click").on("click",function(e){e.preventDefault();TSSSB.call("quitAndInstallUpdate")});r.find(".learn_link").attr("href",a);TS.ui.banner.show("ssb_new_version_available")},closeSSBUpdateBanner:function e(){TS.ui.banner.close()},growlsPermissionChanged:function e(i,t){if("default"!==t)TS.ui.banner.close()},growlsPermissionPrompt:function e(){TS.ui.growls.promptForPermission(function(e,i){if("granted"===i&&e){TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("Nice, notifications are enabled!","prefs")());if(!TS.prefs.getPref("growls_enabled")){TS.prefs.setPrefByAPI({name:"growls_enabled",value:true});TS.prefs.setPrefLocal("growls_enabled",true)}}})},show:function i(t){t=t||e;e=t;var n=TS.client.ui.$banner;n.removeClass("hidden");$("body").addClass("banner_showing");n.css("display","block");n.children(".banner").addClass("hidden");TS.ui.banner.show_hide_sig.dispatch("show");var a=false;var r;if("no_banner"===t){$("#notifications_banner").addClass("hidden");$("#notifications_dismiss_banner").addClass("hidden")}else if("notifications_dismiss"===t){$("#notifications_dismiss_banner").removeClass("hidden");n.unbind("click").bind("click",function(){TS.ui.banner.close();TS.ui.banner.show("no_banner")});a=true;r="recommend_desktop_notifications_banner"}else if("notifications"===t){$("#notifications_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if(0===$(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.growlsPermissionPrompt();else{$("#notifications_banner").addClass("hidden");TS.ui.banner.show("notifications_dismiss");return}TS.ui.banner.close()});a=true;r="enable_desktop_notifications_banner"}else if("macssb1"===t){$("#macssb1_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedMacSSB1Link(this,true);else if(!$(e.target).hasClass("apps_page_link")){var i=$(this).find(".apps_page_link");TS.utility.openInNewTab(i.attr("href"),i.attr("target"));i.click()}});a=true;r="mac_ssb1_banner"}else if("winssb1"===t){$("#winssb1_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedWinSSB1Link(this,true);else if(!$(e.target).hasClass("apps_page_link")){var i=$(this).find(".apps_page_link");TS.utility.openInNewTab(i.attr("href"),i.attr("target"));i.click()}});a=true;r="win_ssb1_banner"}else if("macssb_osx_deprecated"===t){$("#macssb_osx_deprecated_banner").removeClass("hidden");n.unbind("click").bind("click",function(){TS.ui.banner.close()});a=true;r="mac_ssb_osx_deprecated_banner"}else if("ssb_new_version_available"===t){var s=$("#ssb_new_version_available_banner");s.removeClass("hidden");s.find('button[data-action="dismiss_banner"]').unbind("click").bind("click",function(){TS.ui.banner.close();TSSSB.call("closeAllUpdateBanners")});a=true;r="ssb_new_version_available_banner"}else{var o=n.find("#"+t+"_banner");if(!o.length){TS.error("Tried to show a banner called "+t+", but can’t find an element with that as its ID");return}o.removeClass("hidden");o.find('button[data-action="dismiss_banner"]').unbind("click").bind("click",function(){TS.ui.banner.close()});a=true;r="generic_banner"}if(a)TS.clog.track("BANNER_ACTION",{contexts:{ui_context:{action:"impression",ui_element:r}}});TS.view.resizeForBanner("TS.ui.banner.show")},onClickedMacSSB1Link:function e(i,t){TS.ui.banner.close();TS.prefs.setPrefByAPI({name:"no_macssb1_banner",value:true});var n=$(i);if(!n.closest(".banner").hasClass("hidden"))TS.clog.track("BANNER_ACTION",{click_target:"get_mac_ssb_banner",page_url:n.attr("href"),action:t?"banner_dismiss":"banner_click",contexts:{ui_context:{action:t?"close":"click",ui_element:"mac_ssb1_banner"}}})},onClickedWinSSB1Link:function e(i,t){TS.ui.banner.close();TS.prefs.setPrefByAPI({name:"no_winssb1_banner",value:true});var n=$(i);if(!n.closest(".banner").hasClass("hidden"))TS.clog.track("BANNER_ACTION",{click_target:"get_win_ssb_banner",page_url:n.attr("href"),action:t?"banner_dismiss":"banner_click",contexts:{ui_context:{action:t?"close":"click",ui_element:"win_ssb1_banner"}}})},closeNagAndSetCookie:function e(){TS.ui.banner.close();window.createCookie("no_growl_banner","1",3650)},closeNagAndOpenPrefs:function e(){TS.ui.banner.close();setTimeout(function(){TS.ui.prefs_dialog.start("notifications")},500)},close:function e(){var i=TS.client.ui.$banner;i.slideUp(200,function(){i.addClass("hidden");$("body").removeClass("banner_showing");var e=TS.client&&TS.client.ui.areMsgsScrolledToBottom();TS.view.resizeForBanner("TS.ui.banner.close");TS.ui.banner.show_hide_sig.dispatch("hide");if(e)TS.client.ui.instaScrollMsgsToBottom(false)})}});var e="notifications";var i})()},4953:function(e,i){(function(){TS.registerModule("newxp",{slackbot_response_sent_sig:new signals.Signal,slackbot_skip_or_stop_sig:new signals.Signal,slackbot_continue_sig:new signals.Signal,onboarding:{cancel:{step_name:"onboarding_cancelled",pref_name:"onboarding_cancelled",show:"#unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",hide:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #in_skip_messaging",unstyle:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return new Promise(function(){$("#end_display_onboarding").on("click.cancel_onboarding",".skip_tutorial_link",o)}).finally(function(){TS.view.unAdjustForWelcomeSlideShow();TS.client.ui.$msg_input.focus();d(TS.newxp.onboarding.cancel);TS.client.ui.slowScrollMsgsToBottom();$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding").on("click.take_onboarding",l);$("#end_display_onboarding").off("click.cancel_onboarding");TS.onboarding.no_longer_in_onboarding_sig.dispatch();return TS.prefs.setPrefByAPI({name:"onboarding_cancelled",value:true})})}},loading:{step_name:"onboarding_loading",pref_name:"",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container, #pre_skip_messaging",hide:"#banner, #in_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return new Promise(function(){TS.view.adjustForWelcomeSlideShow();d(TS.newxp.onboarding.loading)})}},start:{step_name:"onboarding_start",pref_name:"seen_onboarding_start",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging",hide:"#in_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return new Promise(function(e){TS.view.adjustForWelcomeSlideShow();d(TS.newxp.onboarding.start);$("#explore_btn_container > .btn").on("click",function(){TS.metrics.mark("onboarding_btn_click");TS.clog.track("GROWTH_ONBOARDING",{action:"onboarding_btn_click",step:s})});$("#explore_btn_container > .btn").on("click.start_onboarding",e)}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_start",value:true})}).finally(function(){$("#explore_btn_container > .btn").off("click.start_onboarding");return TS.prefs.setPrefByAPI({name:"seen_welcome_2",value:true})})}},complete:{step_name:"onboarding_complete",pref_name:"seen_onboarding_complete",show:"#star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header, .coachmark_got_it",hide:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #in_skip_messaging, #unskip_messaging",unstyle:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){TS.onboarding.no_longer_in_onboarding_sig.dispatch();return Promise.resolve().then(function(){d(TS.newxp.onboarding.complete);$("#end_display_onboarding").off("click.cancel_onboarding");$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding");TS.client.ui.slowScrollMsgsToBottom();TS.client.ui.$msg_input.focus();if(TS.ims.message_received_sig.has(T))TS.ims.message_received_sig.remove(T);return TS.prefs.setPrefByAPI({name:"newxp_slackbot_step",value:"A2"})})}},slackbot:{step_name:"onboarding_slackbot_conversation",pref_name:"seen_onboarding_slackbot_conversation",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #in_skip_messaging",hide:"#explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",unstyle:"#client_body",promiseTo:function e(){var i=null;var t=function e(i,t,n){if(p(t,n))i()};return Promise.resolve().then(function(){d(TS.newxp.onboarding.slackbot);TS.view.unAdjustForWelcomeSlideShow();TS.view.focusMessageInput();$("#footer_overlay").css("opacity",0);TS.ims.message_received_sig.add(S)}).delay(400*$("#footer_overlay").css("opacity")).then(function(){$("#footer_overlay").addClass("hidden");TS.client.ui.slowScrollMsgsToBottom()}).then(function(){if(!TS.prefs.getPref("onboarding_slackbot_conversation_step"))return Promise.resolve();if(a)return Promise.resolve();return new Promise(function(e){i=t.bind(null,e);TS.ims.message_received_sig.add(i,TS.newxp);return TS.prefs.setPrefByAPI({name:"greeting_step",value:"go"})}).finally(function(){TS.ims.message_received_sig.remove(i,TS.newxp)})}).then(function(){if(TS.prefs.getPref("onboarding_slackbot_conversation_step")>1)return Promise.resolve();return new Promise(function(e){i=t.bind(null,e);TS.ims.message_received_sig.add(i,TS.newxp);TS.metrics.measure("sending_api_call_to_queue_slackbot","onboarding_btn_click");TS.metrics.mark("onboarding_api_call");return TS.prefs.setPrefByAPI({name:"greeting_step",value:"start"})}).then(function(){var e=TS.i18n.t("Type something","newxp")();TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,e);return TS.prefs.setPrefByAPI({name:"onboarding_slackbot_conversation_step",value:1})}).finally(function(){TS.metrics.measure("received_first_slackbot_msg_from_onboarding_button","onboarding_btn_click");TS.metrics.measure("received_first_slackbot_msg_from_api_call","onboarding_api_call");TS.metrics.clearMarks("onboarding_btn_click");TS.metrics.clearMarks("onboarding_api_call");TS.ims.message_received_sig.remove(i,TS.newxp)})}).then(function(){var e=Promise.resolve().then(function(){var e=TS.prefs.getPref("onboarding_slackbot_conversation_step")>1?0:3e4;return Promise.delay(e).then(function(){return new Promise(function(e){i=t.bind(null,e);TS.ims.message_received_sig.add(i,TS.newxp);return TS.prefs.setPrefByAPI({name:"intro_step",value:"notyping_1"})}).then(function(){var e=TS.i18n.t("Type something","newxp")();TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,e);TS.client.ui.$msg_input.addClass("onboarding");TS.client.ui.files.$file_btn.addClass("onboarding");return TS.prefs.setPrefByAPI({name:"onboarding_slackbot_conversation_step",value:2})}).delay(2e3).finally(function(){TS.ims.message_received_sig.remove(i,TS.newxp);TS.client.ui.$msg_input.removeClass("onboarding");TS.client.ui.files.$file_btn.removeClass("onboarding")})})}).delay(6e5).then(function(){return new Promise(function(e){i=t.bind(null,e);TS.ims.message_received_sig.add(i,TS.newxp);return TS.prefs.setPrefByAPI({name:"intro_step",value:"notyping_2"})}).then(function(){o();r.cancel()}).finally(function(){TS.ims.message_received_sig.remove(i,TS.newxp)})});var n=function e(i){TS.newxp.slackbot_response_sent_sig.add(function(){return i()})};var a=function i(t,n){if(g(t,n))e.cancel()};var r=new Promise(function(e){TS.ims.message_received_sig.add(a,TS.newxp);n=n.bind(null,e);TS.ims.message_received_sig.add(n,TS.newxp);return TS.prefs.setPrefByAPI({name:"greeting_step",value:"expecting"})}).then(function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"");return TS.prefs.setMultiPrefsByAPI({onboarding_slackbot_conversation_step:10,seen_onboarding_slackbot_conversation:true})}).finally(function(){TS.ims.message_received_sig.remove(n,TS.newxp);TS.ims.message_received_sig.remove(a,TS.newxp)});return Promise.any([r,e]).finally(function(){if(r)r.cancel();if(e)e.cancel()})}).finally(function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"");TS.client.ui.$msg_input.removeClass("onboarding");TS.client.ui.files.$file_btn.removeClass("onboarding");TS.ims.message_received_sig.remove(S);TS.ims.message_received_sig.add(T);setTimeout(function(){if(TS.ims.message_received_sig.has(T))TS.ims.message_received_sig.remove(T,TS.newxp)},18e4);return TS.prefs.setMultiPrefsByAPI({intro_step:"",greeting_step:""})})}},channels:{step_name:"onboarding_channels",pref_name:"seen_onboarding_channels",show:"#active_channel_name_overlay, #in_skip_messaging, .coachmark_next_tip",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#col_channels_footer",promiseTo:function e(){var i=$("#starred_div, #direct_messages, #channel_list_invites_link, #quick_switcher_btn");return new Promise(function(e){TS.client.ui.$msg_input.blur();d(TS.newxp.onboarding.channels);TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.channels,{resolve:e,reject:o}));i.addClass("translucent")}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_channels",value:true});return null}).finally(function(){i.removeClass("translucent")})}},direct_messages:{step_name:"onboarding_direct_messages",pref_name:"seen_onboarding_direct_messages",show:"#active_channel_name_overlay, #in_skip_messaging",show_member:".coachmark_got_it",show_admin:".coachmark_next_tip",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging",hide_member:".coachmark_next_tip",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#col_channels_footer",promiseTo:function e(){var i=$("#starred_div, #channels, #channel_list_invites_link, #quick_switcher_btn");return new Promise(function(e){d(TS.newxp.onboarding.direct_messages);TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.direct_messages,{resolve:e,reject:o}));i.addClass("translucent")}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_direct_messages",value:true});return null}).finally(function(){i.removeClass("translucent")})}},invites:{step_name:"onboarding_invites",pref_name:"seen_onboarding_invites",show:"#active_channel_name_overlay, #in_skip_messaging, .coachmark_got_it",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, .coachmark_next_tip",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#quick_switcher_btn",promiseTo:function e(){var i=$("#starred_div, #channels, #direct_messages");return new Promise(function(e){d(TS.newxp.onboarding.invites);TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.invites,{resolve:e,reject:o}));i.addClass("translucent")}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_invites",value:true});return null}).finally(function(){i.removeClass("translucent")})}},recent_mentions:{step_name:"onboarding_recent_mentions",pref_name:"seen_onboarding_recent_mentions",promiseTo:function e(){var i;var t;return new Promise(function(e,n){i=$("#recent_mentions_toggle");y(i);t=i.find(".starburst");k(TS.coachmark.start.bind(null,$.extend({},TS.coachmarks.coachmarks.recent_mentions,{resolve:e,reject:n.bind(null,new Error("Click-tick onboarding cancelled"))})),i,t)}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_recent_mentions",value:true});return null}).finally(function(){C(i,t);A(i)})}},starred_items:{step_name:"onboarding_starred_items",pref_name:"seen_onboarding_starred_items",promiseTo:function e(){var i;var t;return new Promise(function(e,n){i=$("#stars_toggle");y(i);t=i.find(".starburst");k(TS.coachmark.start.bind(null,$.extend({},TS.coachmarks.coachmarks.starred_items,{resolve:e,reject:n.bind(null,new Error("Click-tick onboarding cancelled"))})),i,t)}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_starred_items",value:true});return null}).finally(function(){C(i,t);A(i)})}}},onStart:function e(){},inOnboarding:function i(){return e},startOnboarding:function e(){if(TS.model.seen_welcome_2){TS.onboarding.no_longer_in_onboarding_sig.dispatch();return}I();if(TS.model.seen_welcome_2){TS.onboarding.no_longer_in_onboarding_sig.dispatch();return}if(M())TS.ims.startImByMemberName("slackbot");if(TS.prefs.getPref("onboarding_cancelled")){d(TS.newxp.onboarding.cancel);$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding").on("click.take_onboarding",l);$("#end_display_onboarding").removeClass("hidden")}else{TS.model.seen_onboarding_this_session=true;r=!TS.client.ui.$banner.hasClass("hidden");d(TS.newxp.onboarding.loading);l()}},cancelOnboarding:function e(){if(!TS.onboarding.shouldShowFirstWelcome())$("#end_display_onboarding").addClass("hidden");o()},getCurrentStepName:function e(){return s},test:function e(){return{deferredCancel:o,startOnboarding:l,goToStep:d,getBaseSteps:c,getUserSteps:u,composeUserOnboarding:m,composeCancelOnboarding:f,acceptIMMessage:g,isSlackbot:p,onSkipOrStop:S,restartOnGo:T,waitAllOrCancel:v,enableScrollFadeOut:b,disableScrollFadeOut:w,addClickTickStarburst:y,removeClickTickStarburst:A,addClickTickInteractions:k,removeClickTickInteractions:C,shouldDirectToSlackbotForOnboarding:M}}});var e=false;var i=null;var t=null;var n=null;var a=false;var r=false;var s="";var o=function e(){if(t){t.finally(function(){if(t.isCancelled()&&n)n.cancel()});t.cancel()}else if(n)n.cancel()};var l=function e(){o();if(TS.model.ui_state.flex_visible)TS.client.ui.flex.hideFlex();if(TS.prefs.getPref("onboarding_cancelled"))TS.prefs.setPrefByAPI({name:"onboarding_cancelled",value:false});TS.prefs.onPrefChanged({name:"onboarding_cancelled",value:false});b();t=m();n=f();if(!TS.model.user.is_restricted&&!i)i=h();$("#end_display_onboarding").removeClass("hidden")};var d=function e(i){s=i.step_name;$(i.show).removeClass("hidden");$(i.hide).addClass("hidden");$(i.style).addClass("onboarding");$(i.unstyle).removeClass("onboarding");if(TS.ui.admin_invites.canInvite()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26){$(i.hide_admin).addClass("hidden");$(i.show_admin).removeClass("hidden")}else{$(i.hide_member).addClass("hidden");$(i.show_member).removeClass("hidden")}TS.clog.track("GROWTH_ONBOARDING",{action:"enter_step",step:s})};var c=function e(){var i=["start","slackbot","channels","direct_messages","complete"];if(TS.ui.admin_invites.canInvite()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26)i.splice(4,0,"invites");return i};var u=function e(){return c().filter(function(e){return!TS.prefs.getPref(TS.newxp.onboarding[e].pref_name)})};var m=function i(){e=true;return TS.experiment.loadUserAssignments().then(function(){var i;u().forEach(function(e){i=!i?TS.newxp.onboarding[e].promiseTo():i.then(TS.newxp.onboarding[e].promiseTo)});if(i){if(!t)TS.client.ui.$banner.addClass("hidden");TS.ui.banner.close();i.finally(function(){e=false;if(r){TS.ui.banner.show();TS.client.ui.$banner.removeClass("hidden")}if(i.isCancelled())return;TS.model.seen_welcome_2=true;$("#end_display_onboarding").addClass("hidden");TS.client.msg_pane.updateEndMarker();w()})}else e=false;return i})};var f=function e(){return TS.newxp.onboarding.cancel.promiseTo()};var h=function e(){var i=["recent_mentions","starred_items"].filter(function(e){return!TS.prefs.getPref(TS.newxp.onboarding[e].pref_name)}).map(function(e){return TS.newxp.onboarding[e].promiseTo()});return v(i)};var g=function e(i,t){return i.id==TS.model.active_im_id&&TS.members.getMemberById(i.user).is_slackbot&&t&&TS.members.getMemberById(t.user).is_self};var p=function e(i,t){return i&&t&&i.user==t.user&&TS.members.getMemberById(i.user).is_slackbot};var S=function e(){TS.newxp.slackbot_skip_or_stop_sig.add(function(){o()})};var T=function e(){TS.newxp.slackbot_continue_sig.add(function(){TS.ims.message_received_sig.remove(e,TS.newxp);if(TS.prefs.getPref("onboarding_cancelled")&&TS.onboarding.shouldShowFirstWelcome()){l();a=true}})};var v=function e(i){return Promise.all(i).then(_.noop,function(){i.forEach(function(e){e.cancel()})})};var b=function e(){var i=$("#onboarding_fade_out_mask").removeClass("hidden");TS.client.ui.$msgs_scroller_div.on("scroll.onboarding",function(){if(TS.client.ui.$msgs_scroller_div[0].scrollTop>300){if(!i.hasClass("hidden"))i.addClass("hidden")}else if(i.hasClass("hidden"))i.removeClass("hidden")})};var w=function e(){TS.client.ui.$msgs_scroller_div.off("scroll.onboarding");$("#onboarding_fade_out_mask").addClass("hidden")};var y=function e(i){i.append($("<div class='starburst_wrapper'><span class='starburst'></span></div>"))};var A=function e(i){i.find("> .starburst_wrapper").remove()};var k=function e(i,t,n,a,r){t=t||$();n=n||$();r=r||t;a=a||n;t.on("mouseenter.onboarding",function(){if(r.hasClass("onboarding"))return;n.css("opacity",1);if(i)i()}).on("mouseleave.onboarding",function(){if(t.hasClass("onboarding"))return;if(TS.coachmark.is_showing&&TS.coachmark.is_small){TS.coachmark.end();n.css("opacity",0)}}).addClass("jquery_hover");if(a!=n)a.css("height",t.outerHeight(true)).css("width",t.outerWidth(true));a.on("click.onboarding",function(e){if(e)e.stopPropagation();TS.coachmark.expand()})};var C=function e(i,t,n){t=t||$();n=n||t;i.off("mouseenter.onboarding mouseleave.onboarding").removeClass("jquery_hover");n.off("click.onboarding")};var M=function e(){return!TS.onboarding.shouldShowFirstWelcome()&&!TS.prefs.getPref("onboarding_cancelled")};var I=function e(){var i=TS.onboarding.shouldShowFirstWelcome();var t=!i&&(TS.prefs.getPref("onboarding_cancelled")||TS.prefs.getPref("seen_onboarding_start"))||i&&(TS.prefs.getPref("onboarding_cancelled")||TS.prefs.getPref("seen_onboarding_start"))&&!TS.model.seen_onboarding_this_session;if(t){TS.model.seen_welcome_2=true;TS.client.msg_pane.updateEndMarker()}}})()},4954:function(e,i){(function(){TS.registerModule("onboarding",{no_longer_in_onboarding_sig:new signals.Signal,onStart:function e(){if(!TS.client)return;TS.client.login_sig.add(TS.onboarding.onLogin,TS.onboarding,-1);TS.prefs.seen_welcome_2_changed_sig.add(TS.onboarding.setSeenWelcome2)},onLogin:function e(){if(void 0!==TS.boot_data.prefs_seen_welcome_2)TS.model.seen_welcome_2=TS.boot_data.prefs_seen_welcome_2;else TS.onboarding.setSeenWelcome2();TS.onboarding.startOnboarding()},setSeenWelcome2:function e(){TS.model.seen_welcome_2=TS.prefs.getPref("seen_welcome_2")},startOnboarding:function e(){if(TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled"))TS.lessons.startOnboarding();else TS.newxp.startOnboarding()},cancelOnboarding:function e(){if(TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled"))TS.lessons.cancelOnboarding();else TS.newxp.cancelOnboarding()},inOnboarding:function e(){if(TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled"))return TS.lessons.inOnboarding();return TS.newxp.inOnboarding()},shouldShowFirstWelcome:function e(){if(TS.boot_data.incremental_boot_data&&(false===_.get(TS.boot_data.incremental_boot_data,"self.prefs.seen_welcome_2",void 0)||false===TS.boot_data.prefs_seen_welcome_2))return true;if(TS.model&&TS.model.seen_welcome_2)return false;if(!(TS.model&&TS.model.welcome_model_ob&&TS.model.welcome_model_ob.id))return false;var i=TS.shared.getActiveModelOb();if(!i)return false;if(i.id==TS.model.welcome_model_ob.id)return true;return false}})})()},4955:function(e,i){(function(){TS.registerModule("lessons",{lesson_assigned_sig:new signals.Signal,channel_created_sig:new signals.Signal,message_sent_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,coachmark_closed_sig:new signals.Signal,new_channel_modal_opened_sig:new signals.Signal,new_channel_modal_closed_sig:new signals.Signal,file_upload_clicked_sig:new signals.Signal,your_computer_clicked_sig:new signals.Signal,file_upload_modal_sig:new signals.Signal,onStart:function e(){},inOnboarding:function i(){return e},startOnboarding:function i(){e=true;var t=TS.prefs.getPref("seen_welcome_2");if(false===t){TS.channels.displayChannel({id:TS.channels.getGeneralChannel().id});TS.prefs.setPrefByAPI({name:"seen_welcome_2",value:true})}TS.lessons.model.populateFromTSModel();var n={only_active:false};TS.api.call("lessons.list",n).then(function(i){var t=i.data;if(!t.ok){TS.lessons.lesson_assigned_sig.add(T);return}if(!t.user_lessons||!t.user_lessons.length){e=false;return}if("completed"!==_.get(t,"user_lessons[0].state"))T(t.user_lessons);else{e=false;TS.onboarding.no_longer_in_onboarding_sig.dispatch()}})},cancelOnboarding:function i(){e=false;TS.api.call("lessons.skip",r);TS.onboarding.no_longer_in_onboarding_sig.dispatch()},postponeOnboardingAndRemindLater:function i(){e=false;TS.api.call("lessons.paused",r);TS.onboarding.no_longer_in_onboarding_sig.dispatch()},onboardingInProgress:function e(){TS.api.call("lessons.inProgress",r)},initiateTask:function e(){o()},lessonOnboardingClog:function e(i){TS.clog.track("LESSON_ONBOARDING",{contexts:{ui_context:i}})},loadSlackbot:function e(){TS.api.call("slackbot.sendHelpMessage").then(function(e){if(!e.data.ok)TS.error(e.data.error);else{TS.ui.onboarding_dialog.closeDialog();TS.ims.startImByMemberName("slackbot")}})}});var e=false;var i;var t=0;var n=0;var a=[];var r;var s;var o=function e(){TS.ui.onboarding_dialog.closeDialog();s=_.clone(r);t=TS.lessons.model.current_task_index;s.user_task_id=TS.lessons.model.TASKS[t].id;TS.api.call("lessons.tasks.inProgress",s).then(function(e){if(!e.data.ok)TS.error(e.data.error)});i=TS.lessons.model.TASKS[t].steps;f(i[n]);l();$("body").addClass("task_in_progress");var a=_.clone(t);var o="task"+(a+1)+"_1";TS.lessons.lessonOnboardingClog({step:o,action:"click",ui_element:"try_it",ui_properties:{element_type:"button",element_name:"try_it_now"}})};var l=function e(){TS.lessons.new_channel_modal_closed_sig.add(m);TS.lessons.coachmark_closed_sig.add(m);TS.lessons.file_upload_modal_sig.add(u)};var d=function e(){$(".file_upload_btn").on("click",function(){c();TS.lessons.file_upload_clicked_sig.dispatch(true)})};var c=function e(){$('[data-which="choose"], [data-which="gdrive_import"], [data-which="snippet"], [data-which="space"]').on("click",function(){TS.lessons.your_computer_clicked_sig.dispatch(true)})};var u=function e(){if(TS.coachmark.$coachmark)TS.coachmark.end();if("upload_file"===TS.lessons.model.TASKS[t].task_name)_.each(TS.lessons.model.TASKS[t].steps,function(e,i){if("upload_file_menu_coachmark"===e.name){n=i;h()}})};var m=function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"in_progress";n=0;g();TS.view.clearMessageInput();$("body").removeClass("task_in_progress");TS.ui.onboarding_dialog.start(i)};var f=function e(i){var t=s;t.current_step=i.name;TS.api.call("lessons.tasks.currentStep",t).then(function(e){if(!e.data.ok)TS.error(e.data.error)});switch(i.type){case"coachmark":b(i);break;case"alter_channel_creation_modal":w(i);break;case"prefill_message":y(i);break;case"wait_for_file_upload":A(i);break;default:TS.info("Unmatched step type")}};var h=function e(){n+=1;var r=i[n];g();if(r)f(r);else{var o=_.clone(t);var l="task"+(o+1);TS.lessons.lessonOnboardingClog({step:l,action:"complete",action_status:"success"});TS.lessons.model.TASKS[t].task_completed=true;a.push(TS.lessons.model.TASKS[t]);TS.api.call("lessons.tasks.completed",s).then(function(e){if(!e.data.ok)TS.error(e.data.error);else S()})}};var g=function e(){if(TS.coachmark.$coachmark)TS.coachmark.end();var t=_.clone(n)-1;if(t>=0){var a=i[t];if(a&&a.coachmark_highlight_target)$(a.coachmark_highlight_target).removeClass(a.coachmark_highlight_class_name)}};var p=function e(){TS.lessons.lesson_assigned_sig.remove(T);TS.lessons.channel_created_sig.remove(h);TS.lessons.message_sent_sig.remove(h);TS.lessons.file_uploaded_sig.remove(h);TS.lessons.coachmark_closed_sig.remove(m);TS.lessons.new_channel_modal_closed_sig.remove(m)};var S=function i(){if(a.length===TS.lessons.model.TASKS.length)TS.api.call("lessons.completed",r).then(function(i){if(!i.data.ok)TS.error(i.data.error);else{m("completed");p();e=false}});else{var n=t+1;while(n!==t){if(n===TS.lessons.model.TASKS.length)n=0;if(true!==TS.lessons.model.TASKS[n].task_completed){t=n;TS.lessons.model.current_task_index=t;m();break}n+=1}}};var T=function e(i){var n=i.shift();v(n);d();r={user_lesson_id:n.user_lesson_id};if("paused"===n.state)TS.lessons.onboardingInProgress();if("in_progress"===n.state||"paused"===n.state){t=-1;S()}TS.ui.onboarding_dialog.start(n.state)};var v=function e(i){TS.lessons.model.current_lesson_id=i.user_lesson_id;_.each(TS.lessons.model.TASKS,function(e,t){TS.lessons.model.TASKS[t].id=i.tasks[t].user_task_id;TS.lessons.model.TASKS[t].task_completed="completed"===i.tasks[t].state;if("completed"===i.tasks[t].state)a.push(TS.lessons.model.TASKS[t])})};var b=function e(i){if("coachmark"===i.type){var t="send_message_input_coachmark"!==i.name;var n={id:"onboarding_coachmark",coachmark_el_id:"onboarding_coachmark_div",no_footer:true,has_close_btn:true,enter_does_not_dismiss:t,place:function e(){i.coachmark_placement($(i.coachmark_class_target),i.coachmark_offset_y,i.coachmark_offset_x,i.coachmark_offset_callout)},content:function e(){var t={title:i.coachmark_title,description:i.coachmark_description};return TS.templates.onboarding_coachmark(t)}};$(i.coachmark_highlight_target).addClass(i.coachmark_highlight_class_name);TS.coachmark.start(n)}i.signal.add(h)};var w=function e(i){$("#fs_modal_close_btn").on("click",function(){TS.lessons.new_channel_modal_closed_sig.dispatch(true)});i.signal.add(h)};var y=function e(i){var t;var n=TS.model.active_channel_id;if(null!==TS.model.active_channel_id){var a=TS.channels.getChannelById(n).name;t="#"+a}else t="";var r=i.message({name_of_channel:t});r=r.replace(/ +(?= )/g,"");if(TS.utility.contenteditable.isEmpty()){TS.utility.contenteditable.value(TS.client.msg_input.$input,r);TS.utility.contenteditable.focus(TS.client.msg_input.$input)}h()};var A=function e(i){i.signal.add(h)}})()},4956:function(e,i){(function(){TS.registerModule("lessons.model",{populateFromTSModel:function e(){var i=TS.i18n.t("Welcome, {name}","lessons")({name:TS.model.user.real_name});TS.lessons.model.WELCOME.modal_title=i;var t=TS.i18n.t("You just created <strong>{team_name}</strong> on Slack. Next, we’ll show you how to get the conversation going – it only takes a minute or two!","lessons")({team_name:_.escape(TS.model.team.name)});TS.lessons.model.WELCOME.modal_description=t},current_task_index:0,current_lesson_id:0,WELCOME:{modal_media_url:cdn_url+"/28121/img/onboarding/welcome.png",modal_button_text:TS.i18n.t("Let’s go","lessons")()},TASKS:[{task_name:"create_channel",modal_color_class:"blue",modal_media_url:cdn_url+"/adc6a/img/onboarding/CreateChannel.gif",modal_dot_to_highlight_or_mark_as_complete:1,task_completed:false,modal_title:TS.i18n.t("Start by creating a channel","lessons")(),modal_description:TS.i18n.t("Channels give each conversation a dedicated home, helping everyone in your team focus on the right thing at the right time.","lessons")(),modal_button_text:TS.i18n.t("Try it now","lessons")(),steps:[{type:"coachmark",name:"create_channel_button_coachmark",coachmark_class_target:'[data-qa-channel-sidebar-section-heading="channels"]',coachmark_placement:TS.coachmark?TS.coachmark.placeRightOf:void 0,coachmark_offset_x:33,coachmark_offset_y:-15,coachmark_offset_callout:0,coachmark_title:TS.i18n.t("Create a new channel","lessons")(),coachmark_description:TS.i18n.t("Click the + to start creating a channel.","lessons")(),coachmark_highlight_target:".client_channels_list_container",coachmark_highlight_class_name:"coachmark_focal_point_sidebar",signal:TS.lessons?TS.lessons.new_channel_modal_opened_sig:void 0},{type:"alter_channel_creation_modal",name:"create_channel_alter_modal_coachmark",signal:TS.lessons?TS.lessons.channel_created_sig:void 0}]},{task_name:"send_message",modal_color_class:"orange",modal_media_url:cdn_url+"/adc6a/img/onboarding/PostMessage.gif",modal_dot_to_highlight_or_mark_as_complete:2,task_completed:false,modal_title:TS.i18n.t("Post a message","lessons")(),modal_description:TS.i18n.t("Just like a blank page, an empty channel can be intimidating! Post the very first message in this channel to welcome everyone who joins.","lessons")(),modal_button_text:TS.i18n.t("Try it now","lessons")(),steps:[{type:"prefill_message",name:"send_message_prefill_message",message:TS.i18n.t("Hi everyone. Here’s a space for our {name_of_channel} conversations!","lessons"),message_target:".ql-editor p"},{type:"coachmark",name:"send_message_input_coachmark",coachmark_class_target:'[data-qa="message_input"]',coachmark_placement:TS.coachmark?TS.coachmark.placeAboveOf:void 0,coachmark_offset_x:30,coachmark_offset_y:10,coachmark_offset_callout:-400,coachmark_title:TS.i18n.t("Just type and press Enter","lessons")(),coachmark_description:TS.i18n.t("Feel free to send the prefilled message, or replace it with exactly what you want to say to your team.","lessons")(),coachmark_highlight_target:"#msg_form",coachmark_highlight_class_name:"coachmark_focal_point_messagebar",signal:TS.lessons?TS.lessons.message_sent_sig:void 0}]},{task_name:"upload_file",modal_color_class:"yellow",modal_media_url:cdn_url+"/adc6a/img/onboarding/UploadFile.gif",modal_dot_to_highlight_or_mark_as_complete:3,task_completed:false,modal_title:TS.i18n.t("Upload relevant documents","lessons")(),modal_description:TS.i18n.t("Got a project plan, spreadsheet, or design file related to the conversation? Share a file to give your teammates useful context.","lessons")(),modal_button_text:TS.i18n.t("Try it now","lessons")(),steps:[{type:"coachmark",name:"upload_file_button_coachmark",coachmark_class_target:".file_upload_btn",coachmark_placement:TS.coachmark?TS.coachmark.placeRightOf:void 0,coachmark_offset_x:20,coachmark_offset_y:10,coachmark_offset_callout:15,coachmark_title:TS.i18n.t("Add a file here","lessons")(),coachmark_description:TS.i18n.t("Click the + plus icon next to the message input box to add a file to the conversation.","lessons")(),coachmark_highlight_target:".file_upload_btn",coachmark_highlight_class_name:"coachmark_focal_point_fileupload",signal:TS.lessons?TS.lessons.file_upload_clicked_sig:void 0},{type:"coachmark",name:"upload_file_menu_coachmark",coachmark_class_target:"#menu_items",coachmark_placement:TS.coachmark?TS.coachmark.placeRightOf:void 0,coachmark_offset_x:6,coachmark_offset_y:155,coachmark_offset_callout:105,coachmark_title:TS.i18n.t("Browse your computer’s files","lessons")(),coachmark_description:TS.i18n.t("Select Your Computer to open your file browser and find the file you need.","lessons")(),signal:TS.lessons?TS.lessons.your_computer_clicked_sig:void 0},{type:"wait_for_file_upload",name:"upload_file_wait_for_upload",signal:TS.lessons?TS.lessons.file_uploaded_sig:void 0}]}],COMPLETION:{modal_media_url:cdn_url+"/28121/img/onboarding/completion.png",modal_title:TS.i18n.t("Nice work!","lessons")(),modal_description:TS.i18n.t("You’ve set the stage for team discussions. If you’re wondering how to do other things in Slack, you can send questions to Slackbot.","lessons")(),modal_button_text:TS.i18n.t("Ask Slackbot","lessons")(),modal_second_button_text:TS.i18n.t("I’m done","lessons")()}})})()},4957:function(e,i){(function(){TS.registerModule("typing",{started_sig:new signals.Signal,ended_sig:new signals.Signal,test:function e(){return{getNumberOfRecords:t}},maybeStartTimer:function i(){if(e)return;e=setInterval(TS.typing.checkMap,1e3)},userStarted:function e(t){if(!TS.redux.socket.isConnected())return;if(!t)return;var n=TS.model.user;var a=t.id+"_"+n.id;if(i(a))return;var r={type:"typing",channel:t.id};TS.interop.SocketManager.send(r);TS.typing.memberStarted(t,TS.model.user)},memberStarted:function e(t,n){var a=t.id+"_"+n.id;var s=Date.now();var o=!i(a);var l=TS.interop.redux.features.typing.updateTyping({key:a,started:s,model_ob_id:t.id,member_id:n.id,member_is_self:n.is_self});TS.redux.dispatch(l);if(o){TS.typing.started_sig.dispatch(t,n);if(TS.has_pri[r])TS.log(r,"added "+a)}else if(TS.has_pri[r])TS.log(r,"updated "+a);TS.typing.maybeStartTimer()},userEnded:function e(i){if(!i)return;var t=TS.model.user;TS.typing.memberEnded(i,t)},memberEnded:function e(i,t){var n=i.id+"_"+t.id;TS.typing.expungeMember(i,t);if(TS.has_pri[r])TS.log(r,"removed "+n)},expungeMember:function e(i,t){var n=i.id+"_"+t.id;var a=TS.interop.redux.features.typing.clearTyping({key:n});TS.redux.dispatch(a);TS.typing.ended_sig.dispatch(i,t)},checkMap:function i(){var n=Date.now();var s=0;var o=a();var l=TS.interop.redux.features.typing.removeOldTypingRecords({now:n});TS.redux.dispatch(l);var d=a();var c=_.difference(Object.keys(o),Object.keys(d));c.forEach(function(e){var i=o[e];var t=TS.members.getMemberById(i.member_id);var n=TS.redux.channels.getEntityById(i.model_ob_id);TS.typing.ended_sig.dispatch(n,t);if(TS.has_pri[r])TS.log(r,"removed "+e+" after it exceeded its maximum duration")});s=t();if(s<1){clearTimeout(e);e=null}},getTypersInChannel:function e(i){var t=_.map(n(i),TS.members.getMemberById);t.sort(function(e,i){if(TS.members.getPrefCompliantMemberNameLowerCase(e)<TS.members.getPrefCompliantMemberNameLowerCase(i))return-1;if(TS.members.getPrefCompliantMemberNameLowerCase(e)>TS.members.getPrefCompliantMemberNameLowerCase(i))return 1;return 0});return t}});var e=null;var i=TS.redux.bindSelectorToStore("TS.interop.redux.features.typing.getTypingByKey");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.typing.getNumberOfRecords");var n=TS.redux.bindSelectorToStore("TS.interop.redux.features.typing.getTyperIdsInChannel");var a=TS.redux.bindSelectorToStore("TS.interop.redux.features.typing.getAllTyping");var r=47})()},4958:function(e,i){(function(){TS.registerModule("ui.channel_options_dialog",{c_id:null,params:null,preselected_section:null,start:function i(t,n,a){TS.ui.channel_options_dialog.c_id=t;TS.ui.channel_options_dialog.preselected_section=n;TS.ui.channel_options_dialog.params=a;e()},promiseToGetWhoCanPostListData:function e(i){return function(e,a){if("@"===e.charAt(0))e=e.substring(1);return n(t,{user:i},e,a)}}});var e=function e(){var i=TS.shared.getModelObById(TS.ui.channel_options_dialog.c_id);if(!i){var t=TS.i18n.t("Oops! No channel found???","channel_options")();TS.generic_dialog.alert('<p class="no_bottom_margin">'+t+"</p>");return}var n=TS.permissions.channels.canSeeConvertToPrivateOption(i);var a=TS.permissions.channels.canSeeArchiveChannelOption(i);var r=TS.permissions.channels.canSeeDeleteChannelOption(i);var s=TS.permissions.channels.canSeeRenameChannelOption(i);var o=!TS.permissions.members.canPostInModelOb(TS.model.user,i);var l=TS.permissions.channels.canSeePurposeChannelOption(i);var d=TS.permissions.channels.canSeeDataRetentionChannelOption(i);var c=TS.permissions.channels.canSeeManagePostingPermissionsChannelOption(i);var _=TS.permissions.channels.canSeeManageTeamAccessToChannelOption(i);var u=TS.permissions.channels.canSeeDisconnectChannelOption(i);var m=TS.shared.isModelObShared(i)||TS.shared.isModelObPendingShared(i);var f=TS.permissions.channels.canSeeShareChannelOption(i);var h=TS.permissions.members.canExportMessageHistory(i);var g=document.getElementById("channel_options_dialog_mount_point");var p={additionalParams:TS.ui.channel_options_dialog.params,channelId:i.id,disableConvertToPrivate:m,disableRename:o,onCancel:function e(){return Promise.resolve().then(function(){if(g)TS.interop.unmountChannelOptions(g)})},preselectedSection:TS.ui.channel_options_dialog.preselected_section,showArchive:a,showConvertToPrivate:n,showDataRetention:d,showDelete:r,showExport:h,showManageOrgAccess:_,showPostingPermissions:c,showPurpose:l,showRename:s,showShareExternal:f,showStopShareExternal:u};TS.interop.mountChannelOptions(TS.boot_data.team_id,g,p)};var i="1.";var t={};var n=function e(t,n,a){if(t.query!==a)t=_.merge(t,{query:a,include_org:TS.boot_data.page_needs_enterprise,include_slackbot:false,include_self:true,full_profile_filter:true,include_bots:false,all_of_org:true,org_team_ids:[]});return Promise.resolve(t).then(function(e){var t=n.user||[];return TS.members.ensureMembersArePresent(t).then(function(){return TS.members.promiseToSearchMembers(e).then(function(e){var n=[];if(""===e.query)n=TS.members.getMembersForUser();else n=e.items;e.items=n.map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:i+e.id,id:i+e.id,preselected:t&&t.indexOf(e.id)>-1}});e.replace_all_items=true;return e})})})}})()},4959:function(e,i){(function(){TS.registerModule("ui.share_channel_dialog",{start:function e(i){if(!TS.model.team.plan)return;i=i||{};if(!TS.permissions.members.canCreateSharedChannel()){TS.ui.share_channel_dialog.showFindAnAdminDialog({show_slackbot_prompt:true,channel:i.model_ob||null});return}if(!i.model_ob)g(i);else p(i.model_ob);U({event:i.model_ob?c.share_existing_modal_open:c.create_new_modal_open,element:i.element})},showFindAnAdminDialog:function e(i){i=i||{};var t=TS.i18n.t("Only admins can share and unshare channels. If you’d like to stop sharing {channel_name} with {team_name}, you’ll need to ask one of the admins below.","shared_channels")({channel_name:"#test",team_name:"Test Team"});var n=TS.i18n.t("Only admins can unshare and archive channels. If you’d like to archive {channel_name} with {team_name}, you’ll need to ask one of the admins below.","shared_channels")({channel_name:"#test",team_name:"Test Team"});var a=TS.i18n.t("Only admins can share and unshare channels. If you’d like to share {channel_name} with another workspace, you’ll need to ask one of the admins below.","shared_channels")({channel_name:"#test"});var r={is_admin_only_mode:true,title:TS.i18n.t("Find an admin","shared_channels")(),subtitle:TS.i18n.t("Only admins can share and unshare channels. If you’d like to share a channel, you’ll need to ask one of the admins below.","shared_channels")()};if(i.show_slackbot_prompt)r.submit_callback=function(){B(i.channel)};TS.ui.im_browser.start(r)},showApproveRequestDialog:function e(i){var t=function e(i,t){if(i){s=d.review_shared_channel_request;if(t.invite.offer_trial)r=true;var n={inviter:t.invite.user,inviting_team:t.invite.team,team:TS.model.team,channel_name:t.invite.channel_name,custom_message:t.invite.custom_message,show_free_trial:r};o.invite_id=t.invite.id;o.channel_id=t.invite.channel;var a=TS.i18n.t("Accept & Add Channel","shared_channels")();if(TS.boot_data.feature_shared_channel_free_trial_flow)if(r)a=TS.i18n.t("Start Trial & Accept","shared_channels")();else a=TS.i18n.t("Accept & Add Channel","shared_channels")();var l=TS.templates.channel_share_dialog_request(n);TS.ui.fs_modal.start({body_template_html:l,footer_html:TS.templates.shared_channels_help_content(),modal_class:"fs_modal_footer",show_cancel_button:true,show_go_button:true,go_button_text:a,go_button_class:"ladda-button",onShow:C,onEnd:h})}};TS.api.callImmediately("channels.sharedInviteInfo",{invite:i}).then(function(e){var i=e.data,n=e.args,a=e.request_id;var r=true;t(r,i,n,a);return{data:i,args:n,request_id:a}}).catch(function(e){var i=e.data,n=e.args,a=e.request_id;var r=false;t(r,i,n,a);return{data:i,args:n,request_id:a}})},test:function i(){var n={};Object.defineProperty(n,"_generateTemplateArgs",{get:function e(){return E},set:function e(i){E=i}});Object.defineProperty(n,"_onSubmitShare",{get:function e(){return S},set:function e(i){S=i}});Object.defineProperty(n,"_ladda",{get:function e(){return a},set:function e(i){a=i}});Object.defineProperty(n,"$_modal",{get:function i(){return e},set:function i(t){e=t}});Object.defineProperty(n,"$_buttons",{get:function e(){return t},set:function e(i){t=i}});return n}});var e;var i={};var t={};var n={};var a;var r;var s;var o={};var l={};var d={new_shared_channel_create:"new_shared_channel_create",new_shared_channel_invite:"new_shared_channel_invite",share_existing_channel:"share_existing_channel",review_shared_channel_request:"review_shared_channel_request"};var c={create_new_modal_open:"SHARED_CHANNELS_CREATE_NEW_MODAL_OPEN",share_existing_modal_open:"SHARED_CHANNELS_SHARE_EXISTING_MODAL_OPEN",create_new_modal_action:"SHARED_CHANNELS_CREATE_NEW_MODAL_ACTION",share_existing_modal_action:"SHARED_CHANNELS_SHARE_EXISTING_MODAL_ACTION",review_invite_modal_action:"SHARED_CHANNELS_REVIEW_INVITE_MODAL_ACTION",nonadmin_action:"SHARED_CHANNELS_NONADMIN_ACTION",api_error:"SHARED_CHANNELS_INVITE_SENT_ERROR"};var u=["invalid_name_required","invalid_name_punctuation","invalid_name_maxlength","invalid_name_specials","name_taken"];var m={default:"#555459",orange:"#ffa800",green:"#2ab27b"};var f=/^https?:\/\/|www\.|(\.dev(\d+)?)|\.staging|\.qa|(\.slack\.com.*$)/g;var h=function d(){if(t.cancel)t.cancel.off();if(t.submit)t.submit.off();if(i.channel_name)i.channel_name.off();if(i.email_address)i.email_address.off();if(i.team_url)i.team_url.off();if(i.free_trial_checkbox)i.free_trial_checkbox.off();e=null;i={};t={};n={};a=null;r=false;s={};o={};l={}};var g=function e(i){s=d.new_shared_channel_create;var t=E(i);var n=TS.templates.channel_share_dialog_create(t);TS.ui.fs_modal.start({body_template_html:n,footer_html:TS.templates.shared_channels_help_content(),onShow:function e(){A();M()},modal_class:"fs_modal_footer",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Next","shared_channels")(),go_button_class:"ladda-button",modal_contents_container_class:"p-share_channel_dialog__container",onGo:function e(){return false},onEnd:h})};var p=function i(t){s=d.share_existing_channel;var n=new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(t)+_.escape(t.name));var a=E({channel_name:n});var r=TS.templates.channel_share_dialog_invite_wrapper(a);TS.ui.fs_modal.start({body_template_html:r,onShow:function i(){TS.ui.fs_modal.bindBackButton(function(){TS.ui.fs_modal.close(true);TS.ui.channel_options_dialog.start(t.id)});TS.ui.fs_modal.showBackButton();e=$("#fs_modal");k();M()},modal_class:"channel_options_modal",show_cancel_button:false,show_go_button:false,modal_contents_container_class:"p-share_channel_dialog__container",onEnd:h})};var S=function i(t){e.find("[data-label=shared_channel_form_error]").addClass("hidden");var n={target_domain:t.target_domain,email:t.email};if(t.custom_message)n.custom_message=t.custom_message;if(t.model_ob)n.channel=t.model_ob.id;else if(t.channel_name)n.channel_name=t.channel_name;if(TS.boot_data.feature_esc_connecting_private_shared_channels&&t.is_private)n.is_private=true;var r=function e(i,t){if(i){TS.channels.upsertChannel(t.channel);TS.teams.upsertTeam(t.team);a.stop();TS.channels.displayChannel({id:t.channel.id});if(l.selected_invite_ids&&l.selected_invite_ids.length)TS.api.call("conversations.invite",{channel:t.channel.id,users:l.selected_invite_ids.join(",")});if(s===d.share_existing_channel)h();TS.ui.fs_modal.close()}else v(n,t)};TS.api.call("conversations.inviteShared",n).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;r(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;r(a,i,t,n);return{data:i,args:t,request_id:n}});return false};var T=function t(){e.find("[data-label=shared_channel_form_error]").addClass("hidden");var n={invite_id:o.invite_id};if(r&&i.free_trial_checkbox.length&&i.free_trial_checkbox.is(":checked"))O(n);else b(n)};var v=function e(t,n){a.stop();var r=TS.ui.validation.getErrorMessage("");U({event:c.api_error,contexts:{core:{shared_channels_invite_target_domain:t.target_domain,shared_channels_invite_error_msg:n.error}}});if(_.includes(u,n.error)&&s===d.new_shared_channel_invite){r=TS.ui.validation.getErrorMessage(n.error,{maxlength:22,name:t.channel_name});x();TS.ui.validation.showWarning(i.channel_name,r,{})}else if(n.error)switch(n.error){case"invalid_email":r=TS.ui.validation.getErrorMessage("invalid_email");TS.ui.validation.showWarning(i.channel_name,r,{});break;case"url_in_message":r=TS.ui.validation.getErrorMessage("url_in_message");TS.ui.validation.showWarning(i.custom_message,r,{});break;case"invalid_target_domain":case"shared_channel_invites_disabled":case"not_in_shared_channels_beta":case"target_team_is_enterprise":r=TS.templates.channel_share_dialog_error({error:n.error,target_domain:t.target_domain});y(r,{is_html:true});break;default:r=TS.ui.validation.getErrorMessage(n.error);y(r)}else y(r)};var b=function e(t){var n=i.channel_name.val().trim();if(n)t.channel_name=n;var r=i.invite_people.lazyFilterSelect("value");r=_.map(r,"member.id");if(TS.boot_data.feature_esc_connecting_private_shared_channels){var s="private"===i.privacy.filter(":checked").val();if(s)t.is_private=true}var o=function e(i,n){if(i){a.stop();TS.channels.displayChannel({id:n.channel.id});if(r.length)TS.api.call("conversations.invite",{channel:n.channel.id,users:r.join(",")});TS.ui.fs_modal.close()}else w(t,n)};TS.api.call("conversations.acceptSharedInvite",t).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;o(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;o(a,i,t,n);return{data:i,args:t,request_id:n}})};var w=function e(t,n){a.stop();var r=TS.ui.validation.getErrorMessage(n.error,{maxlength:22,name:t.channel_name});if(_.includes(u,n.error))TS.ui.validation.showWarning(i.channel_name,r,{});else y(r)};var y=function i(t,n){n=n||{};if(n.is_html)e.find("[data-label=shared_channel_form_error_label]").html(t);else e.find("[data-label=shared_channel_form_error_label]").text(t);e.find("[data-label=shared_channel_form_error]").removeClass("hidden")};var A=function a(){e=$("#fs_modal");i.privacy=e.find('input[name="channel_privacy"]');i.channel_name=e.find('[data-input="channel_name"]');i.invite_people=$("#invite_people_picker");n.channel_name=e.find('label[for="channel_name"]');n.privacy_alert=e.find($('[data-alert="private_channel"]'));t.cancel=e.find(".dialog_cancel");t.submit=e.find(".dialog_go");i.privacy.bind("change",function(){var t="private"===i.privacy.filter(":checked").val();n.privacy_alert.toggleClass("hidden",!t);e.find(".public_channel_item").toggleClass("hidden",t);e.find(".private_channel_item").toggleClass("hidden",!t)}).trigger("change");TS.utility.disableElement(t.submit,!i.channel_name.val().trim());i.channel_name.bind("input",function(){var e=!i.channel_name.val().trim();TS.utility.disableElement(t.submit,e)});P(l.selected_invite_ids);i.channel_name.focus()};var k=function a(){var r=s===d.share_existing_channel;i.email_address=e.find('[data-input="email_address"]');i.team_url=e.find('[data-input="team_url"]');i.custom_message=e.find('[data-input="custom_message"]');n.email_address=e.find('label[for="email_address"]');n.team_url=e.find('label[for="team_url"]');t.cancel=r?e.find(".cancel_share"):e.find(".dialog_cancel");t.submit=r?e.find(".submit"):e.find(".dialog_go");if(r)t.cancel.click(function(){h();TS.ui.fs_modal.close()});var o=!i.email_address.val().trim()||!i.team_url.val().trim();TS.utility.disableElement(t.submit,o);i.email_address.add(i.team_url).bind("input",function(){var e=!i.email_address.val().trim()||!i.team_url.val().trim();TS.utility.disableElement(t.submit,e)});i.team_url.bind("input",D);i.email_address.focus()};var C=function a(){e=$("#fs_modal");i.privacy=e.find('input[name="channel_privacy"]');i.channel_name=$('[data-input="channel_name"]');i.invite_people=$("#invite_people_picker");n.channel_name=$('label[for="channel_name"]');t.cancel=e.find(".dialog_cancel");t.submit=e.find(".dialog_go");i.privacy.bind("change",function(){var t="private"===i.privacy.filter(":checked").val();e.find(".public_channel_item").toggleClass("hidden",t);e.find(".private_channel_item").toggleClass("hidden",!t)}).trigger("change");P();M();if(r)F()};var M=function e(){if(!a)a=Ladda.create(t.submit[0]);t.submit.click(function(){a.start();switch(s){case d.new_shared_channel_create:a.stop();U({element:"SHARED_CHANNELS_CREATE_NEW_MODAL_NEXT_BTN"});I();break;case d.new_shared_channel_invite:U({element:"SHARED_CHANNELS_CREATE_NEW_MODAL_SUBMIT_BTN",contexts:{core:{shared_channels_invite_target_domain:i.team_url.val()}}});S({channel_name:l.channel_name,is_private:l.is_private,target_domain:i.team_url.val(),email:i.email_address.val(),custom_message:i.custom_message.val()});break;case d.share_existing_channel:U({element:"SHARED_CHANNELS_SHARE_EXISTING_MODAL_SUBMIT_BTN",contexts:{core:{shared_channels_invite_target_domain:i.team_url.val(),channel_id:TS.shared.getActiveModelOb().id}}});S({model_ob:TS.shared.getActiveModelOb(),target_domain:i.team_url.val(),email:i.email_address.val(),custom_message:i.custom_message.val()});break;case d.review_shared_channel_request:U({element:"SHARED_CHANNELS_REVIEW_INVITE_MODAL_SUBMIT_BTN",contexts:{core:{shared_channels_invite_id:o.invite_id}}});T();break;default:a.stop()}})};var I=function n(){l.is_private="private"===i.privacy.filter(":checked").val();l.channel_name=i.channel_name.val();l.selected_invite_ids=_.map(i.invite_people.lazyFilterSelect("value"),"member.id");TS.ui.fs_modal.bindBackButton(x);TS.ui.fs_modal.showBackButton();var a=E({email_address:l.email_address,team_url:l.team_url,custom_message:l.custom_message});var r=TS.templates.channel_share_dialog_invite(a);e.find(".contents").html(r);var o=TS.i18n.t("Create & Invite","shared_channels")();t.submit.find(".ladda-label").text(o);s=d.new_shared_channel_invite;k()};var x=function n(){l.email_address=i.email_address.val();l.team_url=i.team_url.val();l.custom_message=i.custom_message.val();TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();var a=E({channel_name:l.channel_name,is_private:l.is_private});var r=TS.templates.channel_share_dialog_create(a);e.find(".contents").html(r);var o=TS.i18n.t("Next","shared_channels")();t.submit.find(".ladda-label").text(o);s=d.new_shared_channel_create;A()};var E=function e(i){i=i||{};return{sharing_existing_channel:s===d.share_existing_channel,show_heading:s===d.new_shared_channel_create||s===d.new_shared_channel_invite,inviter:TS.model.user,team:TS.model.team,channel_name:i.channel_name||null,is_private:!!i.is_private,email_address:i.email_address||null,team_url:i.team_url||null,custom_message:i.custom_message||null}};var B=function e(i){var t=TS.i18n.t("Be sure to let your admin know the name of the channel (*{channel_name}*) you’d like to stop sharing.","shared_channels")({channel_name:"test"});var n=TS.i18n.t("Be sure to let your admin know the name of the channel (*{channel_name}*) you’d like to stop sharing and archive.","shared_channels")({channel_name:"test"});var a;if(i)a=TS.i18n.t("To share this channel, your admin needs a few pieces of info:\n• The name of the channel you want to share (*{channel_name}*).\n• The email address of an admin at the other workspace.\n• The other workspace’s Slack URL.","shared_channels")({channel_name:TS.shared.getDisplayNameForModelOb(i)});else a=TS.i18n.t("To share a channel, your admin needs a few pieces of info:\n• Who you want to share with, and why.\n• The email address of an admin at the other workspace.\n• The other workspace’s Slack URL.","shared_channels")();TS.client.ui.addEphemeralBotMsg({text:a})};var P=function e(i){var t=TS.i18n.t("Find people...","shared_channels")();var n={include_self:false,include_slackbot:false,include_bots:false,only_local_team:true,placeholder_text:t};if(i)n.preselected_ids=i;TS.ui.people_picker.make($("#invite_people_picker"),n)};var D=function e(){if(!i.team_url.length)return;var t=i.team_url.val().trim();if(!t)return;if(!f.test(t))return;var n=t.replace(f,"");var a=i.team_url[0];a.style.color=m.orange;a.style.transition="color 0.2s ease-out 0s";setTimeout(function(){a.value=n;a.style.color=m.green;a.style.transition="color 0.2s ease-out 0s"},300);setTimeout(function(){a.style.color=m.default;a.style.transition="color 0.6s ease-out 0.3s"},500)};var U=function e(i){if(!i||!_.isObject(i))return;var t=i.event;if(!i.event)switch(s){case d.new_shared_channel_create:case d.new_shared_channel_invite:t=c.create_new_modal_action;break;case d.review_shared_channel_request:t=c.review_invite_modal_action;break;case d.share_existing_channel:t=c.share_existing_modal_action}if(!t)return;var n={event:t};if(i.element)n.element=i.element;if(i.contexts)n.contexts=i.contexts;TS.clog.trackClickWithContext(n)};var F=function n(){TS.utility.disableElement(t.submit,r);var a=e.find("#free_trial_container");e.find(t.submit).wrap('<div id="scroll_and_flash"></div>');e.find("#scroll_and_flash").click(function(){document.getElementById("free_trial_container").scrollIntoView(true);setTimeout(function(){a.toggleClass("sk_white_bg")},400);setTimeout(function(){a.toggleClass("sk_white_bg")},850)});i.free_trial_checkbox=e.find("#free_trial_checkbox");e.find(i.free_trial_checkbox).change(function(){e.find("#free_trial_checkbox_alert").toggleClass("hidden");TS.utility.disableElement(t.submit,!this.checked);if(!this.checked){e.find(t.submit).wrap('<div id="scroll_and_flash"></div>');e.find("#scroll_and_flash").click(function(){document.getElementById("free_trial_container").scrollIntoView(true);setTimeout(function(){a.toggleClass("sk_white_bg")},400);setTimeout(function(){a.toggleClass("sk_white_bg")},850)})}else e.find("#scroll_and_flash").replaceWith(function(){return e.find(t.submit)})})};var O=function e(i){TS.api.call("promocodes.campaigns.redeem",{type:"esc_trial"}).then(function(){b(i)}).catch(function(){a.stop();var e;if(TS.boot_data.feature_shared_channel_free_trial_flow)e=TS.i18n.t('<b>Couldn’t start trial</b>. For some reason, Slack couldn’t start a free trial for your workspace. You may want to <a href="https://slack.com/help/contact" target="_blank" data-clog-event="" data-clog-ui-element="" data-clog-ui-action="click" data-clog-ui-step="">contact support</a>.',"shared_channels");y(e,{is_html:true});document.querySelectorAll("[data-label=shared_channel_form_error]")[0].scrollIntoView(true)})}})()},4960:function(e,i){(function(){TS.registerModule("ui.at_channel_warning_dialog",{$div:null,showing:false,onKeydown:function e(i){if(!TS.ui.at_channel_warning_dialog.showing)return;switch(i.which){case TS.utility.keymap.esc:TS.ui.at_channel_warning_dialog.cancel();break;case TS.utility.keymap.enter:i.preventDefault();TS.ui.at_channel_warning_dialog.go()}},start:function n(a,r,s,o,l,d){if(!TS.ui.at_channel_warning_dialog.$div)TS.ui.at_channel_warning_dialog.build();if(TS.ui.at_channel_warning_dialog.showing)return;var c=TS.ui.at_channel_warning_dialog.$div;e=l;i=a;var _=TS.format.cleanMsg(r);var u="";if(TS.model.everyone_regex.test(_))u=TS.templates.builders.atLabel("everyone");else if(TS.model.channel_regex.test(_))u=TS.templates.builders.atLabel("channel");else if(TS.model.group_regex.test(_))u=TS.templates.builders.atLabel("group");if(s<t){TS.ui.at_channel_warning_dialog.go();return}var m=TS.templates.at_channel_warning_dialog({keyword:u,member_count:s,timezone_count:o});c.html(m);if(d)c.addClass("fullsize");else c.removeClass("fullsize");c.modal("show");TS.ui.a11y.saveCurrentFocusAndFocusOnElement(c);c.find(".dialog_cancel").click(TS.ui.at_channel_warning_dialog.cancel);c.find(".dialog_go").click(TS.ui.at_channel_warning_dialog.go);$(window).bind("resize",TS.ui.at_channel_warning_dialog.position);TS.ui.at_channel_warning_dialog.position();TS.prefs.setPrefByAPI({name:"last_seen_at_channel_warning",value:Date.now()})},startInMessagePane:function e(i,t,a){var r=TS.shared.getModelObById(i);if(!r||r.is_im)return;var s=n(r);var o=function e(){TS.view.clearMessageInput();TS.shared.sendMsg(i,t,a)};var l=TS.client.ui.$msg_input;var d=true;TS.client.msg_input.populate(t);s.then(function(e){TS.ui.at_channel_warning_dialog.start(l,t,e.member_count,e.timezone_count,o,d)})},startInFlexPane:function e(i,t,a){if(!i){TS.error("no file to warn about!");return}var r=function e(){var i=true;TS.client.ui.files.submitFileComment(i)};var s=$("#file_comment_form #file_comment");var o=false;var l=n(i);l.then(function(e){TS.ui.at_channel_warning_dialog.start(s,a,e.member_count,e.timezone_count,r,o)})},position:function e(){var t=TS.ui.at_channel_warning_dialog.$div;var n=i.offset();t.css({top:n.top-t.height()-8,left:n.left})},go:function i(){TS.ui.at_channel_warning_dialog.$div.modal("hide");e()},cancel:function e(){TS.ui.at_channel_warning_dialog.$div.modal("hide");TS.ui.a11y.restorePreviousFocus()},end:function e(){TS.model.dialog_is_showing=false;TS.ui.at_channel_warning_dialog.showing=false;$(window.document).unbind("keydown",TS.ui.at_channel_warning_dialog.onKeydown);$(window).unbind("resize",TS.ui.at_channel_warning_dialog.position)},build:function e(){$("body").append('<div id="at_channel_warning_dialog" class="modal hide fade"></div>');TS.ui.at_channel_warning_dialog.$div=$("#at_channel_warning_dialog");var i=TS.ui.at_channel_warning_dialog.$div;i.on("hide",function(e){if(e.target!=this)return;TS.ui.at_channel_warning_dialog.end()});i.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.at_channel_warning_dialog.showing=true});i.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){$(window.document).bind("keydown",TS.ui.at_channel_warning_dialog.onKeydown)},100)})}});var e=function e(){};var i;var t=5;var n=function e(i){var t=false;var n="conversations.info";var a={timezone_count:true,display_counts:true};if(i.is_group)a.channel=i.id;else if(i.is_channel){a.channel=i.id;a.no_members=true}else{t=true;n="files.info";a.file=i.id}return TS.api.call(n,a).then(function(e){var n;var a;if(t){n=_.get(e,"data.display_counts.display_counts")||1;a=e.data.timezone_count}else{n=(i.is_group?_.get(e,"data.group.display_counts.display_counts"):_.get(e,"data.channel.display_counts.display_counts"))||1;a=i.is_group?e.data.group.timezone_count:e.data.channel.timezone_count}n-=1;return{member_count:n,timezone_count:a}}).catch(function(){return{member_count:0,timezone_count:1}})}})()},4961:function(e,i){(function(){TS.registerModule("client.archives",{current_model_ob:null,not_member:false,$scroller:$("#archive_msgs_scroller_div"),$archives_msgs_div:$("#archives_msgs_div"),msgs_are_auto_scrolling:false,active_highlight_count:0,msgs_scrolled_sig:new signals.Signal,onStart:function i(){if(TS.boot_data.feature_sli_channel_insights){TS.client.flexpane_display_switched_sig.add(R);TS.view.members.unknown_resolution_rebuild_sig.add(function(){if(!TS.model.archive_view_is_showing)return;var e=TS.shared.getActiveModelOb();p(e)})}if(TS.useReactMessages()){y();e=$();return}TS.shared.msg_sent_sig.add(B);TS.channels.joined_sig.add(M);TS.groups.unarchived_sig.add(I);TS.channels.unarchived_sig.add(x);TS.channels.archived_sig.add(E);TS.channels.message_removed_sig.add(P);TS.channels.message_changed_sig.add(D);TS.groups.message_removed_sig.add(P);TS.groups.message_changed_sig.add(D);TS.ims.message_removed_sig.add(P);TS.ims.message_changed_sig.add(D);TS.mpims.message_removed_sig.add(P);TS.mpims.message_changed_sig.add(D);var t=_.throttle(U,1e3);TS.view.members.unknown_resolution_rebuild_sig.add(t);if(!TS.environment.supports_custom_scrollbar)TS.client.archives.$scroller.monkeyScroll({always_show:true});e=$("#monkey_scroll_wrapper_for_archive_msgs_scroller_div");e.addClass("hidden");$("#archives_return").addClass("hidden").removeClass("warning").find(".cancel_archives").addClass("hidden");y()},start:function _(f){if(TS.useReactMessages())return;var S=TS.shared.getActiveModelOb();$("#archives_end_div_msg_lim").addClass("hidden");if(!S){TS.warn("WTF no model_ob in TS.client.archives.start()");return}if(TS.client.archives.getCurrentModelOb())if(S.id==TS.client.archives.getCurrentModelOb().id){if(f&&f==i){if(S._archive_msgs&&TS.utility.msgs.getMsg(f,S._archive_msgs))C(i);return}if(f){if(S._archive_msgs&&TS.utility.msgs.getMsg(f,S._archive_msgs)){i=f;C(i);return}}else{TS.info("no change requested in TS.client.archives.start()");return}}else w();var T=TS.i18n.t("Loading...","archives")();TS.client.archives.$archives_msgs_div.html('<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+T+'" /><br />'+T+"</div>");c=S.id+(f||"");i=f||null;TS.client.archives.current_model_ob=S;TS.client.archives.not_member=S.is_channel&&(!S.is_member||S.is_archived)||S.is_group&&S.is_archived;S.never_needs_joined_msg=true;p(TS.client.archives.getCurrentModelOb());$("#client-ui").addClass("archive_view_is_showing");e.removeClass("hidden");TS.client.archives.$scroller.removeClass("hidden");var y={channel:S.id,count:50,_showing_id:c,ignore_replies:true,include_pin_count:true};var A=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(A)y._x_reason=A;t=false;n=false;a=0;r=0;s=null;o=null;l=false;d=false;b();v();var k=function e(t,n,s){if(!t){if(s._showing_id!=c)return false;w();if("channel_not_found"===n.error){TS.error("Tried opening channel archives for an invalid channel!",n,s);return}TS.client.archives.start(null,true)}if(!g(t,n,s))return;if(r!=a)return;var l=TS.utility.msgs.getMsg(i,S._archive_msgs);if(l&&TS.utility.msgs.isMsgReply(l)){TS.ui.replies.openConversation(S,l.thread_ts,l.ts);if(!S.is_channel||S.is_member){w();return}}u();var d=TS.client.archives.$scroller;var _=function e(){TS.client.archives.msgs_are_auto_scrolling=true;d.scrollTop(d[0].scrollHeight);TS.client.archives.msgs_are_auto_scrolling=false;var t=i;var n=true;if(!l){var a=TS.utility.msgs.getDisplayedMsgAfterTS(i,S._archive_msgs);if(a&&a.ts)t=a.ts;n=false}if(i)TS.client.ui.scrollMsgsSoMsgIsInView(t,false,n)};_();if(o)return;if(TS.client.archives.$archives_msgs_div.find(".message").length>=20)return;var f=true;m(function(){_()},f)};if(i){var M={channel:S.id,count:50,oldest:i,inclusive:true,_showing_id:c,ignore_replies:true,include_pin_count:true};if(A)M._x_reason=A;y.latest=i;y.count=25;a=2;TS.api.callImmediately("conversations.history",M).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;if(k)k(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;if(k)k(a,i,t,n);return{data:i,args:t,request_id:n}});TS.api.callImmediately("conversations.history",y).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;if(k)k(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;if(k)k(a,i,t,n);return{data:i,args:t,request_id:n}}).then(function(e){if(e&&true===e.data.is_limited&&S)S.is_limited=true})}else{a=1;setTimeout(function(){if(!TS.model.archive_view_is_showing)return;if(i)return;TS.api.callImmediately("conversations.history",y).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;if(k)k(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;if(k)k(a,i,t,n);return{data:i,args:t,request_id:n}}).then(function(){h(y)})},20)}if(!i&&S.was_archived_this_session){S.was_archived_this_session=false;if(S.is_channel){TS.channels.calcUnreadCnts(S,true);TS.channels.markMostRecentReadMsg(S,TS.model.marked_reasons.none_qualify)}else{TS.groups.calcUnreadCnts(S,true);TS.groups.markMostRecentReadMsg(S,TS.model.marked_reasons.none_qualify)}S.was_archived_this_session=true}TS.model.archive_view_is_showing=true;if(TS.client.archives.not_member)if(!S.is_group){var I={channel:S.id,no_members:true};var x=function e(i,t){if(!TS.model.archive_view_is_showing)return;if(!i){TS.warn("WTF, bad API rsp? error:"+t.error);return}if(!t.channel){TS.warn("WTF, no channel?");return}var n=TS.channels.upsertChannel(t.channel);if(n.id!=TS.client.archives.getCurrentModelOb().id)return;TS.channels.data_updated_sig.dispatch(n)};TS.api.callImmediately("conversations.info",I).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;x(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;x(a,i,t,n);return{data:i,args:t,request_id:n}})}TS.view.resizeManually("TS.client.archives started")},getCurrentModelOb:function e(){return TS.client.archives.current_model_ob},displayCrossWorkspaceAlert:function e(i,t){return F(i,t)},maybeHandleArchiveLink:function e(i,t){if(!TS.client)return false;if(!i||!i.length)return false;if(!i.is("a"))return false;var n=i.prop("href");if(!n)return false;var a=TS.utility.normalizeDevHost(n);var r=TS.utility.getPathFromSlackUrl(a);var s=TS.utility.getTeamFromSlackUrl(a);if(!r)return;var o=-1!==a.indexOf("?")&&TS.interop.url.queryStringParse(a.split("?")[1]);if("1"===_.get(o,"force-browser"))return false;var l={messages:true,archives:true}[r[0]];if(l){if(r.length<2)return false;var d=decodeURIComponent(r[1]);if(!d)return false;var c=TS.shared.getModelObById(d)||TS.ims.getImByUsername(d)||TS.channels.getChannelByName(d)||TS.groups.getGroupByName(d)||TS.mpims.getMpimByName(d);if(!c&&TS.boot_data.feature_cross_team_deeplink&&TS.boot_data.page_needs_enterprise&&s!==TS.model.team.domain){var u=TS.redux.teams.getTeamByDomain(s);if(u&&u.discoverable){F(u,a,_.get(c,"name"));return true}TS.redux.teams.ensureEnterpriseTeamIsKnown(null,{domain:s}).then(function(e){if(!_.get(e,"id"))TS.utility.openInNewTab(a,"_blank");u=e;F(u,a,_.get(c,"name"))}).catch(function(){TS.utility.openInNewTab(a,"_blank")});return true}if(!c){var m=TS.members.getMemberByName(d);if(m){TS.ims.startImByMemberId(m.id);return true}}if(2==r.length||!r[2]){if(c.is_channel)TS.channels.displayChannel({id:c.id});else if(c.is_mpim)TS.mpims.displayMpim({id:c.id});else if(c.is_group)TS.groups.displayGroup({id:c.id});else TS.ims.startImById(c.id);return c.id==TS.model.active_cid}var f=r[2];if(!f)return false;if(0!==f.indexOf("p"))return false;if(17!=f.length)return false;f=f.replace("p","");if(isNaN(f))return false;var h=f.substr(0,10)+"."+f.substr(10);var g;if(c.id==TS.model.active_cid)if(i.hasClass("timestamp"))if(0!==i.closest("#msgs_div").length||0!==i.closest("#archives_msgs_div").length){g=TS.templates.makeMsgDomId(h);if(0!==i.closest("#"+g).length)return true}var p;if(o&&o.thread_ts){if(!isNaN(o.thread_ts)&&-1===o.thread_ts.indexOf(".")&&o.thread_ts.length>10)o.thread_ts=o.thread_ts.substr(0,10)+"."+o.thread_ts.substr(10,6);if(/^\d+\.\d+$/.test(o.thread_ts))p=o.thread_ts}if(p&&p!==h){if(i.hasClass("timestamp"))if(0!==i.closest("#convo_container").length){g=TS.templates.makeMsgDomIdInConversation(h);if(0!==i.closest("#"+g).length)return true}TS.ui.replies.openConversation(c,p,h,t);return true}return TS.client.ui.tryToJump(c.id,h,p)}return false},onMsgsScroll:function e(){if(!TS.model.archive_view_is_showing)return;TS.utility.throttle.method(A,"ts_archives_on_msgs_scroll",250)},maybeLoadScrollBackHistory:function e(){if(TS.client.archives.active_highlight_count||TS.model.ui.is_mouse_down)return;if(r!=a)return;if(t){TS.info("_scrolled_to_bottom _all_loaded_bottom:"+s);if(!s)f()}else if(n){TS.info("_scrolled_to_top _all_loaded_top:"+o);if(!o)m()}},loadMoreBottom:function e(){if(!TS.model.archive_view_is_showing)return;if(!s)f()},loadMoreTop:function e(){if(!TS.model.archive_view_is_showing)return;if(!o)m()},tryToJoin:function e(){if(!TS.model.archive_view_is_showing)return;if(!TS.client.archives.getCurrentModelOb())return;if(!TS.client.archives.getCurrentModelOb().is_channel)return;if(TS.client.archives.getCurrentModelOb().is_archived)return;$("#footer_archives_action_button").trigger("click")},userWantsToCancel:function e(){if(!TS.model.archive_view_is_showing)return;var i=TS.client.archives.getCurrentModelOb();if(i.is_group&&i.is_archived)TS.client.ui.maybePromptForClosingGroup(i.id);else{if(i.was_archived_this_session)i.was_archived_this_session=false;TS.client.archives.cancel()}},cancel:function e(i){if(!TS.model.archive_view_is_showing)return;var t=(TS.client.archives.not_member||TS.ims.isImWithDeletedMember(TS.client.archives.getCurrentModelOb()))&&!i;w(t)},rebuildMsg:function e(i){if(!TS.model.archive_view_is_showing||!TS.client.archives.getCurrentModelOb())return;if(!i)return;var t=TS.client.archives.$archives_msgs_div.find("#"+TS.templates.makeMsgDomId(i.ts));if(!t.length)return;var n=TS.client.archives.getCurrentModelOb();var a=TS.utility.msgs.getPrevDisplayedMsg(i.ts,n._archive_msgs);var r=TS.templates.builders.msgs.buildHTML({msg:i,model_ob:n,prev_msg:a,container_id:"archives_msgs_div",enable_slack_action_links:false});t.replaceWith(r);TS.utility.makeSureAllExternalLinksAreRefererSafe(t)},adjustFooterForArchiveView:function e(i){TS.model.archive_view_is_showing=true;TS.client.archives.current_model_ob=i;$("#client-ui").addClass("archive_view_is_showing");TS.client.archives.not_member=i.is_channel&&(!i.is_member||i.is_archived)||i.is_group&&i.is_archived;p(i)},unAdjustFooterForArchiveView:function e(){TS.model.archive_view_is_showing=false;T();TS.client.archives.current_model_ob=null;$("#client-ui").removeClass("archive_view_is_showing")}});var e=null;var i=null;var t=false;var n=false;var a=0;var r=0;var s=null;var o=null;var l=false;var d=false;var c=false;var u=function e(){TS.metrics.mark("_displayMsgs");var i=TS.client.archives.getCurrentModelOb();if(!i)return;var t=i._archive_msgs;var n=TS.client.archives.$archives_msgs_div;n.empty();var a;var r;var l;var d=TS.boot_data.team_limit_ts>0;var c;if(i){l=TS.utility.msgs.getOlderMsgsStatus(i);c=l.is_limited||l.more}var u=[];var m;var f;var h="";var g=_.reject(t,TS.utility.msgs.isMsgHidden);for(var p=g.length-1;p>-1;p-=1){if(!m||!TS.utility.msgs.isMsgHidden(m))f=m;m=g[p];if(TS.utility.msgs.isMsgHidden(m))continue;var S=TS.utility.msgs.msgRollUpWorker(p,m,g,u);if("continue"===S){m=f;continue}else if("swap"===S){m=u[0];u.length=0}if(!f||!TS.utility.msgs.areMsgsSameDay(m,f)){if(f)h+="</div></div>";h+='<div class="day_container">';h+=TS.templates.messages_day_divider({ts:m.ts});h+='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(m.ts)+'" data-ts="'+m.ts+'">'}h+=TS.templates.builders.msgs.buildHTML({msg:m,model_ob:i,prev_msg:f,container_id:"archives_msgs_div",enable_slack_action_links:false});if(0===p)h+="</div></div>"}n.html(h);TS.utility.makeSureAllExternalLinksAreRefererSafe(n);var T=!s;$("#archives_bottom_div").toggleClass("hidden",!T);$("#archives_return").toggleClass("hidden",!T);if(d&&o&&c&&!i.is_self_im){var v=$("#archive_msg_lim_btn");$(".msg_lim_header_copy").addClass("hidden");if(i.is_im||i.is_mpim||i.is_slackbot_im){$(".msg_lim_dm_h1").removeClass("hidden");$(".msg_lim_dm_h2").removeClass("hidden")}else if(i.is_channel||i.is_group){var b=TS.templates.builders.makeChannelPrefix(i);$(".channel_name_msg_lim").html(b+i.name);$(".msg_lim_channel_h1").removeClass("hidden");$(".msg_lim_channel_h2").removeClass("hidden")}if(i.is_slackbot_im)r=35;else if(i.is_mpim||i.is_im)r=33;else if(i.is_channel||i.is_group)r=34;a=v.attr("href");a=TS.interop.url.setQueryStringValue(a,"ui_element",r);a=decodeURIComponent(a).substr(1);v.attr("href",a);v.data("data-clog-ui-element",r);$("#archives_end_div_msg_lim").removeClass("hidden");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:r}}})}else $("#archives_top_div").removeClass("hidden");TS.client.archives.msgs_are_auto_scrolling=true;A();TS.client.archives.msgs_are_auto_scrolling=false;TS.ui.utility.updateClosestMonkeyScroller(TS.client.archives.$scroller);k();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_archives_display_msgs","_displayMsgs")};var m=function e(i,t){d=true;b();var n=TS.client.archives.getCurrentModelOb();var r=n._archive_msgs[n._archive_msgs.length-1].ts;a+=1;var s={channel:n.id,latest:r,count:parseInt(TS.model.subsequent_msgs_cnt/2,10),_showing_id:c,ignore_replies:true};var o=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(o)s._x_reason=o;var l=function e(n,a,s){if(!g(n,a,s))return;d=false;b();u();if(r&&!t)TS.client.ui.scrollMsgsSoMsgIsInView(r,true,false);if(i)i()};TS.api.callImmediately("conversations.history",s).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;l(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;l(a,i,t,n);return{data:i,args:t,request_id:n}})};var f=function e(){l=true;v();var i=TS.client.archives.getCurrentModelOb();var t=i._archive_msgs[0].ts;a+=1;var n={channel:i.id,oldest:t,count:parseInt(TS.model.subsequent_msgs_cnt/2,10),_showing_id:c,ignore_replies:true};var r=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(r)n._x_reason=r;var s=function e(i,n,a){if(!g(i,n,a))return;l=false;v();u();if(t)TS.client.ui.scrollMsgsSoMsgIsInView(t,false,false,0)};TS.api.callImmediately("conversations.history",n).then(function(e){var i=e.data,t=e.args,n=e.request_id;var a=true;s(a,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var a=false;s(a,i,t,n);return{data:i,args:t,request_id:n}})};var h=function e(i){var t=TS.client.archives.getCurrentModelOb();if(!TS.model.archive_view_is_showing)return;if(i._showing_id!=c)return;if(!t.is_archived)return;var n=TS.utility.msgs.getMostRecentValidTs(t);var a=TS.utility.msgs.getMostRecentValidTs({msgs:t._archive_msgs});var r=n&&a&&n>a;if(r){TS.info("Message history is not most recent; get more.");s=false;f()}};var g=function e(t,n,a){if(!TS.model.archive_view_is_showing)return false;if(a._showing_id!=c)return false;var l=TS.client.archives.getCurrentModelOb();var d=l._archive_msgs;var _=[];var u;var m=false;var f;var h;var g=d&&d.length?d[0]:"";if(g&&!TS.client.msg_pane.getDivForArchiveMsg(g.ts).length)g=null;if(n.messages)for(h=0;h<n.messages.length;h+=1){f=n.messages[h].ts;if(!d||!TS.utility.msgs.getMsg(f,d)){u=n.messages[h];_.push(TS.utility.msgs.processImsgFromHistory(u,l.id))}if(!TS.client.archives.not_member&&!l.is_im&&!m&&TS.utility.msgs.getMsg(f,l.msgs))m=true}l._archive_msgs=d?_.concat(d):_;if(m){_=[];for(h=0;h<l._archive_msgs.length;h+=1)if(!TS.utility.msgs.getMsg(l._archive_msgs[h].ts,l.msgs)){u=l._archive_msgs[h];_.push(u)}TS.utility.msgs.setMsgs(l,_.concat(l.msgs));TS.client.msg_pane.rebuildMsgsWithReason("archive _onHistory");var p;var S;if(g)S=TS.client.archives.$scroller.scrollTop();else p=i;var T=true;w(false,T);if(g)TS.client.ui.$msgs_scroller_div.scrollTop(S);else if(p){var y=TS.utility.msgs.getMsg(p,l.msgs);if(y&&TS.utility.msgs.isMsgReply(y)){TS.ui.replies.openConversation(l,y.thread_ts,y.ts);return false}var A=true;if(!y){var k=TS.utility.msgs.getDisplayedMsgAfterTS(p,l.msgs);if(k&&k.ts)p=k.ts;A=false}TS.client.ui.scrollMsgsSoMsgIsInView(p,false,A)}return false}TS.utility.msgs.sortMsgs(l._archive_msgs);if(a.latest){o=!n.has_more;b()}else if(a.oldest){s=!n.has_more;v()}else{o=!n.has_more;b();s=true;v()}r+=1;return true};var p=function e(i){var t=i.is_channel?"#":"";var n="";if(i.is_channel)n='<ts-icon class="ts_icon_bold_hash_small"></ts-icon>';else if(i.is_group)n='<ts-icon class="ts_icon_lock"></ts-icon>';var a="";a+=TS.templates.builders.maybeMakeSharedIcon(i);$("#footer_archives_action_button").addClass("btn_outline");var r=TS.ims.isImWithDeletedMember(i);if(TS.client.archives.not_member||r){var s;var o;$("#footer_msgs").addClass("hidden");$("#footer").css("height","auto");$("#footer_archives").removeClass("hidden no_tip");if(i.is_archived&&!i.is_im){if(1===i.is_moved)s=TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>, a moved channel","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(i.name,25)),shared:a});else s=TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>, an archived channel","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(i.name,25)),shared:a});o=TS.i18n.t('<strong aria-label="return">Esc</strong> to close',"archives")();$("#footer_archives_text").html(s);$("#footer_archives_action_button").text(TS.i18n.t("Close Channel","archives")());$("#footer_archives_action_tip").html('<span class="tiny dialog_cancel_hint">'+o+"</span>")}else if(r){s=TS.i18n.t('<ts-icon class="ts_icon_archive"></ts-icon> You are viewing the archives of a deactivated account',"archives")();$("#footer_archives").addClass("no_tip");$("#footer_archives_text").html(s);$("#footer_archives_action_button").text(TS.i18n.t("Close","archives")());$("#footer_archives_action_tip").html("")}else if(TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled()){s=TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(i.name,25)),shared:a});var l="";if(i.creator===TS.model.user.id)l=TS.i18n.t("Created by you on {created_at, date, long}","archives")({created_at:1e3*i.created});else{var d=S(i);l=TS.i18n.t("Created by {name} on {created_at, date, long}","archives")({name:d,created_at:1e3*i.created})}$("#footer_archives").addClass("hidden");$("#footer_archives_preview").removeClass("hidden").html(TS.templates.footer_archives_preview({message:new Handlebars.SafeString(s),metadata:new Handlebars.SafeString(l),hide_more_details:TS.model.ui_state.flex_visible&&"details"===TS.model.ui.active_tab_id}))}else{s=TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(i.name,25)),shared:a});o=TS.i18n.t('<strong aria-label="return">Return <span class="return_char">&crarr;</span></strong> to join',"archives")();$("#footer_archives_text").html(s);$("#footer_archives_action_button").text(TS.i18n.t("Join Channel","archives")()).removeClass("btn_outline");$("#footer_archives_action_tip").html('<span class="tiny dialog_cancel_hint">'+o+"</span>")}TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,TS.i18n.t("You are viewing the archives of {hash}{channel_name}","archives")({hash:t,channel_name:i.name}))};var S=function e(i){var t=TS.members.getPotentiallyUnknownMemberById(i.creator);if(t&&t.is_unknown)return new Handlebars.SafeString(TS.templates.unknown_member({id:t.id}));if(t&&TS.utility.teams.isMemberExternal(t)&&TS.teams.getTeamById(t.team_id))return _.escape(TS.i18n.t("{creator_name} from {team_name}","channel_pages")({creator_name:TS.members.getPrefCompliantMemberName(t),team_name:TS.teams.getTeamNameById(t.team_id)}));if(t)return _.escape(TS.members.getPrefCompliantMemberName(t));return TS.i18n.t("unknown","channel_pages")()};var T=function e(){$("#footer_msgs").removeClass("hidden");$("#footer").css("height","");$("#footer_archives").addClass("hidden");$("#footer_archives_preview").addClass("hidden");$("#archives_bottom_div").addClass("hidden");$("#archives_top_div").addClass("hidden");$("#archives_return").addClass("hidden").removeClass("warning");TS.client.archives.$scroller.addClass("hidden");TS.client.msg_input.setPlaceholder();TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div)};var v=function e(){var t;if(l)t=TS.i18n.t("retrieving history...","archives")();else if(s)if(i)t="&nbsp;";else t="";else t='<a onclick="TS.client.archives.loadMoreBottom()">'+TS.i18n.t("and more...","archives")()+"</a>";$("#archives_bottom_div").html(t)};var b=function e(){var i;if(d)i=TS.i18n.t("retrieving history...","archives")();else if(o)i=TS.i18n.t("~FIN~","archives")();else i='<a onclick="TS.client.archives.loadMoreTop()">'+TS.i18n.t("and more...","archives")()+"</a>";$("#archives_top_div").html(i)};var w=function t(n,a){if(!TS.model.archive_view_is_showing)return;if(n&&!TS.client.archives.previous_model_ob)TS.client.archives.previous_model_ob=TS.channels.getGeneralChannel()||TS.ims.getImByMemberId("USLACKBOT");TS.client.archives.$archives_msgs_div.empty();TS.ui.utility.updateClosestMonkeyScroller(TS.client.archives.$scroller);e.addClass("hidden");if(TS.client.archives.getCurrentModelOb())TS.client.archives.getCurrentModelOb()._archive_msgs=void 0;i=null;TS.client.archives.current_model_ob=null;TS.model.archive_view_is_showing=false;$("#client-ui").removeClass("archive_view_is_showing");T();TS.view.resizeManually("TS.client.archives ended");if(TS.boot_data.feature_initial_scroll_position&&!n&&!a)TS.client.msg_pane.setInitialScrollPosition(-1);if(!TS.boot_data.feature_initial_scroll_position&&!a&&TS.prefs.getPref("start_scroll_at_oldest")&&TS.shared.getActiveModelOb().unread_cnt)setTimeout(TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView,100);else TS.client.msg_pane.checkUnreads();if(n){var r=TS.client.archives.previous_model_ob;delete TS.client.archives.previous_model_ob;if(r.is_channel)TS.channels.displayChannel({id:r.id});else if(r.is_mpim)TS.mpims.displayMpim({id:r.id});else if(r.is_group)TS.groups.displayGroup({id:r.id});else TS.ims.startImById(r.id)}};var y=function e(){$("#footer").on("click","[data-js=join_channel]",function(){if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var e=TS.client.archives.getCurrentModelOb();if(e.is_channel)if(e.is_archived)TS.channels.closeArchivedChannel(e.id);else TS.channels.joinById(e.id,function(){TS.shared.maybeFetchHistory(e);TS.client.msg_pane.maybeSetupCalls()});else if(e.is_im){TS.ims.closeIm(e.id);w(true)}else TS.shared.closeArchivedChannel(e.id)});$("#footer").on("click","[data-js=see_more_details]",function(){TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showAboutSection();var e=TS.shared.getActiveModelOb().id;TS.clog.track("CHANNEL_SEE_MORE_DETAILS_BUTTON_CLICK",{channel_id:e,channel_type:e.charAt(0)})});TS.client.archives.$scroller.scroll(function(){TS.client.archives.onMsgsScroll()});$("#archives_return .archives_return__link-column__link").bind("click",function(){if(TS.client.archives.not_member)if(s)TS.client.ui.slowScrollMsgsToBottom();else{w();TS.client.archives.start()}else w()});TS.client.ui.$msg_input.bind("textchange",function(){if(!TS.model.archive_view_is_showing)return;if(TS.client.archives.not_member)return;var e=$(this);if(""===e.val())$("#archives_return").removeClass("warning");else $("#archives_return").addClass("warning")})};var A=function e(){if(!TS.model.archive_view_is_showing)return;TS.client.archives.msgs_scrolled_sig.dispatch();var i;n=false;t=false;if(TS.client.ui.areMsgsScrolledToBottom(0)){i=-1;t=true}else{i=TS.client.archives.$scroller[0].scrollTop;if(0===i)n=true}var a=TS.client.ui.areMsgsScrolledToBottom(50);$("#archives_return").find(".cancel_archives").toggleClass("hidden",!!a&&s);if(TS.client.archives.msgs_are_auto_scrolling)return;TS.client.ui.checkInlineImgsAndIframes("archives");TS.client.archives.maybeLoadScrollBackHistory()};var k=function e(){var i=TS.client.archives.$scroller.find(".message");var t=[];if(i.length){var n={shortenMonth:true};t.push(TS.interop.datetime.toCalendarDate(i.eq(0).data("ts"),n));if(i.length>1){var a=TS.interop.datetime.toCalendarDate(i.eq(i.length-1).data("ts"),n);if(a!=t[0])t.push(a)}$("#archives_return_date").text(t.join(" - "))}};var C=function e(i){if(TS.client.archives.getCurrentModelOb()){var t=TS.client.archives.getCurrentModelOb();var n=TS.utility.msgs.getMsg(i,t._archive_msgs);if(n&&TS.utility.msgs.isMsgReply(n)){TS.ui.replies.openConversation(t,n.thread_ts,n.ts);return}}TS.client.ui.scrollMsgsSoMsgIsInView(i,false,true)};var M=function e(i){if(!TS.model.archive_view_is_showing)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;TS.client.archives.not_member=false;TS.client.archives.cancel();TS.client.ui.instaScrollMsgsToBottom(false)};var I=function e(i){if(!TS.model.archive_view_is_showing)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;TS.client.archives.not_member=false;TS.client.archives.cancel();TS.client.ui.instaScrollMsgsToBottom(false)};var x=function e(i){if(!TS.model.archive_view_is_showing)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;p(TS.client.archives.getCurrentModelOb())};var E=function e(i){if(!TS.model.archive_view_is_showing)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;p(TS.client.archives.getCurrentModelOb())};var B=function e(i){if(!TS.model.archive_view_is_showing)return;if(TS.client.archives.not_member)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;TS.client.archives.cancel()};var P=function e(i,t){if(!TS.model.archive_view_is_showing)return;if(!t)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;TS.view.removeMsg(i,t)};var D=function e(i,t){if(!TS.model.archive_view_is_showing)return;if(!t)return;if(i.id!=TS.client.archives.getCurrentModelOb().id)return;var n=TS.client.msg_pane.getDivForArchiveMsg(t.ts);if(!n.length)return;u()};var U=function e(){if(!TS.model.archive_view_is_showing)return;var i=TS.client.archives.getCurrentModelOb();if(TS.shared.getActiveModelOb()!=i)return;var t=TS.client.archives.$scroller.scrollTop();u(i,i._archive_msgs);TS.client.archives.msgs_are_auto_scrolling=true;TS.client.archives.$scroller.scrollTop(t);TS.client.archives.msgs_are_auto_scrolling=false};var F=function e(i,t,n){if(!i||!TS.boot_data.feature_grid_archive_link_fixes)return TS.utility.openInNewTab(t,"_blank");var a=TS.utility.teams.isMemberOnTeam(TS.model.user,i);var r=TS.model.user.is_restricted||TS.model.user.is_ultra_restricted;var s;var o;var l;var d=TS.templates.team_icon({team:i,size:20,classes:"small_right_margin"});var c=_.escape(n);var u=_.escape(_.get(i,"name"));if(a){if(TS.model.is_our_app){var m=i.id;var f=TSSSB.call("getSignedInTeamIds");var h=_.includes(f,m);var g=h?Promise.resolve():TS.client.userAddedToTeam(m,true);g.then(function(){return O(t,m)})}else TS.utility.openInNewTab(t,"_blank");return}else if(i.is_closed&&!r)if(i.has_join_request){o=TS.i18n.t("Your request to join the <strong>{workspace}</strong> workspace is pending. You’ll receive a message from Slackbot when your request has been approved.","archives")({workspace:u});l=TS.i18n.t("{image} Request sent","archives")({image:d});s={title:'<span class="display_flex align_items_center">'+l+"</span>",body:"<p>"+o+"</p>",show_cancel_button:false,show_close_button:true,go_button_text:TS.i18n.t("Got it","archives")()}}else{if(n)o=TS.i18n.t("This message was posted in {channel} in the <strong>{workspace}</strong> workspace. To view this message, you’ll need to request to join that workspace.","archives")({channel:c,workspace:u});else o=TS.i18n.t("This message was posted in the <strong>{workspace}</strong> workspace. To view this message, you’ll need to request to join that workspace.","archives")({workspace:u});l=TS.i18n.t("{image} Request to join {workspace}?","archives")({image:d,workspace:u});s={title:'<span class="display_flex align_items_center">'+l+"</span>",body:"<p>"+o+"</p>",go_button_text:TS.i18n.t("Request to Join","archives")(),onGo:function e(){var n=TS.utility.getPathFromSlackUrl(t);var a=decodeURIComponent(n[1]);var r=n[2]&&n[2].replace("p","").replace(/(\d{10})(\d{6})/,"$1.$2");var s={link_channel_id:a,link_message_ts:r};TS.enterprise.workspaces.requestToJoinTeam(i.id,s).then(function(){var e=document.getElementById("toast_mount_point");var i=20;var t=TS.model.ui_state.flex_visible?20:$("#footer").height()+20;var n=TS.i18n.t("Request to join {workspace} sent!","archives")({workspace:u});var a={children:n,offsetX:i,offsetY:t,onClose:function i(){return Promise.resolve().then(function(){if(e)TS.interop.unmountToast(e)})}};TS.interop.mountToast(TS.boot_data.team_id,e,a)})}}}else if(i.is_open&&!r){if(n)o=TS.i18n.t("This message was posted in {channel} in the <strong>{workspace}</strong> workspace. To view this message, you’ll need to join that workspace.","archives")({channel:c,workspace:u});else o=TS.i18n.t("This message was posted in the <strong>{workspace}</strong> workspace. To view this message, you’ll need to join that workspace.","archives")({workspace:u});l=TS.i18n.t("{image} Join {workspace}?","archives")({image:d,workspace:u});s={title:'<span class="display_flex align_items_center">'+l+"</span>",body:"<p>"+o+"</p>",show_close_button:true,go_button_text:TS.i18n.t("Join Workspace","archives")(),onGo:function e(){TS.enterprise.workspaces.joinTeam(i.id).then(function(){if(TS.model.is_our_app){O(t,i.id);return}TS.utility.openInNewTab(t,"_blank")})}}}else{o=TS.i18n.t("This message may be from a workspace you’re not a member of, or it may have been deleted.","archives")();s={title:TS.i18n.t("Can’t view message","archives")(),body:"<p>"+o+"</p>",show_close_button:true,show_cancel_button:false,go_button_text:TS.i18n.t("Got it","archives")()}}TS.generic_dialog.start(s)};var O=function e(i,t){var n=-1!==i.indexOf("?")&&TS.interop.url.queryStringParse(i.split("?")[1]);var a=TS.utility.getPathFromSlackUrl(i);var r=decodeURIComponent(a[1]);var s=a[2]&&a[2].replace("p","").replace(/(\d{10})(\d{6})/,"$1.$2");var o=n&&n.thread_ts;var l={team:t,id:r};if(s)l.message=s;if(o)l.thread_ts=o;var d="slack://channel"+TS.interop.url.queryStringEncode(l);var c=document.createElement("iframe");c.src=d;document.body.appendChild(c);setTimeout(function(){c.remove()},1e3)};var R=function e(){if(!TS.boot_data.feature_sli_channel_insights||!TS.client||!TS.client.ui.channel_insights.isEnabled()||!TS.model.archive_view_is_showing)return;if(!TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.prev_flex_name||TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.prev_flex_name&&"details"!==TS.model.ui_state.flex_name)$(".c-archive_footer__see_more").removeClass("hidden");else if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$(".c-archive_footer__see_more").addClass("hidden")}})()},4962:function(e,i){(function(){TS.registerModule("client.channel_page",{onStart:function e(){A=new TS.PresenceList;TS.client.login_sig.add(H);TS.client.flexpane_display_switched_sig.add(G);TS.redux.socket.connectedSig.add(j);TS.channels.data_updated_sig.add(W);TS.channels.switched_sig.add(K);TS.channels.purpose_changed_sig.add(V);TS.channels.member_left_sig.add(X);TS.channels.member_joined_sig.add(Z);TS.channels.renamed_sig.add(z);TS.channels.left_sig.add(le);TS.channels.joined_sig.add(de);TS.channels.topic_changed_sig.add(V);TS.channels.converted_to_shared_sig.add(V);TS.channels.shared_teams_updated_sig.add(V);TS.channels.unshared_sig.add(V);TS.groups.switched_sig.add(K);TS.groups.purpose_changed_sig.add(V);TS.groups.member_left_sig.add(J);TS.groups.member_joined_sig.add(Y);TS.groups.renamed_sig.add(z);TS.groups.left_sig.add(le);TS.groups.topic_changed_sig.add(V);TS.groups.converted_to_shared_sig.add(V);TS.groups.shared_teams_updated_sig.add(V);TS.ims.switched_sig.add(K);TS.mpims.switched_sig.add(K);TS.members.presence_changed_sig.add(ee);TS.members.changed_name_sig.add(ie);TS.members.changed_profile_sig.add(ie);TS.members.changed_current_status_sig.add(ie);TS.members.changed_account_type_sig.add(ie);TS.members.changed_deleted_sig.add(te);TS.view.members.unknown_resolution_rebuild_sig.add(ie);TS.view.members.unknown_resolution_rebuild_sig.add(function(){if(!ce())return;var e=TS.shared.getActiveModelOb();Te(e)});TS.membership.membership_counts_need_refetch_sig.add(ue);TS.prefs.display_real_names_override_changed_sig.add(ne);TS.prefs.team_display_real_names_changed_sig.add(ne);TS.prefs.push_changed_sig.add(q);TS.prefs.dtop_notif_changed_sig.add(q);TS.prefs.team_perms_pref_changed_sig.add(q);TS.prefs.muted_channels_changed_sig.add(q);TS.ui.growls.permission_changed_sig.add(q);TS.files.channel_files_fetched_sig.add(ae);TS.files.team_file_added_sig.add(re);TS.files.team_file_deleted_sig.add(re);TS.files.team_file_changed_sig.add(re);TS.files.team_file_comment_edited_sig.add(se);TS.pins.pinned_status_changed_sig.add(oe);TS.pins.pinned_message_changed_sig.add(oe);TS.pins.pinned_message_deleted_sig.add(oe);TS.pins.pins_fetched_sig.add(oe);TS.view.members.unknown_resolution_rebuild_sig.add(function(){if(!ce())return;Ae(TS.shared.getActiveModelOb())});TS.apps.permissions.app_resource_membership_changed_sig.add(je);TS.apps.permissions.xoxa_apps_installed_sig.add(function(){if(!ce())return;me()});TS.client.channel_page.initUI();D();TS.view.resize_sig.add(ke)},initUI:function _(){S=TS.storage.fetchChannelPageState();if(!S.expanded_sections)S.expanded_sections={about:false,highlights:false,pinned_items:false,members:false,shared_files:false,notif_prefs:false,apps:false};T=S.expanded_sections;e=$("#details_tab");e.append(TS.templates.channel_page_empty_state({state:S}));i=e.find("#channel_page_scroller");s=e.find(".conversation_details");t=e.find(".channel_page_about .section_content.channel_purpose");n=e.find(".channel_page_pinned_items .section_content.pinned_items");a=e.find(".channel_page_member_tabs");r=e.find(".channel_page_member_lists");o=e.find(".channel_page_shared_files .section_content");l=e.find(".channel_page_notif_prefs .section_content");d=e.find(".channel_page_notif_prefs .channel_page_notif_prefs_mute_state");m=e.find('[data-js="channel_page_apps_list"]');if(TS.boot_data.feature_sli_channel_insights){c=e.find('[data-js="sli_channel_highlights_section"]');u=e.find(".channel_page_highlights")}$(".channel_page_shared_files").on("focus",".file_actions",function(){$(this).closest(".actions").addClass("focused")});$(".channel_page_shared_files").on("blur",".file_actions",function(){$(this).closest(".actions").removeClass("focused")})},showAboutSection:function e(){if(!T.about)F("about");i.find(".channel_page_about").scrollintoview({offset:"top",px_offset:50})},showPinsSection:function e(){if(T.members)F("members");if(T.shared_files)F("shared_files");if(TS.boot_data.feature_sli_channel_insights&&T.highlights)F("highlights");if(!T.pinned_items)F("pinned_items");i.find(".channel_page_pinned_items").scrollintoview({offset:"top",px_offset:50})},showMembersSection:function e(){if(T.pinned_items)F("pinned_items");if(T.shared_files)F("shared_files");if(TS.boot_data.feature_sli_channel_insights&&T.highlights)F("highlights");if(!T.members)F("members");i.find(".channel_page_members").scrollintoview({offset:"top",px_offset:50})},showMemberSectionAndHighlight:function e(){TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showMembersSection();$("#channel_page_scroller .channel_page_members").highlight(null,"channel_page_members_highlighter")},showFilesSection:function e(){if(T.members)F("members");if(T.pinned_items)F("pinned_items");if(TS.boot_data.feature_sli_channel_insights&&T.highlights)F("highlights");if(!T.shared_files)F("shared_files");i.find(".channel_page_shared_files").scrollintoview({offset:"top",px_offset_:50})},showNotifPrefsSection:function e(){if(!T.notif_prefs)F("notif_prefs");i.find(".channel_page_notif_prefs").scrollintoview({offset:"top",px_offset_:50})},showAppsSection:function e(){if(!T.apps)F("apps");i.find('[data-js="channel_page_apps"]').scrollintoview({offset:"top",px_offset_:50})},showHighlightsSection:function e(){if(T.members)F("members");if(T.pinned_items)F("pinned_items");if(T.shared_files)F("shared_files");if(T.apps)F("apps");if(!T.highlights)F("highlights")},pinnedItemHtml:function e(i,t){try{var n={item:i,model_ob:t,can_remove:TS.pins.canUserPinHere(t)};if("message"===i.type){var a=i.message;var r=TS.members.getPotentiallyUnknownMemberById(a.user);var s=TS.utility.msgs.shouldHaveBotLabel(a,r);var o;var l;if(s){var d=TS.bots.getBotInfoByMsg(a);if(d){o=d.app_id;l=d.bot_id}}n.is_message=true;n.member=r;n.permalink=TS.utility.msgs.constructMsgPermalink(t,i.message.ts,i.message.thread_ts);n.is_bot=s;n.is_reply=a.thread_ts&&a.thread_ts!=a.ts;n.is_broadcast="thread_broadcast"===a.subtype;n.app_id=o;n.bot_id=l}else if("file"===i.type)n.is_file=true;else if("file_comment"===i.type)n.is_comment=true;return TS.templates.channel_page_pinned_item(n)}catch(e){TS.info("Problem in pinnedItemHtml:"+e);return""}},clearUnreadPinState:function e(){$(".pinned_item").removeClass("unread_pin")},highlightPinnedItemForRemoval:function e(i){var t=ze(i);t.addClass("delete_mode")},unHighlightPinnedItemForRemoval:function e(i){var t=ze(i);t.removeClass("delete_mode")},isPurposeTooLong:function e(i){return TS.utility.contenteditable.getDisplayValueLength(i)>TS.model.channel_purpose_max_length},updatePurposeTooLongWarning:function e(i){var t=TS.client.channel_page.isPurposeTooLong(i);$(i).parent().find(".too_long_warning").toggleClass("hidden",!t);return!t},test:function e(){var i={initEvents:D,rebuildChannelPage:me,rebuildChannelDetails:Te,rebuildPinnedItems:Ae,rebuildMembersTabs:Ie,rebuildMemberLists:$e,generateMemberListTemplateArgs:Be,SEE_ALL_MEMBERS_DIALOG_THRESHOLD:M,MAX_SIDEBAR_MEMBERS_COUNT:I};Object.defineProperty(i,"_will_rebuild_count_templates_after_promise_resolves",{get:function e(){return Me},set:function e(i){Me=i}});Object.defineProperty(i,"_expanded_sections",{get:function e(){return T},set:function e(i){T=i}});Object.defineProperty(i,"_renderMemberList",{get:function e(){return Pe},set:function e(i){Pe=i}});return i}});var e;var i;var t;var n;var a;var r;var s;var o;var l;var d;var c;var u;var m;var f=false;var h=false;var g=false;var p;var S;var T;var v=[];var b={};var w={};var y=10;var A;var k;var C;var M=50;var I=20;var x=10;var E=5;var B=6e4;var P=2e4;var D=function n(){e.on("click",".invite_link",function(){var e=TS.shared.getActiveModelOb();TS.ui.channel_invite_modal.startInviteToChannelModal(e.id)});e.on("click",".find_files_link",function(){var e=TS.shared.getActiveModelOb();TS.search.setInputVal("in:"+(e.is_channel&&!e.is_private?"#":"")+e.name);TS.search.setFilter("files");TS.search.submitSearch()});e.on("click",".leave_link",function(){var e=TS.shared.getActiveModelOb();if(e.is_channel)TS.channels.leave(e.id);else if(e.is_group)TS.groups.leave(e.id)});e.on("click",".member_preview_link[data-member-id]",function(e){e.preventDefault();var i=$(this).data("member-id");TS.menu.member.startWithMember(e,i)});e.on("click",".section_header",function(e){var i=$(e.target).closest("[data-section-name]");var t=i.data("section-name");if(!t)return;if("members"===t&&!T.members)return TS.client.channel_page.showMembersSection();if("pinned_items"===t&&!T.pinned_items)return TS.client.channel_page.showPinsSection();if("shared_files"===t&&!T.shared_files)return TS.client.channel_page.showFilesSection();if(TS.boot_data.feature_sli_channel_insights&&"highlights"===t&&!T.highlights)return TS.client.channel_page.showHighlightsSection();F(t)});e.on("click keydown",".edit_purpose, .purpose_cancel",function(e){if("click"===e.type)O();else if(e.which==TS.utility.keymap.enter)O()});e.on("click keydown",".purpose_done",function(e){if("click"===e.type)R();else{if(e.which==TS.utility.keymap.enter)R();if(e.which==TS.utility.keymap.tab){e.preventDefault();e.stopImmediatePropagation();t.find(".purpose_cancel").focus()}}});e.on("click","[data-app-user-id]",function(e){var i=$(e.currentTarget);var t=i.data("app-user-id");var n=TS.members.getMemberById(t);if(n)if($(e.target).is('[data-action="remove_app"]'))TS.apps.permissions.removeAppOrBotFromActiveResource(n);else{var a=_.get(n,"profile.bot_id");if(a)TS.menu.app.startWithApp(e,a).then(function(){TS.menu.positionAt(i,-320,0)})}});e.on("click",'[data-js="channel_page_apps_add"]',function(){TS.ui.apps_browser.startAddApps()});e.on("click",".pinned_item .remove_pin",function(e){var i=TS.shared.getActiveModelOb();var t=$(this).closest(".pinned_item");var n=t.data("ts");var a=t.data("comment-id");var r=t.data("file-id");var s=t.data("type");if("message"===s)TS.pins.unPinMessage(n.toString(),i);else if("file"===s)TS.pins.unPinFile(r,i);else if("file_comment"===s)TS.pins.unPinFileComment(a,r,i);e.preventDefault()});e.on("click",".pinned_item .pin_metadata",function(e){if(TS.client.archives.maybeHandleArchiveLink($(this)))e.preventDefault()});e.on("click",".pinned_item",function(e){if(e.isDefaultPrevented()||$(e.target).is("a"))return;e.preventDefault();var i=$(this).data("type");var t=TS.shared.getActiveModelOb();var n=$(this).data("ts");var a=$(this).data("file-id");var r=$(this).attr("data-thread-ts");var s=$(this).data("is-broadcast");var o="channel_page";if(t.is_im||t.is_mpim)o="im_page";else if(t.is_group)o="group_page";if("message"===i)if(r&&r!=n&&!s)TS.ui.replies.openConversation(t,r,n,o);else TS.view.displayMsgInModelOb(t,n);else if("file"===i||"file_comment"===i)TS.client.ui.files.previewFile(a,o)});e.on("click",".view_all_files_link",function(){TS.clog.track("SEARCH_OPEN",{open_method:"files",search_session_id:TS.search.getSearchSessionId()});var e=TS.shared.getActiveModelOb();TS.search.setInputVal("in:"+(e.is_channel&&!e.is_private?"#":"")+e.name);TS.search.setFilter("files");TS.search.submitSearch()});e.on("click",".edit_notif_prefs_btn",function(){var e=TS.shared.getActiveModelOb();TS.ui.channel_prefs_dialog.start(e.id)});e.on("click",".add_someone",function(e){e.preventDefault();var i=TS.shared.getActiveModelOb();var t=i.is_channel||i.is_group&&!i.is_mpim;if(t)TS.ui.channel_invite_modal.startInviteToChannelModal(i.id);else if(i.is_mpim)TS.ui.im_browser.startWithMpim(i)});e.on("click",".creator_link",function(e){var i=TS.shared.getActiveModelOb();var t=i.created;if(TS.useReactMessages()){e.preventDefault();U(t,i);return}var n=i.msgs[i.msgs.length-1];var a=Math.floor(n.ts);if(a<=t){var r=TS.utility.msgs.getDisplayedMsgAfterTS(t,i.msgs);if(r)TS.client.ui.scrollMsgsSoMsgIsInView(r.ts,false,true)}else U(t,i)});if(TS.boot_data.feature_sli_channel_insights){$(".channel_page_section").delegate(".c-channel_insights__channel .channel_link","click",function(e){var i=$(e.target).closest(".channel_link");var t=TS.client.ui.channel_insights.last_highlights_response.channel;var n=i.data("channel-id");var a={channel_id:t,channel_type:t[0]||"",click_channel_id:n,click_channel_type:n[0]||"",request_id:TS.client.ui.channel_insights.last_highlights_response.response.request_id};TS.clog.track("CHANNEL_INSIGHTS_RELATED_CHANNELS_CLICK",a)});$(".channel_page_section").delegate(".c-channel_insights .c-member__display-name","click",function(e){var i=$(e.target).closest(".c-member");var t=i.data("member-id");var n=TS.client.ui.channel_insights.last_highlights_response.channel;var a={channel_id:n,channel_type:n[0]||"",click_target_user_id:t,request_id:TS.client.ui.channel_insights.last_highlights_response.response.request_id};TS.clog.track("CHANNEL_INSIGHTS_MOST_ACTIVE_USER_CLICK",a)})}i.on("scroll",_.debounce(function(){if(!ce())return;k=i.scrollTop()},100))};var U=function e(i,t){var n={channel:t.id,oldest:i,count:1,inclusive:1,ignore_replies:true,include_pin_count:true};var a=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(a)n._x_reason=a;TS.api.call("conversations.history",n).then(function(e){if(TS.useReactMessages()){var i=_.get(e,"data.messages[0].ts");if(i)TS.client.ui.tryToJump(t.id,i);return}var n;if(e.data.messages.length<1){n=t._archive_msgs[0].ts;TS.client.archives.start(n)}else{n=e.data.messages[0].ts;if(TS.utility.msgs.getMsg(n,t.msgs))TS.client.ui.scrollMsgsSoMsgIsInView(n,false,true);else TS.client.archives.start(n)}return true}).catch(function(){return TS.warn("Couldn’t find creation message at "+i+" in channel: "+t.id)})};var F=function e(t){var n=TS.shared.getActiveModelOb();var a=i.find('.channel_page_section[data-section-name="'+t+'"]');if(0===a.length)return;if(T[t]){T[t]=false;if("about"===t)pe(n);if("pinned_items"===t)Ce();if("members"===t)Fe();if("shared_files"===t)Ne(n);if("notif_prefs"===t)ye();if("apps"===t)Le();if("highlights"===t&&TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled())oi();a.removeClass("expanded")}else{T[t]=true;a.addClass("expanded");if("about"===t)Te(n);if("about"===t&&(n.is_im||n.is_mpim))ge(n);if("pinned_items"===t)Ae(n);if("members"===t)$e(n);if("shared_files"===t)Re(n);if("notif_prefs"===t)we(n);if("apps"===t)Qe(n);if("highlights"===t&&TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled())di(n)}TS.storage.storeChannelPageState(S);TS.ui.utility.updateClosestMonkeyScroller(i);qe()};var O=function e(){t.find(".edit_purpose_label, #channel_purpose_input, .purpose_done, .purpose_cancel, .purpose_label, .channel_purpose_section .channel_purpose_text").toggleClass("hidden");var i=t.find("#channel_purpose_input");if(t.find("#channel_purpose_input").hasClass("hidden")){$("#channel_purpose_input + .too_long_warning").addClass("hidden");TS.utility.contenteditable.blur(i);t.find(".purpose_done, .purpose_cancel").blur()}else{var n=TS.shared.getActiveModelOb();TS.utility.contenteditable.value(i,TS.utility.unformatTopicOrPurpose(n.purpose.value));TS.utility.contenteditable.focus(i)}};var R=function e(){var i=TS.shared.getActiveModelOb();var n=t.find("#channel_purpose_input");var a=_.trim(TS.utility.contenteditable.value(n));a=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(a,{complete_member_specials:false});if(TS.client.channel_page.isPurposeTooLong(n))return;if(i.purpose.value===a){O();return}if(i.is_group)TS.groups.setPurpose(i.id,a);else if(i.is_channel)TS.channels.setPurpose(i.id,a);O()};var N=function e(i){var t=TS.shared.getActiveModelOb();var n=i.channels;if(t.is_group)n=i.groups;else if(t.is_im)n=i.ims;return-1!==n.indexOf(t.id)};var H=function e(){f=true};var Q=function e(){if(C)clearInterval(C)};var L=function e(){Q();C=setInterval(Ue,B)};var G=function e(i){var t=TS.model.ui_state.flex_name;if(!t||"details"===i&&"details"!==t){fe();g=false;if("details"===i){var n=TS.shared.getActiveModelOb();var a=n&&n.id?{channel_id:n.id,channel_type:n.id.charAt(0),is_member:n.is_member}:{};TS.clog.track("FLEXPANE_CHANNEL_DETAILS_CLOSE",a)}return}if(!g&&"details"===t){g=true;me();var r=TS.shared.getActiveModelOb();var s=r&&r.id?{channel_id:r.id,channel_type:r.id.charAt(0),is_member:r.is_member}:{};TS.clog.track("FLEXPANE_CHANNEL_DETAILS_OPEN",s)}};var j=function e(){if(h){b={};if(!ce())return;me()}else h=true};var K=function e(){if(!f)return;Me=false;var i=TS.shared.getActiveModelOb();if(!i)return;k=null;if("details"===TS.model.ui_state.flex_name)me()};var W=function e(i){if(!_e(i))return;if("details"===TS.model.ui_state.flex_name)me()};var V=function e(i){if(!ce())return;if(!_e(i))return;var t=TS.shared.getActiveModelOb();Te(t);he(t)};var q=function e(){if(!ce())return;var i=TS.shared.getActiveModelOb();we(i)};var z=function e(i){if(!ce())return;if(!_e(i))return;var t=TS.shared.getActiveModelOb();he(t);Te(t)};var Y=function e(i){if(!ce())return;if(!_e(i))return;var t=TS.shared.getActiveModelOb();Te(t);Ie(t);if(T.members)Ue()};var J=function e(i,t){if(!ce())return;if(!_e(i))return;var n=TS.shared.getActiveModelOb();Te(n);Ie(n);if(T.members){$("#channel_page_member_"+t.id).remove();Ue()}};var Z=function e(i){if(!ce())return;if(!_e(i))return;var t=TS.shared.getActiveModelOb();Ie(t);if(T.members)Ue()};var X=function e(i,t){if(!ce())return;if(!_e(i))return;var n=TS.shared.getActiveModelOb();Ie(n);if(T.members){$("#channel_page_member_"+t.id).remove();Ue()}};var ee=function e(i){var t=true;ie(i,t)};var ie=function e(i,t){if(!TS.redux.socket.isConnected())return;if(!i||"undefined"===typeof i.id)return;if(!ce())return;var n=TS.shared.getActiveModelOb();if(n){var a=TS.membership.getUserChannelMembershipStatus(i.id,n);var r=a.is_known?a.is_member:true;if(r){var s=!t;if(s)Ie(n);if(T.members)Ue()}if(n.creator&&n.creator===i.id)Te(n)}};var te=function e(){if(!ce())return;var i=TS.shared.getActiveModelOb();Ie(i);if(T.members)Ue()};var ne=function e(){if(!ce())return;var i=TS.shared.getActiveModelOb();$e(i)};var ae=function e(i){if(!ce())return;var t=TS.shared.getActiveModelOb();if(!t||!i||t.id!==i)return;delete w[t.id];if(!t.is_channel||t.is_member)b[t.id]=true;Re(t)};var re=function e(i){if(!ce())return;var t=TS.shared.getActiveModelOb();if(!t)return;if(i.pinned_to&&-1!==i.pinned_to.indexOf(t.id))Ae(t);if(N(i))Re(t)};var se=function e(i,t){if(!ce())return;var n=TS.shared.getActiveModelOb();if(!n)return;if(t.pinned_to&&-1!==t.pinned_to.indexOf(n.id))Ae(n)};var oe=function e(i){if(!ce())return;if(!_e(i))return;Ae(i)};var le=function e(i){delete b[i.id];if(ce()&&TS.model.user.is_restricted)Te(TS.shared.getActiveModelOb())};var de=function e(i){if(!ce())return;if(_e(i))me();else if(TS.model.user.is_restricted)Te(TS.shared.getActiveModelOb())};var ce=function e(){return g};var _e=function e(i){var t=TS.shared.getActiveModelOb();if(!t||!i||t.id!==i.id)return false;return true};var ue=function e(){var i=TS.shared.getActiveModelOb();Ie(i);if(T.members)$e(i)};var me=function e(){fe();var t=TS.shared.getActiveModelOb();if(t.is_im||t.is_mpim){if(t.is_im)$("#details_tab").addClass("dm_info_pane");else $("#details_tab").removeClass("dm_info_pane");if(t.is_mpim)$("#details_tab").addClass("mpim_info_pane");else $("#details_tab").removeClass("mpim_info_pane");ge(t)}else $("#details_tab").removeClass("dm_info_pane mpim_info_pane");if(TS.apps.permissions.areXoxaAppsInstalled()){$("#details_tab").toggleClass("app_dm_info_pane",TS.apps.isCurrentModelViewAnApp());He=null}$('[data-js="channel_page_apps"]').toggleClass("hidden",!TS.apps.permissions.areXoxaAppsInstalled());he(t);Te(t);Ae(t);Ie(t);$e(t);Re(t);we(t);if(TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled())di(t);if(TS.apps.permissions.areXoxaAppsInstalled())Qe(t);L();if(!TS.environment.supports_custom_scrollbar){var n=i.data("monkeyScroll");if(n)TS.ui.utility.updateClosestMonkeyScroller(i);else i.monkeyScroll()}qe();if(k)i.scrollTop(k)};var fe=function e(){We();Ce();Ee();Fe();pe();Ne();ye();if(TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled())li();if(TS.apps.permissions.areXoxaAppsInstalled())Le();Q()};var he=function e(i){var t;if(i.is_channel&&!i.is_mpim||!i.is_channel&&i.is_group&&!i.is_mpim){$("#channel_page_title").text(TS.i18n.t("Channel Details","client")());var n='<span class="channel_name overflow_hidden"><span class="overflow_ellipsis">';n+=TS.templates.builders.makeChannelPrefix(i);n+=_.escape(i.name);n+="</span>";n+=TS.templates.builders.maybeMakeSharedIcon(i);n+="</span>";t=TS.i18n.t("About {formatted_channel_name}","client")({formatted_channel_name:n})}else t='<span class="overflow_ellipsis">'+TS.i18n.t("About this conversation","client")()+"</span>";$("#details_tab_header").html(t)};var ge=function e(i){pe();if(i.is_mpim)return;var t=TS.members.getPotentiallyUnknownMemberById(i.user);A.add(t.id);s.html(TS.templates.channel_page_conversation_details({member:t}));TS.client.flex_pane.startLocalTimeInterval();Oe("about")};var pe=function e(){Oe("about");A.clear();s.empty();TS.client.flex_pane.stopLocalTimeInterval()};var Se=function e(i){var t=TS.membership.getMembershipCounts(i);if(t.promise)if(!Me){if(TS.has_pri[ii])TS.log(ii,"Channel member counts ("+i.id+"): Will rebuild member tabs after we get counts from API");Me=true;t.promise.then(function(){if(i.id===TS.shared.getActiveModelOb().id){if(TS.has_pri[ii])TS.log(ii,"Channel member counts ("+i.id+"): Got counts from API, rebuilding member tabs now");Ie(i);if(TS.shared.isModelObShared(i)){if(TS.has_pri[ii])TS.log(ii,"Channel member counts ("+i.id+"): Got counts from API, rebuilding channel details now");Te(i)}}else if(TS.has_pri[ii])TS.log(ii,"Channel member counts ("+i.id+"): Got counts from API, but active model object has changed, so not rebuilding member tabs")}).finally(function(){Me=false})}var n=_.get(t,"counts.member_count");var a=_.get(t,"counts.restricted_member_count");var r;if(!t.counts)r="waiting for initial data";else if(t.promise)r="using provisional data while waiting for API response";else r="have up-to-date data";if(TS.has_pri[ii])TS.log(ii,"Channel member counts ("+i.id+"): Rebuilding count templates: "+r+"; member count = "+n+"; restricted member count = "+a);return t};var Te=function e(i){if(i.is_im||i.is_mpim)return;var n={model_ob:i,show_set_purpose:(i.is_member||i.is_group)&&!TS.model.user.is_ultra_restricted&&(!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInGeneral(TS.model.user)),show_edit_purpose_or_topic:(i.is_member||i.is_group)&&!TS.model.user.is_ultra_restricted&&!TS.model.user.is_restricted&&(!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInGeneral(TS.model.user))};if(TS.boot_data.page_needs_enterprise&&(i.is_channel||i.is_group)&&i.is_org_shared&&i.is_global_shared){n.is_globally_shared=true;var a=TS.redux.enterprise.getEnterprise();n.enterprise_org_name=a.name;n.enterprise_org_icon=a.icon}var r=TS.members.getPotentiallyUnknownMemberById(i.creator);if(r&&r.is_self)n.creator_is_self=true;else if(r&&r.is_unknown)n.creator_name=new Handlebars.SafeString(TS.templates.unknown_member({id:r.id}));else if(r&&TS.utility.teams.isMemberExternal(r)&&TS.teams.getTeamById(r.team_id))n.creator_name=TS.i18n.t("{creator_name} from {team_name}","channel_pages")({creator_name:TS.members.getPrefCompliantMemberName(r),team_name:TS.teams.getTeamNameById(r.team_id)});else if(r)n.creator_name=TS.members.getPrefCompliantMemberName(r);else n.creator_name=TS.i18n.t("unknown","channel_pages")();var s=i.msgs&&i.msgs.length&&_.get(i,["msgs",i.msgs.length-1,"ts"],"");n.permalink=s&&TS.utility.msgs.constructMsgPermalink(i,s)||"javascript:void(0)";var o=TS.interop.datetime.toDateObject(i.created);if(TS.interop.datetime.isToday(o))n.days_since_creation=0;else if(TS.interop.datetime.isYesterday(o))n.days_since_creation=1;n.creation_date=1e3*i.created;if(TS.boot_data.page_needs_enterprise&&i.is_org_shared&&i.shared_team_ids){_.assign(n,be(i));if(n.shared_teams_loading)ve(i)}else if(TS.shared.isModelObShared(i)){var l=0;var d=Se(i);n.is_loading_members=!d.counts;var c=TS.utility.teams.getTeamsForModelOb(i,{include_pending:true});c=_.map(c,function(e){e=_.clone(e);e.member_count=_.get(d,["counts","teams_member_count",e.id])||0;e.is_pending_ext_shared=_.indexOf(i.pending_shared,e.id)>-1;e.connecting_admin=pi(i,e.id);l+=e.member_count;return e});var u=_.clone(TS.model.team);u.member_count=_.get(d,["counts","member_count"])-l;u.connecting_admin=pi(i,u.id);c.unshift(u);n.shared_teams=c}t.html(TS.templates.channel_page_details(n)).removeClass("hidden");ri(i);var m=$("#channel_purpose_input");TS.utility.contenteditable.create(m,{modules:{tabcomplete:{positionMenu:function e(i){i.style.width=m.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(i,m)},searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"]}},onEnter:function e(i){if(i.shiftKey)return true;R();return false},onEscape:function e(){O()},onTextChange:function e(){TS.client.channel_page.updatePurposeTooLongWarning(m)}});TS.utility.contenteditable.enable(m);TS.utility.contenteditable.value(m,TS.utility.unformatTopicOrPurpose(i.purpose.value));m.on("keydown",function(e){if(e.which===TS.utility.keymap.up||e.which===TS.utility.keymap.down)e.stopPropagation()});Oe("about");if(TS.boot_data.feature_sli_channel_insights){var f=TS.shared.getTypeForModelOb(i);if(_.invoke(TS,"client.ui.channel_insights.isEnabled")&&("channel"===f||"group"===f)&&ni){$(".channel_page_highlights").removeClass("hidden");ni=false}}if(n.show_more_teams_link)t.find("#see_all_teams").off("click").on("click",function(e){e.preventDefault();TS.ui.enterprise_teams_dialog.show(i)})};var ve=function e(i){var t=_.get(i,"shared_team_ids",[]);if(TS.model.user.is_restricted)t=_.intersection(TS.model.user.enterprise_user.teams,t);var n=t.length;var a=n<=x;var r=[];if(a)r=i.shared_team_ids;else{var s=_.partition(t,TS.teams.getTeamById);var o=s[0];var l=s[1];r=l.slice(0,Math.max(0,E-o.length))}if(!r.length)return;TS.teams.ensureTeamsArePresent(r).then(function(){if(_.get(TS.shared.getActiveModelOb(),"id")===_.get(i,"id"))Te(i)}).catch(function(){$(".channel_shared_teams .infinite_spinner").remove()})};var be=function e(i){var t=_.get(i,"shared_team_ids",[]);if(TS.model.user.is_restricted)t=_.intersection(TS.model.user.enterprise_user.teams,t);var n=t.length;var a=n<=x;var r={};r.shared_teams=_(t).map(TS.teams.getTeamById).compact().value();if(a)r.shared_teams_loading=r.shared_teams.length<n;else{r.shared_teams_loading=r.shared_teams.length<E;r.shared_teams=r.shared_teams.slice(0,E);r.show_more_teams_link=true;r.total_teams_count=n}return r};var we=function e(i){ye();if(i.is_im)return;var t=i.id;var n=TS.notifs.isCorGMuted(t);var a=TS.ui.growls.checkPermission();var r=false===a&&TS.ui.growls.no_notifications;var s=false===a&&"denied"===TS.ui.growls.getPermissionLevel();var o=false===a&&TS.ui.growls.shouldShowPermissionButton();var c=TS.notifs.getCalculatedCorGNotifySetting(t);var _=TS.notifs.getCalculatedCorGPushNotifySetting(t);var u="everything"===c;var m="mentions"===c;var f="nothing"===c;var h="everything"===_;var g="mentions"===_;var p="nothing"===_;var S={model_ob:i,is_muted:n,desktop_notifs_enabled:a,notifications_impossible:r,notifications_not_allowed:s,notifications_not_yet_allowed:o,desktop_everything:u,desktop_mentions:m,desktop_nothing:f,push_everything:h,push_mentions:g,push_nothing:p};l.html(TS.templates.channel_page_notif_prefs(S));d.html(TS.templates.channel_page_notif_prefs_mute_state({is_muted:n}));Oe("notif_prefs")};var ye=function e(){Oe("notif_prefs");l.empty()};var Ae=function e(i){Ce();var t=i.pinned_items;var a=i.pinned_items_count;var r="";var s=false;if(T.pinned_items&&!Je(i)){Ze(i);s=true}if(a>0)$("#pinned_items_title").text(TS.i18n.t("{pinned_items_count, plural, =1 {# Pinned Item} other {# Pinned Items}}","channel_pages")({pinned_items_count:a}));else $("#pinned_items_title").text(TS.i18n.t("Pinned Items","channel_pages")());if(!T.pinned_items)return;if(t&&t.length>0)t.forEach(function(e){if(e.file&&e.file.is_deleted)return;Ye(e);r+=TS.client.channel_page.pinnedItemHtml(e,i)});else if(!s)r=TS.templates.channel_page_empty_pinned_items({model_ob:i});else r=TS.templates.infinite_spinner({color:"white",size:"medium"});n.toggleClass("loading",!!s);r=TS.format.replaceHighlightMarkers(r);n.html(r);Oe("pinned_items");ke()};var ke=function e(){if(!ce())return;if(!T.pinned_items)return;TS.utility.rAF(function(){var e=n.find(".pinned_item");e.each(function(){var e=$(this);if("message"!==e.data("type"))return;var i=e.find(".pinned_message_text");var t=e.find(".pin_truncate_fade");if(i[0].scrollHeight>i[0].clientHeight+3)t.removeClass("hidden");else t.addClass("hidden")});e.find(".pinned_message_text").addClass("hide_scroll")})};var Ce=function e(){Oe("pinned_items");n.empty()};var Me;var Ie=function e(i){var t;var n;var a;var r;if(i.is_im)return;var s=Se(i);t=!s.counts;n=null;a=_.get(s,"counts.member_count");r=_.get(s,"counts.restricted_member_count");xe(i,t,a,n,r)};var xe=function e(i,t,n,r,s){Ee();var o={model_ob:i,member_count:n,online_count:r,restricted_count:s,show_restricted_members:s>0,is_loading_members:t};a.html(TS.templates.channel_page_member_tabs(o))};var Ee=function e(){a.empty()};var Be=function e(i,t,n){var a;var r=[];var s=t||i.members;for(var o=0;o<s.length;o+=1){a=TS.members.getMemberById(s[o]);if(a)if(TS.boot_data.page_needs_enterprise){if(TS.shared.isModelObOrgShared(i)){if(!a.deleted)r.push(a)}else if(a.enterprise_user&&a.enterprise_user.teams&&a.enterprise_user.teams.length&&a.enterprise_user.teams.indexOf(TS.model.team.id)>-1)r.push(a)}else if(!a.deleted)r.push(a)}var l=TS.membership.getMembershipCounts(i);var d=_.get(l,"counts.member_count");if(d<=M)r=TS.members.memberSorterByActiveWithBotsLast(r);var c={model_ob:i};if(_.isUndefined(n))n=d<=M;if(n)c.members=r;else{c.members=r.slice(0,I);c.show_more_members_link=true;c.total_member_count=d}c.show_channel_invite_link=TS.permissions.members.canUserInviteToChannel(i);c.all_members=r;return c};var Pe=function e(i,t,n,a){var s=Be(i,t,a);if(n)Fe();s.members=TS.members.memberSorterByActiveWithBotsLast(s.members);A.add(_.map(s.members,"id"));r.html(TS.templates.channel_page_member_lists(s));r.find("#see_all_members").on("click",function(e){e.preventDefault();TS.client.channel_page.members_dialog.show(i,s.all_members,s.total_member_count)});Oe("members");Ke()};var $e=function e(i,t){if(i.is_im)return;var n=TS.channels.backfills.isBackfilling(i.id);if(!t||n)Fe();if(!T.members)return;if(!t||n)r.addClass("loading").html(TS.templates.infinite_spinner({color:"white",size:"medium"}));if(n){TS.client.ui.rebuildMemberListToggle();return}var a=Math.max(I,M);var s={count:a,channels:[i.id],present_first:true,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name",filter:"everyone",locale:TS.i18n.locale()};var o=[TS.members.fetchAndUpsertMembersWithQuery(s)];var l=TS.membership.getMembershipCounts(i);if(l.promise)o.push(l.promise);Promise.all(o).then(function(e){var n=e[0];if(TS.shared.getActiveModelOb().id!==i.id)return;var a=TS.membership.getMembershipCounts(i);var r=_.get(a,"counts.member_count");var s=r<=M;var o=s?M:I;var l=_.map(n.objects,"id").slice(0,o);Pe(i,l,t,s);return null}).catch(function(){if(TS.has_pri[ii])TS.log(ii,"Flannel error: failed to fetch all members for channel "+i.id);TS.logError("failed to fetch all members for channel "+i.id,"Flannel error");r.removeClass("loading");r.html('<div class="align_center subtle_silver">'+TS.i18n.t("Oops, something went wrong.","client")()+' <a href="#">'+TS.i18n.t("Try again","client")()+"</a></div>");r.find("a").click(function(t){t.preventDefault();e(i)})})};var De=function e(){var i=TS.shared.getActiveModelOb();var t=true;$e(i,t)};var Ue=_.throttle(De,P);var Fe=function e(){Oe("members");A.clear();We();r.empty()};var Oe=function e(t){var n=310;var a=i.find('.channel_page_section[data-section-name="'+t+'"]');var r=_.sum(a.children(":visible").map(function(e,i){return $(i).outerHeight(true)}).toArray());clearTimeout(a.data("animate"));if(T[t])a.css({"max-height":r,height:""}).data("animate",setTimeout(function(){if(T[t])a.css("max-height","none")},n));else a.css({"max-height":r,height:r}).data("animate",setTimeout(function(){a.css("max-height","").data("animate",setTimeout(function(){if(!T[t])a.css("height","")},n))},10))};var Re=function e(i){Ne();var t=false;var n="";var a;if(T.shared_files&&!Xe(i)){ei(i);t=true}if(!T.shared_files)return;if(t)n=TS.templates.infinite_spinner({color:"white",size:"medium"});o.toggleClass("loading",!!t);if(n){o.html(n);Oe("shared_files");return}for(var r=0;r<TS.model.files.length;r+=1){a=TS.model.files[r];if(a.is_deleted)continue;if(N(a))if(v.length<y){v.push(a);n+=TS.templates.builders.fileHTML(a)}}if(v.length>=y)if(i.is_im){var s=TS.members.getPotentiallyUnknownMemberById(i.user);n+=TS.templates.channel_page_view_all_files_link({model_ob:i,member:s})}else n+=TS.templates.channel_page_view_all_files_link({model_ob:i});if(n)o.html(n);else o.html(TS.templates.channel_page_empty_shared_files({model_ob:i}));Oe("shared_files");Ke()};var Ne=function e(){Oe("shared_files");v=[];o.empty()};var He=null;var Qe=function e(i){if(!TS.apps.permissions.areXoxaAppsInstalled())return;Le();if(TS.apps.isCurrentModelViewAnApp())return;if(!He)Ge();if(!T.apps)return;m.html(TS.templates.infinite_spinner({color:"white",size:"medium"}));Oe("apps");TS.apps.permissions.promiseToGenerateAppAndBotListForResource(i.id).then(function(e){He=e.length;Ge(He);m.html(TS.templates.channel_page_apps_list({apps:e}));Oe("apps")})};var Le=function e(){Oe("apps");m.empty()};var Ge=function e(i){var t=i?TS.i18n.t("{app_count, plural, =1 {# App} other {# Apps}}","channel_pages")({app_count:i}):TS.i18n.t("Apps","channel_pages")();$("[data-js=channel_page_apps_title]").text(t)};var je=function e(i){if(!ce())return;if(!_e(i))return;Qe(i)};var Ke=function e(){We();p=i.find(".lazy").lazyload({container:i});qe()};var We=function e(){if(p&&p.detachEvents){p.detachEvents();p=null}};var Ve;var qe=function e(){TS.utility.cancelRAF(Ve);Ve=TS.utility.rAF(function(){i.trigger("resize-immediate")})};var ze=function e(i){var t;if("message"===i.type)t=n.find('.pinned_item[data-type="message"][data-ts="'+i.message.ts+'"]');else if("file"===i.type)t=n.find('.pinned_item[data-type="file"][data-file-id="'+i.file.id+'"]');else if("file_comment"===i.type)t=n.find('.pinned_item[data-type="file_comment"][data-comment-id="'+i.comment.id+'"]');return t};var Ye=function e(i){if("file_comment"!==i.type)return;var t=TS.files.getFileCommentById(i.file,i.comment.id);i.comment=t};var Je=function e(i){if(false===i.has_pins)return true;return TS.pins.havePinsBeenFetched(i)};var Ze=function e(i){if(TS.pins.arePinsCurrentlyBeingFetched(i))return;TS.pins.fetchPins(i)};var Xe=function e(i){return!!b[i.id]};var ei=function e(i){if(w[i.id])return;w[i.id]=true;TS.files.fetchChannelFiles(i.id,function(e){delete w[i.id];if(!e)return;b[i.id]=true},y)};var ii=1989;var ti={};var ni=true;var ai={};var ri=function e(i){if(!TS.boot_data.feature_sli_channel_insights)return;if(!TS.client.ui.channel_insights.isEnabled())return;if(!T.about)return;var t=$('[data-js="sli_channel_insights_section"]');var n=TS.shared.getTypeForModelOb(i);if("channel"!==n&&"group"!==n){t.html("");return}if(ti[i.id])return;if(TS.client.ui.channel_insights.last_details_response&&TS.client.ui.channel_insights.last_details_response.channel===i.id)t.html(TS.client.ui.channel_insights.renderInsightsSection(TS.client.ui.channel_insights.last_details_response.response));else{t.html(TS.client.ui.channel_insights.renderLoadingState());ti[i.id]=true;TS.api.call("channels.insights",{channel:i.id,modules:"group"===n?"top_contributors":"top_contributors,similar_channels"}).then(function(e){return TS.client.ui.channel_insights.ensureChannelMemberCounts(e)}).then(function(e){if(TS.shared.getActiveModelOb().id===i.id){$('[data-js="sli_channel_insights_section"]').html(TS.client.ui.channel_insights.renderInsightsSection(e));TS.client.ui.channel_insights.last_details_response={channel:i.id,response:e};si("top_contributors,similar_channels",i.id,e.request_id)}}).catch(function(e){TS.error(e);if(TS.shared.getActiveModelOb().id===i.id)$('[data-js="sli_channel_insights_section"]').html("")}).finally(function(){delete ti[i.id]})}};var si=function e(i,t,n){TS.clog.track("CHANNEL_INSIGHTS_MODULE_SHOWN",{channel_id:t,request_id:n,module:i})};var oi=function e(){Oe("highlights");if(c)c.html("")};var li=function e(){if(TS.boot_data.feature_sli_channel_insights)$("#highlights_title").text(TS.i18n.t("Highlights","channel_page")())};var di=function e(i){if(!TS.boot_data.feature_sli_channel_insights)return;var t=TS.shared.getTypeForModelOb(i);if("channel"!==t&&"group"!==t){if(!ni){u.addClass("hidden");ni=true}return}if(!T.highlights||!c)return;if(ni){u.removeClass("hidden");ni=false}if(ai[i.id])return;if(TS.client.ui.channel_insights.last_highlights_response&&TS.client.ui.channel_insights.last_highlights_response.channel===i.id){gi(i,TS.client.ui.channel_insights.last_highlights_response.response);Oe("highlights")}else{c.html(TS.client.ui.channel_insights.renderLoadingState());$("#highlights_title").text(TS.i18n.t("Highlights","channel_page")());Oe("highlights");ai[i.id]=true;TS.api.call("channels.insights",{channel:i.id,modules:"highlights"}).then(function(e){if(TS.shared.getActiveModelOb().id===i.id){TS.client.ui.channel_insights.last_highlights_response={channel:i.id,response:e};gi(i,e);si("highlights",i.id,e.request_id)}}).catch(function(){if(TS.shared.getActiveModelOb().id===i.id)gi(i,{})}).finally(function(){delete ai[i.id]})}};var ci=604800;var _i=2678400;var ui=3*_i;var mi=6*_i;var fi=function e(){return new Date/1e3};var hi=function e(i,t){return'<div class="c-channel_insights__message">\n\t\t'+TS.templates.builders.msgs.buildHTML({msg:i,model_ob:t,enable_slack_action_links:false,container_id:"channel_page_scroller",prev_msg:null,briefing:true,full_date:true,standalone:true})+"\n\t</div>"};var gi=function e(i,t){if(TS.boot_data.feature_sli_channel_insights)if(_.get(t,"data.top_messages.messages.length")){var n="";var a=fi();var r=_.reduce(_.reverse([].concat(t.data.top_messages.messages)),function(e,i){if(i.ts>=a-ci)e.this_week.push(i);else if(i.ts>=a-_i)e.this_month.push(i);else if(i.ts>=a-ui)e.within_past_three_months.push(i);else if(i.ts>=a-mi)e.within_past_six_months.push(i);else e.older.push(i);return e},{this_week:[],this_month:[],within_past_three_months:[],within_past_six_months:[],older:[]});var s=!!_.get(t,"data.top_messages.debug");n+='<p class="c-channel_insights__highlights_description">'+TS.i18n.t("Below {count, plural, =1 {is the top message} other {are a few of the top messages}} in <strong>{channel_name}</strong>.","channel_page")({channel_name:TS.shared.getDisplayNameForModelOb(i),count:t.data.top_messages.messages.length})+"\n\t\t\t"+(s?TS.client.ui.channel_insights.buildDebugTooltip("top-messages"):"")+"\n\t\t\t</p>";if(r.this_week.length){n+='<h4 class="c-channel_insights__date_heading">\n\t\t\t\t\t<span>'+TS.i18n.t("This week","channel_page")()+"</span>\n\t\t\t\t</h4>";n+=r.this_week.map(function(e){return hi(e,i)}).join("")}if(r.this_month.length){n+='<h4 class="c-channel_insights__date_heading">\n\t\t\t\t\t<span>'+TS.i18n.t("This month","channel_page")()+"</span>\n\t\t\t\t</h4>";n+=r.this_month.map(function(e){return hi(e,i)}).join("")}if(r.within_past_three_months.length){n+='<h4 class="c-channel_insights__date_heading">\n\t\t\t\t\t<span>'+TS.i18n.t("More than a month ago","channel_page")()+"</span>\n\t\t\t\t</h4>";n+=r.within_past_three_months.map(function(e){return hi(e,i)}).join("")}if(r.within_past_six_months.length){n+='<h4 class="c-channel_insights__date_heading">\n\t\t\t\t\t<span>'+TS.i18n.t("More than 3 months ago","channel_page")()+"</span>\n\t\t\t\t</h4>";n+=r.within_past_six_months.map(function(e){return hi(e,i)}).join("")}if(r.older.length){n+='<h4 class="c-channel_insights__date_heading">\n\t\t\t\t\t<span>'+TS.i18n.t("More than 6 months ago","channel_page")()+"</span>\n\t\t\t\t</h4>";n+=r.older.map(function(e){return hi(e,i)}).join("")}c.html(n);c.find(".c-channel_insights__message").each(function(e,i){var t=$(i).find(".message_body");if(t.length&&t.outerHeight()>=260)$(i).addClass("c-channel_insights__message--truncate")});$("#highlights_title").text(TS.i18n.t("{count, plural, =1 {# Highlight} other {# Highlights}}","channel_page")({count:t.data.top_messages.messages.length}))}else{c.html('\n\t\t\t\t<p class="c-channel_insights__empty italic greigh">\n\t\t\t\t\t'+TS.i18n.t("<strong>Nothing yet.</strong> When this channel gets a bit more active, check back here.","channel_pages")()+"\n\t\t\t\t</p>\n\t\t\t");$("#highlights_title").text(TS.i18n.t("Highlights","channel_page")())}};var pi=function e(i,t){if(_.isArray(i.shares)&&_.isObject(i.shares[0])){var n=i.shares[0];if(n){var a=TS.members.getPotentiallyUnknownMemberById(i.creator);var r=a&&!TS.utility.teams.isMemberExternal(a);var s=t===TS.model.team.id;var o=s?n.user:n.accepted_user;if(r&&s||!r&&!s)return TS.i18n.t("Shared by {admin_name}","channel_pages")({admin_name:TS.members.getMemberRealName(o)});return TS.i18n.t("Added by {admin_name}","channel_pages")({admin_name:TS.members.getMemberRealName(o)})}}}})()},4963:function(e,i){(function(){TS.registerModule("client.channel_page.members_dialog",{show:l,updateMembers:d,isShowing:o,test:function e(){var i={updateMembersInDialog:d};Object.defineProperty(i,"filterMembersInDialog",{get:function e(){return u},set:function e(i){u=i}});Object.defineProperty(i,"getFilter",{get:function e(){return c},set:function e(i){c=i}});Object.defineProperty(i,"members",{get:function e(){return t},set:function e(i){t=i}});return i}});var e;var i;var t;var n="all_members_dialog";function a(e){$(window.document).bind("keydown",r);var i=new TS.SearchableMemberList({$container:$("#channel_membership_dialog_container"),id:"channel_membership_dialog",model_ob_id:e.id,triggered_by_user_action:true});i.showInitial()}var r=function e(i){if(i.which==TS.utility.keymap.esc)if(""===TS.generic_dialog.div.find("input").val())TS.generic_dialog.cancel()};var s=function e(){TS.generic_dialog.cancel()};function o(){if(!TS.generic_dialog.is_showing)return false;return TS.generic_dialog.current_setting.dialog_class==n}function l(o,l,d){var c=TS.templates.channel_page_all_members_dialog();var u=TS.i18n.t("{member_count, number} members in {channel_name}","channel_pages")({member_count:_.isUndefined(d)?l.length:d,channel_name:TS.shared.getDisplayNameForModelOb(o)});t=l;TS.generic_dialog.start({dialog_class:n,title:u,body:c,cancel_button_text:TS.i18n.t("Close","channel_pages")(),hide_footer:true,show_cancel_button:true,show_go_button:false,backdrop_click_to_dismiss:true,onShow:function e(){a(o)},onEnd:function n(){var a=TS.SearchableMemberList.get("channel_membership_dialog");if(a)a.destroy();TS.generic_dialog.div.remove();TS.generic_dialog.div=void 0;e=void 0;i=void 0;t=void 0;TS.menu.member.member_item_click_sig.remove(s);$(window.document).unbind("keydown",r)}})}function d(e){if(!o())return;t=e;var i=c();var n=true;u(i,n)}function c(){var e=TS.generic_dialog.div.find("#all_members_filter input");return _.toString(e.val()).toLowerCase().trim()}function u(n,a){if(a)e=void 0;if(n&&n===e)return;if(i&&e&&n&&_.includes(n,e))i=TS.utility.members.filterMembersByQuery(i,n);else i=TS.utility.members.filterMembersByQuery(t,n);e=n;var r=true;var s=TS.generic_dialog.div.find("#all_members_container");s.longListView("setItems",i,r);s.toggleClass("invisible",!i.length);TS.generic_dialog.div.find("#all_members_no_matches").toggleClass("hidden",i.length>0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(s)})}})()},4964:function(e,i){function t(e){if(Array.isArray(e)){for(var i=0,t=Array(e.length);i<e.length;i++)t[i]=e[i];return t}else return Array.from(e)}(function(){TS.registerModule("ui.channel_browser",{onStart:function e(){TS.channels.list_fetched_sig.add(p);TS.view.members.unknown_resolution_rebuild_sig.add(S);TS.channels.unshared_sig.add(v);TS.channels.joined_sig.add(T);TS.channels.left_sig.add(T);TS.groups.joined_sig.add(T);TS.groups.left_sig.add(T)},start:function e(){if(TS.model.user.is_ultra_restricted)return;if(TS.client.ui.checkForEditing())return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var i="channel_browser_show";var t="start_channel_browser_show";TS.metrics.mark(t);var n=TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups();var a=TS.i18n.t("Browse channels","channel_browser")();var r;var s;if(TS.model.ui_state){r=TS.model.ui_state.channel_browser_show_which_channels;s=TS.model.ui_state.sort_channel_browser_by}else{r="all";s="name"}var o=TS.templates.channel_browser({show_which_channels_selected:r,sort_by_selected:s,can_create:n,title:a,external_teams:TS.teams.getAllExternalTeams()});TS.ui.fs_modal.start({body_template_html:o,onShow:m,onEnd:h,modal_class:"fs_modal_internal_scroll"});TS.metrics.measureAndClear(i,t);TS.clog.track("CHANNEL_BROWSER_OPEN",{is_admin:TS.model.user.is_admin,enable_shared_channels_pref:TS.prefs.getTeamPref("enable_shared_channels")})},endAndStartSharedChannelDialog:function e(){h();TS.ui.share_channel_dialog.start({element:"shared_channels_channel_browser_create_btn"})},test:function e(){var i={onShow:m,onEnd:h,channelsListFetched:p,filterList:M,sortChannels:D};Object.defineProperty(i,"_openChannel",{get:function e(){return H},set:function e(i){H=i}});Object.defineProperty(i,"_confirmIntentToDisconnectSharedChannel",{get:function e(){return Q},set:function e(i){Q=i}});return i}});var e=false;var i=false;var n=null;var a;var r;var s;var o;var l;var d;var c;var u;var m=function i(){e=true;r=$("#channel_browser");s=r.find("#channel_list_container");o=r.find("#channel_browser_filter");l=r.find("#channel_browser_sort");u=r.find("#show_which_channels");c=$("#new_channel_container");F();if(TS.model.ui_state&&TS.model.ui_state.sort_channel_browser_by)l.find('option[value="'+TS.model.ui_state.sort_channel_browser_by+'"]').prop("selected",true);if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels)){if(C({},TS.model.ui_state.channel_browser_show_which_channels)){TS.model.ui_state.channel_browser_show_which_channels="all";TS.storage.storeUIState(TS.model.ui_state)}u.find('option[value="'+TS.model.ui_state.channel_browser_show_which_channels+'"]').prop("selected",true)}g();if(f()){a=false;TS.channels.fetchList()}else p()};var f=function e(){if(!a)return true;return _.some(TS.model.channels,function(e){return!e.is_member&&void 0==e.num_members})};var h=function t(){e=false;i=false;n=null;TS.kb_nav.end();if(r)r.remove();r=null;s=null;o=null;l=null;u=null;if(c)c.remove();c=null;O();TS.ui.new_channel_modal.end()};var g=function t(){var a={classes:"show_which_channels_selector",onItemAdded:function t(n){if(!e||!i)return;var a;var r;if(TS.useReactLFS())r=n.value;else{a=$(n);r=a.val()}if(TS.model.ui_state){TS.model.ui_state.channel_browser_show_which_channels=r;TS.storage.storeUIState(TS.model.ui_state)}if("archived"===r)if(TS.useReactLFS())h();else{l.lazyFilterSelect("update",_.toArray(l.children()).filter(function(e){return"members_low"!==e.value&&"members_high"!==e.value}));if("members_low"===TS.model.ui_state.sort_channel_browser_by||"members_high"===TS.model.ui_state.sort_channel_browser_by)l.lazyFilterSelect("setValue","name")}else if(TS.useReactLFS())h();else l.lazyFilterSelect("update");M({show_which_channels:r})},template:function e(i){if(TS.useReactLFS())return i.label;var t=$(i);return new Handlebars.SafeString(t.text())},tokenTemplateSingle:function e(i){if(TS.useReactLFS())return TS.interop.lazyFilterSelect.channelBrowserShowWhichChannelsToken(i);var t=$(i);var n=TS.i18n.t('<span class="greigh">Show:</span> {value}',"channel_browser")({value:t.text()});return new Handlebars.SafeString(n)},listItemClass:function e(){return"capitalize"}};if(TS.useReactLFS()){var c=document.getElementById("show_which_channels_react");var m=TS.ui.lazy_filter_select.convertHTMLDataToRLFSData(u);a=_.assign({},a,{items:_.concat([],m),tokenTemplate:a.tokenTemplateSingle,single:true,styling:"small",onListShown:function e(){TS.ui.lazy_filter_select.is_list_open=true;TS.kb_nav.pause(true)},onListHidden:function e(){TS.ui.lazy_filter_select.is_list_open=false;TS.kb_nav.pause(false)}});TS.interop.mountLazyFilterSelect(TS.boot_data.team_id,c,a);u.hide()}else u.hide().lazyFilterSelect(a);var f={classes:"channel_browser_sort",onItemAdded:function t(a){if(!e||!i)return;var r;var s;if(TS.useReactLFS())s=a.value;else{r=$(a);s=r.val()}if(TS.model.ui_state){TS.model.ui_state.sort_channel_browser_by=s;TS.storage.storeUIState(TS.model.ui_state)}D(n,s);var o=null;if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels))o=TS.model.ui_state.channel_browser_show_which_channels;M({show_which_channels:o})},template:function e(i){if(TS.useReactLFS())return i.label;var t=$(i);return new Handlebars.SafeString(t.text())},tokenTemplateSingle:function e(i){if(TS.useReactLFS())return TS.interop.lazyFilterSelect.channelBrowserSortByToken(i);var t=$(i);var n=TS.i18n.t('<span class="greigh">Sort:</span> {value}',"channel_browser")({value:t.text()});return new Handlebars.SafeString(n)}};function h(e){if(!e){e=TS.ui.lazy_filter_select.convertHTMLDataToRLFSData(l);if(TS.model.ui_state&&TS.model.ui_state.channel_browser_show_which_channels&&"archived"===TS.model.ui_state.channel_browser_show_which_channels){e=e.filter(function(e){return"members_low"!==e.value&&"members_high"!==e.value});if("members_low"===TS.model.ui_state.sort_channel_browser_by||"members_high"===TS.model.ui_state.sort_channel_browser_by)e=e.map(function(e){e.preselected="name"===e.value;return e})}}var i=document.getElementById("channel_browser_sort_react");$(i).html("");f=_.assign({},f,{items:_.concat([],e),tokenTemplate:f.tokenTemplateSingle,single:true,styling:"small"});TS.interop.mountLazyFilterSelect(TS.boot_data.team_id,i,f)}if(TS.useReactLFS()){h();l.hide()}else l.hide().lazyFilterSelect(f);s.on("click",".channel_browser_row",function(e){H($(this),e)});o.on("textchange",function(){if(!e||!i)return;var t=null;if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels))t=TS.model.ui_state.channel_browser_show_which_channels;M({show_which_channels:t})}).on("keydown",function(e){if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()});d.on("click",".about_channels",function(e){e.preventDefault();TS.ui.fs_modal.close();setTimeout(function(){TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.channels,{ui_click:true}))},500)});r.on("click",".new_channel",R);r.on("click",".clear_filter_icon",function(){o.val("").trigger("textchange").focus()})};var p=function t(){a=true;if(!e||i)return;var n=null;if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels))n=TS.model.ui_state.channel_browser_show_which_channels;M({show_which_channels:n,init:true})};var S=function e(i){w(function(e){return e.creator===i.id})};var T=function e(i){w(function(e){return e.id===i.id},{should_reapply_filters:true})};var v=function e(i){w(function(e){return e.id===i.id},{should_reapply_filters:true})};var b=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!i)return;var a=s.longListView("getCurrentVisibleItemsInView");if(n.should_reapply_filters&&a.some(t))M({show_which_channels:TS.model.ui_state.channel_browser_show_which_channels});else a.filter(t).forEach(function(e){s.longListView("itemUpdatedById",e.id)})};var w=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!i)return;if(s.longListView("isScrolling"))s.longListView("getCurrentVisibleItemsInViewSignal").addOnce(b.bind(void 0,t,n));else b(t,n)};var y=function e(i,t){var n=$(".channel_modal_list").find('[data-channel-id="'+i.id+'"]');var a=n.find(".channel_browser_teams");a.html(TS.templates.shared_channel_list_team_icon({canceled:true,target_team:t}))};var A=function e(i,t,n){var a=[];var r=TS.model.user.is_admin;if(r&&i.length>0&&TS.boot_data.feature_esc_cancel_invitations_button){a.push({is_divider:true,first_divider:true,name:TS.i18n.t("Pending shared channel invitations","channel_browser")()});a=a.concat(i)}if(t.length>0){a.push({is_divider:true,first_divider:!r||r&&0===i.length,name:TS.i18n.t("Channels you can join","channel_browser")()});a=a.concat(t)}if(n.length>0){a.push({is_divider:true,name:TS.i18n.t("Channels you belong to","channel_browser")()});a=a.concat(n)}return a};var k=function e(){s.longListView({items:n,approx_item_height:60,preserve_dom_order:true,calcDividerHeight:function e(i,t){if(t.first_divider)return 32;return 61},makeElement:function e(i){var t=$(TS.templates.channel_browser_row());i.$icon=t.find(".channel_browser_type_icon");i.$name=t.find(".channel_browser_channel_name");i.$creator=t.find(".channel_browser_created_by");i.$date=t.find(".channel_browser_created_on");i.$purpose=t.find(".channel_browser_channel_purpose");i.$external_shared_channels_icon=t.find(".shared_channels_icon");i.$external_shared_channels_pending_icon=t.find(".shared_channels_pending_icon");i.$member_count=t.find(".channel_browser_member_count");i.$open=t.find(".channel_browser_open");i.$preview=t.find(".channel_browser_preview");i.$joined=t.find(".channel_browser_joined");i.$shared_channel_icon=t.find(".shared_channel_icon");i.$teams=t.find(".channel_browser_teams");return t},makeDivider:function e(){return $("<div>").addClass("channel_browser_divider")},renderItem:function e(i,t,n){if(TS.shared.isModelObOrgShared(t)){n.$shared_channel_icon.removeClass("hidden");n.$external_shared_channels_icon.addClass("hidden");n.$external_shared_channels_pending_icon.addClass("hidden")}else if(TS.shared.isModelObPendingShared(t)){var a=n.$external_shared_channels_pending_icon.find(".ts_icon_shared_channels");a.removeClass("ts_icon_shared_channels");a.addClass("ts_icon_shared_channels_pending");n.$external_shared_channels_pending_icon.removeClass("hidden");n.$external_shared_channels_icon.addClass("hidden");n.$shared_channel_icon.addClass("hidden")}else if(TS.shared.isModelObShared(t)){n.$external_shared_channels_icon.removeClass("hidden");n.$shared_channel_icon.addClass("hidden");n.$external_shared_channels_pending_icon.addClass("hidden")}else{n.$external_shared_channels_icon.addClass("hidden");n.$shared_channel_icon.addClass("hidden");n.$external_shared_channels_pending_icon.addClass("hidden")}if(t.is_group||t.is_private)n.$icon.removeClass("ts_icon_channel_pane_hash ts_icon_archived_channel").addClass("ts_icon_lock");else if(t.is_archived)n.$icon.removeClass("ts_icon_lock ts_icon_channel_pane_hash").addClass("ts_icon_archived_channel");else n.$icon.removeClass("ts_icon_lock ts_icon_archived_channel").addClass("ts_icon_channel_pane_hash");n.$name.text(t.name);var r=s.longListView("isScrolling");var o=TS.members.getMemberById(t.creator,r);if(o){n.$creator.removeClass("hidden");n.$creator.find(".channel_browser_creator_name").text(TS.members.getPrefCompliantMemberName(o))}else n.$creator.addClass("hidden");n.$date.text(TS.interop.datetime.toCalendarDate(t.created));var l=U(t);n.$member_count.text(l);if(t.purpose&&t.purpose.value){var d=TS.utility.formatTopicOrPurpose(t.purpose.value);d=d.replace(/<a .*?>(.*?)<\/a>/g,"$1");n.$purpose.removeClass("hidden").html(d)}else n.$purpose.text("").addClass("hidden");var c=t.is_member||t.is_group;if(c){n.$open.removeClass("hidden");n.$preview.addClass("hidden");n.$joined.removeClass("hidden")}else{n.$open.addClass("hidden");n.$preview.removeClass("hidden");n.$joined.addClass("hidden")}if(t.is_group){i.removeClass("channel_link").removeAttr("data-channel-id");i.addClass("group_link").attr("data-group-id",t.id)}else{i.removeClass("group_link").removeAttr("data-group-id");i.addClass("channel_link").attr("data-channel-id",t.id)}if(TS.shared.isModelObShared(t)||TS.shared.isModelObPendingShared(t)){var u=_.map(TS.utility.teams.getTeamsForModelOb(t),"id");var m=_.map(TS.utility.teams.getTeamsForModelOb(t,{only_pending:true}),"id");var f=TS.templates.shared_channel_list_team_icon({shared_team_ids:u,pending_shared_team_ids:m});n.$teams.html(f);if(!n.$teams.parent().length)i.append(n.$teams)}else n.$teams.remove()},renderDivider:function e(i,t){i.text(t.name)},calcItemHeight:function e(i){return i.outerHeight()}});if(!TS.environment.supports_custom_scrollbar)s.monkeyScroll();i=true;TS.kb_nav.start(s.find(".list_items"),".channel_browser_row",s,{use_data_ordering:true,px_offset:35,scrollToStartImmediately:function e(){s.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){s.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){H($(this),e)})};var C=function e(i,t){if("all"===t)return!i.is_archived;if("local"===t)return!TS.shared.isModelObShared(i)&&!TS.shared.isModelObOrgShared(i)&&!i.is_archived;if("org_shared"===t)return TS.shared.isModelObOrgShared(i)&&!i.is_archived;if("ext_shared"===t)return TS.shared.isModelObShared(i);if("pending_ext_shared"===t)return TS.shared.isModelObPendingShared(i);if(t.indexOf("ext_shared_team")>-1){if(TS.shared.isModelObShared(i)){if(i.shared_team_ids&&i.shared_team_ids.some(function(e){return t.indexOf(e)>-1}))return true;return i.pending_shared&&i.pending_shared.some(function(e){return t.indexOf(e)>-1})}return false}if("archived"===t)return i.is_archived;if("private"===t)return(i.is_group||i.is_private)&&!i.is_archived;return true};var M=function e(t){t=t||{};if(!t.show_which_channels)t.show_which_channels="all";var a="channel_browser_search";var r="start_channel_browser_search";TS.metrics.mark(r);var d=$.trim(o.val());if(""!==d)if(-1!==d.indexOf("#")){d=d.replace("#","","g");d=$.trim(d)}if(d)o.closest(".channel_browser_filter_container").addClass("active");else o.closest(".channel_browser_filter_container").removeClass("active");var c=TS.searcher.search(d,x({show_which_channels:t.show_which_channels}));c.then(function(e){n=e;if(TS.model.ui_state&&TS.model.ui_state.sort_channel_browser_by){D(n,TS.model.ui_state.sort_channel_browser_by);P(TS.model.ui_state.sort_channel_browser_by)}else{D(n,l.val());P(l.val())}if("archived"!==t.show_which_channels&&"private"!==t.show_which_channels){var o=I(n);n=A(o.pending_shared_channels,o.non_member_channels,o.member_channels)}if(t.init){s.empty();k()}else if(i)s.longListView("setItems",n);if(0===n.length)E(d);else B();s.scrollTop(0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(s)});if(d)TS.kb_nav.highlightFirstItem();else TS.kb_nav.clearHighlightedItem();TS.metrics.measureAndClear(a,r)})};var I=function e(i){var t;var n;var a;var r=_.partition(i,function e(i){return i.is_member||i.is_group});if(TS.model.user.is_admin){var s=_.partition(r[0],TS.shared.isModelObPendingShared);var o=_.partition(r[1],TS.shared.isModelObPendingShared);t=_.concat(s[0],o[0]);a=s[1];n=o[1]}else{t=[];n=r[1];a=r[0]}return{pending_shared_channels:t,non_member_channels:n,member_channels:a}};var x=function e(i){i=i||{};return{channels:{exclude_mpims:true},groups:true,filter:function e(t){t.channels=_.filter(t.channels,function(e){return C(e,i.show_which_channels)});t.groups=_.filter(t.groups,function(e){return C(e,i.show_which_channels)});return t},sort:{allow_empty_query:true,frecency:false},limit:Infinity}};var E=function e(i){var t="ext_shared"===TS.model.ui_state.channel_browser_show_which_channels||"pending_ext_shared"===TS.model.ui_state.channel_browser_show_which_channels;var n=$("#channel_browser_empty");var a=n.find(".channel_browser_empty_message");if(i)a.html(TS.i18n.t("No matches found for <strong>{query}</strong>","channel_browser")({query:TS.utility.truncateAndEscape(i,50)}));else if(t&&TS.permissions.members.canRequestSharedChannel())a.html(TS.templates.shared_channels_empty_state_for_channel_browser({can_create_shared_channel:TS.permissions.members.canCreateSharedChannel(),show_pending_shared_channels:"pending_ext_shared"===TS.model.ui_state.channel_browser_show_which_channels}));else a.text(TS.i18n.t("No channels","channel_browser")());n.removeClass("hidden")};var B=function e(){var i=$("#channel_browser_empty");i.addClass("hidden")};var P=function e(i){TS.clog.track("CHANNEL_BROWSE_SORT",{sort_type:i})};var D=function e(i,t){var n=["name","creator","created","members_high","members_low"];var a="name";if(-1!==n.indexOf(t))a=t;if("creator"===a)i.sort(function(e,i){var t=TS.members.getMemberById(e.creator);var n=TS.members.getMemberById(i.creator);return TS.i18n.sorter(TS.members.getPrefCompliantMemberNameLowerCase(t),TS.members.getPrefCompliantMemberNameLowerCase(n))});else if("created"===a)i.sort(function(e,i){if(e.created<i.created)return 1;if(i.created<e.created)return-1;return 0});else if("members_high"===a)i.sort(function(e,i){var t=U(e);var n=U(i);if(t<n)return 1;if(n<t)return-1;return 0});else if("members_low"===a)i.sort(function(e,i){var t=U(e);var n=U(i);if(t>n)return 1;if(n>t)return-1;return 0})};var U=function e(i){return i.num_members||_.get(i,"active_members.length")||0};var F=function e(){d=$(TS.templates.channel_browser_footer()).appendTo("#fs_modal")};var O=function e(){if(d)d.remove();d=null};var R=function e(){var i=$.trim(o.val());TS.ui.new_channel_modal.startInContainer(c,i);r.addClass("hidden");$("#fs_modal").removeClass("fs_modal_internal_scroll");c.removeClass("no_opacity");d.addClass("hidden");TS.ui.fs_modal.bindBackButton(N);TS.ui.fs_modal.showBackButton()};var N=function e(){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();c.addClass("no_opacity");$("#fs_modal").addClass("fs_modal_internal_scroll");r.removeClass("hidden");d.removeClass("hidden");TS.ui.new_channel_modal.end();o.focus();if(i)s.longListView("resizeImmediately");TS.ui.utility.updateClosestMonkeyScroller(s)};var H=function e(i,t){var n;var a;var r;if($(t.target).closest(".channel_browser_teams_disconnect_shared_channel").length){a=i.data("channel-id");r=i.data("group-id");Q(a||r);return}if(TS.boot_data.feature_esc_cancel_invitations_button)if($(t.target).closest(".channel_browser_revoke_share_invite").length){a=i.data("channel-id")||i.data("group-id");n=TS.channels.getChannelById(a);var s=n.pending_shared[0];TS.teams.ensureTeamsArePresent([s]).then(function(){L(a,s)});return}if(i.hasClass("channel_link")){a=i.data("channel-id");n=TS.channels.getChannelById(a);if(n)TS.clog.track("CHANNELBROWSER_SELECT",{item_id:a,item_type:a.charAt(0),is_member:n.is_member});TS.view.onChannelReferenceClick(t,a)}else{r=i.data("group-id");TS.clog.track("CHANNELBROWSER_SELECT",{item_id:r,item_type:r.charAt(0)});TS.view.onGroupReferenceClick(t,r)}TS.ui.fs_modal.close()};var Q=function e(i){var n;var a=TS.shared.getModelObById(i);var r=_.map(TS.utility.teams.getTeamsForModelOb(a,{include_pending:true}),"id");var s=[TS.model.team.id].concat(t(r));var o=TS.templates.channel_stop_sharing_dialog({model_ob:a,team_ids:s});TS.generic_dialog.start({title:TS.i18n.t("Stop sharing {channel_name}","shared")({channel_name:TS.templates.builders.makeModelObNameForDisplay(a,{inherit_font_size:true})}),body:o,go_button_text:TS.i18n.t("Stop Sharing","shared")(),go_button_class:"btn_danger",onGo:function e(){TS.clog.track("SHARED_CHANNELS_STOP_SHARING_ACTION",{is_last_channel_with_team:n,contexts:{ui_context:{action:"click",ui_element:"SHARED_CHANNELS_STOP_SHARING_CONFIRM_SUBMIT_BTN",ui_component:"CHANNEL_BROWSER"}}});TS.shared.disconnectSharedChannel(a)},onCancel:function e(){TS.clog.track("SHARED_CHANNELS_STOP_SHARING_ACTION",{is_last_channel_with_team:n,contexts:{ui_context:{action:"click",ui_element:"SHARED_CHANNELS_STOP_SHARING_CONFIRM_CANCEL_BTN",ui_component:"CHANNEL_BROWSER"}}})}});var l=$("#generic_dialog .dialog_go");l.toggleClass("disabled",true);TS.teams.getTeamIdsConnectedOnlyByModelOb(a).then(function(e){n=!!e.length;if(n){var i=TS.i18n.listify(_.map(e,TS.teams.getTeamNameById)).join("");$(".p-stop_sharing_channel_dialog__last_channel_team_names").text(i);$(".p-stop_sharing_channel_dialog__last_channel_alert").removeClass("hidden")}TS.clog.track("SHARED_CHANNELS_STOP_SHARING_ACTION",{is_last_channel_with_team:n,contexts:{ui_context:{action:"click",ui_element:"SHARED_CHANNELS_CHANNEL_BROWSER_STOP_SHARING_BTN",ui_component:"CHANNEL_BROWSER"}}});l.toggleClass("disabled",false)})};var L=function e(i,t){if(!TS.boot_data.feature_esc_cancel_invitations_button)return;var n=TS.shared.getModelObById(i);TS.api.callImmediately("conversations.sharedInviteInfo",{channel:i,target_team:t}).then(function(e){var i=e.data;var a=i.invite.user;var r=TS.teams.getTeamById(t);var s=TS.templates.channel_revoke_share_invite_dialog({target_team:r,inviter_name:a.profile.real_name,invite_sent_by_user:TS.model.user.id===a.id});TS.generic_dialog.start({dialog_class:"p-channel_revoke_share_invite_dialog",title:TS.i18n.t("Cancel invitation?","shared")(),body:s,go_button_text:TS.i18n.t("Cancel Invitation","shared")(),cancel_button_text:TS.i18n.t("Never Mind","shared")(),go_button_class:"btn_danger",onGo:function e(){y(n,r);TS.shared.revokeSharedChannelInvite(n,r)}})})}})()},4965:function(e,i){(function(){TS.registerModule("ui.im_browser",{onStart:function e(){d=new TS.PresenceList;TS.redux.socket.connectedSig.add(I)},start:function e(i){i=i||{};if(TS.client.ui.checkForEditing())return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}M();b(i)},startWithMpim:function e(i,t){if(!i)return;var n=i.members.concat(t);TS.ui.im_browser.start({preselected_ids:n})},test:function e(){return{onShow:w,onEnd:y,getLastMsg:x}},getRecentDMList:function e(){return A()}});var e;var i;var t;var n;var a;var r;var s;var o;var l={};var d;var c=false;var u;var m;var f=false;var h=null;var g=null;var p=null;var S=64;var T=24;var v=8;var b=function e(i){c=!!i.is_admin_only_mode;h=i.submit_callback;s=[];l={};if(i.preselected_ids)i.preselected_ids.forEach(function(e){var i=TS.members.getMemberById(e);if(!i)return;if(i.is_self)return;if(i.deleted)return;if(i.is_slackbot)return;if(-1!==s.indexOf(i))return;s.push(i);l[i.id]=true});var t=TS.templates.im_browser({is_admin_only_mode:c,title:i.title,subtitle:i.subtitle,team_name:TS.model.team.name,preselected:s,reached_maximum:s.length===v,quickswitcher_shortcut:TS.model.is_mac?"⌘K":"Ctrl+K"});TS.ui.fs_modal.start({body_template_html:t,onShow:w,onEnd:y,modal_class:"fs_modal_internal_scroll"})};var w=function e(){i=$("#im_browser");t=$("#im_list_container");if(!s)s=[];ne();M().then(function(){if(TS.boot_data.feature_ms_latest)t.empty();C()});var n=i.find(".im_browser_go")[0];if(n)m=Ladda.create(n);t.on("click",".im_browser_row",function(e){if(0!==$(e.target).closest("a").length)return;K($(this))});i.on("input","#im_browser_filter",function(){B()});i.on("keydown","#im_browser_filter",function(e){var i=$("#im_browser_filter").val();if(e.which===TS.utility.keymap.del&&""===i){V();return}if(e.which===TS.utility.keymap.enter&&""===i){e.preventDefault();if(!TS.kb_nav.getHighlightedItem())L();return}if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();return}if(s.length>=v)e.preventDefault()});i.on("focus","#im_browser_filter",function(){$("#im_browser_tokens").addClass("active")}).on("blur","#im_browser_filter",function(){$("#im_browser_tokens").removeClass("active")});i.on("click","#im_browser_tokens",function(e){var i=$(e.target).closest(".member_token");if(i.length)W(i);else{if($(e.target).closest("#im_browser_filter").length)return;$("#im_browser_filter").focus()}});i.on("click",".im_browser_go:not(.disabled)",function(){L()});i.on("click",".create_private_channel",function(e){e.preventDefault();ae()});setTimeout(function(){$("#im_browser_filter").focus()},0)};var y=function e(){if(i)i.remove();i=null;t=null;n=null;a=null;c=false;r=null;s=null;l={};m=null;f=false;h=null;if(g)g.cancel();p=null;TS.kb_nav.end();TS.ui.new_channel_modal.end();d.clear()};var A=function e(){var i=TS.members.getActiveMembersWithSelfAndSlackbot();var t=TS.channels.getAllVisibleMpimsForUser();var n=i.map(function(e){return{id:e.id,model_ob:TS.ims.getImByMemberId(e.id),member:e}});var a=n;if(t&&t.length>0){var s=t.map(function(e){return{id:e.id,model_ob:e,members:TS.mpims.getMembersInDisplayOrder(e)}});a=n.concat(s)}a.sort(ee);r=a;return r};var k=function e(){g=TS.searcher.search("",ce({initial:true}));g.then(function(e){var n=_.map(e.members,function(e){return{id:e.id,model_ob:TS.ims.getImByMemberId(e.id),member:e,disabled_dm:null}});var a=_.map(e.all_mpims,function(e){return{id:e.id,model_ob:e,members:TS.mpims.getMembersInDisplayOrder(e)}});var s=_.concat(n,a);s.sort(ee);r=s;t.longListView("setItems",r);i.addClass("showing_recent");i.removeClass("filter_active no_filter_matches");X()});return g};var C=function e(){var i;k();i=[];t.longListView({items:i,approx_item_height:S,preserve_dom_order:true,makeElement:function e(){return $('<div class="im_browser_row"></div>')},renderItem:function e(i,t){i.data("row_id",t.id);var n=t.model_ob;i.toggleClass("multiparty",!!(n&&n.is_mpim));i.toggleClass("disabled",!!l[t.id]);if(t.member)i.toggleClass("disabled_dm",!!t.disabled_dm);var a={item:t,model_ob:n,slackbot_msg:u};if(t.members){if(t.members.length>0)a.member_one=t.members[0];if(t.members.length>1)a.member_two=t.members[1]}else if(t.member&&t.member.is_self)a.is_self=true;a.secondary_name=null;if(n&&n.is_mpim)a.display_name=TS.mpims.getDisplayName(n);else{a.display_name=TS.members.getPrefCompliantMemberName(t.member);a.secondary_name=TS.members.getMemberSecondaryName(t.member);if(t.member.profile.title)a.title=t.member.profile.title}var r="";var s="";var o=n&&x(n);var d;var c=false;if(o){var m=o.comment?TS.members.getMemberById(o.comment.user):TS.members.getMemberById(o.user);if(m){if(m.id===TS.model.user.id){r=TS.i18n.t("You","im_browser")()+": ";c=true}else{r=_.escape(E(m));r+=": "}if(o.file&&("file_share"===o.subtype||"file_mention"===o.subtype||"file_reaction"===o.subtype))d=de(o);else{d=TS.format.formatNoHighlightsNoSpecialsNoInlineImgs(o.text,o);d=d.replace(/<a .*?>(.*?)<\/a>/g,"$1")}r+=d;if(c&&!n.is_slackbot_im)s+='<i class="ts_icon ts_icon_angle_arrow_up_left ts_icon_inherit"></i>';s+=TS.interop.datetime.toTimeAgo(o.ts)}}else if(n){var f=TS.shared.getLatestMsgTs(n);if(f)s+=TS.interop.datetime.toTimeAgo(f)}if(r)a.last_msg=new Handlebars.SafeString(r);if(s)a.last_msg_time=new Handlebars.SafeString(s);if(n&&n.unread_cnt>0){var h=t.model_ob.unread_cnt;if(h>10)h="9+";a.unread_cnt=h}i.html(TS.templates.im_browser_row(a))}});if(t.longListView("getCurrentItemsInView")){TS.utility.rAF(function(){var e=t.longListView("getCurrentItemsInView");d.clear();d.add(_.map(e,"id"))});t.longListView("getCurrentItemsInViewSignal").add(function(e){d.clear();d.add(_.map(e,"id"))})}if(!TS.environment.supports_custom_scrollbar)t.monkeyScroll();TS.kb_nav.start(t.find(".list_items"),".im_browser_row",t,{use_data_ordering:true,no_blur:true,scrollToStartImmediately:function e(){t.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){t.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){K($(this));e.preventDefault()});if(s.length&&TS.boot_data.page_needs_enterprise)B();else Z()};var M=function i(){if(!TS.boot_data.feature_ms_latest)Promise.resolve();if(!e)e=TS.shared.promiseToGetImAndMpimLatest();return e};var I=function i(t){if(!t)e=null};var x=function e(i){return TS.shared.getLastMsg(i)};var E=function e(i){if(TS.members.shouldDisplayRealNames())if(i.profile&&i.profile.first_name)return i.profile.first_name;return i.name};var B=function e(){var i=$("#im_browser_filter").val();return N(i)};var P=function e(){U();O()};var D=function e(){F();R()};var U=function e(){var i=document.getElementById("im_browser_spinner");if(i&&i.classList)i.classList.remove("hidden")};var F=function e(){var i=document.getElementById("im_browser_spinner");if(i&&i.classList)i.classList.add("hidden")};var O=function e(){if(!a){a=$("#monkey_scroll_wrapper_for_im_list_container");n=$("<div>",{class:"monkey_scroll_mask"});a.append(n);return}n.removeClass("hidden")};var R=function e(){if(n)n.addClass("hidden")};var N=function e(n){TS.metrics.mark("im_browser_search_start");p=n;P();if(g)g.cancel();var a=!!s.length;if(!n)TS.kb_nav.clearHighlightedItem();if(!n&&!a){var o=r;i.addClass("showing_recent");i.removeClass("filter_active no_filter_matches");t.longListView("setItems",o);t.scrollTop(0);if(0===o.length)Z(n);else X();D();return}g=TS.searcher.search(n,ce());g.then(function(e){e=e.map(function(e){var i=e.model_ob;e.id=i.id;if(i.is_mpim)e.members=TS.mpims.getMembersInDisplayOrder(i);else e.member=i;if(e.member&&true===Q(e.member))e.disabled_dm=true;else e.disabled_dm=null;return e});e=_(e).partition("model_ob.deleted").reverse().flatten().value();i.toggleClass("filter_active",!!n).removeClass("showing_recent");t.longListView("setItems",e);t.scrollTop(0);if(0===e.length){Z(n);i.addClass("no_filter_matches");TS.kb_nav.clearHighlightedItem()}else{X();i.removeClass("no_filter_matches");if(n)TS.kb_nav.highlightFirstItem()}D();TS.metrics.measureAndClear("im_browser_search_searcher","im_browser_search_start")}).catch(function(e){D();TS.error("Error occured when searching in the IM browser:",e)})};var H=function e(i){var t=s.every(function(e){return-1!==i.members.indexOf(e.id)});if(!t)return false;if(s.length===i.members.length-1)return false;var n=TS.mpims.getMembersInDisplayOrder(i);var a=n.some(function(e){if(-1!==s.indexOf(e))return false;return!e.is_self});if(!a)return false;return true};var Q=function e(i){if(!i.is_external)return false;if(!o)return false;if(i.is_external&&i.team_id!==o)return true;return false};var L=function e(){if(!s.length)return;if(1===s.length){if(m)m.start();TS.ims.promiseToStartImByMemberId(s[0].id).then(function(){if(h)h.call();TS.ui.fs_modal.close();return null}).finally(function(){if(m)m.stop();return null});return}if(!TS.permissions.members.canCreateMpims())return;m.start();G(s,function(e){if(m)m.stop();if(!e.ok){if(e.error)TS.error("Could not open MPIM: "+e.error);return}if(h)h.call();TS.ui.fs_modal.close()})};var G=function e(i,t){var n=i.map(function(e){return e.id});n=n.join(",");return TS.api.call("conversations.open",{users:n}).then(function(e){var i;if(e.data.channel)i=e.data.channel;else if(e.data.group)i=e.data.group;if(i.is_channel){i=TS.channels.upsertChannel(i);if(i.is_mpim)TS.channels.displayChannel({id:i.id});else TS.error("no mpim?!?")}else if(i.is_group){i=TS.mpims.upsertMpim(i);if(i)TS.mpims.displayMpim({id:i.id});else TS.error("no mpim?!?")}if(t)t(e.data);return null}).catch(function(){TS.error("failed to open the mpim");return null})};var j=function e(i){var t=i.data("row_id");if(TS.interop.utility.looksLikeMemberId(t))TS.ims.startImByMemberId(t);else TS.mpims.displayMpim({id:t});TS.ui.fs_modal.close()};var K=function e(i){if(i.hasClass("disabled_dm"))return;if(s.length===v)return;if(!TS.permissions.members.canCreateMpims())return j(i);var t=i.data("row_id");if(p)TS.ui.frecency.record({id:t},p);if(t===TS.model.user.id||"USLACKBOT"===t)return j(i);var n=[];if(TS.interop.utility.looksLikeMemberId(t)){var a=TS.members.getMemberById(t);if(!a)return;if(a.deleted||a.is_app_user)return j(i);if(-1!==s.indexOf(a))return;s.push(a);l[a.id]=true;n.push(a)}else{var r=TS.shared.getModelObById(t);if(!r.is_mpim)return;var o=TS.mpims.getMembersInDisplayOrder(r);if(_.some(o,"deleted")){j(i);return}o.forEach(function(e){if(-1!==s.indexOf(e))return;s.push(e);l[e.id]=true;n.push(e)})}z();q(n)};var W=function e(i){var t=i.data("member-id");var n=[];s=s.filter(function(e){if(t===e.id)n.push(e);return e.id!==t});delete l[t];q(n)};var V=function e(){if(!s.length)return;var i=s.pop();delete l[i.id];q([i])};var q=function e(n){Y();if(s.length)i.find(".im_browser_go").removeClass("disabled");else i.find(".im_browser_go").addClass("disabled");if(s.length>=v)i.addClass("reached_maximum");else i.removeClass("reached_maximum");if(n)n.forEach(function(e){t.longListView("itemUpdatedById",e.id);var i=t.longListView("getCurrentItemsInView");i.forEach(function(e){t.longListView("itemUpdatedById",e.id)})});J();le();TS.kb_nav.clearHighlightedItem();t.longListView("resizeImmediately")};var z=function e(){s.forEach(function(e){if(e.is_external)o=e.team_id})};var Y=function e(){var t=v;var n=Math.max(0,t-s.length);var a=i.find(".remaining_participant_hint");if(n)a.text(TS.i18n.t("You can add {num_remaining, plural, =1 {# more person} other {# more people}}","im_browser")({num_remaining:n}));else a.text(TS.i18n.t("You have reached the maximum number of participants","im_browser")())};var J=function e(){var t=$("#im_browser_filter").val();$("#im_browser_tokens").replaceWith(TS.templates.im_browser_tokens({members:s}));var n=$("#im_browser_filter");if(!t&&TS.boot_data.page_needs_enterprise)n.focus();else n.val("").trigger("input").focus();i.removeClass("filter_active")};var Z=function e(i){var t=$("#im_browser_empty");var n=t.find(".im_browser_empty_message");if(i)n.html(TS.i18n.t("No one found matching <strong>{query}</strong>","im_browser")({query:TS.utility.truncateAndEscape(i,50)}));else n.empty();t.removeClass("hidden");$("#monkey_scroll_wrapper_for_im_list_container").addClass("hidden")};var X=function e(){var i=$("#im_browser_empty");i.addClass("hidden");$("#monkey_scroll_wrapper_for_im_list_container").removeClass("hidden")};var ee=function e(i,t){var n=TS.shared.sorterByLastMsg(i.model_ob,t.model_ob);if(0!==n)return n;return ie(i,t)};var ie=function e(i,t){var n;var a;if(i.member)n=[i.member];else n=i.members||[];if(t.member)a=[t.member];else a=t.members||[];if(n.length!==a.length){if(1===n.length)return-1;if(1===a.length)return 1}return te(n,a,0)};var te=function e(i,t,n){var a=i[n];var r=t[n];if(a&&r){var s=TS.members.memberSorterByName(a,r);if(0!==s)return s;return e(i,t,n+1)}if(r)return-1;if(a)return 1;return 0};var ne=function e(){var i=[TS.i18n.t("Yay! You’re here. What can I do for you?","im_browser")(),TS.i18n.t("Hello, What’s up?","im_browser")(),TS.i18n.t("How can I help today?","im_browser")(),TS.i18n.t("Hi hi! How can I help?","im_browser")(),TS.i18n.t("You’re here! What can I do to help?","im_browser")(),TS.i18n.t("You rang?","im_browser")()];u=i[Math.round(Math.random()*(i.length-1))]};var ae=function e(){if(!TS.permissions.members.canCreateGroups())return;var t=$("#new_channel_container");var n=Object.keys(l);TS.ui.new_channel_modal.startInContainer(t,"",false,n);i.addClass("hidden");$("#fs_modal").removeClass("fs_modal_internal_scroll");t.removeClass("hidden");TS.ui.fs_modal.bindBackButton(re);TS.ui.fs_modal.showBackButton()};var re=function e(){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();var n=$("#new_channel_container");n.addClass("hidden");$("#fs_modal").addClass("fs_modal_internal_scroll");i.removeClass("hidden");TS.ui.new_channel_modal.end();t.longListView("resizeImmediately");TS.ui.utility.updateClosestMonkeyScroller(t)};var se=function e(t){oe();i.prepend(t);i.addClass("showing_alert")};var oe=function e(){$("#im_browser_alert").remove();i.removeClass("showing_alert")};var le=function e(){if(f){oe();f=false}var i=s.filter(function(e){return e.is_external});var t;if(i.length>0)t=TS.templates.im_browser_guest_alert({team:TS.teams.getTeamNameByMember(i[0])});else{if(TS.model.user.is_restricted)return;if(s.length<2)return;var n=s.filter(function(e){return e.is_restricted});if(0===n.length)return;var a=1===n.length&&n[0];var r=a&&a.is_ultra_restricted;t=TS.templates.im_browser_guest_alert({ra_alert:true,members:n,member:a,is_ura:r})}se(t);f=true};var de=function e(i){if(!i||!i.file)return"";var t=true;var n=TS.templates.builders.msgs.buildFileShareMetaText(i,t);var a=i.file;var r=a.title?a.title:a.name;return n+": "+r};var ce=function e(i){i=i||{};if(c){var t={members:{include_self:false,only_admins:true},limit:T,sort:false};if(!i.initial)t.sort={frecency:true,allow_empty_query:true};return t}if(i.initial)return{members:{include_slackbot:true,include_self:true},all_mpims:true,sort:false};var n=!!s.length;o=null;z();return{members:{include_slackbot:!n,include_self:!n,include_deleted:!n},all_mpims:true,limit:T,filter:function e(i){i.mpims=_.filter(i.all_mpims,H);if(n&&TS.apps.permissions.areXoxaAppsInstalled())i.members=_.filter(i.members,{is_app_user:false});return i},sort:{allow_empty_query:true}}}})()},4966:function(e,i){(function(){TS.registerModule("ui.channel_invite_modal",{startInviteToChannelModal:function e(t,n){if(TS.isPartiallyBooted())return;var a=TS.shared.getModelObById(t);if(!a){TS.error("TS.ui.channel_invite_modal.startInviteToChannelModal no channel or group found with id "+t);return}i=a;n=n||[];c=n.map(function(e){u[e]=true;return TS.model.getMemberById(e)});var r={model_ob:a,create_child_option:!!a.is_group,private_shared_channel_warning:a.is_private&&TS.shared.isModelObShared(a),async_data:true,preselected:c};var s=TS.templates.channel_invite_modal(r);TS.ui.fs_modal.start({body_template_html:s,onShow:g,onEnd:p,modal_class:"fs_modal_internal_scroll"});if(TS.model.user.is_admin){var o=TS.i18n.t('Or, <a class="do_admin_invite" data-channel-id="{channel_id}">invite a new person to your workspace</a>',"channel_modal")({channel_id:t});var l='<div class="channel_modal_footer">'+o+"</div>";$("#channel_invite_modal").append(l)}}});var e;var i;var t=true;var n=false;var a;var r;var s;var o;var l;var d;var c=[];var u={};var m={};var f=58;var h;var g=function n(){e=$("#channel_invite_modal");e.on("click",".no_create_channel",function(){t=false;T()});e.on("click",".yes_show_history",function(){t=true;T()});e.on("click",".do_admin_invite",function(){TS.ui.fs_modal.close();var e=$(this).data("channel-id");setTimeout(function(){TS.ui.admin_invites.start({initial_channel_id:e})},500)});if(i.is_channel)v()};var p=function _(){e=null;i=null;t=true;n=false;a=null;r=null;s=null;o=null;l=null;d=null;c=[];u={};if(m._searcher_p)m._searcher_p.cancel();m={};TS.kb_nav.end();$(window).off("resize",j)};var S=function e(){if(!c.length)return;if(t||!i.is_group){var n="conversations.invite";_.chunk(Object.keys(u),30).forEach(function(e){TS.api.call(n,{channel:i.id,force:true,users:e.join(",")})});TS.ui.fs_modal.close()}else{if(s)s.start();var a=Object.keys(u);var r=function e(i,t){if(s)s.stop();if(!i){if(t&&"restricted_action"===t.error){var n=TS.i18n.t("You don’t have permission to create new private channels.","channel_modal")();if(!TS.permissions.members.canArchiveChannels())n=TS.i18n.t("You don’t have permission to archive channels.","channel_modal")();var a=TS.i18n.t("Talk to your Workspace Owner.","channel_modal")();setTimeout(function(){TS.generic_dialog.alert("<p>"+n+"</p><p>"+a+"</p>")},500)}else alert("failed! "+t.error);return}TS.ui.fs_modal.close()};TS.groups.createChild(i.id,a,r)}};var T=function i(){$("#private_channel_invite_step_one").addClass("hidden");$("#channel_invite_container").removeClass("hidden");e.find(".channel_invite_filter_container").removeClass("hidden");v()};var v=function e(){M();G()};var b=function e(){y();k()};var w=function e(){A();C()};var y=function e(){var i=document.getElementById("channel_invite_spinner");if(i&&i.classList)i.classList.remove("hidden")};var A=function e(){var i=document.getElementById("channel_invite_spinner");if(i&&i.classList)i.classList.add("hidden")};var k=function e(){if(!d){d=$("#monkey_scroll_wrapper_for_channel_invite_container");l=$("<div>",{class:"monkey_scroll_mask"});d.append(l);return}l.removeClass("hidden")};var C=function e(){if(l)l.addClass("hidden")};var M=function i(){o=$("#channel_invite_container");o.longListView({items:[],approx_item_height:f,preserve_dom_order:true,makeElement:function e(){return $('<div class="channel_invite_row"></div>')},renderItem:function e(i,t){i.data("member-id",t.id);i.toggleClass("disabled",!!(u[t.id]||t.invite_exception_reason));i.html(TS.templates.channel_invite_member({member:t.member,invite_exception_reason:t.invite_exception_reason}))}});o.monkeyScroll();D();o.on("click",".channel_invite_row",function(e){O($(e.currentTarget))});e.on("keydown","#channel_invite_filter",function(e){var i=$(e.currentTarget).val();if(e.which===TS.utility.keymap.del&&""===i){N();return}if(e.which===TS.utility.keymap.enter&&""===i){if(!TS.kb_nav.getHighlightedItem())S();return}if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()}).on("input",function(e){K();I($(e.target).val().trim()).then(E).then(P)});e.on("focus","#channel_invite_filter",function(){$("#channel_invite_tokens").addClass("active")}).on("blur","#im_browser_filter",function(){$("#channel_invite_tokens").removeClass("active")});e.on("click","#channel_invite_tokens",function(e){var i=$(e.target).closest(".member_token");if(i.length)R(i);else $("#channel_invite_filter").focus()});setTimeout(function(){TS.kb_nav.start(o.find(".list_items"),".channel_invite_row",o,{use_data_ordering:true,no_blur:true,scrollToStartImmediately:function e(){o.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){o.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){O($(this));e.preventDefault()});$("#channel_invite_filter").focus()});I("").then(E).then(P)};var I=function e(t){b();var n=t;if("@"===t.charAt(0))n=t.substring(1);if(m.query!==n){m.query=n;if(TS.boot_data.feature_channel_invite_modal_cannot_join)m.include_org=!!TS.boot_data.page_needs_enterprise||!!TS.shared.isModelObOrgShared(i);else m.include_org=!!TS.shared.isModelObOrgShared(i);m.include_slackbot=false;m.include_self=false;m.not_member_of=[i.id];m.scroll_mark=0;m.query_for_display=t;o.off("scroll.filter")}return TS.members.promiseToSearchMembers(m)};var x=function e(i,t,n){var a=_.map(n,"id");var r=t||TS.model.user.is_admin;if(TS.model.user.is_ultra_restricted&&!r)return Promise.resolve([]);return TS.membership.ensureChannelMembershipIsKnownForUsers(i.id,a).then(function(){var e=_(n).map(function(e){if(e.is_ultra_restricted)return;if(e.is_slackbot)return;if(e.is_self)return;if(e.deleted)return;if(e.is_app_user)return;if(!r&&e.is_restricted&&!i.is_group)return;var t=TS.membership.getUserChannelMembershipStatus(e.id,i);if(!t.is_member)if(TS.permissions.channels.canMemberBeInvitedToChannel(i,e))return e;if(TS.boot_data.feature_channel_invite_modal_cannot_join)return e;return}).compact().uniq().value();return e})};var E=function e(t){var a;var r;var s=[];s.push(x(i,true,t.items));if(!TS.model.user.is_admin)s.push(x(i,false,t.items));return Promise.all(s).then(function(i){if(i.length){a=i[0];if(2===i.length)r=i[1];else r=a}n=r.length!=a.length;D();if(r.length!=t.items.length){t.num_new-=t.items.length-r.length;t.items=r}if(!t.num_new&&t.num_found&&t.num_remaining)return I(t.query).then(e);return Promise.resolve(t)})};var B=function e(i){if(!h){var t=TS.frecency&&TS.frecency.getExisting("jumper");h=t&&t.getMostCommon()}if(!h){TS.warn("WTF no frecency module? Sorting alphabetically.");i.sort(TS.i18n.sorter);return i}_.each(i,function(e){var i=_.find(h,{id:e.id});e.score=i&&parseInt(i.score,10)||0});i.sort(function e(i,t){if(i.score<t.score)return 1;if(i.score>t.score)return-1;return 0});return i};var P=function e(t){var n=t.items.map(function(e){if(!TS.boot_data.feature_channel_invite_modal_cannot_join)return{id:e.id,member:e};var t=TS.membership.getUserChannelMembershipStatus(e.id,i);var n=t.is_member;var a;var r;if(n)r=false;else r=TS.permissions.channels.canMemberBeInvitedToChannel(i,e);if(n)a=TS.i18n.t("Already in this channel","channel_modal")();else if(!r)if(TS.utility.teams.isMemberExternal(e))a=TS.i18n.t("From another workspace","channel_modal")();else if(U(e))a=TS.i18n.t("Not a member of this workspace","channel_modal")();else a=TS.i18n.t("Cannot join this channel","channel_modal")();return{id:e.id,member:e,invite_exception_reason:a}});n=n.map(function(e){e.member._pref_compliant_name=TS.members.getPrefCompliantMemberName(e.member);return e});n.sort(TS.i18n.mappedSorter("member._pref_compliant_name"));if(TS.boot_data.feature_channel_invite_modal_cannot_join){var a=[];var r=[];_.each(n,function(e){if(e.invite_exception_reason)r.push(e);else a.push(e)});r=B(r);a=B(a);n=a.concat(r)}o.longListView("setItems",n);if(t._is_new)o.scrollTop(0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(o)});if(t._is_new)o.on("scroll.filter",function(){var i=o.scrollTop()+o.height()+f;if(i<=t.scroll_mark)return;var n=o.find(".list_items").height();if(i>n&&m._searcher_p&&m._searcher_p.isResolved()){I(t.query).then(E).then(e);t.scroll_mark=i}});if(n.length){L();w()}else{Q(t.query_for_display);w();return}if(t.query&&"@"!==t.query&&0!==n.length){if(t._is_new)TS.kb_nav.highlightFirstItem()}else TS.kb_nav.clearHighlightedItem()};var D=function i(){if(n)if(!e.find(".ra_not_appear_warning").length){var t=TS.i18n.t("Multi-channel guests may not appear below. Ask a Workspace Admin to invite them.","channel_modal")();var a='<p class="mini subtle_silver no_bottom_margin ra_not_appear_warning">'+t+"</p>";e.find(".kb_nav_label").after(a)}};var U=function e(i){if(!i.enterprise_user)return false;var t=_.get(i,"enterprise_user.teams",[]);if(-1===t.indexOf(TS.model.team.id))return true;return false};var F=function e(){var i=$("#channel_invite_filter");var t=i.val();$("#channel_invite_tokens").replaceWith(TS.templates.channel_invite_tokens({members:c,async_data:true}));i=$("#channel_invite_filter");if(!t)i.focus();else i.val("").trigger("input").focus()};var O=function e(i){var t=i.data("member-id");var n=[];var a=TS.members.getMemberById(t);if(!a)return;if(TS.boot_data.feature_channel_invite_modal_cannot_join&&i.hasClass("disabled"))return;if(u[t])return;c.push(a);u[t]=true;n.push(a);H(n)};var R=function e(i){var t=i.data("member-id");var n=_.remove(c,function(e){return e.id===t});delete u[t];H(n)};var N=function e(){if(!c.length)return;var i=c.pop();delete u[i.id];H([i])};var H=function i(t){if(t)t.forEach(function(e){o.longListView("itemUpdatedById",e.id)});F();K();e.find(".invite_go").toggleClass("disabled",!c.length);o.longListView("resizeImmediately")};var Q=function e(i){var t=$("#filter_invite_empty");var n=t.find(".filter_invite_empty_message");if(i){var a={query:i};n.html(TS.templates.channel_invite_no_results(a))}else n.empty();t.removeClass("hidden");$("#monkey_scroll_wrapper_for_channel_invite_container").addClass("hidden")};var L=function e(){var i=$("#filter_invite_empty");i.addClass("hidden");$("#monkey_scroll_wrapper_for_channel_invite_container").removeClass("hidden")};var G=function i(){var t=$("#channel_invite_container");if(a){var n=t.find(".lfs_input_container");n.wrap("<div></div>");n.attr("style","max-width: 85%").addClass("inline_block").addClass("no_padding");n.after(TS.templates.channel_modal_go_button({class_name:"invite_go",label:TS.i18n.t("Invite","channel_modal")()}))}K();var r=e.find(".invite_go");s=Ladda.create(r[0]);r.on("click",S)};var j=function e(){$("#channel_invite_container").lazyFilterSelect("recomputeHeight")};var K=function i(){var t=$("#channel_invite_container");if(a){var n=a.lazyFilterSelect("value");var s=t.find(".enter_to_go_label");if(r.val())s.addClass("hidden");else if(n&&n.length>0)s.removeClass("hidden");else s.addClass("hidden")}else{var o=e.find(".return_hint");if($("#channel_invite_filter").val())o.addClass("hidden");else if(c.length)o.removeClass("hidden");else o.addClass("hidden")}}})()},4967:function(e,i){(function(){TS.registerModule("ui.prefs_dialog",{onStart:function e(){K();TS.client.login_sig.add(y);TS.prefs.sidebar_theme_changed_sig.add(fe);TS.prefs.dtop_notif_changed_sig.add(ne);TS.prefs.read_changed_sig.add(_e);TS.prefs.display_real_names_override_changed_sig.add(oe);TS.prefs.team_display_real_names_changed_sig.add(oe);TS.prefs.tz_changed_sig.add(Se);TS.prefs.locale_changed_sig.add(Te);TS.members.changed_tz_sig.add(pe);r=TS.qs_args.prefs_last_section||r;TS.prefs.email_alerts_changed_sig.add(ne);TS.prefs.push_changed_sig.add(ne);TS.prefs.all_notifications_prefs_changed_sig.add(ne);ne=_.throttle(ne,1e3);TS.prefs.time24_changed_sig.add(ee)},start:function e(i,t){A(i,t)}});var e=false;var i=null;var t=null;var n=null;var a=null;var r="notifications";var s=null;var o=0;var l=false;var d=false;var c=false;var u=false;var m=false;var f=false;var h=[];var g="validation_error";var p;var S;var T;var v;var b=false;var w=false;var y=function e(){d=TS.model.mac_ssb_version&&TS.model.mac_ssb_version>=.32||TS.model.win_ssb_version&&TS.model.is_mac;c=TS.model.win_ssb_version&&TS.model.is_win;u=TS.model.lin_ssb_version&&TS.model.is_lin;l=TS.prefs.getPref("sidebar_theme")&&("custom_theme"===TS.prefs.getPref("sidebar_theme")||"cotton_theme"===TS.prefs.getPref("sidebar_theme")||"eco_theme"===TS.prefs.getPref("sidebar_theme"));if(TS.environment.isSSBAndAtLeastVersion("2.8.0"))m=true;b=TS.boot_data.feature_email_forwarding&&!TS.model.user.is_restricted&&!TS.model.user.is_ultra_restricted&&"disable_all"!==TS.prefs.getTeamPref("disable_file_uploads")&&"disable_all_except_images"!==TS.prefs.getTeamPref("disable_file_uploads")&&!TS.prefs.getTeamPref("disable_email_ingestion")};var A=function o(l,_){l=l||r;if(!TS.model.ms_logged_in_once||!TS.prefs.prefs_loaded||$("body").hasClass("loading")||TS.ui.fs_modal.is_showing)return;if(!s)s=TS.templates.prefs_nav({show_mac_ssb_prefs:d,show_win_ssb_prefs:c,show_lin_ssb_prefs:u,show_labs_prefs:TS.boot_data.feature_tinyspeck});e=true;var m={title:k(),body_template_html:"",sidebar_html:s,onShow:C,onCancel:M,modal_class:"fs_modal_header fs_modal_sidebar prefs_modal"};m.onGo=Fe;TS.ui.fs_modal.start(m);i=$("#fs_modal");t=$("#fs_modal_bg");n=i.find(".contents");i.add(t).addClass("starting");a=$("#fs_modal_sidebar");a.find("a").on("click",function(){I($(this).data("section"))});if(!TS.environment.supports_custom_scrollbar)i.find(".contents_container").monkeyScroll();p=we();T={};I(l);if(_)setTimeout(function(){i.find(_).scrollintoview({offset:"bottom",px_offset:-100}).highlight()},1e3);B();setTimeout(function(){i.add(t).removeClass("starting")},150);$("#col_channels").addClass("prefs_open")};var k=function e(){return TS.i18n.t("Your preferences for {team_name}","prefs")({team_name:TS.model.team.name})};var C=function e(){};var M=function t(){if(w)if(TS.boot_data.feature_channel_notif_dialog_update)TS.interop.unmountChannelNotificationSettings($("#channel_prefs_container")[0]);$("#col_channels").removeClass("prefs_open");h=[];e=false;i=null;n=null;a.find("a").off("click");a=null;w=false};var I=function e(t){if(f)me();var s=x(t);r=t;a.find("a").removeClass("is_active").end().find('a[data-section="'+t+'"]').addClass("is_active");n.html(s);E(t);if(i.find("input").length)i.find("input").first().focus();else if(document.activeElement&&document.activeElement!==document.body)document.activeElement.blur();setTimeout(function(){if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(n);i.find(".contents_container").scrollTop(0)},0);f="sidebar"===t;if("notifications"===t)_.each(h,function(e){te(e)})};var x=function e(i){var t;var n={};switch(i){case"notifications":var a=TS.notifs.getGlobalHighlightWords()||"";a=a.replace(/,/g,", ").replace(/ {2}/g," ");n={notification_sounds:TS.boot_data.notification_sounds,member:TS.model.user,highlight_words:a,time24:TS.prefs.getPref("time24"),show_mac_ssb_prefs:d,show_win_ssb_prefs:c,has_tz:!!TS.prefs.getPref("tz"),tz_guess:!TS.prefs.getPref("tz")&&F()};n.new_msg_snd_label=ve(TS.notifs.getDesktopNotificationSoundPref());t=TS.templates.prefs_notifications_new(n);break;case"win_ssb":case"lin_ssb":t=TS.templates.prefs_win_lin_ssb({show_lin_ssb_prefs:u,show_auto_launch_pref:TS.environment.isSSBAndAtLeastVersion("3.0.0")||!TSSSB.call("isAppStoreBuild")});break;case"language_region":n={show_keyboard:!TS.i18n.canAutoGetKeyboard(),user_locale:TS.i18n.locale(),languages:TS.prefs.getPref("locales_enabled"),user_keyboard:TS.i18n.keyboard(),supported_keyboards:TS.i18n.supportedKeyboards(),timezones:window.timezones_list(TS.i18n.locale()),user_tz:TS.model.user.tz};t=TS.templates.prefs_language_region(n);break;case"messages_media":var r="";if(TS.prefs.getPref("preferred_skin_tone")&&"1"!==TS.prefs.getPref("preferred_skin_tone"))r=":skin-tone-"+TS.prefs.getPref("preferred_skin_tone")+":";var s=TS.emoji.graphicReplace(":wave:");n={inline_img_byte_limit:TS.model.inline_img_byte_limit,clean_theme:"light_with_avatars"===TS.prefs.getPref("messages_theme"),compact_theme:"dense"===TS.prefs.getPref("messages_theme"),thumbs_up_name_with_skin_tone_modifier:":thumbsup:"+r,messages_theme:TS.prefs.getPref("messages_theme"),show_time24_pref:!TS.boot_data.feature_localization||"en-US"===TS.i18n.locale(),enable_email_forwarding:b,slackbot_message:TS.i18n.t("Feeling great!","prefs")(),name_preview_avatar:cdn_url+"/2b909/img/name_pref/avatar_meg@2x.png",name_preview_full_name:TS.i18n.t("Megan Mary Anne","prefs")(),name_preview_display_name:TS.i18n.t("Meg","prefs")(),name_preview_message:new Handlebars.SafeString(TS.i18n.t('{wave_emoji} Hi, I’m <a class="internal_member_link">@Meg</a>.',"prefs")({wave_emoji:s}))};t=TS.templates.prefs_messages_media(n);break;case"sidebar":if(TS.prefs.getPref("sidebar_theme_custom_values")&&"undefined"!==TS.prefs.getPref("sidebar_theme_custom_values")){n.theme=JSON.parse(TS.prefs.getPref("sidebar_theme_custom_values"));n.show_customization_ui=l;n.show_customization_ui=l}n.show_separate_shared_channels_pref=TS.permissions.members.canRequestSharedChannel();n.cmd_key=TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")();n.cmd_key_label=TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")();n.is_app_space_enabled=TS.apps.isAppSpaceEnabled();n.show_sidebar_sort_pref=TS.boot_data.feature_sli_channel_priority&&""!==TS.model.team.plan;t=TS.templates.prefs_sidebar(n);break;case"search":t=TS.templates.prefs_search(ce());break;case"read_state_tracking":t=TS.templates.prefs_read_state_tracking({short_key_name:TS.model.is_mac?"Option":"Alt"});break;case"a11y":t=function(){var e=TS.model.is_electron&&(TSSSB.env.mac_ssb_version>2.5||2.5===TSSSB.env.mac_ssb_version&&2===TSSSB.env.mac_ssb_version_minor||TSSSB.env.lin_ssb_version>2.5||2.5===TSSSB.env.lin_ssb_version&&2===TSSSB.env.lin_ssb_version_minor||TSSSB.env.win_ssb_version>2.5||2.5===TSSSB.env.win_ssb_version&&2===TSSSB.env.win_ssb_version_minor);n={zoom_pref_enabled:TSSSB.supports_zoom_api,zoom_pref_70_supported:e};return TS.templates.prefs_a11y(n)}();break;case"advanced":var o=false;var f="";var h=[];if(TS.model.is_our_app){o=window.TSSSB&&TSSSB.call("hasPreference","PrefSSBFileDownloadPath");if(TSSSB.env.mac_ssb_version&&TSSSB.env.mac_ssb_version<2)o=false;if(o)f=TSSSB.call("getPreference","PrefSSBFileDownloadPath");if(m)h=window.desktop.spellCheckingHelper.getDictionaries()}n.show_app_download_path=o;n.app_download_path=f;n.show_language_select=m;n.available_dictionaries=h;n.show_console_whitelist=true;var g=TS.prefs.getPref("client_logs_pri")||"";n.user_facing_pris=_(Object.keys(TS.boot_data.client_logs)).filter(function(e){var i=TS.boot_data.client_logs[e];var t=true;if(!_.isUndefined(i.features)){var n=i.features;if(!_.isArray(i.features))n=n.split(",");var a=0;n.forEach(function(e){if(0!==e.indexOf("feature_"))e="feature_"+e;if(TS.boot_data[e])a+=1});t=a===n.length}return!_.isUndefined(i.user_facing)&&i.user_facing&&t}).map(function(e){var i=_.merge({},TS.boot_data.client_logs[e]);i.selected=g.indexOf(e)>-1;if(i.name)i.name=i.name.replace(/[_-]/g," ");return i}).value();n.client_logs_pri_all_selected=g.indexOf("all")>-1;n.show_send_btn_pref=TS.i18n.localeSupportsSendButton();t=TS.templates.prefs_advanced(n);break;case"labs":n={show_electron_prefs:TS.model.is_electron};t=TS.templates.prefs_labs(n);break;default:TS.error("This isn't the Prefs HTML builder you're looking for: "+i);return}return t};var E=function e(i){switch(i){case"notifications":P();ne();if(d){z();ge()}if(c)Y();ie();break;case"win_ssb":case"lin_ssb":Z();X();break;case"language_region":R();break;case"messages_media":N();oe();$("#dont_obey_inline_img_limit_cb").prop("disabled",!TS.prefs.getPref("expand_inline_imgs"));break;case"sidebar":V();fe();ue();break;case"search":H();break;case"read_state_tracking":Q();_e();break;case"a11y":L();break;case"advanced":W();break;case"labs":q();break;default:TS.error("This isn't the Prefs UI binding you're looking for: "+i)}};var B=function e(){n.on("change",'input[type="checkbox"][data-inline-saver], input[type="radio"][data-inline-saver], input[type="file"], select[data-inline-saver]',function(){TS.ui.inline_saver.show({target:$(this).data("inline-saver")})});var i=1e3;n.on("input",'input[type="text"][data-inline-saver], textarea[data-inline-saver]',TS.utility.debounce(function(){var e=$(this);if(e.hasClass(g))return;TS.ui.inline_saver.show({target:e.data("inline-saver")})},i))};var P=function e(){$(".growls_stuff").addClass("hidden");$("#growls_permission_link").on("click",se);$("#growls_test").on("click",function(){TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("What do you know? It works.","prefs")())}).addClass("hidden");if(TS.ui.growls.shouldShowPermissionButton())$("#growls_permission_div").removeClass("hidden");else if(TS.ui.growls.checkPermission()){$("#growls_allowed_div").removeClass("hidden");$("#growls_test").removeClass("hidden")}else if(TS.ui.growls.no_notifications)$("#growls_impossible_div").removeClass("hidden");else if("denied"===TS.ui.growls.getPermissionLevel())$("#growls_disallowed_div").removeClass("hidden");$('input:radio[name="notifications_rd"]').on("change",function(){var e=$(this).val();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{desktop_notifications:e.toString()}});if("all"===e)e="everything";else if("mentions"===e)e="mentions";else if("never"===e)e="nothing";if(TS.boot_data.feature_mpdm_default_fe){var i=!p;TS.notifs.setDesktopGlobalNotifySetting(e,i);return}var t={};if("everything"===e){t.all_channels_loud=true;t.growls_enabled=true}else if("mentions"===e){t.all_channels_loud=false;t.growls_enabled=true}else{t.all_channels_loud=false;t.growls_enabled=false}if(!p)_.assign(t,Ae(e));TS.prefs.setMultiplePrefs(t);TS.prefs.setMultiPrefsByAPI(t);TS.prefs.dtop_notif_changed_sig.dispatch()});$("#no_text_in_notifications_cb").on("change",function(){var e=!$(this).prop("checked");TS.notifs.setNoTextInNotificationsPref(e);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{no_text_in_notifications:e.toString()}})});var t;$('input:radio[name="sound_option_rd"]').on("change",function(){t=$(this).val();TS.sounds.play(t,{ignore_mute:true});TS.notifs.setDesktopNotificationSoundPref(t)});$(".sound_option").find("ts-icon").on("click",function(e){t=$(this).siblings("input").val();TS.sounds.play(t,{ignore_mute:true});e.preventDefault();e.stopPropagation()});$("#mute_sounds_cb").prop("checked",true===TS.prefs.getPref("mute_sounds"));$("#mute_sounds_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("mute_sounds",e);TS.prefs.setPrefByAPI({name:"mute_sounds",value:e});ne();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{mute_sounds:e.toString()}})});$("#threads_everything_cb").prop("checked",true===TS.notifs.getThreadsEverythingNotificationPref());$("#threads_everything_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("threads_everything",e);TS.notifs.setThreadsEverythingNotificationPref(e);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:e.toString()}})});var n=1e3;i.find("#highlight_words_input").on("input",TS.utility.debounce(de,n));if(TS.model.win_ssb_version||TS.model.lin_ssb_version){var a=$("#highlight_words_input").attr("placeholder");var r=true;$("#highlight_words_input").on("textchange",function(){if($(this).val()&&r){$(this).attr("placeholder","");r=false}else if(!$(this).val()&&!r){$(this).attr("placeholder",a);r=true}})}$("#dnd_enabled").prop("checked",!!TS.prefs.getPref("dnd_enabled"));$("#dnd_start_hour, #dnd_end_hour").prop("disabled",!TS.prefs.getPref("dnd_enabled")).closest("label").toggleClass("disabled",!TS.prefs.getPref("dnd_enabled"));var s=D();$("#dnd_enabled").on("change",function(){var e=$(this).is(":checked");if(e)$("#dnd_start_hour, #dnd_end_hour").prop("disabled",false).closest("label").removeClass("disabled");else $("#dnd_start_hour, #dnd_end_hour").prop("disabled",true).closest("label").addClass("disabled");s.dnd_enabled=e;TS.prefs.setMultiPrefsByAPI(s);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{dnd_enabled:e.toString()}})});var o=U($("#dnd_start_hour"),s.dnd_start_hour);o.prop("selected",true);var l=U($("#dnd_end_hour"),s.dnd_end_hour);l.prop("selected",true);$("#dnd_start_hour").on("change",function(){s.dnd_start_hour=$(this).val();TS.prefs.setMultiPrefsByAPI(s);$("#dnd_end_hour option").each(function(){return $(this).prop("disabled",false)});var e=U($("#dnd_end_hour"),s.dnd_start_hour);e.prop("disabled",true)});$("#dnd_end_hour").on("change",function(){s.dnd_end_hour=$(this).val();TS.prefs.setMultiPrefsByAPI(s);$("#dnd_start_hour option").each(function(){return $(this).prop("disabled",false)});var e=U($("#dnd_start_hour"),s.dnd_end_hour);e.prop("disabled",true)});o=U($("#dnd_start_hour"),s.dnd_end_hour);o.prop("disabled",true);l=U($("#dnd_end_hour"),s.dnd_start_hour);l.prop("disabled",true);$("#confirm_dnd_tz_guess").click(function(){if($(this).hasClass("disabled"))return;if(!window.timezones_guess)return;var e=window.timezones_guess();TS.prefs.setPrefByAPI({name:"tz",value:e});$(this).addClass("disabled")});$('#global_prefs_container [data-action="your_keywords_jump"]').click(function(e){e.preventDefault();$("#prefs_highlight_words").scrollintoview({offset:"bottom",px_offset:-100}).highlight()});$("#change_notification_sound").click(function(e){TS.menu.startWithSoundsMenu(e,function(e){TS.sounds.play(e,{ignore_mute:true});var i=TS.notifs.setDesktopNotificationSoundPref(e);TS.ui.inline_saver.show({target:"#prefs_sounds_and_appearance",promise:i});var t=ve(e);$("#selected_new_msg_snd").text(t);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{new_msg_snd:e}})})});$("#new_msg_snd_none_cb").on("change",function(){var e=$(this).is(":checked");var i;if(e){i=T.new_msg_snd||"knock_brush.mp3";$("#selected_new_msg_snd").text(ve(i));$("#select_new_msg_snd").removeClass("hidden")}else{T.new_msg_snd=TS.notifs.getDesktopNotificationSoundPref();i="none";$("#select_new_msg_snd").addClass("hidden")}TS.notifs.setDesktopNotificationSoundPref(i);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{new_msg_snd:i}})});$("#email_alerts_cb").on("change",function(){var e=$(this).is(":checked");if(e)TS.prefs.setPrefLocal("email_alerts",T.email_alerts||"instant");else{T.email_alerts=TS.prefs.getPref("email_alerts");TS.prefs.setPrefLocal("email_alerts","none")}TS.prefs.setPrefByAPI({name:"email_alerts",value:TS.prefs.getPref("email_alerts")});ne();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{email_alerts:TS.prefs.getPref("email_alerts")}})});$("#change_email_alerts").on("click",function(e){TS.menu.startWithGeneric(e,[{value:"instant",label:TS.i18n.t("Once every 15 minutes","prefs")()},{value:"hourly",label:TS.i18n.t("Once an hour","prefs")()}],function(e){var i=TS.prefs.setPrefByAPI({name:"email_alerts",value:e});TS.ui.inline_saver.show({target:"#prefs_notifs_delay",promise:i});TS.prefs.setPrefLocal("email_alerts",e);ne();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{email_alerts:TS.prefs.getPref("email_alerts")}})})});$("#mobile_specific_settings select").on("change",function(){var e=$(this).val();ye(e);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{mobile_notifications:e}})});$("#mobile_different_settings_cb").on("change",function(){p=$(this).is(":checked");$("#mobile_specific_settings").toggleClass("hidden",!p);if(!p&&we()){var e=TS.notifs.getGlobalNotificationSetting();ye(e)}TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{use_different_mobile_settings:p.toString()}})});$("#push_idle_wait_select").on("change",function(){var e=$(this).val();var i=TS.notifs.setNotificationPushIdleWaitTimeInMinutes(e);TS.ui.inline_saver.show({target:"#prefs_notifs_delay",promise:i});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{push_idle_wait:e.toString()}})});$(".global_notification_block").on("click",function(e){if(e.isDefaultPrevented())return;if($(e.target).closest("label, input").length)return;$(this).find("input").prop("checked",true).trigger("change")});$("#channel_specific_overrides").on("click",'[data-action="reset_channel_to_defaults"]',function(e){var i=$(this).closest(".channel_overrides_row");var t=i.attr("data-cid");if(!t)return;e.preventDefault();Be(t);Ce()});$("#channel_specific_overrides").on("click",'[data-action="open_channel_overrides"]',function(e){if(e.isDefaultPrevented())return;var i=$(this).attr("data-cid");if(!i)return;Pe();De(i)});$('#global_prefs_container [data-action="add_channel_override"]').on("click",function(){Pe();$e()});$("#channel_prefs_container").on("click",'[data-action="proceed_to_channel_options"]',function(){var e=$("#channel_override_picker").lazyFilterSelect("value")[0];var i=_.get(e,"model_ob.id");if(!i)return;De(i)});$("#global_prefs_container").on("click",'[data-action="highlight_channel_overrides"]',function(e){e.preventDefault();$("#prefs_channel_overrides").scrollintoview({offset:"top",px_offset:50}).highlight()});$('#global_prefs_container [data-action="show_time_zone"]').on("click",function(e){e.preventDefault();var i=$(this).closest(".contents_container");var t=function e(){I("language_region");setTimeout(function(){$(".prefs_tz").highlight()},500)};if(0===i.scrollTop())t();else $(this).closest(".contents_container").animate({scrollTop:0}).queue(function(e){setTimeout(t,250);e()})})};var D=function e(){return{dnd_enabled:TS.prefs.getPref("dnd_enabled"),dnd_start_hour:TS.prefs.getPref("dnd_start_hour")||TS.prefs.getTeamPref("dnd_start_hour")||"22:00",dnd_end_hour:TS.prefs.getPref("dnd_end_hour")||TS.prefs.getTeamPref("dnd_end_hour")||"08:00"}};var U=function e(i,t){var n=i.find("option").filter(function(){var e=$(this).attr("value");var i=e===t;if(!i)i=e==="0"+t;return i});if(!n.length){n=$('<option data-custom-time="true">');n.val(t);if(TS.utility.date.do24hrTime())n.text(t);else{var a=re(t);n.text(a)}var r=i.find("option").filter(function(){var e=$(this).attr("value");return e>t});if(r.length)r.filter(":first").before(n);else i.append(n)}return n};var F=function e(){if(!window.timezones_guess||!window.timezones_list)return null;var i=window.timezones_guess();var t=window.timezones_list();var n=_.find(t,function(e){if(2===e.length)return e[1]===i;return false});if(n)return n[0];return null};var O=function e(i){TS.utility.disableElement($("#jumbomoji_cb"),i);$("#jumbomoji_pref").toggleClass("jumbomoji_pref_disabled",i)};var R=function e(){n.find('[name="lang"]').on("change",function(){var e=$(this).val();var i=TS.i18n.locale();var t=TS.i18n.localesEnabled()[e];if(e===i)return;TS.generic_dialog.start({title:TS.i18n.t("Change language to {lang}?","prefs")({lang:t}),body:"<p>"+TS.i18n.t("Are you sure you want to change the language you use with Slack?","prefs")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Change to {lang}","prefs")({lang:t}),onGo:function t(){if(e!==i){window.createCookie("i18n_locale",e,365,"slack.com");v=true;TS.prefs.setPrefByAPI({name:"locale",value:e},function(){TS.reload(null,"prefs dialog change: locale -> "+e)})}},onCancel:function t(){if(e!==i)n.find('[name="lang"]').val(i)}})});if(!TS.i18n.canAutoGetKeyboard())n.find('[name="keyboard"]').on("change",function(){var e=$(this).val();var i=TS.model.user.keyboard;if(e!==i)TS.prefs.setPrefByAPI({name:"keyboard",value:e})});n.find('[name="tz"]').on("change",function(){var e=$(this).val();var i=TS.model.user.tz;if(e!==i)TS.prefs.setPrefByAPI({name:"tz",value:e})})};var N=function e(){$('input:radio[name="messages_theme_select"]').filter('[value="'+TS.prefs.getPref("messages_theme")+'"]').prop("checked",true);$('input:radio[name="messages_theme_select"]').on("change",function(){$(".prefs_messages_theme_preview").toggleClass("hidden");var e=$(this).val();O("dense"===e);TS.prefs.setPrefByAPI({name:"messages_theme",value:e})});$("#show_typing_cb").prop("checked",true===TS.prefs.getPref("show_typing")).removeClass("hidden");$("#show_typing_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"show_typing",value:!!$(this).prop("checked")})});$('#display_real_names_override_cb,input:radio[name="display_real_names_override_cb"]').on("change",function(){var e="real_names"===$(this).val();var i;if(TS.prefs.getTeamPref("display_real_names"))i=e?0:-1;else i=e?1:0;TS.prefs.setPrefLocal("display_real_names_override",i);TS.prefs.setPrefByAPI({name:"display_real_names_override",value:i});oe()});$(".global_notification_block").on("click",function(e){if(e.isDefaultPrevented())return;if($(e.target).closest("label, input").length)return;$(this).find("input").prop("checked",true).trigger("change")});$("#time24_cb").prop("checked",true===TS.prefs.getPref("time24"));$("#time24_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"time24",value:!!$(this).prop("checked")});ee()});$("#hide_hex_swatch_cb").prop("checked",false===TS.prefs.getPref("hide_hex_swatch"));$("#hide_hex_swatch_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"hide_hex_swatch",value:!e})});$('input:radio[name="emoji_mode_select"]').filter('[value="'+TS.prefs.getPref("emoji_mode")+'"]').prop("checked",true);$('input:radio[name="emoji_mode_select"]').on("change",function(){TS.prefs.setPrefByAPI({name:"emoji_mode",value:$(this).val()})});$("#jumbomoji_cb").prop("checked",true===TS.prefs.getPref("jumbomoji"));$("#jumbomoji_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"jumbomoji",value:e});TS.prefs.onPrefChanged({name:"jumbomoji",value:e})});$("#convert_emoticons_cb").prop("checked",true===TS.prefs.getPref("convert_emoticons"));$("#convert_emoticons_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"convert_emoticons",value:e})});$("#expand_internal_inline_imgs_cb").prop("checked",true===TS.prefs.getPref("expand_internal_inline_imgs"));$("#expand_internal_inline_imgs_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"expand_internal_inline_imgs",value:!!$(this).prop("checked")})});$("#expand_inline_imgs_cb").prop("checked",true===TS.prefs.getPref("expand_inline_imgs"));$("#expand_inline_imgs_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"expand_inline_imgs",value:e});TS.prefs.setPrefLocal("expand_inline_imgs",e);$("#dont_obey_inline_img_limit_cb").prop("disabled",!TS.prefs.getPref("expand_inline_imgs"))});$("#dont_obey_inline_img_limit_cb").prop("checked",false===TS.prefs.getPref("obey_inline_img_limit"));$("#dont_obey_inline_img_limit_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("obey_inline_img_limit",!e);TS.prefs.setPrefByAPI({name:"obey_inline_img_limit",value:!e})});$("#expand_non_media_attachments_cb").prop("checked",true===TS.prefs.getPref("expand_non_media_attachments"));$("#expand_non_media_attachments_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"expand_non_media_attachments",value:!!$(this).prop("checked")})});if(b){var i=$(".prefs_modal");var t=$("#forwarding_address");Ladda.bind("#get_forwarding_email_cb");TS.api.call("users.emailtoken.get").then(function(e){return Promise.resolve(e.data.email_address)}).catch(function(){return Promise.resolve(false)}).then(function(e){$(".prefs_email_forwarding").replaceWith(TS.templates.prefs_email_forwarding({existing_forwarding_email:e}));t=$("#forwarding_address");if(e)t.select()});i.on("click","#get_forwarding_email_cb",function(){$("#get_forwarding_email_cb").removeClass("btn_outline");TS.api.call("users.emailtoken.create").then(function(e){Ladda.stopAll();$(".prefs_email_forwarding").replaceWith(TS.templates.prefs_email_forwarding({existing_forwarding_email:e.data.email_address}));t=$("#forwarding_address");t.select()})});i.on("focus, click","#forwarding_address",function(e){e.target.select()});i.on("click","#copy_forwarding_email_cb",function(e){TS.clipboard.writeText(TS.i18n.t("Send to Slack <{address}>","prefs")({address:t.val()}));TS.tips.updateTipTitle($(e.target),TS.i18n.t("Copied!","prefs"));$(e.target).mouseleave(function(){setTimeout(function(){TS.tips.updateTipTitle($(e.target),TS.i18n.t("Copy email address","prefs"))},500)});t.select()});i.on("click","#disable_forwarding_email_cb",function(e){e.preventDefault();TS.generic_dialog.start({title:TS.i18n.t("This address will be permanently deleted","prefs")(),body:TS.i18n.t("<p>The address <strong>{existing_forwarding_email}</strong> will no longer work. If you’d like, you can always request a new forwarding address.","prefs")({existing_forwarding_email:t.val()}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Disable Address","prefs")(),go_button_class:"btn_danger",onGo:function e(){TS.api.call("users.emailtoken.delete").then(function(){$(".prefs_email_forwarding").replaceWith(TS.templates.prefs_email_forwarding({existing_forwarding_email:false}));Ladda.bind("#get_forwarding_email_cb")})}})})}};var H=function e(){$("#search_channel_exclusion").lazyFilterSelect({placeholder_text:TS.i18n.t("Pick channels to exclude...","prefs")()}).on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"search_exclude_channels",value:e?e.join(","):""})}).hide()};var Q=function e(){$('input:radio[name="read_rd"]').on("change",function(){var e=$(this).val();TS.prefs.setReadStateTrackingPref(e);_e()})};var L=function e(){var i=$("#a11y_animations");i.prop("checked",true===TS.prefs.getPref("a11y_animations"));i.on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"a11y_animations",value:e})});G=TSSSB.call("getZoom");var t=TS.ui.a11y.zoomLevelToPercent(G);j(t);$('input:radio[name="a11y_font_size_select"]').on("change",function(){var e=$(this).val();G=TS.ui.a11y.zoomPercentToLevel(e);TSSSB.call("setZoom",G)})};var G;var j=function e(i){$('input:radio[name="a11y_font_size_select"]').filter('[value="'+i+'"]').prop("checked",true)};var K=function e(){if(!(TS.client&&TSSSB.supports_zoom_api))return;TS.ui.a11y.zoom_level_changed_sig.add(function(e){var i=e.zoom_level;var t=G==i;if(!t){G=i;j(TS.ui.a11y.zoomLevelToPercent(G))}var n=TS.ui.a11y.zoomLevelToPercent(i);var a="normal"===n?"100":n;var r=t?"PREF":"OTHER";var s={a11y_zoom_level:a,a11y_zoom_set_origin:r};TS.clog.track("PREF_USER_CLIENT_UPDATE",s)})};var W=function e(){$("#webapp_spellcheck_cb").prop("checked",true===TS.prefs.getPref("webapp_spellcheck")).removeClass("hidden");$("#webapp_spellcheck_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"webapp_spellcheck",value:!!$(this).prop("checked")})});if(m){$("select#spellchecker_languages").prop("disabled",true!==TS.prefs.getPref("webapp_spellcheck"));$("#webapp_spellcheck_cb").on("change",function(){$("select#spellchecker_languages").prop("disabled",!$(this).prop("checked"))});$("select#spellchecker_languages").on("change",function(){var e=null;if("automatic"!==$(this).val())e=$(this).val();TSSSB.call("setPreference",{name:"spellcheckerLanguage",value:e})})}$("#enter_is_special_in_tbt_cb").prop("checked",true===TS.prefs.getPref("enter_is_special_in_tbt"));$("#enter_is_special_in_tbt_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"enter_is_special_in_tbt",value:!!$(this).prop("checked")})});$("#arrow_history_cb").prop("checked",true===TS.prefs.getPref("arrow_history"));$("#arrow_history_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"arrow_history",value:e})});$("#msg_input_send_btn_cb").prop("checked",true===TS.prefs.getPref("msg_input_send_btn"));$("#msg_input_send_btn_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"msg_input_send_btn",value:!!$(this).prop("checked")})});i.find('[data-action="select_ssb_download_path"]').on("click",function(){var e=TSSSB.call("getPreference","PrefSSBFileDownloadPath")||"";var t={type:"openDirectory",title:TS.i18n.t("Select a download location","prefs")(),defaultPath:e};TSSSB.call("showOpenDialog",{options:t,callback:function e(t){if(!t)return;var n=t[0];TSSSB.call("setPreference",{name:"PrefSSBFileDownloadPath",value:n});i.find("#app_download_path_input").val(n);TS.ui.inline_saver.show({target:i.find("#prefs_download_location")})}})});$("#pagekeys_handled_cb").prop("checked",true===TS.prefs.getPref("pagekeys_handled")).removeClass("hidden");$("#pagekeys_handled_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"pagekeys_handled",value:!!$(this).prop("checked")})});$("#f_key_search_cb").prop("checked",true===TS.prefs.getPref("f_key_search")).removeClass("hidden");$("#f_key_search_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"f_key_search",value:!!$(this).prop("checked")})});$("#k_key_omnibox_cb").prop("checked",true===TS.prefs.getPref("k_key_omnibox")).removeClass("hidden");$("#k_key_omnibox_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"k_key_omnibox",value:!!$(this).prop("checked")})});$("#ask_after_away_cb").prop("checked",true===TS.prefs.getPref("confirm_user_marked_away"));$("#ask_after_away_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("confirm_user_marked_away",e);TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:e})});$("#enable_chan_suggestions").prop("checked",true===TS.prefs.getPref("overloaded_message_enabled"));$("#enable_chan_suggestions").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"overloaded_message_enabled",value:e})});$("#allow_calls_to_set_current_status").prop("checked",true===TS.prefs.getPref("allow_calls_to_set_current_status"));$("#allow_calls_to_set_current_status").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"allow_calls_to_set_current_status",value:e})});$("#ls_disabled_cb").prop("checked",true===TS.prefs.getPref("ls_disabled"));$("#ls_disabled_cb").bind("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("ls_disabled",e);TS.storage.setDisabled(TS.prefs.getPref("ls_disabled"));TS.prefs.setPrefByAPI({name:"ls_disabled",value:e},function(){TS.reload(null,"prefs dialog change: ls_disabled -> "+e)})});$("#ss_emojis_cb").prop("checked",true!==TS.prefs.getPref("ss_emojis"));$("#ss_emojis_cb").bind("change",function(){var e=!$(this).prop("checked");TS.prefs.setPrefLocal("ss_emojis",e);TS.prefs.setPrefByAPI({name:"ss_emojis",value:e},function(){TS.reload(null,"prefs dialog change: ss_emojis -> "+e)})});$("#enhanced_debugging_cb").prop("checked",true===TS.prefs.getPref("enhanced_debugging"));$("#enhanced_debugging_cb").bind("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("enhanced_debugging",e);TS.prefs.setPrefByAPI({name:"enhanced_debugging",value:e},function(){TS.reload(null,"prefs dialog change: enhanced_debugging -> "+e)})});$("#flannel_server_pool").val(TS.prefs.getPref("flannel_server_pool"));$("#flannel_server_pool").on("change",function(){var e=$(this).val();var i=TS.prefs.getPref("flannel_server_pool");if(!_.includes(["production","canary","random"],e)){TS.error("Tried to set an invalid value ('"+e+"') for `flannel_server_pool` pref");return}TS.prefs.setPrefByAPI({name:"flannel_server_pool",value:e},function(){TS.log(1989,"Flannel: canary pref changed from "+i+" to "+e);TS.interop.SocketManager.disconnect()})});$("#client_logs_pri").hide().lazyFilterSelect({placeholder_text:TS.i18n.t("Select logs to enable...","prefs")(),tokenClass:function e(){return"capitalize"},listItemClass:function e(){return"capitalize"}}).on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"client_logs_pri",value:e?e.join(","):""})});var t=Math.random();if("U024BE7LV"===TS.model.user.id)$("#emo_bear").attr("src","/img/emo_bear2.gif?"+t);else $("#emo_bear").attr("src","/img/emo_bear.gif?"+t);$("#surprise_me").on("change",function(){$("#surprise").fadeIn(150,function(){setTimeout(function(){$("#surprise").fadeOut(500,function(){t=Math.random();if("U024BE7LV"===TS.model.user.id)$("#emo_bear").attr("src","/img/emo_bear2.gif?"+t);else $("#emo_bear").attr("src","/img/emo_bear.gif?"+t);$("#surprise_me").prop("checked",false)})},2400)})});if(TS.boot_data.feature_show_jumper_scores){$("#show_jumper_scores").prop("checked",true===TS.prefs.getPref("show_jumper_scores"));$("#show_jumper_scores").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_jumper_scores",value:e})})}};var V=function e(){$('input:radio[name="pr_sidebar"]').filter('[value="'+TS.prefs.getPref("sidebar_behavior")+'"]').prop("checked",true);$('input:radio[name="pr_sidebar"]').on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"sidebar_behavior",value:e});TS.prefs.onPrefChanged({name:"sidebar_behavior",value:e})});if(TS.boot_data.feature_sli_channel_priority){var t=$("#channel_sort_select");var n={};if(TS.boot_data.feature_sidebar_settings_button)n={default:TS.i18n.t("Sort channels alphabetically (default)","prefs")(),priority:TS.i18n.t("Sort channels scientifically (based on how you use Slack)","prefs")()};else n={default:TS.i18n.t("Alphabetically (default)","prefs")(),priority:TS.i18n.t("Scientifically (sorted based on how you use Slack)","prefs")()};_.each(n,function(e,i){t.append('<option value="'+i+'">'+e+"</option>")});var a=_.get(n,TS.prefs.getPref("channel_sort"))?TS.prefs.getPref("channel_sort"):"default";t.val(a);t.on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"channel_sort",value:e});TS.prefs.onPrefChanged({name:"channel_sort",value:e})})}$("#separate_private_channels_cb").prop("checked",true===TS.prefs.getPref("separate_private_channels"));$("#separate_private_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"separate_private_channels",value:e})});$("#separate_shared_channels_cb").prop("checked",true===TS.prefs.getPref("separate_shared_channels"));$("#separate_shared_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"separate_shared_channels",value:e})});$("#enable_unread_view").prop("checked",true===TS.prefs.getPref("enable_unread_view"));$("#enable_unread_view").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("seen_unread_view_coachmark",true);TS.prefs.setMultiPrefsByAPI({enable_unread_view:e,seen_unread_view_coachmark:true});TS.prefs.onPrefChanged({name:"enable_unread_view",value:e})});if(TS.boot_data.feature_jumper_sidebar){$("#show_sidebar_quickswitcher_button_cb").prop("checked",true===TS.prefs.getPref("show_sidebar_quickswitcher_button")).removeClass("hidden");$("#show_sidebar_quickswitcher_button_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_sidebar_quickswitcher_button",value:e})})}else{$("#no_omnibox_in_channels_cb").prop("checked",false===TS.prefs.getPref("no_omnibox_in_channels")).removeClass("hidden");$("#no_omnibox_in_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"no_omnibox_in_channels",value:!e})})}i.find('input:radio[name="sidebar_theme_rd"]').on("change",function(){var e=$(this).val();var i=TS.sidebar_themes.default_themes[e];he(e,i)});i.find("input.color_hex").on("textchange",function(){var e=$.trim($(this).val());if(!e.match(TS.prefs.hex_regex)){clearTimeout(o);return}if(0!==e.indexOf("#"))e="#"+e;$(this).prev(".color_swatch").css("background-color",e).data("hex",e);clearTimeout(o);o=setTimeout(function(){var e="custom_theme";var t={column_bg:i.find('input[name="color_column_bg_hex"]').val(),menu_bg:i.find('input[name="color_menu_bg_hex"]').val(),active_item:i.find('input[name="color_active_item_hex"]').val(),active_item_text:i.find('input[name="color_active_item_text_hex"]').val(),hover_item:i.find('input[name="color_hover_item_hex"]').val(),text_color:i.find('input[name="color_text_color_hex"]').val(),active_presence:i.find('input[name="color_active_presence_hex"]').val(),badge:i.find('input[name="color_badge_hex"]').val()};$.each(t,function(e,i){if("#"!==i[0])t[e]="#"+i});he(e,t)},250)});i.find("#sidebar_theme_custom").on("textchange",function(){var e=$(this);setTimeout(function(){var i=$.trim(e.val());var t=i.replace(/ /g,"").split(",");var n=true;$.each(t,function(e,i){if(!i.match(TS.prefs.hex_regex))n=false});if(!n){clearTimeout(o);return}var a={column_bg:t[0],menu_bg:t[1],active_item:t[2],active_item_text:t[3],hover_item:t[4],text_color:t[5],active_presence:t[6],badge:t[7]};$.each(a,function(e,i){if("#"!==i[0])a[e]="#"+i});clearTimeout(o);o=setTimeout(function(){he("custom_theme",a)},250)},0)});i.find(".color_swatch").on("click.show_picker",function(e){e.stopPropagation();var t=$(this);var n=t.next("input");i.find(".color_swatch.selected").removeClass("selected").find(".colpick").addClass("hidden");var a=t.data("hex").replace("#","");t.colpick({flat:true,layout:"hex",color:a,submit:0,onChange:function e(a,r){t.css("background-color","#"+r).data("hex","#"+r);n.val("#"+r);clearTimeout(o);o=setTimeout(function(){var e="custom_theme";var t={column_bg:i.find('input[name="color_column_bg_hex"]').val(),menu_bg:i.find('input[name="color_menu_bg_hex"]').val(),active_item:i.find('input[name="color_active_item_hex"]').val(),active_item_text:i.find('input[name="color_active_item_text_hex"]').val(),hover_item:i.find('input[name="color_hover_item_hex"]').val(),text_color:i.find('input[name="color_text_color_hex"]').val(),active_presence:i.find('input[name="color_active_presence_hex"]').val(),badge:i.find('input[name="color_badge_hex"]').val()};he(e,t)},500)}}).colpickSetColor(a);i.on("click.hide_colpick",function(){i.find(".color_swatch.selected").removeClass("selected").find(".colpick").addClass("hidden")});t.addClass("selected").find(".colpick").removeClass("hidden")});$("#customize_theme_toggle").on("click",function(){$("#customize_theme_info").addClass("hidden");$("#prefs_themes_customize").removeClass("hidden");l=true})};var q=function e(){$("#full_text_extracts_cb").prop("checked",true===TS.prefs.getPref("full_text_extracts"));$("#full_text_extracts_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefLocal("full_text_extracts",e);TS.prefs.setPrefByAPI({name:"full_text_extracts",value:e})});$("#msg_preview_cb").prop("checked",true===TS.prefs.getPref("msg_preview"));$("#msg_preview_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"msg_preview",value:e});$("#msg_preview_persistent_cb").prop("disabled",!e);TS.prefs.onPrefChanged({name:"msg_preview",value:e})});$("#msg_preview_persistent_cb").prop("checked",true===TS.prefs.getPref("msg_preview_persistent"));$("#msg_preview_persistent_cb").prop("disabled",!TS.prefs.getPref("msg_preview"));$("#msg_preview_persistent_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"msg_preview_persistent",value:e});TS.prefs.onPrefChanged({name:"msg_preview_persistent",value:e})});$("#measure_css_usage_cb").prop("checked",true===TS.prefs.getPref("measure_css_usage"));$("#measure_css_usage_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"measure_css_usage",value:e});TS.prefs.onPrefChanged({name:"measure_css_usage",value:e})});if(TS.model.is_electron){$("#show_memory_instrument_cb").prop("checked",true===TS.prefs.getPref("show_memory_instrument"));$("#show_memory_instrument_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_memory_instrument",value:e});TS.prefs.onPrefChanged({name:"show_memory_instrument",value:e})})}$("#react_msg_pane_cb").prop("checked",true===TS.boot_data.use_react_messages);$("#react_msg_pane_cb").on("change",function(){var e=!!$(this).prop("checked");var i=function i(){TS.prefs.setPrefByAPI({name:"use_react_messages",value:e}).then(function(){TS.reload()})};if(e)TS.generic_dialog.start({title:"Are you sure?",body:"The React Message Pane is a work in progress. You should not enable it unless you are prepared to put up with bugs. Are you sure you want to turn it on?",show_cancel_button:true,onGo:i,onCancel:function e(){$("#react_msg_pane_cb").prop("checked",false)}});else i()});$("#opt_out_react_msg_pane_cb").prop("checked",true===TS.prefs.getPref("opt_out_react_messages"));$("#opt_out_react_msg_pane_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"opt_out_react_messages",value:e}).then(function(){TS.reload()})});$("#show_org_wide_channels_sidebar").prop("checked",true===TS.prefs.getPref("ent_org_wide_channels_sidebar"));$("#show_org_wide_channels_sidebar").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"ent_org_wide_channels_sidebar",value:e})})};var z=function e(){$("#mac_ssb_bounce_cb").prop("checked",!!TS.prefs.getPref("mac_ssb_bounce"));$("#mac_ssb_bounce_short_cb").prop("checked","long"!==TS.prefs.getPref("mac_ssb_bounce"));$("#mac_ssb_bounce_cb").on("change",function(){var e=!!$(this).prop("checked");var i=!!$("#mac_ssb_bounce_short_cb").prop("checked");TS.prefs.setPrefLocal("mac_ssb_bounce","");if(e)TS.prefs.setPrefLocal("mac_ssb_bounce",i?"short":"long");TS.prefs.setPrefByAPI({name:"mac_ssb_bounce",value:TS.prefs.getPref("mac_ssb_bounce")});ge()});$("#mac_ssb_bounce_short_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"mac_ssb_bounce",value:e?"short":"long"})});$("#mac_ssb_bullet_cb").prop("checked",true===TS.prefs.getPref("mac_ssb_bullet"));$("#mac_ssb_bullet_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"mac_ssb_bullet",value:e})})};var Y=function e(){if(window.TSSSB&&TSSSB.call("hasPreference","windowFlashBehavior")){J();$("#winssb_flash_window_cb").on("change",function(){var e=$(this).is(":checked");var i=e?"always":"never";TSSSB.call("setPreference",{name:"windowFlashBehavior",value:i});J()});$("#winssb_flash_window_only_inactive_cb").on("change",function(){var e=$(this).is(":checked");var i=e?"idle":"always";TSSSB.call("setPreference",{name:"windowFlashBehavior",value:i});J()})}else{$("#winssb_flash_window_heading").addClass("hidden");$("#winssb_flash_window_choices").addClass("hidden")}var i=TS.boot_data.feature_notification_method;var t=TS.environment.isSSBAndAtLeastVersion("2.7.0")&&!(TS.environment.isSSBAndAtLeastVersion("2.8.0")&&i);var n=function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{show:true};if(i&&i.show){$("#winssb_notify_prefs_heading").removeClass("hidden");$("#winssb_notify_position").removeClass("hidden")}else{$("#winssb_notify_prefs_heading").addClass("hidden");$("#winssb_notify_position").addClass("hidden")}};if(window.TSSSB&&TS.model.is_win&&!t&&TSSSB.call("hasPreference","notifyPosition")){var a=TSSSB.call("getPreference","notifyPosition");$("#winssb_notify_corner").val(a.corner);$("#winssb_notify_corner").on("change",function(){var e=$(this).val();var i=$("#winssb_notify_display").val();TSSSB.call("setPreference",{name:"notifyPosition",value:{corner:e,display:i}})});$("#winssb_notify_display").val(a.display);$("#winssb_notify_display").on("change",function(){var e=$("#winssb_notify_corner").val();var i=$(this).val();TSSSB.call("setPreference",{name:"notifyPosition",value:{corner:e,display:i}})})}else n({show:false});var r=TS.environment.isSSBAndAtLeastVersion("2.7.0")&&TSSSB.call("hasPreference","notificationMethod");var s=TS.environment.isSSBAndAtLeastVersion("2.8.0");if(TS.model.is_win&&r&&i){var o=!!(navigator.userAgent.indexOf("Windows NT 10")>=0);var l=!!(navigator.userAgent.indexOf("Windows NT 6.3")>=0);var d=!!(navigator.userAgent.indexOf("Windows NT 6.2")>=0);var c=TS.model.is_win;var _=null;$("#please_restart").addClass("hidden");if(o){_="winrt";$("#method_window_win7").remove();$("#method_window_win8").remove()}else if(d||l){_="html";$("#method_winrt").remove();$("#method_window_win10").remove();$("#method_window_win7").remove()}else if(c){_="html";if(!TSSSB.call("getPreference","isAeroGlassEnabled"))$("#winssb_notification_method_container").addClass("hidden");$("#method_winrt").remove();$("#method_window_win10").remove();$("#method_window_win8").remove()}var u=TSSSB.call("getPreference","notificationMethod")||_;n({show:s&&"html"===u});$("#winssb_notification_method").val(u);$("#winssb_notification_method").on("change",function(){var e=$(this).val();if(e!==u)$("#please_restart").removeClass("hidden");else $("#please_restart").addClass("hidden");n({show:s&&"html"===e});TSSSB.call("setPreference",{name:"notificationMethod",value:e})})}else $("#winssb_notification_method_container").addClass("hidden")};var J=function e(){var i=TSSSB.call("getPreference","windowFlashBehavior");if("never"===i){$("#winssb_flash_window_cb").prop("checked",false);$("#winssb_flash_window_only_inactive_cb").prop("checked",false).prop("disabled",true)}else if("idle"===i){$("#winssb_flash_window_cb").prop("checked",true);$("#winssb_flash_window_only_inactive_cb").prop("checked",true).prop("disabled",false)}else{$("#winssb_flash_window_cb").prop("checked",true);$("#winssb_flash_window_only_inactive_cb").prop("checked",false).prop("disabled",false)}};var Z=function e(){$("#winssb_launch_on_start_cb").prop("checked",TSSSB.call("getPreference","launchOnStartup"));$("#winssb_launch_on_start_cb").on("change",function(){var e=!!$(this).prop("checked");TSSSB.call("setPreference",{name:"launchOnStartup",value:e})});$("#winssb_run_from_tray_cb").prop("checked",TSSSB.call("getPreference","runFromTray"));$("#winssb_run_from_tray_cb").on("change",function(){var e=!!$(this).prop("checked");TSSSB.call("setPreference",{name:"runFromTray",value:e});X()});if(window.TSSSB&&TSSSB.call("hasPreference","useHwAcceleration")){$("#winssb_disable_hw_acceleration_cb").prop("checked",!TSSSB.call("getPreference","useHwAcceleration"));$("#winssb_disable_hw_acceleration_cb").on("change",function(){var e=!$(this).prop("checked");TSSSB.call("setPreference",{name:"useHwAcceleration",value:e})})}else{$("#winssb_disable_hw_acceleration_pref").addClass("hidden");$("#winssb_disable_hw_acceleration_note").addClass("hidden")}};var X=function e(){var i=true;if(window.TSSSB&&TSSSB.call("hasPreference","windowFlashBehavior")){var t=TSSSB.call("getPreference","windowFlashBehavior");if("never"!==t&&"idle"!==t&&TSSSB.call("getPreference","runFromTray"))i=false}$("#winssb_flash_warning").toggleClass("hidden",i)};var ee=function e(){$(".message_theme_preview .timestamp").text(TS.interop.datetime.toTime(window.moment().unix(),{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:!TS.utility.date.do24hrTime()}))};var ie=function e(){i.find(".section_rollup").on("click",function(e){var i=$(e.target);var t=$(this);var a=t.attr("id");if(i.closest(".section_rollup_header").length){t.toggleClass("is_active");if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(n)}else if(!t.hasClass("is_active")){t.toggleClass("is_active");if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(n)}if(t.hasClass("is_active")){h.push(a);h=_.uniq(h)}else _.remove(h,function(e){return e===a})})};var te=function e(i){var t=$("#"+i);if(t.length)t.addClass("is_active")};var ne=function t(){if(!e)return;var n=ae();if("never"!==n)if(!TS.ui.growls.checkPermission())n="never";$("#growls_test").css("visibility","");var a=$('input:radio[name="notifications_rd"]').filter('[value="'+n+'"]').prop("checked",true);$(".global_notification_block.selected").removeClass("selected");a.closest(".global_notification_block").addClass("selected");if(!TS.boot_data.feature_mpdm_default_fe){var r=TS.templates.builders.buildNonDefaultNotificationBlock("margin-left");if(r){$(".non_default").removeClass("hidden");$("#non_default_html").html(r);$("#no_non_default").addClass("hidden")}else{$(".non_default").addClass("hidden");$("#no_non_default").removeClass("hidden")}$("#non_default_tip_link").tooltip("destroy").attr("title",TS.templates.builders.buildNonDefaultNotificationBlock("align_left")).tooltip({html:true})}$('input:radio[name="sound_option_rd"]').each(function(){if($(this).val()==TS.notifs.getDesktopNotificationSoundPref())$(this).attr("checked",true)});if(TS.prefs.getPref("mute_sounds")){i.find('input:radio[name="sound_option_rd"]').attr("disabled","disabled");i.find("label.sound_option").addClass("disabled")}else{i.find('input:radio[name="sound_option_rd"]').removeAttr("disabled");i.find("label.sound_option").removeClass("disabled")}var s="never"===n;var o="nothing"===be();var l=s&&o;$("#new_msg_snd_settings").toggleClass("disabled",!!TS.prefs.getPref("mute_sounds"));$("#new_msg_snd_none_cb").prop("checked","none"!==TS.notifs.getDesktopNotificationSoundPref());$("#select_new_msg_snd").toggleClass("hidden","none"===TS.notifs.getDesktopNotificationSoundPref()||s);$("#email_alerts_cb").prop("checked","none"!==TS.prefs.getPref("email_alerts"));$("#select_email_alerts, #email_alerts_info").toggleClass("hidden","none"===TS.prefs.getPref("email_alerts"));if("instant"===TS.prefs.getPref("email_alerts"))$("#email_alerts_current").html(TS.i18n.t("once every 15 minutes","prefs")());else if("hourly"===TS.prefs.getPref("email_alerts"))$("#email_alerts_current").html(TS.i18n.t("once an hour","prefs")());$("#mobile_different_settings_cb").prop("checked",p);$("#mobile_specific_settings").toggleClass("hidden",!p);$("#mobile_specific_settings").find('option[value="'+be()+'"]').prop("selected",true);$("#push_idle_wait_select").find('option[value="'+TS.notifs.getNotificationPushIdleWaitTimeInMinutes()+'"]').prop("selected",true);$("#no_text_in_notifications_cb").prop("checked",true!==TS.notifs.getNoTextInNotificationsPref());$("#threads_everything_cb").prop("checked",!!TS.notifs.getThreadsEverythingNotificationPref()&&!l);$("#no_notifications_warning").toggleClass("hidden","never"!==n);var d=["#threads_everything_cb","#no_text_in_notifications_cb","#dnd_enabled","#dnd_start_hour","#dnd_end_hour","#push_idle_wait_select"].join(", ");$(d).prop("disabled",l).closest("label").toggleClass("disabled",l);var c=["#new_msg_snd_none_cb","#mac_ssb_bounce_cb","#mac_ssb_bounce_short_cb","#winssb_flash_window_cb","#winssb_flash_window_only_inactive_cb","#winssb_notify_corner","#winssb_notify_display"].join(", ");$(c).prop("disabled",s).closest("label").toggleClass("disabled",s);var u=Ie();if(_.size(u)>0)$("#channel_overrides_callout").removeClass("hidden").html(TS.templates.prefs_channel_overrides_callout({count:_.size(u)}));else $("#channel_overrides_callout").addClass("hidden");ke()};var ae=function e(){if(TS.boot_data.feature_mpdm_default_fe){var i=TS.notifs.getGlobalNotificationSetting();if("everything"==i)return"all";else if("nothing"==i)return"never";return"mentions"}var t="all";if(!TS.prefs.getPref("growls_enabled"))t="never";else if(!TS.prefs.getPref("all_channels_loud"))t="mentions";return t};var re=function e(i){var t=/(\d?\d):(\d\d)/.exec(i);if(!t)return i;var n=parseInt(t[1],10);var a=t[2];var r="AM";if(n>12){r="PM";n-=12}else if(0==n)n=12;else if(12==n)r="PM";return n+":"+a+" "+r};var se=function e(){$("#growls_permission_div").addClass("hidden");$("#growls_instructions_div").removeClass("hidden");TS.ui.growls.promptForPermission(function(e,i){TS.info("callback called allowed:"+e+" permission_level:"+i);$("#growls_instructions_div").addClass("hidden");if("granted"===i&&e){$("#growls_allowed_div").removeClass("hidden").find(".desktop_notifications_title").addClass("kelly_green").text(TS.i18n.t("Desktop Notifications enabled!","prefs")());$("#growls_test").removeClass("hidden");if(!TS.prefs.getPref("growls_enabled")){TS.prefs.setPrefByAPI({name:"growls_enabled",value:true});TS.prefs.setPrefLocal("growls_enabled",true)}ne()}else if("default"===i)$("#growls_permission_div").removeClass("hidden");else if("denied"===i)$("#growls_disallowed_div").removeClass("hidden");else alert("huh allowed:"+e+" permission_level:"+i)})};var oe=function i(){if(!e)return;var t=TS.members.shouldDisplayRealNames()?"real_names":"display_names";var n=$('input:radio[name="display_real_names_override_cb"]').filter('[value="'+t+'"]').prop("checked",true);$(".global_notification_block.selected").removeClass("selected");n.closest(".global_notification_block").addClass("selected");if(TS.prefs.getTeamPref("display_real_names")){$(".display_real_names_default").removeClass("hidden");$(".display_usernames_default").addClass("hidden");$("#display_real_names_default").removeClass("hidden");$("#display_usernames_default").addClass("hidden")}else{$(".display_real_names_default").addClass("hidden");$(".display_usernames_default").removeClass("hidden");$("#display_real_names_default").addClass("hidden");$("#display_usernames_default").removeClass("hidden")}};var le=null;var de=function e(){if(le)le.cancel();var i=$("#highlight_words_input");var t=i.parents("label");var n=TS.ui.validation.validate(i);t.toggleClass(g,!n);i.toggleClass(g,!n);if(!n)return;var a=$("#highlight_words_input").val();le=TS.prefs.saveHighlightWords(a);le.finally(function(){le=null})};var ce=function e(){var i=[];var t=[];var n;var a=TS.channels.getChannelsForUser();a.sort(function e(i,t){var n=i._name_lc;var a=t._name_lc;if(n<a)return-1;if(n>a)return 1;return 0});_.forOwn(a,function(e){n=false;if(-1!=$.inArray(e.id,TS.model.search_exclude_channels))n=true;if(e.is_archived)t.push({search_channel_exclusion:n,channel:e});else i.push({search_channel_exclusion:n,channel:e})});return{active_channels:i,archived_channels:t}};var _e=function i(){if(!e)return;var t=TS.prefs.getReadStateTrackingPref();$('input:radio[name="read_rd"]').filter('[value="'+t+'"]').prop("checked",true)};var ue=function e(){$("#fs_modal, #fs_modal_bg").addClass("show_sidebar");$("#fs_modal_bg").append('<div id="sidebar_overlay"></div>')};var me=function e(){$("#fs_modal, #fs_modal_bg").removeClass("show_sidebar");$("#sidebar_overlay").remove();setTimeout(function(){TS.view.resizeManually()},TS.ui.fs_modal.transition_duration)};var fe=function t(n){if(!e)return;n=false!==n;if(TS.prefs.last_theme_selected_in_UI&&TS.prefs.getPref("sidebar_theme")!==TS.prefs.last_theme_selected_in_UI)return;else if(TS.prefs.last_theme_selected_in_UI&&n)TS.prefs.last_theme_selected_in_UI=null;if("default"===TS.prefs.getPref("sidebar_theme"))TS.prefs.setPrefLocal("sidebar_theme","default_theme");var a=TS.prefs.getPref("sidebar_theme");$('input:radio[name="sidebar_theme_rd"]').filter('[value="'+a+'"]').prop("checked",true);if(TS.prefs.getPref("sidebar_theme_custom_values")&&"undefined"!==TS.prefs.getPref("sidebar_theme_custom_values")){var r=JSON.parse(TS.prefs.getPref("sidebar_theme_custom_values"));var s=$.map(r,function(e){return e});if(i){i.find('input[name="color_column_bg_hex"]').val(r.column_bg);i.find('input[name="color_menu_bg_hex"]').val(r.menu_bg);i.find('input[name="color_active_item_hex"]').val(r.active_item);i.find('input[name="color_active_item_text_hex"]').val(r.active_item_text);i.find('input[name="color_hover_item_hex"]').val(r.hover_item);i.find('input[name="color_text_color_hex"]').val(r.text_color);i.find('input[name="color_active_presence_hex"]').val(r.active_presence);i.find('input[name="color_badge_hex"]').val(r.badge);i.find('.color_swatch[data-theme-element="column_bg"]').css("background-color",r.column_bg).data("hex",r.column_bg);i.find('.color_swatch[data-theme-element="menu_bg"]').css("background-color",r.menu_bg).data("hex",r.menu_bg);i.find('.color_swatch[data-theme-element="active_item"]').css("background-color",r.active_item).data("hex",r.active_item);i.find('.color_swatch[data-theme-element="active_item_text"]').css("background-color",r.active_item_text).data("hex",r.active_item_text);i.find('.color_swatch[data-theme-element="hover_item"]').css("background-color",r.hover_item).data("hex",r.hover_item);i.find('.color_swatch[data-theme-element="text_color"]').css("background-color",r.text_color).data("hex",r.text_color);i.find('.color_swatch[data-theme-element="active_presence"]').css("background-color",r.active_presence).data("hex",r.active_presence);i.find('.color_swatch[data-theme-element="badge"]').css("background-color",r.badge).data("hex",r.badge);$("#sidebar_theme_custom").val(s.join(","))}}};var he=function e(i,t){var n=false;TS.prefs.last_theme_selected_in_UI=i;TS.prefs.setMultiPrefsByAPI({sidebar_theme:i,sidebar_theme_custom_values:JSON.stringify(t)});TS.prefs.setPrefLocal("sidebar_theme",i);TS.prefs.setSidebarThemeCustomValues(t);fe(n);TS.view.prefs.sidebarThemePrefChanged(n);TS.prefs.messages_theme_changed_sig.dispatch()};var ge=function e(){if(TS.prefs.getPref("mac_ssb_bounce"))$("#mac_ssb_bounce_short_cb").prop("disabled",false);else $("#mac_ssb_bounce_short_cb").prop("disabled",true)};var pe=function i(t){if(!t.is_self)return;if(!e)return;$(".dnd_tz_label").text(TS.model.user.tz_label)};var Se=function i(){if(!e)return;if(TS.prefs.getPref("tz"))$("#prefs_dnd").removeClass("tz_not_set")};var Te=function e(i){if(v){v=false;return}if(TS.i18n.locale()===TS.prefs.getPref("locale")){if(TS.generic_dialog.is_showing)TS.generic_dialog.cancel();return}var t=TS.i18n.localesEnabled()[i];if(window.desktop&&desktop.teams&&desktop.teams.setTeamLocale)desktop.teams.setTeamLocale(i);if(TS.generic_dialog.is_showing)TS.generic_dialog.end();TS.generic_dialog.start({title:TS.i18n.t("Switching to {lang}","prefs")({lang:t}),body:"<p>"+TS.i18n.t("Changing your language will take just a moment.","prefs")()+"</p>",show_cancel_button:false,onGo:function e(){window.createCookie("i18n_locale",i,365,"slack.com");TS.reload(null,"prefs dialog change: locale -> "+t)}})};var ve=function e(i){var t=TS.boot_data.notification_sounds;var n=_.find(t,{value:i});return n?n.label:""};var be=function e(){var i=TS.notifs.getGlobalPushNotificationSetting();if("mentions"===i||"dm_and_mentions"===i||"dms"===i)i="mentions";return i};var we=function e(){var i=TS.notifs.getGlobalNotificationSetting();var t=be();return i!==t};var ye=function e(i){var t;if(TS.boot_data.feature_mpdm_default_fe)t=TS.notifs.setMobileGlobalNotifySetting(i);else{var n=Ae(i);if(!n)return;t=TS.prefs.setMultiPrefsByAPI(n)}if(t)TS.ui.inline_saver.show({target:"#prefs_send_notifications_for",promise:t})};var Ae=function e(i){var t={};switch(i){case"nothing":t.push_dm_alert=0;t.push_mention_alert=0;t.push_everything=0;break;case"mentions":t.push_dm_alert=1;t.push_mention_alert=1;t.push_everything=0;break;case"everything":t.push_dm_alert=1;t.push_mention_alert=1;t.push_everything=1;break;default:t=null}return t};var ke=function e(){var i=$("#channel_specific_overrides");i.longListView({items:[],approx_item_height:61,makeElement:function e(){return $('<div class="channel_overrides_row" data-action="open_channel_overrides"></div>')},renderItem:function e(i,t){i.attr("data-cid",t.id);i.html(TS.templates.prefs_channel_overrides({override:t}))},calcItemHeight:function e(i){return i.outerHeight()},preserve_dom_order:true,scrollable:i.closest(".contents_container")});Ce()};var Ce=function e(){var i=Ie();i=_.values(i);var t=_.reject(i,"channel.is_mpim");var n=_.filter(i,"channel.is_mpim");t=_.sortBy(t,"channel.name");n=_.sortBy(n,"channel.name");var a=t.concat(n);var r=$("#channel_specific_overrides");var s=true;r.longListView("setItems",a,s)};var Me=function e(i,t){if(i.muted)return false;if(i.suppress_at_channel)return false;var n=TS.redux.notifications.getDefaultDesktopNotifySetting(t);var a=TS.redux.notifications.getDefaultMobileNotifySetting(t);if(i.desktop!==n)return false;if(i.mobile!==a)return false;return true};var Ie=function e(){var i={};if(TS.boot_data.feature_mpdm_default_fe){var t=TS.redux.notifications.getAllNotificationOverrides();for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=t[n];if(Me(a,n))continue;var r=TS.shared.getModelObById(n);if(r)i[n]=xe(r,a)}return i}var s=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();var o=TS.notifs.getCorGsNotUsingGlobalPushNotificationSetting();var l=function e(t,n,a){t.forEach(function(e){var t=i[e.id];if(!t){t=Ee(e);i[e.id]=t}t[n]=a})};l(s.everything,"desktop","everything");l(s.mentions,"desktop","mentions");l(s.nothing,"desktop","nothing");l(s.muted,"is_muted",true);l(s.suppressed,"is_suppressed",true);l(o.everything,"mobile","everything");l(o.mentions,"mobile","mentions");l(o.nothing,"mobile","nothing");return i};var xe=function e(i,t){if(!TS.boot_data.feature_mpdm_default_fe)return;if(!i||!i.id)return;var n=TS.redux.notifications.getDefaultDesktopNotifySetting(i.id);var a=TS.redux.notifications.getDefaultMobileNotifySetting(i.id);var r={is_muted:!!t.muted,is_suppressed:!!t.suppress_at_channel,channel:i,id:i.id};if(t.desktop!==n)r.desktop=t.desktop;if(t.mobile!==a){r.mobile=t.mobile;if("dms"==r.mobile)r.mobile="mentions_dms"}return r};var Ee=function e(i){var t={channel:i,id:i.id};return t};var Be=function e(i){var t=TS.notifs.getGlobalNotificationSetting();if("everything"===t)TS.notifs.makeCorGDTopEverything(i);else if("mentions"===t)TS.notifs.makeCorGDTopMentions(i);else TS.notifs.makeCorGDTopNothing(i);var n=be();if("everything"===n)TS.notifs.makeCorGPushEverything(i);else if("mentions"===n)TS.notifs.makeCorGPushMentions(i);else TS.notifs.makeCorGPushNothing(i);TS.notifs.makeCorGNOTPushSuppressed(i);TS.notifs.makeCorGNOTSuppressed(i);TS.notifs.makeCorGNOTMuted(i);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(","),push_loud_channels:TS.model.push_loud_channels.join(","),push_mention_channels:TS.model.push_mention_channels.join(","),push_loud_channels_set:TS.model.push_loud_channels_set.join(","),at_channel_suppressed_channels:TS.model.at_channel_suppressed_channels.join(","),push_at_channel_suppressed_channels:TS.model.push_at_channel_suppressed_channels.join(","),muted_channels:TS.redux.channels.getMutedChannelsAsArray().join(",")}).catch(function(){TS.error("Failed to reset to channel defaults: "+i)})};var Pe=function e(){var i=$("#global_prefs_container");var t=$("#channel_prefs_container");if(!S)S=i.closest(".contents_container").scrollTop();a.addClass("hidden");i.addClass("hidden");t.removeClass("hidden");$("#channel_specific_overrides").longListView("setHidden",true);TS.ui.fs_modal.bindBackButton(Ue);TS.ui.fs_modal.showBackButton()};var $e=function e(){var i=$("#channel_prefs_container");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Add a Channel-Specific Notification Setting","prefs")());i.html(TS.templates.prefs_channel_picker());var t=function e(i){return TS.searcher.search(i,{channels:{include_archived:false,only_if_member:true},groups:{include_archived:false},mpims:true,sort:{allow_empty_query:true}}).then(function(e){e.all_items_fetched=true;_.forEach(e,function(e){e.lfs_id=e.model_ob.id});return e})};$("#channel_override_picker").lazyFilterSelect({single:true,placeholder_text:TS.i18n.t("Select or search","prefs")(),approx_item_height:30,tab_to_nav:true,no_default_selection:true,template:function e(i){return new Handlebars.SafeString(TS.templates.file_sharing_channel_row({item:i.model_ob}))},data_promise:t}).one("remove",function(){$(this).lazyFilterSelect("destroy")})};var De=function e(i){var t=$("#channel_prefs_container");var n=TS.shared.getModelObById(i);if(!n)return;var a=_.escape(TS.shared.getDisplayNameForModelOb(n));if(a.length>30)a=a.substring(0,30)+"...";a+=TS.templates.builders.maybeMakeSharedIcon(n);TS.ui.fs_modal.setHeaderTitle(new Handlebars.SafeString(TS.i18n.t("Notification Preferences: {channel_name}","prefs")({channel_name:a})));if(TS.boot_data.feature_channel_notif_dialog_update)TS.interop.mountChannelNotificationSettings(TS.boot_data.team_id,t[0],{channelId:i,onClose:function e(){return Ue(true)},onReset:function e(){Be(i)}});else{var r=true;TS.ui.channel_prefs_dialog.renderOptions(t,i,r)}t.find('[data-action="done"]').on("click",Ue);t.find('[data-action="reset_channel_to_defaults"]').on("click",function(){Be(i)});w=true};var Ue=function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:false;var t=$("#global_prefs_container");var n=$("#channel_prefs_container");TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();TS.ui.fs_modal.setHeaderTitle(k());if(TS.boot_data.feature_channel_notif_dialog_update)TS.interop.unmountChannelNotificationSettings(n[0]);a.removeClass("hidden");t.removeClass("hidden");n.addClass("hidden").empty();$("#channel_specific_overrides").longListView("setHidden",false);if(i)S=0;t.closest(".contents_container").scrollTop(S);S=0;w=false};var Fe=function e(){var i=$("#channel_prefs_container");if(!i.length||i.hasClass("hidden"))return true;var t=$("#channel_override_picker");if(t.length){var n=t.lazyFilterSelect("value")[0];var a=_.get(n,"model_ob.id");if(!a)return false;De(a);return false}Ue();return false}})()},4968:function(e,i){(function(){TS.registerModule("ui.mpim_conversion_modal",{onStart:function e(){},startMpimConversionModal:function e(i){t=i;var s=TS.mpims.getMembersInDisplayOrder(t);var o=_.filter(s,{is_ultra_restricted:true});var l=TS.templates.mpim_conversion_modal({members:s,uras:o});TS.ui.fs_modal.start({body_template_html:l,onShow:n,onEnd:r,modal_class:"mpim_conversion_modal",onGo:a})},go:function n(){var a=e.find(".title_input").val();if(i)i.start();TS.mpims.convertToGroup(t,a,{validate_name:true}).then(function(){if(i)i.stop();TS.ui.fs_modal.close()}).catch(function(t){if(i)i.stop();var n=t.data.error;var r=TS.ui.validation.getErrorMessage(n,{maxlength:22,name:a});return TS.ui.validation.showWarning(e.find(".title_input"),r,{custom_for:"channel_create_title"})})}});var e;var i;var t;var n=function i(){e=$(".mpim_conversion_modal");e.on("click",".continue",function(){a()});e.find(".convert_mpim_go").click(TS.ui.mpim_conversion_modal.go);var t=e.find(".title_input");t.keydown(function(e){if(e.which===TS.utility.keymap.enter)TS.ui.mpim_conversion_modal.go();else if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()})};var a=function t(){if(!$("#conversion_step").hasClass("hidden")&&e.find(".title_input").val().length>1)return TS.ui.mpim_conversion_modal.go();$("#confirmation_step").addClass("hidden");$("#conversion_step").removeClass("hidden");i=Ladda.create(e.find(".convert_mpim_go")[0]);e.find(".title_input").focus();return false};var r=function e(){s()};var s=function n(){e=null;i=null;t=null}})()},4969:function(e,i){(function(){TS.registerModule("ui.fs_modal_file_viewer",{start:function e(i){b=i;y=TS.useReactMessages();if(!b||!b.current_file_id&&!b.current_external_link){TS.error("Full screen file viewer modal requires something to show.");return}if(TS.ui.fs_modal_file_viewer.is_showing){TS.error("Full screen file viewer modal is already showing.");return}TS.files.team_file_comment_added_sig.add(Se);TS.files.team_file_comment_deleted_sig.add(Se);TS.files.team_file_deleted_sig.add(Ie);TS.files.team_file_changed_sig.add(Q);TS.channels.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.members.changed_current_status_sig.add(TS.ui.fs_modal_file_viewer.updateCurrentStatusForMember,TS.ui.fs_modal_file_viewer);TS.ui.fs_modal.start(le());TS.ui.fs_modal_file_viewer.is_showing=true;Y();ge();pe();he();Te();we();fe("both");setTimeout(function(){de()},0)},getCurrentFileId:function e(){if(!TS.ui.fs_modal_file_viewer.is_showing)return false;if(b.current_file_id)return b.current_file_id;if(b.current_external_link)return b.current_external_link.getAttribute("data-src");return false},previous:function e(){if(i.find(".previous_btn:not([disabled])").length)ue(-1)},next:function e(){if(i.find(".next_btn:not([disabled])").length)ue(1)},updateGallery:function e(){if(TS.client.activeChannelIsHidden())return;setTimeout(function(){if(y){T=J();ge();pe();he();return}var e=$("#msgs_div").find(".file_viewer_link, .file_viewer_external_link, .thumbnail_link");if(e!==T){T=e;if(TS.model.pdf_viewer_enabled)Z();pe();he()}},500)},updateCurrentStatusForMember:function e(i){if(!TS.ui.fs_modal_file_viewer.is_showing)return;var t={member:i,for_message:true};$(".aside_panel .message_current_status.color_"+i.id).replaceWith(TS.templates.current_status(t))},storeLastCommentInput:function e(){if(!i)return;if(!v||!v.file||!v.file.id)return;TS.storage.storeLastCommentInput(v.file.id,TS.utility.contenteditable.value(i.find("#file_comment")))},test:function e(){var e={_generateTemplateArguments:ne,_shouldDisplayLargestThumb:te};Object.defineProperty(e,"_settings",{get:function e(){return b},set:function e(i){b=i}});Object.defineProperty(e,"_current_file",{get:function e(){return v},set:function e(i){v=i}});Object.defineProperty(e,"_canComment",{get:function e(){return L},set:function e(i){L=i}});return e},canClose:function e(){return U()}});var e=$("body");var i;var t;var n;var a;var r;var s;var o;var l;var d;var c;var u;var m;var f;var h;var g;var p;var S;var T;var v={index:0,aside_panel_showing:false};var b={};var w;var y;var A=function e(){i=$(".fs_modal_file_viewer");t=i.find(".fs_modal_file_viewer_content");n=i.find(".viewer");k();s=n.find(".images");C();M()};var k=function e(){a=i.find(".fs_modal_file_viewer_header");r=a.find(".file_header_detailed")};var C=function e(){o=s.find(".scaled_image");l=s.find(".actual_pixel_image")};var M=function e(){d=i.find(".comment_btn");c=i.find(".aside_panel");u=i.find(".details_container");m=i.find(".comments_container");f=i.find(".shared_to_conversations");h=i.find(".file_comment_form_container")};var I=function e(){i=null;t=null;n=null;o=null;s=null;d=null;c=null;u=null;m=null;f=null;h=null;l=null;a=null;r=null;T=null;b.$el=null};var x=function e(){X();ke();H();TS.ui.inline_edit.end();ee();Me();I();TS.ui.fs_modal_file_viewer.is_showing=false};var E=function e(){A();B();Ce();if(v.is_pdf)w=new TS.ui.PdfViewer(s.find("#pdf_display"),v.file)};var B=function n(){i.on("click",".comment_btn, .aside_close_btn",G);i.on("click","#fs_modal_close_btn, .channel_link, .group_link, .file_preview_link",TS.ui.fs_modal.close);i.on("mousedown",".viewer",O);i.on("click",".viewer",R);i.on("click",".scaled_image",function(e){e.stopPropagation();V(e)});i.on("click",".actual_pixel_image",function(e){e.stopPropagation();q()});i.on("click",".previous_btn",function(e){e.stopPropagation();TS.ui.fs_modal_file_viewer.previous()});i.on("click",".next_btn",function(e){e.stopPropagation();TS.ui.fs_modal_file_viewer.next()});i.on("click",".file_comment_btn",function(e){var i=$(e.target);var t=i.closest("[data-model-ob-id]").attr("data-model-ob-id");Te(t)});i.on("click",".aside_back_btn",function(){Te(null)});e.on("keydown",D);TS.view.resize_sig.add(de);t.on("click.view",TS.view.onFilePreviewClick);P()};var P=function e(){i.find(".scaled_image").on("error",function(){if(!s)return;s.addClass("broken_image")})};var D=function e(i){switch(i.which){case TS.utility.keymap.up:if(TS.utility.isFocusOnInput())return;if(!v.is_actual_pixel_image_shown)return;i.preventDefault();i.stopPropagation();z("up");break;case TS.utility.keymap.down:if(TS.utility.isFocusOnInput())return;if(!v.is_actual_pixel_image_shown)return;i.preventDefault();i.stopPropagation();z("down");break;case TS.utility.keymap.left:if(TS.utility.isFocusOnInput())return;i.preventDefault();i.stopPropagation();if(v.is_actual_pixel_image_shown)z("left");else TS.ui.fs_modal_file_viewer.previous();break;case TS.utility.keymap.right:if(TS.utility.isFocusOnInput())return;i.preventDefault();i.stopPropagation();if(v.is_actual_pixel_image_shown)z("right");else TS.ui.fs_modal_file_viewer.next();break;case TS.utility.keymap.space:if(TS.utility.isFocusOnInput())return;i.preventDefault();i.stopPropagation();W(i);break;case TS.utility.keymap.esc:N(i)}};var U=function e(){if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;if(TS.ui.inline_edit.containsActiveElement(i))return false;return true};var F=true;var O=function e(){F=U()};var R=function e(i){if(!F)return;if($(i.target).closest(".control_btns").length)return;TS.ui.fs_modal.close()};var N=function e(i){if(TS.utility.isFocusOnInput())return;if(!U())return;i.stopPropagation();i.preventDefault();if(v.is_actual_pixel_image_shown)q();else TS.ui.fs_modal.close()};var H=function t(){i.off("click");e.off("keydown",D);TS.view.resize_sig.remove(de)};var Q=function e(t){if(i.length&&v.file.id===t.id){var n=ne();var a=false;if(TS.ui.inline_edit.containsActiveElement(r))a=true;if(!a){r.replaceWith(TS.templates.file_header_detailed(n));k()}}};var L=function e(){if(TS.files.isFileAuthorExternal(v.file))return false;if(!b.current_file_id)return false;return true};var G=function e(){if(v.aside_panel_showing)K();else j()};var j=function e(){d.addClass("active");t.addClass("aside_panel_active");v.aside_panel_showing=true;window.setTimeout(function(){p.focus()},250)};var K=function e(){d.removeClass("active");t.removeClass("aside_panel_active");v.aside_panel_showing=false;window.setTimeout(function(){d.blur()},250)};var W=function e(i){if(v.is_actual_pixel_image_shown)q();else V(i)};var V=function e(i){if(v.is_image_within_viewer)return false;var t=ce(i);n.addClass("show_actual_pixel");v.is_actual_pixel_image_shown=true;_e(t)};var q=function e(){n.removeClass("show_actual_pixel");v.is_actual_pixel_image_shown=false;n.scrollLeft(0);n.scrollTop(0)};var z=function e(i){var t=n[0];if(!t)return;var a="up"===i||"down"===i;var r=a?"scrollTop":"scrollLeft";var s=25;if("up"===i||"left"===i)s*=-1;t[r]+=s};var Y=function e(){if(TS.client.activeChannelIsHidden()){T=y?[]:$();return}if(y)T=J();else{T=$("#msgs_div").find(".file_viewer_link, .file_viewer_external_link, .thumbnail_link");if(TS.model.pdf_viewer_enabled)Z()}};var J=function e(){var i=v.file&&v.file.timestamp+".000000"||v.msg&&v.msg.ts;var t=TS.redux.messages.getMessagesInChannel(TS.shared.getActiveModelOb().id,i,false);var n=[];_.forEach(t,function(e){if(e.file&&TS.files.fileIsImage(e.file))n.push({file:e.file});if(e.attachments)_.forEach(e.attachments,function(i){if(i.image_url)n.push({src:i.image_url,width:i.image_width,height:i.image_height,rotation:i.rotation,ts:e.ts,channel:e.channel})})});return n};var Z=function e(){T=T.filter(function(){var e=$(this);var i=e.attr("data-file-id");return!TS.files.fileIsPDF(i)})};var X=function e(){TS.files.team_file_comment_added_sig.remove(Se);TS.files.team_file_comment_deleted_sig.remove(Se);TS.files.team_file_deleted_sig.remove(Ie);TS.files.team_file_changed_sig.remove(Q);TS.channels.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer)};var ee=function e(){b.current_file_id=null;b.current_external_link=null;v.external_file_src=null;v.link_url=null;v.is_image_within_viewer=null;if(w){w.destroy();w=null}};var ie=function e(){if(b.current_file_id){v.file=TS.files.getFileById(b.current_file_id);v.member=TS.members.getMemberById(v.file.user);v.original_w=v.file.original_w;v.original_h=v.file.original_h;v.is_pdf=TS.model.pdf_viewer_enabled&&TS.files.fileIsPDF(v.file);TS.files.fetchFileInfo(v.file.id,function(){if(v.file&&v.file.comments&&v.file.comments.length)if(!TS.boot_data.feature_share_mention_comment_cleanup){var e=c||$();e.find(".comments").html(TS.templates.builders.buildComments(v.file))}})}else if(b.current_external_link){v.file={};v.model_ob=re();v.msg=se();v.member=oe(v.msg);if(y&&b.current_external_link.src){v.link_url=b.current_external_link.src;v.external_file_src=b.current_external_link.src;v.original_w=b.current_external_link.width;v.original_h=b.current_external_link.height;v.rotation=b.current_external_link.rotation;v.content_type=b.current_external_link.contentType}else{v.link_url=b.current_external_link.getAttribute("data-link-url");v.external_file_src=b.current_external_link.getAttribute("data-src");v.original_w=b.current_external_link.getAttribute("data-width");v.original_h=b.current_external_link.getAttribute("data-height");v.rotation=b.current_external_link.getAttribute("data-rotation");v.content_type=b.current_external_link.getAttribute("data-content-type")}v.is_pdf=false}else v.file={}};var te=function e(i){var t=false===TS.prefs.getPref("a11y_animations")&&"gif"===i.filetype&&!i.deanimate_gif;var n="external"===i.mode;var a=i.image_exif_rotation>4;var r="tiff"===_.toLower(i.pretty_type);return t||n||a||r};var ne=function e(){var i=v.file.comments_count?v.file.comments_count:"";var t=!v.external_file_src||b.current_file_id;var n;if(t)n=TS.templates.builders.makeFileShareLabel(v.file);else n=TS.templates.builders.makeMessageShareLabelSafe(v.model_ob);var a=t?v.file.timestamp:v.msg&&v.msg.ts;var r=t?"file":"message";var s="message"===r?v.msg:v.file;var o="message"===r?v.model_ob:null;var l=v.file.id?TS.files.getFileActions(v.file):{};l.more=t;l.comment=L();if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.createFileCommentsGroup(v.file);var d={file:v.file,member:v.member,share_label:n,timestamp:a,star_type:r,star_ob:s,star_parent_ob:o,msg:v.msg,model_ob:v.model_ob,comments_count:i,is_aside_panel_active:!!v.aside_panel_showing,show_open_public_link:t&&!TS.prefs.getTeamPref("disallow_public_file_urls"),show_revoke_public_link:t&&!TS.prefs.getTeamPref("disallow_public_file_urls")&&TS.files.getFileActions(v.file).revoke_public_link,control_btns:b.show_control_btns,actions:l,link_url:v.link_url};if(TS.model.pdf_viewer_enabled&&v.is_pdf){d.file_is_pdf=true;d.control_btns=false;d.pdf_viewer_url=TS.boot_data.abs_root_url+"pdf-viewer?feature_pdf_viewer=1"}else{var c=ae(v);var _=c.scaled;var u=c.actual_pixel;d.scaled_src=_;d.scaled_rotation=_===v.file.url_private&&v.file.image_exif_rotation;d.actual_pixel_src=u;d.actual_pixel_rotation=u===v.file.url_private&&v.file.image_exif_rotation}return d};var ae=function e(i){var t=i.file.url_private;if(te(i.file))t=TS.files.getThumbSrcForFile(i.file,{max_size:1024});else if(false===TS.prefs.getPref("a11y_animations")&&"gif"===i.file.filetype&&i.file.deanimate_gif)t=i.file.deanimate_gif;if(i.external_file_src){var n={};n.rotate=!!parseInt(i.rotation,10);if("image/svg+xml"===i.content_type){n.render_svg=true;n.width=i.original_w;n.height=i.original_h}t=TS.utility.getImgProxyURLWithOptions(i.external_file_src,n)}var a=t;if(i.file.thumb_1024&&!i.file.thumb_360_gif){var r=$(window).width()<i.file.thumb_1024_w||$(window).height()<i.file.thumb_1024_h;if(r)t=i.file.thumb_1024}return{scaled:t,actual_pixel:a}};var re=function e(){if(y&&b.current_external_link.channel)return TS.shared.getModelObById(b.current_external_link.channel);var i=$(b.current_external_link);var t;if(i.closest(".search_message_result").length){var n=i.closest(".search_message_result").data("channel");t=TS.ims.getImById(n)||TS.channels.getChannelById(n)||TS.groups.getGroupById(n)||TS.mpims.getMpimById(n)}else if(i.closest("#messages_container").length)t=TS.shared.getActiveModelOb();return t||{}};var se=function e(){if(y&&b.current_external_link.ts)return TS.utility.msgs.findMsg(b.current_external_link.ts,b.current_external_link.channel);var i=$(b.current_external_link).closest("ts-message").data("ts");var t=TS.utility.msgs.findMsg(i,v.model_ob.id);return t||{ts:i}};var oe=function e(i){if(!i)return false;return TS.members.getMemberById(i.user)};var le=function e(){ie();v.aside_panel_showing=false;var i="fs_modal_file_viewer";if(TS.boot_data.feature_share_mention_comment_cleanup)i+=" with_conversations";return $.extend({},{modal_class:i,modal_contents_container_class:"fs_modal_file_viewer_content",disable_default_controls:true,body_template_html:TS.templates.fs_modal_file_viewer(ne()),onShow:E,onEnd:x})};var de=function e(){v.is_image_within_viewer=null;if(!n)return;if(v.is_pdf)return;var i=n.width();var t=n.height();var a;var r;if(te(v.file)){var s=TS.files.getThumbSrcForFile(v.file,{max_size:1024});var d=_.invert(v.file)[s];if(d&&v.file){a=v.file[d+"_w"];r=v.file[d+"_h"]}}else{a=v.original_w;r=v.original_h}if(!a)a=l.width();if(!r)r=l.height();var c=a-i;var u=r-t;if(c<1&&u<1)v.is_image_within_viewer=true;if(v.is_image_within_viewer)o.addClass("no_zoom");else o.removeClass("no_zoom")};var ce=function e(i){if(i.pageX){var t={width:o.width(),height:o.height()};var n={x:i.pageX-o.offset().left,y:i.pageY-o.offset().top};return{x:n.x/t.width,y:n.y/t.height}}return{x:.5,y:.5}};var _e=function e(i){var t={x:(l.width()-n.width())*i.x,y:(l.height()-n.height())*i.y};n.scrollLeft(t.x);n.scrollTop(t.y)};var ue=function e(i){TS.ui.inline_edit.end();ee();v.index+=i;if(T){if(y){var t=T[v.index];if(t&&t.file)b.current_file_id=t.file;if(t&&t.src)b.current_external_link=t}else{var n=T.eq(v.index);b.current_file_id=n.data("file-id");if(n.hasClass("file_viewer_external_link"))b.current_external_link=n[0]}me();if(!L())K();Ce();P();fe(i)}};var me=function e(){ie();var i=ne();var t=$(TS.templates.fs_modal_file_viewer_header(i));a.replaceWith(t);a=t;if(v.is_pdf){var n=$(TS.templates.fs_modal_file_viewer_content_pdf(i));s.replaceWith(n);s=n;w=new TS.ui.PdfViewer(s.find("#pdf_display"),v.file)}else{var r=$(TS.templates.fs_modal_file_viewer_content_image(i));s.replaceWith(r);s=r}C();ye();if(TS.boot_data.feature_share_mention_comment_cleanup)Te();else{var o=$(TS.templates.fs_modal_file_viewer_aside(i));c.replaceWith(o);c=o}M();Ae();he();de()};var fe=function e(i){if("both"===i){e(1);i=-1}var t=v.index+i;if(!T||t<0||T.length<=t)return;var n;if(y){var a=T[t];n={file:TS.files.getFileById(a.file)||{},external_file_src:a.src}}else{var r=T.eq(t);var s=r.hasClass("file_viewer_external_link");n={file:TS.files.getFileById(r.data("file-id"))||{},external_file_src:s?r.data("src"):void 0}}if(TS.model.pdf_viewer_enabled&&TS.files.fileIsPDF(n.file))return;var o=ae(n);var l=new Image;l.src=o.scaled};var he=function e(){if(!i)return;var t=i.find(".control_btns");var n=i.find(".previous_btn");var a=i.find(".next_btn");if(1===T.length||0===T.length)t.addClass("hidden");else t.removeClass("hidden");n.attr("disabled",v.index<=0);a.attr("disabled",v.index>=T.length-1)};var ge=function e(){if(y){T=_.uniqBy(T,function(e){return e.file||e.src});return}var i={};T=T.filter(function(){var e=this.getAttribute("data-file-id")?this.getAttribute("data-file-id"):"";e+=this.getAttribute("data-src")?this.getAttribute("data-src"):"";if(i.hasOwnProperty(e))return false;i[e]=true;return true})};var pe=function e(){if(y){_.forEach(T,function(e,i){if(e.file&&e.file===b.current_file_id){v.index=i;return false}if(e.src&&e.src===v.external_file_src){v.index=i;return false}});return}for(var i=0;i<T.length;i+=1)if(T[i].getAttribute("data-file-id")){if(T[i].getAttribute("data-file-id")===b.current_file_id){v.index=i;break}}else if(T[i].getAttribute("data-src")===v.external_file_src){v.index=i;break}};var Se=function e(){if(!i)return;var t=v.file.comments&&v.file.comments.length;i.find(".comment_count").text(t||"")};var Te=function e(i){if(TS.boot_data.feature_share_mention_comment_cleanup){i=null!==i&&(i||b.$el.closest("[data-model-ob-id").attr("data-model-ob-id"));if(i)be(i);else ve()}};var ve=function e(){TS.files.createFileCommentsGroup(v.file);f.replaceWith(TS.templates.shared_to_conversations(v.file));c.attr("data-model-ob-id","");h.addClass("hidden");u.unhideWithRememberedScrollTop();m.hideWithRememberedScrollTop()};var be=function e(i){TS.files.createFileCommentsGroup(v.file);var t=jQuery.extend(true,{},v.file);var n=t._comments_grouped[i];t.comments=n.comments;var a=TS.shared.getModelObById(i);var r=a&&TS.shared.getDisplayNameForModelOb(a);var s=t.id?TS.files.getFileActions(t):{};s.comment=L();var o={file:t,name:r,actions:s};m.html(TS.templates.fs_modal_file_viewer_comments(o));c.attr("data-model-ob-id",i);if(s.comment)h.removeClass("hidden");else h.addClass("hidden");m.unhideWithRememberedScrollTop();u.hideWithRememberedScrollTop()};var we=function e(){ye();Ae()};var ye=function e(){p=$("#file_comment");g=$("#file_comment_form").detach();S=$("#file_edit_comment_form").detach()};var Ae=function e(){h.append(g);h.append(S);var i=TS.storage.fetchLastCommentInput(v.file.id);if(i)TS.utility.contenteditable.value(p,i);else TS.utility.contenteditable.clear(p);TS.utility.contenteditable.clearHistory(p)};var ke=function e(){TS.ui.comments.onEndEdit();var i;if(TS.boot_data.feature_share_mention_comment_cleanup)i=$(".file_comments_scroller");else i=$("#file_preview_scroller");var t=$("#file_comment_form").detach();var n=$("#file_edit_comment_form").detach();i.append(t);i.append(n);if(v.file.id!==TS.model.last_previewed_file_id){var a=TS.storage.fetchLastCommentInput(TS.model.last_previewed_file_id);if(a)TS.utility.contenteditable.value($("#file_comment_form #file_comment"),a);else TS.utility.contenteditable.clear($("#file_comment_form #file_comment"));TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment"))}};var Ce=function e(){TS.client.downloads.addIndividualDownload(i.find(".flex_menu_download_circle"),b.current_file_id)};var Me=function e(){TS.client.downloads.removeIndividualDownload()};var Ie=function e(){TS.ui.fs_modal.close(true)}})()},4970:function(e,i){(function(){TS.registerComponent("ui.PdfViewer",{_constructor:function e(i,t){if(!t||!i||!i.length){TS.error("TS.ui.PdfViewer missing either the file or iframe");return}if(!TS.files.fileIsPDF(t)){TS.error("Non-PDF given to TS.ui.PdfViewer");return}TS.metrics.count("pdf_viewer_open");this.file=t;this.$iframe=i;this.$image_wrapper=this.$iframe.parent();this.$pdf_loading_spinner=$("#pdf_loading_spinner");var n=TS.boot_data.abs_root_url;if(_.endsWith(n,"/"))n=n.substring(0,n.length-1);this.iframe_origin=n;this.iframe_ready=false;this.addLoadingSpinner(this.$pdf_loading_spinner);this.loadData();this.boundOnMessage=this.onMessage.bind(this);$(window).on("message",this.boundOnMessage)},addLoadingSpinner:function e(i){i.removeClass("hidden").html(TS.templates.infinite_spinner({color:"blue",size:"medium",speed:"fast"}))},removeLoadingSpinner:function e(i){i.addClass("hidden")},destroy:function e(){if(this.xhr)this.xhr.abort();$(window).off("message",this.boundOnMessage)},loadData:function e(){this.xhr=new XMLHttpRequest;this.xhr.onload=this.onLoad.bind(this);this.xhr.onerror=this.onError.bind(this);this.xhr.open("GET",this.file.url_private_download);this.xhr.responseType="arraybuffer";this.xhr.withCredentials=true;this.xhr.send()},addFallBackImage:function e(){this.$image_wrapper.addClass("broken_image")},onError:function e(){TS.metrics.count("pdf_viewer_xhr_error");TS.warn("Error requesting PDF data!");this.removeLoadingSpinner(this.$pdf_loading_spinner);this.addFallBackImage()},onLoad:function e(){if(4===this.xhr.readyState&&200==this.xhr.status){this.buffer=new Uint8Array(this.xhr.response);if(this.iframe_ready)this.sendBuffer()}this.xhr=null},onMessage:function e(i){var t=i.origin||i.originalEvent.origin;if(!t)return;var n=i.data||i.originalEvent.data;if(_.includes(["pdf_iframe_ready","corrupt_pdf","close_file_viewer"],n)){if(t!==this.iframe_origin){TS.warn(n+" from unexpected origin: "+t);return}}else return;if("pdf_iframe_ready"===n){this.iframe_ready=true;this.$iframe.focus();if(this.buffer)this.sendBuffer()}else if("corrupt_pdf"===n){TS.metrics.count("pdf_viewer_corrupt_pdf");this.addFallBackImage()}else if("close_file_viewer"===n&&TS.ui.fs_modal_file_viewer.canClose())TS.ui.fs_modal.close()},sendBuffer:function e(){if(!TS.model.is_our_app)this.$iframe[0].contentWindow.postMessage(this.buffer,this.iframe_origin);else this.$iframe[0].contentWindow.postMessage(this.buffer,this.iframe_origin,[this.buffer.buffer]);this.removeLoadingSpinner(this.$pdf_loading_spinner)}})})()},4971:function(e,i){(function(){TS.registerModule("ui.jumper",{is_showing:false,k_key_omnibox_auto_hide_count_max:5,onStart:function e(){TS.client.login_sig.add(TS.ui.jumper.onLogin)},onLogin:function e(){c()},start:function e(a){if(TS.isPartiallyBooted())return;if(TS.ui.jumper.is_showing)return;a=true===a?a:false;TS.metrics.mark("start_jumper_open");$(window.document).on("keydown.jumper",T);TS.tips.hideAll();t[0].classList.add("active");n.removeAttr("disabled");n.focus();TS.model.dialog_is_showing=true;TS.ui.jumper.is_showing=true;TS.metrics.measureAndClear("jumper_open","start_jumper_open");if(TS.boot_data.feature_cross_workspace_quick_switcher_prototype)t.find("ts-jumper-shortcut-pill").toggleClass("hidden",a);if(TS.boot_data.feature_jumper_sidebar)t.find("ts-jumper-shortcut-banner").toggleClass("hidden",a);TS.searcher.search("",{members:B(),channels:{include_archived:false},groups:{include_archived:false},enterprise_channels:TS.enterprise.isCrossWorkspacePrototypeEnabled(),mpims:true,sort:false,tiered:TS.enterprise.isCrossWorkspacePrototypeEnabled()}).then(function(e){if(!TS.ui.jumper.is_showing)return;i=P(e);f(i,"");return null})},end:function e(){u();t[0].classList.remove("active");$(window.document).off("keydown.jumper",T);TS.kb_nav.end();a.off("mousemove");if(r)r.cancel();r=null;TS.model.dialog_is_showing=false;TS.ui.jumper.is_showing=false;n.blur();TS.tips.unhideAll()},debugQuery:function e(i){TS.sorter.printTest(i,{prefer_exact_match:true,frecency:true})}});var e=24;var i=[];var t;var n;var a;var r;var s;var o;var l=200;var d=false;var c=function e(){var i={};if(TS.boot_data.feature_jumper_sidebar||TS.boot_data.feature_cross_workspace_quick_switcher_prototype)i.cmd_shortcut=TS.model.is_mac?TS.i18n.t("⌘K","keys")():TS.i18n.t("Ctrl+K","keys")();var r=TS.templates.jumper(i);$("body").append(r);t=$("ts-jumper");n=t.find("input");a=t.find("ts-jumper-results");m();if(!TS.environment.supports_custom_scrollbar)a.monkeyScroll();s=TS.utility.debounceWithPromise(function(e,i){d=true;f(e,i)},l)};var u=function e(){n.val("");_.each(i,function(e){if(e.model_ob._jumper_previous_name_match)e.model_ob._jumper_previous_name_match=void 0});f(i,"");a.scrollTop(0);setTimeout(function(){TS.ui.utility.updateClosestMonkeyScroller(a)},0)};var m=function e(){n.on("input.search",function(){var e=_.trim(n.val()).toLocaleLowerCase();if(r)r.cancel();if(e){TS.metrics.mark("start_jumper_search");TS.metrics.mark("start_jumper_remote_search");x(e)}else u()});n.on("keydown",function(e){if(e.which!=TS.utility.keymap.enter)return;var i=a.find('[data-action="new_channel"]');if(i.length)I();e.stopPropagation()});if(TS.boot_data.feature_jumper_prevent_blur)n.on("blur",function(){if(TS.ui.jumper.is_showing)n.focus()});t.on("click","[data-item-id]",function(e){v($(this));e.preventDefault()});t.on("click",'[data-action="new_channel"]',I);t.on("click.end",function(e){if($(e.target).is("ts-jumper"))TS.ui.jumper.end()})};var f=function e(i,r){if(o)o.cancel();if(!r&&_.trim(n.val()).length>0)return;var s=h(i,r);var l="";i=_.uniqBy(i,"model_ob.id");if(0==i.length){l=TS.utility.channels.getPermissibleChannelName(r);if(s)l=null}var d=_.remove(i,function(e){return e.model_ob.deleted});var c={matches:i,query:r,deleted:d,show_new_channel_link:!!l,clean_name:l,show_extended_search:s,threads_has_unreads:TS.model.threads_has_unreads,threads_mention_count:TS.model.threads_mention_count,show_scores:TS.boot_data.feature_show_jumper_scores&&TS.prefs.getPref("show_jumper_scores")};var u=TS.templates.jumper_results(c).trim();if(i.length||d.length||s)t.removeClass("empty_results");else t.addClass("empty_results");if(TS.boot_data.feature_cross_workspace_quick_switcher_prototype)t.toggleClass("p-jumper--loading",s);a.html(u).removeClass("show_deleted");if(1===d.length)a.addClass("show_deleted");S(i.concat(d));p();TS.ui.utility.updateClosestMonkeyScroller(a)};var h=function i(t,n){if(d){d=false;return true}if(TS.boot_data.should_use_flannel&&!!n&&t.length<e&&r&&!r.isResolved())o=s(t,n);return false};var g=function e(){a.addClass("show_deleted");var i=t.find("li.deleted").eq(0);if(i.length)TS.kb_nav.highlightItemWithKey(i,true)};var p=function e(){a.one("mousemove",function(){a.one("mousemove",function(){var e=a.find("ol")[0];if(e)e.classList.remove("no_pointer_events")})})};var S=function e(i){TS.kb_nav.end();TS.kb_nav.start(t.find("ol"),"li",t.find("ol"),{bindTo:n[0],allowTabHighlightWhenEmptyInput:true});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){v($(this));e.preventDefault()});if(i.length>0){var a=t.find("li:first");TS.kb_nav.highlightItemWithKey(a,true)}};var T=function e(i){if(!TS.ui.jumper.is_showing)return;if(i.which==TS.utility.keymap.tab)i.preventDefault();if(i.which==TS.utility.keymap.esc){TS.ui.jumper.end();i.preventDefault();i.stopPropagation()}else if(!i.altKey&&TS.utility.cmdKey(i)&&(75==i.which||TS.model.is_our_app&&84==i.which))if(!_.trim(n.val())){TS.ui.jumper.end();i.preventDefault()}else u()};var v=function e(i){if(!i)TS.warn("No $el for Jumper selection");var t=i.data("item-id");if(!t)TS.warn("No ID for Jumper selection");var a;var r=_.trim(n.val());if("deleted_count"===t){g();return}if("V"===t.charAt(0))a=TS.model.getViewById(t);else a=b(t);TS.ui.frecency.record(a,r);if(a.domain)k(a);else if(a)y(a).catch(function(){TS.sounds.play("beep")}).finally(function(){TS.ui.jumper.end()});else TS.error("Unknown jumper item "+t)};var b=function e(i){return TS.boot_data.page_needs_enterprise?TS.enterprise.getModelObById(i):TS.shared.getModelObById(i)};var w=function e(i){var t={item_id:i.id,item_type:i.id.charAt(0)};if(void 0!==i.is_member&&null!==i.is_member)t.is_member=i.is_member;TS.clog.track("QUICKSWITCHER_SELECT",t)};var y=function e(i){if(TS.boot_data.feature_tinyspeck)TS.info("jumper: promising to switch to "+i.id);if(i.is_channel){w(i);if(TS.enterprise.getChannelById(i.id)){A(i);return Promise.resolve()}if(TS.useReactMessages())return TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(i.id));TS.channels.displayChannel({id:i.id});return Promise.resolve()}else if(i.is_mpim&&i.is_group){w(i);if(TS.useReactMessages())return TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(i.id));TS.mpims.displayMpim({id:i.id});return Promise.resolve()}else if(i.is_group&&!i.is_mpim){w(i);if(TS.enterprise.getGroupById(i.id)){A(i);return Promise.resolve()}if(TS.useReactMessages())return TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(i.id));TS.groups.displayGroup({id:i.id});return Promise.resolve()}else if(i.is_view){w(i);if(TS.useReactMessages())return TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(i.id));TS.client.ui.showView(i.id);return Promise.resolve()}else if(i.presence){n.attr("disabled","disabled");w(i);var t;if(TS.useReactMessages())t=TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(i.id,{waitForDisplay:true}));else t=TS.ims.promiseToStartImByMemberId(i.id);var a=setTimeout(function(){C(TS.members.getPrefCompliantMemberName(i))},500);return t.then(function(){clearTimeout(a)},function(e){M();throw e})}return Promise.reject()};var A=function e(i){var t=i.id;if(TS.environment.isSSBAndAtLeastVersion("2.8")){var n=i.team_id;var a=TSSSB.call("getSignedInTeamIds");var r=_.includes(a,n);var s=r?Promise.resolve():TS.client.userAddedToTeam(n,true);var o=true;if(!r)C(i.name);s.then(function(){return TS.enterprise.displayEnterpriseChannel(t,o)})}else TS.enterprise.displayEnterpriseChannel(t)};var k=function e(i){var t=_.find(TS.boot_data.other_accounts,{team_id:i.id});if(TS.environment.isSSBAndAtLeastVersion("2.8")){if(TSSSB.call("displayTeamById",i.id)){TS.ui.jumper.end();return}}else if(t&&TSSSB.call("displayTeam",t.id)){TS.ui.jumper.end();return}C(i.name);var n=i.url||TS.utility.enterprise.buildTeamUrl(i.domain);TS.prefs.setPrefByAPI({name:TS.ui.frecency.isEnterprise()?"frecency_ent_jumper":"frecency_jumper",value:JSON.stringify(TS.model.frecency_jumper)}).finally(function(){window.location.href=n})};var C=function e(i){n.attr("disabled","disabled");if(TS.boot_data.feature_cross_workspace_quick_switcher_prototype)t.addClass("p-jumper--loading");else{a.html(TS.templates.jumper_switch_loading({name:i}));TS.ui.utility.updateClosestMonkeyScroller(a)}};var M=function e(){n.removeAttr("disabled").removeClass("p-jumper--loading").trigger("input.search")};var I=function e(){var i=_.trim(n.val());TS.ui.jumper.end();TS.ui.new_channel_modal.start(i)};var x=function i(n){if(TS.boot_data.feature_log_quickswitcher_queries)TS.clog.track("QUICKSWITCHER_QUERY",{});r=TS.searcher.search(n,{members:B(),channels:{include_archived:true},groups:{include_archived:true},mpims:true,teams:true,views:true,enterprise_channels:TS.enterprise.isCrossWorkspacePrototypeEnabled(),tiered:true,sort:{search_previous_channel_names:true},limit:e}).then(function(e){f(e,n);TS.metrics.measureAndClear("jumper_results","start_jumper_search");return e.promise});r.then(function(e){var i=TS.kb_nav.getHighlightedItem();var a=t.find("li:first");f(e,n);TS.metrics.measureAndClear("jumper_remote_results","start_jumper_remote_search");if(i){var r=i.data("item-id");var s=a.data("item-id");var o=r&&s&&r!==s;if(o){var l=TS.kb_nav.getItemByItemId(r);if(l)TS.kb_nav.highlightItemWithKey(l,true)}}})};var E=function e(i){var t=TS.shared.getActiveModelOb().id;return t&&t==i.id};var B=function e(){return{include_org:true,include_slackbot:true,include_self:true,include_deleted:true,full_profile_filter:false,org_team_ids:[]}};var P=function i(t){var n=[];var a=[];var r=[];var s=[];_.forEach(t.members,function(e){var i=TS.ims.getImByMemberId(e.id);if(i&&i.unread_cnt&&i.unread_cnt>0)n.push({model_ob:e,score:0});else if(i&&_.trim(i.last_msg_input)&&!E(i)&&!TS.ims.isImWithDeletedMember(i))r.push({model_ob:e,score:0})});_.forEach(t.mpims,function(e){if(e.unread_cnt&&e.unread_cnt>0)n.push({model_ob:e,score:0});else if(_.trim(e.last_msg_input)&&!E(e))r.push({model_ob:e,score:0})});_.forEach(t.groups,function(e){if(e.unread_highlight_cnt&&e.unread_highlight_cnt>0)n.push({model_ob:e,score:0});else if(e.unread_cnt&&e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id))a.push({model_ob:e,score:0});else if(_.trim(e.last_msg_input)&&!E(e)&&!e.is_archived)r.push({model_ob:e,score:0})});_.forEach(t.channels,function(e){if(e.unread_highlight_cnt&&e.unread_highlight_cnt>0&&e.is_member)n.push({model_ob:e,score:0});else if(e.unread_cnt&&e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id)&&e.is_member)a.push({model_ob:e,score:0});else if(_.trim(e.last_msg_input)&&!E(e)&&!e.is_archived&&e.is_member)r.push({model_ob:e,score:0})});var o=_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"});if(TS.model.threads_mention_count&&o)n.push({model_ob:o,score:0});else if(TS.model.threads_has_unreads&&o)a.push({model_ob:o,score:0});s=n.concat(a,r);if(!s.length)if(t.channels.length+t.groups.length<10){_.forEach(t.channels,function(e){s.push({model_ob:e,score:0})});_.forEach(t.groups,function(e){s.push({model_ob:e,score:0})})}return s.slice(0,e)}})()},4972:function(e,i){(function(){TS.registerModule("utility.box",{onStart:function e(){},launchPopup:function e(){if(!window.BoxSelect)return;var n;try{n=window.open;window.open=function(e,t,a){var r;var s;var o;var l;r=String(a).match(/width\D+(\d+)/);r=parseInt(r&&r[1]||590,10);s=String(a).match(/height\D+(\d+)/);s=parseInt(s&&s[1]||520,10);o=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-r)/2;l=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-s)/2;i=n(e,t,[a,"left="+o,"top="+l].join(","));return i};t().launchPopup();if(window.focus&&i)i.focus()}finally{window.open=n}},closePopup:function e(){if(window.BoxSelect)t().closePopup()},success:function e(i){if(window.BoxSelect)t().success(i)},cancel:function e(i){if(window.BoxSelect)t().cancel(i)},unregister:function e(){if(window.BoxSelect)t().unregister.apply(t(),arguments)},isBrowserSupported:function e(){if(window.BoxSelect)return t().isBrowserSupported()},test:function e(){return{getBoxSelect:t,setBoxSelect:n}}});var e;var i;var t=function i(){if(e)return e;e=new window.BoxSelect({clientId:TS.boot_data.box_app_key,linkType:"shared",multiselect:"true"});TS.utility.box.SUCCESS_EVENT_TYPE=e.SUCCESS_EVENT_TYPE;TS.utility.box.CANCEL_EVENT_TYPE=e.CANCEL_EVENT_TYPE;return e};var n=function i(t){e=t}})()},4973:function(e,i){var t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("ui.inline_edit",{onStart:function i(){var t="."+e+"_inner";var n=".ui_"+e+"_start";$(t).attr("tabindex",0);$(document).on("keydown"+n,t,function(e){if(m)return;if(!$(e.target).is(t))return;var i=13==e.keyCode||32==e.keyCode;if(!i)return;e.preventDefault();var n=h(e);TS.ui.inline_edit.start(n);f=true});$(document).on("focus",".inline_edit_inner",function(e){$(e.target).closest(".inline_edit").addClass("has_focus")});$(document).on("blur",".inline_edit_inner",function(e){$(e.target).closest(".inline_edit").removeClass("has_focus")});$(document).on("click"+n,t,function(e){var i=h(e);e.stopPropagation();TS.ui.inline_edit.start(i)})},start:function i(c,u){if(!c)return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var m=c.find("."+e+"_input");if(!m)return;if(a&&!c.is(a))TS.ui.inline_edit.end();var f=u||_.find(n,function(e){var i=c.data(e.data_attribute)||m.data(e.data_attribute);if(!i)return false;e.arguments={};e.arguments[e.argument_name_for_data_attribute]=i;return true});if("object"!==("undefined"===typeof f?"undefined":t(f)))return;s=f.method_name;o=f.value_name;l=f.arguments;if(!s||!o||"object"!==("undefined"===typeof l?"undefined":t(l)))return;var h="topic"===o?TS.utility.formatTopicOrPurpose:TS.format.formatNoSpecials;d=function e(i){return h(TS.utility.removeLinksFromTabFlow(i))};a=c;r=m;g()},end:function e(){p();v()},containsActiveElement:function e(i){if(!TS.ui.inline_edit.is_showing||!r||!r.length)return false;var t=document.activeElement;var n=$(t);if(!n.is(r))return false;if(i instanceof jQuery&&i[0])i=i[0];if(i.nodeType!==Node.ELEMENT_NODE)return false;return $.contains(i,t)},focus:function i(){a.find("."+e+"_inner").focus()}});var e="inline_edit";var i=["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"].join(".ui_"+e+" ")+".ui_"+e;var n=[{data_attribute:"file-id",method_name:"files.edit",value_name:"title",argument_name_for_data_attribute:"file"},{data_attribute:"group-id",method_name:"conversations.setTopic",value_name:"topic",argument_name_for_data_attribute:"channel"},{data_attribute:"channel-id",method_name:"conversations.setTopic",value_name:"topic",argument_name_for_data_attribute:"channel"}];var a;var r;var s;var o;var l;var d;var c;var u=true;var m=false;var f=false;var h=function i(t){var n=$(t.target);var a=n.closest("."+e);if(!a||!a.length)return;var r=n.closest("a[href]");if(r&&r.length)return;return a};var g=function t(){if(m)return;$(document).off(".ui_"+e).on("keydown.ui_"+e,A).on("mousedown.ui_"+e,k);a.off(".ui_"+e).on("blur.ui_"+e,"."+e+"_input",C).on(i,y);r.off(".ui_"+e).on("paste.ui_"+e,M);c=r.data("inline-edit-unformatted")||r.text();c=TS.format.unFormatMsg(c);r.text(c);a.addClass(e+"_editing");r.attr("contenteditable",true);r.focus();TS.ui.inline_edit.is_showing=true;m=true;I(r)};var p=function i(){if(!m)return;if(r)r.removeAttr("contenteditable");if(a)a.removeClass(e+"_editing");m=false;if(f){TS.ui.inline_edit.focus();f=false}};var S=function i(){u=false;p();a.addClass(e+"_updating").removeClass(e+"_done");var t=function i(){a.removeClass(e+"_updating")};var n=_.clone(l);var d=r[0].innerText;if(!d)d=$("<textarea/>").html(r.html().replace(/<br[^>]*>/,"\n")).text();n[o]=d;TS.api.call(s,n).then(function(){t();w.apply(null,arguments)}).catch(function(){t();b.apply(null,arguments)})};var T=function e(){if(!m)return;if(r)r.html(d(c));p();TS.ui.inline_edit.is_showing=false};var v=function i(){$(document).off(".ui_"+e);if(a)a.off(".ui_"+e);if(r)r.off(".ui_"+e);TS.ui.inline_edit.is_showing=false;m=false;u=true;c=null;l=null;o=null;s=null;r=null;a=null};var b=function i(){r.html(d(c));a.addClass(e+"_done "+e+"_error")};var w=function i(t){var n=t.data||{};if(!n.ok){b(t);return}var s=r.text();if(n.topic)s=n.topic;if(n.file&&n.file.title)s=n.file.title;r.data("inline-edit-unformatted",s);r.html(d(s));a.addClass(e+"_done "+e+"_success")};var y=function i(t){var n=t.originalEvent.animationName;if(n!==e+"_hide_done")return;a.removeClass(e+"_done "+e+"_error "+e+"_success");u=true;if(!m){p();TS.ui.inline_edit.is_showing=false}};var A=function i(t){var n="."+e+"_inner";if(!m)return;if($(t.target).is(n))return;switch(t.which){case TS.utility.keymap.esc:T(t);break;case TS.utility.keymap.enter:if(t.shiftKey||t.altKey)return;t.preventDefault();S()}};var k=function e(i){if(a[0]&&$.contains(a[0],i.target))u=false;else u=true};var C=function e(i){if(!m)return;if(u)T(i);else{r.focus();_.delay(I,0,r)}};var M=function e(i){if(!m)return;i=i.originalEvent||i;var t=window.clipboardData||i.clipboardData;var n=document.queryCommandSupported("insertText")||document.queryCommandSupported("insertHTML");if(document.queryCommandSupported("ms-pasteTextOnly")){i.preventDefault();window.document.execCommand("ms-pasteTextOnly",false)}else if(t&&n){var a=t.getData("text");if(""==a)a=t.getData("text/plain");if(""!==a){i.preventDefault();if(document.queryCommandSupported("insertText"))document.execCommand("insertText",false,a);else document.execCommand("insertHTML",false,_.escape(a))}}};var I=function e(i){if(i.length)i=i[0];var t=document.createRange();t.selectNodeContents(i);var n=window.getSelection();n.removeAllRanges();n.addRange(t)}})()},4974:function(e,i){(function(){TS.registerModule("files.gdrive",{onStart:function e(){if(!TS.client)return;TS.files.team_file_shared_sig.add(S)},openPickerWindow:function i(){var t=null;return new Promise(function(i,r){var s=TS.utility.window.open({url:e,try_window_open_in_ssb:true,height:n});if(!s)r(new Error("could not open window"));t=o(i,r);window.addEventListener("message",t);if(a)r("Promise already made");a=true}).then(function(e){a=false;return c(e.chosen_files,TS.shared.getActiveModelOb())}).catch(function(e){if("Promise already made"===e)return;var i=r;var t=TS.shared.getActiveModelOb();TS.error(e);if(("unidentified_external_url"===e.data.error||"file_type_has_no_handler"===e.data.error)&&e.args.link){i=TS.i18n.t("We don’t currently support importing that type of Google Drive file, but we included the link so that others can access it.","files")();p(t.id,e.args.link)}if("filename_too_long"===e.data.error)i=s;TS.client.ui.addEphemeralBotMsg({text:i,ephemeral_type:"file_type_has_no_handler",slackbot_feels:"sad_surprise"});a=false}).finally(function(){window.removeEventListener("message",t)})},createAndShare:function e(i,t){return f(i,t).then(function(e){TS.files.gdrive.create(i,e)}).catch(function(){TS.menu.file.onGDriveCreateComplete(false)})},create:function e(i,n){if(n&&n.channel){var a=TS.shared.getModelObById(n.channel);if(a.is_channel)TS.channels.displayChannel({id:a.id});else if(a.is_mpim)TS.mpims.displayMpim({id:a.id});else if(a.is_group)TS.groups.displayGroup({id:a.id});else if(TS.ims.getImByMemberId(n.channel))TS.ims.startImByMemberId(n.channel);else TS.error("no valid shared channel/im/mpim/group to display")}return TS.api.call("files.createExternal",{service_stub:"gdrive",mime_type:t+"."+i,filename:n.title||"",open_edit:!!n.channel}).then(function(e){TS.utility.window.alwaysOpenInBrowser(e.data.url);if(n&&n.channel)g(e.data.url,n.channel,n.comment);TS.menu.file.onGDriveCreateComplete(true,e)}).catch(function(e){TS.menu.file.onGDriveCreateComplete(false);var t=r;if("use_auth_url"===e.data.error)return m(i,n);if("filename_too_long"===e.data.error)t=s;TS.error(e);TS.client.ui.addEphemeralBotMsg({text:t,ephemeral_type:"unhandled_gdrive_create",slackbot_feels:"sad_surprise"})})}});var e=TS.boot_data.team_url+"files/import/gdrive";var i=TS.boot_data.team_url+"files/create/gdrive/auth";var t="application/vnd.google-apps";var n=675;var a=false;var r=TS.i18n.t("Darn, that didn’t work. Try again or <https://my.slack.com/help/requests/new|contact us> if it’s still not working.","files")();var s=TS.i18n.t("Sorry! The name of that file is too long for us to handle. Please try importing a file with a shorter filename.","files")();var o=function e(i,t){return d({resolve:i,reject:t,method:"gdrive_picker"})};var l=function e(i,t){return d({resolve:i,reject:t,method:"google_auth"})};var d=function e(i){return function(e){if(e.data.method!==i.method)return;if(!e.data.ok)i.reject(new Error(i.method+" not ok"));else i.resolve(e.data)}};var c=function e(i,t){var n=i.map(function(e){return u(e,t)});return Promise.all(n)};var u=function e(i,t){return TS.api.call("files.uploadExternal",{channels:t.id,link:i.url}).then(function(e){if(t.user&&TS.ims.getImByMemberId(t.user)&&TS.model.team.enterprise_id)p(t.id,e.data.file.url_private,true,true)})};var m=function e(t,a){var r=null;return new Promise(function(e,t){var a=TS.utility.window.open({url:i,try_window_open_in_ssb:true,height:n});if(!a)t(new Error("could not open window"));r=l(e,t);window.addEventListener("message",r)}).then(function(){return TS.files.gdrive.create(t,a)}).catch(function(e){TS.error(e)}).finally(function(){window.removeEventListener("message",r)})};var f=function e(i,n){return new Promise(function(e,a){var r={type:t+i,display_type:n};var s=TS.templates.builders.buildFileSharingControls(r,false,false,true,null);var o=void 0;if("Document"===n)o=TS.i18n.t("Create a Google Document","files")();else if("Presentation"===n)o=TS.i18n.t("Create a Google Presentation","files")();else if("Spreadsheet"===n)o=TS.i18n.t("Create a Google Spreadsheet","files")();else o=TS.i18n.t("Create a Google file","files")();TS.generic_dialog.start({title:o,body:TS.templates.gdrive_create_dialog({sharing_html:new Handlebars.SafeString(s)}),show_cancel_button:true,esc_for_ok:false,fullscreen:false,go_button_text:TS.i18n.t("Create","files")(),type:"overflow_visible",onGo:function i(){e(h())},onCancel:a});$("#share_cb").removeAttr("checked");TS.ui.file_share.bindFileShareDropdowns();TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField();TS.ui.comments.bindInput($("#file_comment_textarea"),function(){e(h)})})};var h=function e(){var i=_.trim(TS.utility.contenteditable.value($("#file_comment_textarea")));i=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(i,{complete_member_specials:false});return{title:_.trim($("#document_title").val())||TS.i18n.t("Untitled","files")(),comment:i,channel:$("#share_cb").is(":checked")?$("#share_model_ob_id").val():false}};var g=function e(i,t,n){var a=false;if(TS.ims.getImByMemberId(t))a=true;return TS.api.call("files.uploadExternal",{link:i,channels:a?"":t}).then(function(e){if(a)p(t,e.data.file.url_private,true,true);if(n)TS.api.call("files.comments.add",{file:e.data.file.id,comment:n,channel:t})}).catch(function(e){TS.error(e);TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("Oh no! I couldn’t import your newly created file","files")(),ephemeral_type:"gdrive_share_file_error",slackbot_feels:"sad_surprise"})})};var p=function e(i,t,n,a){TS.api.call("chat.postMessage",{channel:i,text:t,unfurl_links:n||false,unfurl_media:a||false}).catch(function(e){TS.error(e)})};var S=function e(i){if("gdrive"!==_.get(i,"external_type"))return;if(_.get(i,"user")!==TS.model.user.id)return;if(!TS.prefs.getTeamPref("gdrive_enabled_team"))return;if(TS.prefs.getPref("seen_gdrive_coachmark"))return;TS.coachmark.start(TS.coachmarks.coachmarks.gdrive);TS.prefs.setPrefLocal("seen_gdrive_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_gdrive_coachmark",value:true})}})()},4975:function(e,i){(function(){TS.registerModule("files.onedrive",{onStart:function e(){if(!TS.client)return;TS.files.team_file_shared_sig.add(l)},openPickerWindow:function r(){var o=null;return new Promise(function(t,n){$("<iframe>",{src:e,id:"onedrive_picker_iframe"}).appendTo("body").hide();o=a(t,n);window.addEventListener("message",o);if(i)n("Promise already made");i=true}).then(function(e){i=false;return s(e.chosen_files,TS.shared.getActiveModelOb())}).catch(function(e){if("Promise already made"===e)return;var a=t;TS.error(e);if(("unidentified_external_url"===e.data.error||"file_type_has_no_handler"===e.data.error)&&e.args.link)a=TS.i18n.t("We don’t currently support importing that type of OneDrive file, but we included the link so that others can access it.","files")();if("filename_too_long"===e.data.error)a=n;TS.client.ui.addEphemeralBotMsg({text:a,ephemeral_type:"file_type_has_no_handler",slackbot_feels:"sad_surprise"});i=false}).finally(function(){$("#onedrive_picker_iframe").remove();window.removeEventListener("message",o)})}});var e=TS.boot_data.team_url+"files/import/onedrive";var i=false;var t=TS.i18n.t("Darn, that didn’t work. Try again or <https://my.slack.com/help/requests/new|contact us> if it’s still not working.","files")();var n=TS.i18n.t("Sorry! The name of that file is too long for us to handle. Please try importing a file with a shorter filename.","files")();var a=function e(i,t){return r({resolve:i,reject:t,method:"onedrive_picker"})};var r=function e(i){return function(e){if(e.data.method!==i.method)return;if(!e.data.ok)i.reject(new Error(i.method+" not ok"));else i.resolve(e.data)}};var s=function e(i,t){var n=i.map(function(e){return o(e,t)});return Promise.all(n)};var o=function e(i,t){return TS.api.call("files.uploadExternal",{channels:t.id,link:i}).then(function(e){TS.log(9999,"TODO");TS.log(9999,e)})};var l=function e(i){if("onedrive"!==_.get(i,"external_type"))return;if(_.get(i,"user")!==TS.model.user.id)return;if(!TS.prefs.getTeamPref("onedrive_enabled_team"))return;if(TS.prefs.getPref("seen_onedrive_coachmark"))return;TS.coachmark.start(TS.coachmarks.coachmarks.onedrive);TS.prefs.setPrefLocal("seen_onedrive_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_onedrive_coachmark",value:true})}})()},4976:function(e,i){(function(){TS.registerModule("client.unread",{switched_sig:new signals.Signal,switched_away_sig:new signals.Signal,fetched_unreads_sig:new signals.Signal,marked_group_as_read_sig:new signals.Signal,marked_group_as_unread_sig:new signals.Signal,marked_all_as_read:new signals.Signal,marked_all_as_unread:new signals.Signal,new_messages_in_channels:[],messages_loaded:false,last_request_id:"",onStart:function e(){TS.prefs.enable_unread_view_changed_sig.add(k);TS.prefs.enable_unread_view_changed_sig.add(C);TS.channels.message_received_sig.add(T);TS.groups.message_received_sig.add(T);TS.ims.message_received_sig.add(T);TS.mpims.message_received_sig.add(T);TS.channels.message_changed_sig.add(v);TS.groups.message_changed_sig.add(v);TS.ims.message_changed_sig.add(v);TS.mpims.message_changed_sig.add(v);TS.channels.message_removed_sig.add(b);TS.groups.message_removed_sig.add(b);TS.ims.message_removed_sig.add(b);TS.mpims.message_removed_sig.add(b);TS.files.team_file_changed_sig.add(y);TS.channels.deleted_sig.add(A);TS.groups.deleted_sig.add(A);TS.client.login_sig.add(I);TS.client.login_sig.add(D);TS.prefs.all_unreads_sort_order_changed_sig.add(D)},isEnabled:function e(){return!!TS.prefs.getPref("enable_unread_view")},shouldRecordMetrics:function i(){return!!e},debug:function e(i,t){h.push({msg:i,data:t});if(!TS.boot_data.feature_tinyspeck)return;TS.info("[ALL_UNREADS] "+i,t)},showUnreadView:function i(t,n,a){if(!TS.client.unread.isEnabled())return false;t=!!t;n=!!n;var r=n?false:t;var o=TS.client.unreadViewActivated(n,r);if(o)TS.client.unread.switched_sig.dispatch();else return false;if(TS.msg_edit.editing_in_msg_pane)TS.msg_edit.resetEditUI();u=a;e=TS.utility.enableFeatureForUser(1);if(e)TS.metrics.mark("unread_view_time_to_display");M();s=TS.interop.datetime.makeTsStamp(null,{padder:"0",uniqueNum:9});TS.client.ui.unread.showUnreadView();if(e)TS.metrics.count("unread_view_displayed");if(e)TS.metrics.mark("unread_view_time_spent");if(m){m=false;if(TS.interop&&TS.interop.ChannelSidebar)TS.interop.ChannelSidebar.ensureRowInView("Vall_unreads");TS.metrics.count("unread_view_coachmark_conversion")}return true},destroyUnreadView:function i(){if(!TS.client.ui.unread.isUnreadViewDOMShowing())return;if(e)TS.metrics.measureAndClear("unread_view_time_spent","unread_view_time_spent");TS.client.ui.unread.destroyUnreadView();M();TS.client.unread.switched_away_sig.dispatch()},reloadIfPendingMessages:function e(){if(TS.client.unread.getTotalNewUnreadCount()>0&&TS.client.unread.new_messages_in_channels.length)TS.client.unread.reload()},reload:function e(){u=void 0;TS.client.ui.unread.removeEmptyState();M();TS.client.ui.unread.restart()},getGroup:function e(t){return _.find(i,{model_ob:{id:t}})},getAllGroups:function e(){return i},collapseGroup:function e(n,a){if(a)TS.api.call("unread.collapse",{channel:n.id});n.collapsed=true;n.hidden_msgs=n.msgs;n.msgs=[];if(o&&o.id===n.id){i=i.concat(t);TS.client.ui.unread.addMessageContainerGroups(t);B()}return n},expandGroup:function e(n,r){n.collapsed=false;if(r)TS.api.call("unread.expand",{channel:n.id});if(n.msgs.length>0){n.new_unread_msgs=n.msgs;n.new_unread_cnt=n.new_unread_msgs.length;n.msgs=[]}n.msgs=n.msgs.concat(n.hidden_msgs);S(n,"msgs");n.hidden_msgs=[];if(n.has_more){var s=_.findIndex(i,{id:n.id});t=i.splice(s+1);TS.client.ui.unread.removeMessageContainerGroup(_.map(t,"id"));o=n;l=a;a=false}return n},markGroupAsRead:function i(t,n){var a=null;t.previous_read_ts=t.model_ob.last_read;t.marked_as_read_cnt=t.total_unreads;t.marked_as_read=true;t.total_unreads=0;t.manually_marked_unread_msg=null;if(!n){TS.shared.markReadMsg(t.model_ob.id,TS.client.unread.getMarkerTS(t),a);if(e)TS.metrics.store("unread_view_mark_model_read",t.marked_as_read_cnt,{is_count:true})}TS.client.unread.marked_group_as_read_sig.dispatch(t);return t},markGroupAsUnread:function e(i){TS.shared.markReadMsg(i.model_ob.id,i.previous_read_ts,null);i.marked_as_read=false;i.manually_marked_unread_msg=null;n=i.id;i.total_unreads=i.marked_as_read_cnt;i.marked_as_read_cnt=0;TS.client.unread.marked_group_as_unread_sig.dispatch(i);return i},markAllAsRead:function t(){var n=true;var r={};var s=0;i.forEach(function(e){r[e.id]=TS.client.unread.getMarkerTS(e);TS.client.unread.markGroupAsRead(e,n);s+=e.msgs.length});if(e)TS.metrics.count("unread_view_mark_all_read");if(e)TS.metrics.store("unread_view_mark_all_read_count",s,{is_count:true});if(a){TS.api.call("unread.markRead",{markers:JSON.stringify(r)});TS.client.ui.unread.displayEmptyState(s);TS.client.unread.marked_all_as_read.dispatch()}else TS.api.call("unread.markRead",{markers:JSON.stringify(r)}).then(function(){if(!TS.model.unread_view_is_showing)return;TS.client.unread.reload();TS.client.unread.marked_all_as_read.dispatch()});var o={unread_count:s,request_id:TS.client.unread.last_request_id};TS.clog.track("UNREADS_MARK_ALL_AS_READ",o)},markAllAsUnread:function e(){i.forEach(function(e){TS.client.unread.markGroupAsUnread(e)});TS.client.ui.unread.removeEmptyState();TS.client.unread.marked_all_as_unread.dispatch(i);var t={request_id:TS.client.unread.last_request_id};TS.clog.track("UNREADS_MARK_ALL_AS_UNREAD",t)},getMarkerTS:function e(i){var t=TS.client.unread.getNewestMsgTs(i);if(!t||t<s)t=s;return t},updateGroupWithNewMessages:function e(i){if(i.new_unread_msgs){i.msgs=i.new_unread_msgs.concat(i.msgs);S(i,"msgs");i.total_unreads+=i.new_unread_cnt;i.new_unread_cnt=0;i.new_unread_msgs=[];i.marked_as_read=false;i.collapsed=false;TS.client.unread.new_messages_in_channels=_.without(TS.client.unread.new_messages_in_channels,i.id);TS.client.ui.unread.showOrHideRefreshButton()}return i},moveNewUnreadsOntoHiddenMsgs:function e(i){if(i.collapsed&&i.marked_as_read&&i.new_unread_msgs.length){i.hidden_msgs=i.new_unread_msgs;S(i,"msgs");i.new_unread_cnt=0;i.new_unread_msgs=[];i.msgs=[];i.total_unreads=i.hidden_msgs.length;i.marked_as_read=false;TS.client.unread.new_messages_in_channels=_.without(TS.client.unread.new_messages_in_channels,i.id);TS.client.ui.unread.showOrHideRefreshButton()}return i},getNewestMsgTs:function e(i){return i.msgs&&i.msgs.length?i.msgs[0].ts:null},promiseToGetMoreMessages:function i(){TS.client.unread.debug("promiseToGetMoreMessages");if(!u&&!n&&!TS.client.unread.getAllCurrentlyUnreadGroups().length){TS.client.unread.debug("DONE FETCHING: First fetch, not from boot, nothing in global model is unread, marking all msgs as fetched");a=true}if(a){TS.client.unread.debug("NO FETCHING: All messages are fetched");return Promise.resolve({groups:[],has_more:false})}clearTimeout(c);c=setTimeout(function(){TS.client.ui.unread.displaySlowLoadingMessage()},5e3);r=new Promise(function(i,r){TS.experiment.loadUserAssignments().then(function(){var l=[];var d;if(n)if(e)TS.metrics.count("unread_view_scroll");if(o){var u=o.id;d={channel:o.id,oldest:TS.client.unread.getNewestMsgTs(o)||o.model_ob.last_read,latest:s,always_asc:true,ignore_replies:true,include_pin_count:true};TS.client.unread.debug("Backfilling using api_args: ",_.clone(d));var m=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(m)d._x_reason=m;TS.api.call("conversations.history",d).then(function(e){clearTimeout(c);if(!TS.model.unread_view_is_showing)return;TS.client.unread.last_request_id=e.request_id;if(o||o.id!=u){var n={channels:[{channel_id:o.id,messages:e.data.messages,has_more:e.data.has_more}],channels_count:1,total_messages_count:null};if(!e.data.has_more)n.groups=t;var s=p(n,l);if(!e.data.has_more){B();s.has_more=!a}i(s)}else r(new Error("channels.history rejected because we are no longer backfilling or we are backfilling a different group"));return null}).catch(function(e){TS.console.logError(e,"all_unreads_fatal_error");clearTimeout(c);TS.client.ui.unread.displayFatalError()})}else{d={timestamp:s,sort:TS.client.unread.getSortOrder()};if(n){d.current_channel=n;var f=TS.client.unread.getGroup(n);if(f)if(f.collapsed){d.current_channel_timestamp=s;l.push(n)}else if(TS.client.unread.getNewestMsgTs(f))d.current_channel_timestamp=TS.client.unread.getNewestMsgTs(f)}if(e||TS.boot_data.feature_tinyspeck)TS.metrics.mark("unread_history_sort_marker");TS.client.unread.debug("Regular fetch using api_args: ",_.clone(d));TS.api.call("unread.history",d).then(function(t){if(e||TS.boot_data.feature_tinyspeck)TS.metrics.measureAndClear("unread_history_sort_"+d.sort,"unread_history_sort_marker");clearTimeout(c);if(!TS.model.unread_view_is_showing)return;TS.client.unread.last_request_id=t.request_id;if(o)r(new Error("unread.history rejected because we are now backfilling"));else i(p(t.data,l,!n));return null}).catch(function(e){TS.error(e);clearTimeout(c);TS.client.ui.unread.displayFatalError()})}return null})});return r},getMessage:function e(i,t){if(!TS.model.unread_view_is_showing)return null;var n;var a;n=TS.client.unread.getGroup(i.id);if(n)a=TS.utility.msgs.getMsg(t,n.msgs);if(!a&&TS.boot_data.feature_sli_briefing&&TS.highlights_briefing)a=TS.highlights_briefing.getMessageFromCache(i.id,t);if(a)return a;return null},getTotalMessagesCount:function e(){return i.reduce(function(e,i){return!i.marked_as_read?e+i.msgs.length:e},0)},getCurrentModelID:function e(){return n},areAllMessagesFetched:function e(){return a},getAllCurrentlyUnreadGroups:function e(){return TS.channels.getUnarchivedChannelsForUser().concat(TS.groups.getUnarchivedGroups(),TS.model.mpims,TS.model.ims).filter(function(e){return e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id)})},getTotalNewUnreadCount:function e(){var t=i.reduce(function(e,i){return i.new_unread_msgs?e+i.new_unread_msgs.length:e},0);if(d)t=Object.keys(d).reduce(function(e,i){return e+d[i].length},t);return t},moveActiveMarker:function e(t){var n=0;var a=_.findIndex(i,{active:true});if(-1!=a)n=t?a-1:a+1;if(n>=0&&i[n]){if(i[a])i[a].active=false;i[n].active=true;return i[n]}},setActiveGroup:function e(i){var t=TS.client.unread.getActiveGroup();if(t)t.active=false;i.active=true;return i},getActiveGroup:function e(){return _.find(i,{active:true})},getSortOrder:function e(){return f},getHighlightsForMessages:function e(i){_.map(i.channels,function(e){var i=TS.shared.getModelObById(e.channel_id);if(e.messages.length&&e.total_unreads>=10)TS.client.highlights.getHighlightsForMessages({channel:i,timestamps:_.map(e.messages,"ts"),channel_open_ts:s})})},test:function e(){var c={_current_model_ob_id:null,_processResp:p,_resetData:M,_messageReceived:T,_appendNewUnreadToGroup:w,_messageChanged:v,_messageRemoved:b,_toggleUnreadView:k,_groups:[],_all_messages_fetched:false,_more_messages_p:void 0,_init_timestamp:void 0};Object.defineProperty(c,"_processResp",{get:function e(){return p},set:function e(i){p=i}});Object.defineProperty(c,"_resetData",{get:function e(){return M},set:function e(i){M=i}});Object.defineProperty(c,"_current_model_ob_id",{get:function e(){return n},set:function e(i){n=i}});Object.defineProperty(c,"_groups",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(c,"_all_messages_fetched",{get:function e(){return a},set:function e(i){a=i}});Object.defineProperty(c,"_more_messages_p",{get:function e(){return r},set:function e(i){r=i}});Object.defineProperty(c,"_messageReceived",{get:function e(){return T},set:function e(i){T=i}});Object.defineProperty(c,"_messageChanged",{get:function e(){return v},set:function e(i){v=i}});Object.defineProperty(c,"_messageRemoved",{get:function e(){return b},set:function e(i){b=i}});Object.defineProperty(c,"_appendNewUnreadToGroup",{get:function e(){return w},set:function e(i){w=i}});Object.defineProperty(c,"_toggleUnreadView",{get:function e(){return k},set:function e(i){k=i}});Object.defineProperty(c,"_init_timestamp",{get:function e(){return s},set:function e(i){s=i}});Object.defineProperty(c,"_backfilling_for_group",{get:function e(){return o},set:function e(i){o=i}});Object.defineProperty(c,"_excluded_groups",{get:function e(){return t},set:function e(i){t=i}});Object.defineProperty(c,"_orphan_new_msgs",{get:function e(){return d},set:function e(i){d=i}});Object.defineProperty(c,"_direct_from_boot",{get:function e(){return u},set:function e(i){u=i}});Object.defineProperty(c,"_sortAndDedupe",{get:function e(){return S},set:function e(i){S=i}});Object.defineProperty(c,"_backfilling_was_all_fetched",{get:function e(){return l},set:function e(i){l=i}});return c}});var e;var i=[];var t=[];var n=null;var a=false;var r;var s;var o=null;var l;var d={};var c;var u;var m=false;var f;var h=[];var g=[];var p=function t(r,s,o){s=s||[];var l={groups:[],has_more:true};TS.info("Received unread view response: "+r.channels_count+" channels; "+r.total_messages_count+" total messages ("+(o?"first fetch":"subsequent fetch")+")");TS.client.unread.debug("Process response starting info:",{first_fetch:o,skip_channels:s,channels_count:r.channels_count,total_messages_count:r.total_messages_count,channels:r.channels.map(function(e){return{channel_id:e.channel_id,msg_count:e.messages?e.messages.length:null,collapsed:e.collapsed,total_unreads:e.total_unreads,has_more:e.has_more}})});if(o){if(e)TS.metrics.count("unread_view_fetched_channels_first",r.channels_count);if(e)TS.metrics.count("unread_view_fetched_messages_first",r.total_messages_count)}if(r.channels.length&&s.length)_.remove(r.channels,function(e){return-1!==s.indexOf(e.channel_id)});if(0===r.channels.length||1===r.channels.length&&!r.channels[0].has_more&&(!r.channels[0].messages||0===r.channels[0].messages.length)){a=true;l.has_more=false;TS.client.unread.debug("DONE FETCHING: API response had no messages",r.channels.length);TS.client.unread.messages_loaded=true;return l}if(1===r.channels.length&&0===r.channels[0].messages.length&&r.channels[0].collapsed&&TS.client.unread.getGroup(r.channels[0].channel_id)&&TS.client.unread.getGroup(r.channels[0].channel_id).collapsed&&0===TS.client.unread.getGroup(r.channels[0].channel_id).msgs.length){a=true;l.has_more=false;TS.client.unread.debug("DONE FETCHING: Received only one collapsed group with zero messages");TS.client.unread.messages_loaded=true;return l}var c=_.last(r.channels);var m=c.has_more;r.channels.forEach(function(e){n=e.channel_id;var t=TS.shared.getModelObById(n);var a=TS.client.unread.getGroup(n);var r=[];if(!t)return;g.push(e.channel_id);if(a){r=e.messages.map(function(e){return TS.utility.msgs.processImsg(e,t.id)});r=a.msgs.concat(r);if(a.collapsed){a.hidden_msgs=a.hidden_msgs.concat(r);a.marked_as_read_cnt=a.hidden_msgs.length}else a.msgs=r;a.has_more=e.has_more;if(!a.has_more)a.total_unreads=r.filter(function(e){return!e.no_display}).length}else{if(!e.has_more&&!e.collapsed&&!e.messages.length){TS.warn("Received model_ob with no messages for unread view: "+n);TS.client.unread.debug("all_unreads_ignored_channel no msgs",{current_model_ob_id:n,unread_obj_id:e.channel_id,has_more:e.has_more,collapsed:!!e.collapsed,msg_count:e.messages.length});return}if(!(o&&u)&&0===t.unread_cnt){TS.client.unread.debug("all_unreads_ignored_channel model_ob has no unreads",{current_model_ob_id:n,unread_obj_id:e.channel_id,model_ob_id:t.id,model_ob_unread_cnt:t.unread_cnt,first_fetch:o,direct_from_boot:u});return}r=e.messages.map(function(e){return TS.utility.msgs.processImsg(e,t.id)});a={id:n,order:i.length,msgs:r,hidden_msgs:[],model_ob:t,marked_as_read:false,new_unread_cnt:0,collapsed:e.collapsed,total_unreads:e.total_unreads,has_more:e.has_more};if(!a.has_more)a.total_unreads=r.filter(function(e){return!e.no_display}).length;i.push(a)}if(!a.has_more&&d[a.id]){d[a.id].forEach(function(e){w(a,e)});delete d[a.id]}S(a,"msgs");l.groups.push(a)});if(r.groups)r.groups.forEach(function(e){i.push(e);l.groups.push(e);m=e.has_more});if(!m){a=true;l.has_more=false}if(o&&i.length&&!TS.client.unread.getActiveGroup())i[0].active=true;TS.client.unread.debug("Process response, processed data",{has_more:l.has_more,touched_groups:l.groups.map(function(e){return{channel_id:e.id,has_more:e.has_more,msg_count:e.msgs.length,marked_as_read:e.marked_as_read,collapsed:e.collapsed}}),all_groups:i.map(function(e){return{channel_id:e.id,has_more:e.has_more,msg_count:e.msgs.length,marked_as_read:e.marked_as_read,collapsed:e.collapsed}})});if(!m)TS.client.unread.debug("DONE FETCHING: Last group has no more messages");TS.client.unread.getHighlightsForMessages(r);TS.client.unread.messages_loaded=true;return l};var S=function e(i,t){t=t||"msgs";TS.utility.msgs.sortMsgs(i[t]);i[t]=_.uniqBy(i[t],"ts");return i};var T=function e(i,t){if(!TS.model.unread_view_is_showing)return;if(TS.utility.msgs.isMsgHidden(t))return;if(t.is_ephemeral)return;if(t.user===TS.model.user.id)return;if(_.startsWith(t.subtype,"sh_room"))return;if(TS.utility.msgs.isMsgHidden(t))return;if(TS.utility.msgs.msgMightBeRolledUp(t))return;var n=i.is_channel&&i.is_archived||TS.notifs.isCorGMuted(i.id);if(!n&&TS.client.ui.unread.isFatalErrorDisplaying()){TS.client.unread.reload();return}var a=TS.client.unread.getGroup(i.id);if(a&&!n)TS.client.ui.unread.updateNewMessagesMessage(w(a,t));else if(!i.is_channel||!n){if(!d[i.id])d[i.id]=[];d[i.id].push(t)}if(!n)if(-1===_.indexOf(TS.client.unread.new_messages_in_channels,i.id))TS.client.unread.new_messages_in_channels.push(i.id);TS.client.ui.unread.showOrHideRefreshButton()};var v=function e(i,t){if(!TS.model.unread_view_is_showing)return;if(d[i.id]){var n=_.findIndex(d[i.id],{ts:t.ts});d[i.id].splice(n,1,TS.utility.msgs.processImsg(t,i.id))}var a=TS.client.unread.getGroup(i.id);if(!a)return;var r=_.findIndex(a.msgs,{ts:t.ts});var s=_.findIndex(a.new_unread_msgs,{ts:t.ts});if(s>=0)a.msgs.splice(s,1,TS.utility.msgs.processImsg(t,i.id));if(r>=0){a.msgs.splice(r,1,TS.utility.msgs.processImsg(t,i.id));TS.client.ui.unread.updateMsgs()}};var b=function e(i,t){if(!TS.model.unread_view_is_showing)return;if(d[i.id]){_.remove(d[i.id],{ts:t.ts});if(!d[i.id].length)delete d[i.id]}var n=TS.client.unread.getGroup(i.id);if(!n){if(!d[i.id])_.pull(TS.client.unread.new_messages_in_channels,i.id);TS.client.ui.unread.showOrHideRefreshButton();return}var a=_.findIndex(n.msgs,{ts:t.ts});var r=_.findIndex(n.new_unread_msgs,{ts:t.ts});if(r>=0){n.new_unread_msgs.splice(r,1);n.new_unread_cnt=n.new_unread_msgs.length;TS.client.ui.unread.updateNewMessagesMessage(n)}if(a>=0){n.msgs.splice(a,1);n.total_unreads-=1;if(0===n.msgs.length)A(n.model_ob);else TS.client.ui.unread.updateMsgs()}};var w=function e(i,t){var n=_.find(i.msgs,{ts:t.ts});if(n)return i;if(!i.first_new_unread_ts)i.first_new_unread_ts=t.ts;t=TS.utility.msgs.processImsg(t,i.id);if(!i.new_unread_msgs)i.new_unread_msgs=[];i.new_unread_msgs.push(t);S(i,"new_unread_msgs");i.new_unread_cnt=i.new_unread_msgs.length;return i};var y=function e(t){if(!TS.model.unread_view_is_showing)return;var n=_.intersection(_.map(i,"id"),t.channels.concat(t.ims,t.groups));var a=_.filter(i,function(e){return-1===n.indexOf(e.id)});a.forEach(function(e){e.msgs.forEach(function(i){if("file_mention"===i.subtype&&i.file.id===t.id)n.push(e.id)})});n=_.uniq(n);if(!n.length)return;n.forEach(function(e){var i=TS.client.unread.getGroup(e);i.msgs.forEach(function(e){if(!t.is_deleted&&("file_share"===e.subtype||"file_mention"===e.subtype||"file_comment"===e.subtype)&&e.file&&e.file.id==t.id);else if(e.attachments&&e.attachments.length&&TS.inline_attachments.getAttachmentBySlackFileId(e.attachments,t.id));else return;if("hosted"===t.mode||"external"===t.mode)if(t.comments.length||!t.is_tombstoned)v(i.model_ob,e);else return;TS.client.ui.unread.rebuildMsgFile(e,t)})})};var A=function e(t){var a=TS.client.unread.getGroup(t.id);if(a){TS.client.ui.unread.removeMessageContainerGroup([t.id]);_.remove(i,{id:t.id});if(n===t.id){var r=_.last(i);if(r)n=r.id}TS.client.ui.unread.updateMsgs()}};var k=function e(){if(!TS.prefs.getPref("enable_unread_view")&&TS.model.unread_view_is_showing){TS.client.displayModelOb(TS.shared.getActiveModelOb());TS.client.unread.destroyUnreadView()}};var C=function e(){TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{enable_unread_view:TS.prefs.getPref("enable_unread_view").toString()}})};var M=function e(){o=null;l=void 0;t=[];a=false;n=null;i=[];r=void 0;s=TS.interop.datetime.makeTsStamp(null,{padder:"0",uniqueNum:9});TS.client.unread.new_messages_in_channels=[];d={};if(c){clearTimeout(c);c=null}h=[];g=[]};var I=function e(){TS.channels.unread_changed_sig.add(E);TS.groups.unread_changed_sig.add(E);TS.ims.unread_changed_sig.add(E);TS.mpims.unread_changed_sig.add(E)};var x=function e(){TS.channels.unread_changed_sig.remove(E);TS.groups.unread_changed_sig.remove(E);TS.ims.unread_changed_sig.remove(E);TS.mpims.unread_changed_sig.remove(E)};var E=function e(){P();var i=TS.model.all_unread_cnt>0&&TS.client.unread.getAllCurrentlyUnreadGroups().length>0;TS.redux.all_unreads.updateHasUnreads(i)};var B=function e(){if(o){t=[];o=null;a=l;l=void 0;TS.client.ui.unread.setMessageContainerHasMoreEnd(!a)}};var P=function e(){if(TS.client.unread.isEnabled()||TS.prefs.getPref("seen_unread_view_coachmark"))return;if(TS.client.unread.isEnabled()||TS.prefs.getPref("seen_unread_view_coachmark")){x();return}if(TS.model.all_unread_cnt>=100){var i=TS.client.unread.getAllCurrentlyUnreadGroups();if(i.length>=4){x();$()}}};var $=function e(){if(TS.client.unread.isEnabled())return;if(TS.prefs.getPref("seen_unread_view_coachmark"))return;TS.prefs.setPrefLocal("seen_unread_view_coachmark",true);TS.prefs.setMultiPrefsByAPI({enable_unread_view:true,seen_unread_view_coachmark:true},function(){TS.metrics.count("unread_view_coachmark_displayed");m=true;TS.coachmark.start(TS.coachmarks.coachmarks.unread_view)});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{enable_unread_view:"true"}})};var D=function e(){if(TS.prefs.getPref("all_unreads_sort_order"))f=TS.prefs.getPref("all_unreads_sort_order");else if(""!==TS.model.team.plan)f="priority";else f="alphabetical"}})()},4977:function(e,i){(function(){TS.registerModule("client.ui.unread",{$scroller:$("#unread_msgs_scroller_div"),$loading_msg_container:null,$unread_msgs_div:null,$container:null,unread_groups:[],msgs_rendered_sig:new signals.Signal,started_sig:new signals.Signal,ended_sig:new signals.Signal,showUnreadView:function t(){TS.channels.renamed_sig.add(S);TS.groups.renamed_sig.add(S);TS.inline_file_previews.collapse_sig.add(A);TS.inline_file_previews.expand_sig.add(A);TS.inline_others.collapse_sig.add(A);TS.inline_others.expand_sig.add(A);TS.inline_audios.collapse_sig.add(A);TS.inline_audios.expand_sig.add(A);TS.inline_videos.collapse_sig.add(A);TS.inline_videos.expand_sig.add(A);TS.inline_room_previews.toggle_sig.add(A);TS.inline_imgs.expand_sig.add(A);TS.inline_imgs.collapse_sig.add(A);TS.inline_attachments.expand_sig.add(A);TS.inline_attachments.collapse_sig.add(A);if(TS.boot_data.feature_sli_briefing)TS.highlights_briefing.updated_sig.add(A);TS.client.highlights.updated_sig.add(TS.client.ui.unread.rebuildMsgsWithHighlights);TS.client.highlights.feedback_submitted_sig.add(TS.client.ui.unread.maybeRebuildMsgsWithHighlightsFeedback);TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vall_unreads"));TS.view.members.unknown_resolution_rebuild_sig.add(E);c=Date.now();f=false;$("#client-ui").addClass("unread_view_is_showing");if("details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(true);var a=true;TS.client.msg_pane.hideNewMsgsBar(a);TS.client.ui.unread.$scroller.html(TS.templates.unread_main());TS.client.ui.unread.$unread_msgs_div=$("#unread_msgs_div");h=true;TS.client.ui.unread.displayLoadingMessage();if(TS.environment.supports_custom_scrollbar)TS.client.ui.unread.$container=$("#unread_msgs_scroller_div");else{TS.client.ui.unread.$scroller.monkeyScroll();TS.client.ui.unread.$container=$("#monkey_scroll_wrapper_for_unread_msgs_scroller_div")}$("#footer").addClass("hidden");p();TS.view.resize_sig.add(p);TS.client.ui.unread.$unread_msgs_div.on("click.unread",".bottom_mark_all_read_btn",function(){TS.client.unread.markAllAsRead()});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_mark",function(e){var i=$(e.target).closest(".unread_group").data("model-id");var t=TS.client.unread.getGroup(i);if(!t||t.marked_as_read)return;TS.client.ui.unread.markGroupAsRead(i)});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_undo > a",function(e){TS.client.ui.unread.markGroupAsUnread($(e.target).closest(".unread_group").data("model-id"))});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_header_name .channel_link, .unread_group_header_name .mpim_link, .unread_group_header_name .internal_im_link",function(){if(TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_channel_navigation")});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_new",function(e){var i=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(i.collapsed){if(i.marked_as_read)TS.client.unread.moveNewUnreadsOntoHiddenMsgs(i);TS.client.ui.unread.expandGroup(i)}else TS.client.ui.unread.updateGroupWithNewMessages(i)});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_collapse_toggle",function(e){var i=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(i){var t={channel_id:i.id,channel_type:i.id[0]||"",request_id:TS.client.unread.last_request_id};if(i.collapsed){TS.client.ui.unread.expandGroup(i,{persist_state:true});TS.clog.track("UNREADS_EXPAND_GROUP",t)}else{var n=w(i);var a=n.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(i,a,{persist_state:true});TS.clog.track("UNREADS_COLLAPSE_GROUP",t)}}});o=false;$(window).on("keydown.unread",T);if(!TS.environment.supports_sticky_position){if($("body").hasClass("banner_showing"))k();TS.ui.banner.show_hide_sig.add(k);var r=new signals.Signal;n=_.throttle(y,16,{leading:true,trailing:false});TS.client.ui.unread.$scroller.on("scroll",n);r.add(A)}e={name:"unread",container:$("#unread_msgs_div"),scroller:$("#unread_msgs_scroller_div"),page_size:25,sections:[],has_more_beginning:false,has_more_end:false,updated_sig:r,promiseToLoadMoreAtEnd:function e(){return TS.client.ui.unread.promiseToShowNextPage()},buildMsgHTML:function e(t,n,a){var r=$(TS.templates.builders.msgs.buildHTML({msg_dom_id:TS.templates.makeMsgDomIdInUnreadView(t.ts),msg:t,model_ob:a.model_ob,prev_msg:n,container_id:"unread_msgs_div",enable_slack_action_links:true,hide_actions:false,from_all_unreads:true}));if(i)r.css("opacity",0);return r},buildSection:function e(i){return TS.templates.unread_group(C(i))},buildDayDivider:function e(t,n){var a=n.ts;var r=TS.interop.datetime.toDateObject(a);var s=TS.interop.datetime.isToday(r);var o=$(TS.templates.unread_day_divider({ts:a,is_today:s}));if(i)o.css("opacity",0);return o},updateCallback:function e(i){var t=TS.client.unread.getAllGroups().map(function(e){return e.manually_marked_unread_msg});i.added.forEach(function(e){if(!e.data("ts"))return;var i=e.data("ts");if(t.indexOf(i)>=0){var n=e.data("modelObId");x(i,n,e)}});TS.client.ui.unread.msgs_rendered_sig.dispatch(i)}};if(TS.boot_data.feature_sli_briefing)_.assign(e,{afterPageDown:function e(i){if(!i)TS.highlights_briefing.hideBriefing()},afterPageUp:function e(i){if(i)TS.highlights_briefing.showBriefing()}});TS.ui.message_container.register(e);g();TS.client.ui.unread.$scroller.attr("tabindex","-1");TS.client.ui.rebuildAllButMsgs();Promise.all([TS.client.ui.unread.promiseToShowNextPage(),TS.highlights_briefing.promiseToGetBriefing()]).then(function(e){var i=e[1];if(TS.client.unread.shouldRecordMetrics())TS.metrics.measureAndClear("unread_view_time_to_display","unread_view_time_to_display");if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length){if(i)TS.highlights_briefing.showBriefingWithResponse(i);I()}else{var t;var n=true;TS.client.ui.unread.displayEmptyState(t,n)}});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".message[data-ts]",function(e){if(e.altKey){var i=$(e.target).closest(".message");var t=i.data("ts");var n=$(e.target).closest(".message").data("modelObId");x(t,n,i)}});TS.clog.track("UNREADS_OPEN",{});TS.client.ui.unread.started_sig.dispatch()},promiseToShowNextPage:function e(){if(s&&s.isPending())return s;s=TS.client.unread.promiseToGetMoreMessages().then(function(e){if(!TS.model.unread_view_is_showing)return;u.unreads_page+=1;TS.client.ui.unread.updateHeaders(e.groups);TS.client.ui.unread.addMessageContainerGroups(e.groups);TS.client.ui.unread.setMessageContainerHasMoreEnd(!!e.has_more);p();M();if(l){var i=false;var t=TS.client.unread.getActiveGroup();var n=TS.client.unread.moveActiveMarker(i);v(n,t,{collapse_current_group:false});l=false}s=null;return null}).catch(function(e){TS.error(e)});return s},removeMessageContainerGroup:function i(t){e.sections=e.sections.filter(function(e){return-1===t.indexOf(e.id)});e.has_more_end=true;return e},addMessageContainerGroups:function i(t){_.forEach(t,function(i){var t=TS.client.unread.getGroup(i.id);var n=_.findIndex(e.sections,{id:t.id});if(-1===n)e.sections.push(t)})},updateHeaders:function i(t){_.forEach(t,function(i){var t=TS.client.unread.getGroup(i.id);var n=_.findIndex(e.sections,{id:t.id});if(-1!==n)TS.client.ui.unread.updateHeader(t)})},setMessageContainerHasMoreEnd:function i(t){e.has_more_end=t},restart:function i(){TS.client.ui.unread.showOrHideRefreshButton();TS.ui.message_container.cleanup(e);TS.client.ui.unread.$unread_msgs_div.empty();e.sections=[];e.has_more_end=false;TS.ui.message_container.register(e);h=true;TS.client.ui.unread.displayLoadingMessage();g();f=false;Promise.all([TS.client.ui.unread.promiseToShowNextPage(),TS.highlights_briefing.promiseToGetBriefing()]).then(function(e){var i=e[1];if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length){if(i){TS.highlights_briefing.showBriefingWithResponse(i);TS.highlights_briefing.showBriefing()}I()}else{var t;var n=true;TS.client.ui.unread.displayEmptyState(t,n)}})},createLoadingMsgHTML:function e(){var i=$('<div class="unread_msgs_loading"><div class="unread_msgs_loading_msg"></div></div>');TS.client.ui.unread.$scroller.after(i);TS.client.ui.unread.$loading_msg_container=i},displayLoadingMessage:function e(i){if(!TS.client.ui.unread.$loading_msg_container)TS.client.ui.unread.createLoadingMsgHTML();TS.client.ui.unread.$loading_msg_container.removeClass("hidden");var t=TS.i18n.t("Loading messages...","unread")();var n=i||t;TS.client.ui.unread.$loading_msg_container.find(".unread_msgs_loading_msg").text(n)},hideLoadingMessage:function e(){TS.client.ui.unread.$loading_msg_container.addClass("hidden")},displaySlowLoadingMessage:function e(){if(!h)return;var i=TS.i18n.t("Still loading... sorry for the long wait!","unread")();TS.client.ui.unread.displayLoadingMessage(i)},isFatalErrorDisplaying:function e(){return $("#messages_container .unread_error_state").length},displayFatalError:function e(){TS.client.ui.unread.hideLoadingMessage();TS.client.ui.unread.$scroller.addClass("invisible");$("#messages_container .unread_empty_state_wrapper").remove();$("#messages_container").prepend(TS.templates.unread_error({emoji:new Handlebars.SafeString(TS.emoji.graphicReplace(":tropical_fish:",{jumbomoji:true}))}));$(".unread_error_state_refresh_button").on("click",function(){TS.client.unread.reload()});_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning")})},displayEmptyState:function e(i,t){TS.client.ui.unread.hideLoadingMessage();TS.client.ui.unread.$scroller.addClass("invisible");$("#messages_container .unread_empty_state_wrapper").remove();$("#messages_container").prepend(TS.templates.unread_empty_state({line_one:r.line_one,line_two:r.line_two,emoji:r.emoji_url,marked_as_read_cnt:i}));_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning");var e=$("#messages_container .unread_empty_state_undo");if(e.length){e.addClass("unread_empty_state_undo_visible");_.delay(function(){e.removeClass("unread_empty_state_undo_visible")},10300);$(".unread_empty_state_undo_action").one("click",function(){TS.client.unread.markAllAsUnread();TS.client.ui.unread.updateChannelHeader()})}});if(!t){m=true;_.delay(function(){m=false;TS.client.ui.unread.showOrHideRefreshButton()},2e3)}else m=false;TS.client.ui.unread.updateChannelHeader();TS.client.ui.unread.showOrHideRefreshButton()},removeEmptyState:function e(){$(window).off("keydown.unread_empty_state");$("#messages_container .unread_empty_state_wrapper").remove();$("#messages_container .unread_empty_state_undo").remove();TS.client.ui.unread.$scroller.removeClass("invisible");m=false},showOrHideRefreshButton:function e(){var i=TS.client.unread.getTotalNewUnreadCount();var t=$("#messages_container .unread_empty_state");var n=$(".unread_empty_state_refresh");if(i>0&&TS.client.unread.new_messages_in_channels.length)$("#channel_header_unread_refresh").removeClass("hidden");else{$("#channel_header_unread_refresh").addClass("hidden");if(n)n.remove()}if(i>0&&t.length&&TS.client.unread.new_messages_in_channels.length&&!t.hasClass("unread_error_state")){if(n.length>0)n.html($(TS.templates.unread_empty_state_refresh({unreads_count:i})).html());else{if(m)return;t.append(TS.templates.unread_empty_state_refresh({unreads_count:i}));t.addClass("faded");t.addClass("with_refresh");$(window).on("keydown.unread_empty_state",function(e){if(TS.model.unread_view_is_showing&&e.which==TS.utility.keymap.enter&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput())TS.client.unread.reload()})}$(".unread_empty_state_refresh_button").on("click",function(){TS.client.unread.reload()})}},destroyUnreadView:function i(){if(!TS.client.ui.unread.isUnreadViewDOMShowing())return;$(window).off("keydown.unread");if(s&&s.isPending())s.cancel();TS.client.ui.unread.$scroller.removeAttr("tabindex");var a=$("#client-ui");a.removeClass("unread_view_is_showing");TS.ui.message_container.cleanup(e);e=null;TS.client.ui.unread.removeEmptyState();TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_mark");TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_undo > a");if(!TS.environment.supports_sticky_position){TS.client.ui.unread.$scroller.off("scroll",n);TS.ui.banner.show_hide_sig.remove(k)}TS.client.ui.unread.$unread_msgs_div.empty();h=false;TS.client.ui.unread.hideLoadingMessage();$("#footer").removeClass("hidden");TS.view.resize_sig.remove(p);TS.channels.renamed_sig.remove(S);TS.groups.renamed_sig.remove(S);TS.client.ui.unread.unread_groups=null;t=null;var r=TS.client.ui.unread.getTrackingData();TS.clog.track("UNREADS_CLOSE",r);c=0;u={unreads_event_seq_id:0,unreads_elasped_time:0,unreads_page:0,unreads_page_message_index:0};TS.client.ui.unread.ended_sig.dispatch()},isUnreadViewDOMShowing:function e(){return $("#client-ui").hasClass("unread_view_is_showing")},collapseGroup:function e(i,t,n){n=_.extend({persist_state:false,add_classname:true,scroll_group:true},n||{});if(i.collapsed)return Promise.resolve(i);TS.client.unread.collapseGroup(i,n.persist_state);return new Promise(function(e){var a=w(i);var r=a.offset().top;a.addClass("collapsing");TS.client.ui.unread.updateHeader(i);t.animate({opacity:0},300,function(){a.removeClass("collapsing");if(n.add_classname)a.addClass("collapsed");TS.client.ui.unread.updateMsgs();if(n.scroll_group&&r<0)b(a);A();if(!TS.environment.supports_sticky_position)y();t.css("opacity",1);e(i)})})},expandGroup:function e(t,n){n=_.extend({persist_state:false},n||{});var a=w(t);if(!t.collapsed||a.hasClass("collapsing")||!a.hasClass("collapsed"))return Promise.resolve(t);return new Promise(function(e){TS.client.unread.expandGroup(t,n.persist_state);TS.client.ui.unread.updateHeader(t);a.removeClass("collapsed");a.removeClass("marked_as_read");a.removeClass("with_footer");i=true;TS.client.ui.unread.$unread_msgs_div.css("height",TS.client.ui.unread.$unread_msgs_div.height());var r=TS.client.ui.unread.updateMsgsWithFocus(a);i=false;if(s)s.then(function(){TS.client.ui.unread.$unread_msgs_div.css("height","auto")});else TS.client.ui.unread.$unread_msgs_div.css("height","auto");TS.client.ui.unread.updateNewMessagesMessage(t);r.added.forEach(function(e){e.animate({opacity:1},300)});A();if(!TS.environment.supports_sticky_position)y();e(t)})},markGroupAsRead:function e(i){var t=TS.client.unread.getGroup(i);if(!t)return;var n={channel_id:t.id,channel_type:t.id[0]||"",unread_count:t.total_unreads,request_id:TS.client.unread.last_request_id};TS.client.unread.markGroupAsRead(t);TS.clog.track("UNREADS_MARK_GROUP_AS_READ",n);TS.client.ui.unread.updateChannelHeader();var a=w(t);var r=a.find(".unread_group_msgs");if(t.new_unread_cnt<1)a.addClass("marked_as_read");if(r.length){if(!t.new_unread_cnt)M();if(t.collapsed)TS.client.ui.unread.updateHeader(t);else{var s={add_classname:t.new_unread_cnt<1};return TS.client.ui.unread.collapseGroup(t,r,s).then(function(e){if(e.new_unread_cnt>0)TS.client.ui.unread.updateGroupWithNewMessages(e);else TS.client.ui.unread.updateHeader(e)})}}else TS.client.ui.unread.updateMsgs();return Promise.resolve()},markGroupAsUnread:function e(i){var t=TS.client.unread.getGroup(i);if(!t)return;var n={channel_id:t.id,channel_type:t.id[0]||"",unread_count:t.marked_as_read_cnt,request_id:TS.client.unread.last_request_id};TS.client.unread.markGroupAsUnread(t);TS.clog.track("UNREADS_MARK_GROUP_AS_UNREAD",n);TS.client.ui.unread.expandGroup(t);TS.client.ui.unread.updateChannelHeader()},updateNewMessagesMessage:function e(i){if(i.has_more)return;var t=w(i);var n=t.find(".unread_group_footer");if(i.collapsed)TS.client.ui.unread.updateHeader(i);else if(i.new_unread_cnt>0&&i.new_unread_msgs){n.find(".unread_group_new_text").text(TS.i18n.t("{new_unread_cnt, plural, =1 {# new message} other {# new messages}}","all_unreads")({new_unread_cnt:i.new_unread_cnt}));t.addClass("with_footer")}else if(n)t.removeClass("with_footer")},updateHeader:function e(i){var t=w(i);t.find(".unread_group_header").html(TS.templates.unread_group_header(C(i)))},updateMsgs:function i(){return TS.ui.message_container.update(e)},updateMsgsWithFocus:function i(t){return TS.ui.message_container.updateWithFocus(e,t)},updateGroupWithNewMessages:function e(t){var n=w(t);var a=n.height();n.height(a);TS.client.unread.updateGroupWithNewMessages(t);i=true;var r=TS.client.ui.unread.updateMsgsWithFocus(n);i=false;n.css("height","auto");var s=n.height();n.removeClass("with_footer");n.height(a).animate({height:s,margin:0},300,function(){n.css("height","");n.css("margin","");r.added.forEach(function(e){e.animate({opacity:1},300)});A()});n.removeClass("collapsed").removeClass("marked_as_read");TS.client.ui.unread.updateHeader(t)},rebuildMsgFile:function e(i,t){var n=TS.client.ui.unread.$unread_msgs_div.find("#"+TS.templates.makeMsgDomIdInUnreadView(i.ts));if(!n||!n.length)return;var a=n.find(".file_container");if(!a||!a.length)return;var r={file:t,is_message:true,msg_dom_id:n.attr("id")};if("post"===t.mode||"space"===t.mode)a.replaceWith(TS.templates.file_post(r));else if("snippet"===t.mode)a.replaceWith(TS.templates.file_snippet(r));else if("email"===t.mode)a.replaceWith(TS.templates.file_email(r));else if("arugula"===t.mode)a.replaceWith(TS.templates.file_arugula(r));else return TS.warn("Trying to rebuild message file, but cannot rebuild "+t.mode);TS.utility.makeSureAllLinksHaveTargets(n);TS.ui.utility.updateClosestMonkeyScroller(n)},updateChannelHeader:function e(){var i=TS.templates.unread_header_info({is_showing:TS.model.unread_view_is_showing,has_new_messages:TS.model.unread_view_is_showing&&TS.client.unread.new_messages_in_channels.length,messages_loaded:TS.client.unread.messages_loaded,total_unread_count:TS.client.unread.getTotalMessagesCount(),sort_order:TS.client.unread.getSortOrder()});TS.client.channel_header.updateChannelHeaderInfo(i)},setUnreadPoint:function e(i){var t=TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+i+'"]');if(!t.length){if(TS.boot_data.feature_sli_briefing)TS.highlights_briefing.setUnreadPointOnMessage(i);return}var n=t.data("modelObId");x(i,n,t)},getTrackingData:function e(i){var t={is_unreads_view:true,unreads_event_seq_id:u.unreads_event_seq_id,unreads_elasped_time:Date.now()-c,unreads_page:u.unreads_page};if(i)t.unreads_page_message_index=_(TS.client.unread.getAllGroups()).map(function(e){return e.msgs}).flatten().reverse().findIndex({ts:i.toString()});return t},incrementTrackingSeqId:function e(){u.unreads_event_seq_id+=1},rebuildMsgsIncludingMember:function i(t){if(!TS.model.unread_view_is_showing||!e)return;TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(t,e)})},rebuildMsgCurrentStatusIncludingMember:function i(t){if(!TS.model.unread_view_is_showing||!e)return;var n=$(e.container);var a=e.sections;if(!a)return;var r={member:t,for_message:true};_.each(a,function(e){if(!e)return;_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){var i=n.find('ts-message[data-ts="'+e.ts+'"] .message_current_status');i.replaceWith(TS.templates.current_status(r))}})})},rebuildMsgsWithHighlights:function i(t){if(!TS.model.unread_view_is_showing||!e)return;var n=_.reduce(t,function(e,i){_.each(i,function(i,t){e[t]=i});return e},{});TS.ui.message_container.maybeUpdateMessages(e,function(e){return n[e.ts]&&(n[e.ts].show_recap||n[e.ts].is_leaving_feedback||n[e.ts].left_feedback)})},maybeRebuildMsgsWithHighlightsFeedback:function i(t){if(!TS.model.unread_view_is_showing||!e)return;var n=_.reduce(t,function(e,i){_.each(i,function(i,t){e[t]=i});return e},{});TS.ui.message_container.maybeUpdateMessages(e,function(e){var i=n[e.ts]&&"positive"===n[e.ts].feedback;if(i){TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+e.ts+'"] .sli_briefing__feedback_controls').addClass("gave_positive_feedback");return false}return n[e.ts]&&(n[e.ts].show_recap||n[e.ts].is_leaving_feedback||n[e.ts].left_feedback)})}});var e;var i=false;var t=false;var n;var a=0;var r;var s=null;var o=false;var l=false;var d=false;var c=0;var u={unreads_event_seq_id:0,unreads_elasped_time:0,unreads_page:0,unreads_page_message_index:0};var m;var f=false;var h=false;var g=function e(){var i=[];switch(TS.i18n.locale()){case"fr-FR":i=[{emoji:"balloon",skintone:false,line_one:"Vous êtes à jour.",line_two:"On se sent déjà plus léger."},{emoji:"bee",skintone:false,line_one:"Vous êtes à jour.",line_two:"On décolle mieux face au vent, courage !"},{emoji:"books",skintone:false,line_one:"Lu et relu !",line_two:""},{emoji:"boom",skintone:false,line_one:"Boum !",line_two:"Vous êtes à jour."},{emoji:"clap",skintone:true,line_one:"Bravo !",line_two:"Vous avez tout lu."},{emoji:"coffee",skintone:false,line_one:"Vous avez tout lu !",line_two:"Une pause s’impose !"},{emoji:"crystalball",skintone:false,line_one:"Vous avez tout lu !",line_two:"Que vous réserve l’avenir ?"},{emoji:"high5",skintone:true,line_one:"C’est tout !",line_two:""},{emoji:"island",skintone:false,line_one:"Terminé !",line_two:"Vous pouvez vous la couler douce !"},{emoji:"owl",skintone:false,line_one:"Chouette !",line_two:"Vous avez terminé."},{emoji:"racecar",skintone:false,line_one:"Voilà !",line_two:"Vous êtes sur la bonne voie."},{emoji:"rocket",skintone:false,line_one:"Terminé !",line_two:"L’avenir vous appartient."},{emoji:"sun",skintone:false,line_one:"Vous êtes à jour.",line_two:"L’horizon est dégagé."},{emoji:"sunglasses",skintone:false,line_one:"Tout est à jour.",line_two:""},{emoji:"tada",skintone:false,line_one:"Tadam !",line_two:"Vous avez tout lu."},{emoji:"thumbup",skintone:true,line_one:"Ça y est !",line_two:"Vous avez fini."},{emoji:"victory",skintone:true,line_one:"Vous êtes à jour.",line_two:"Quelle est la suite du programme ?"}];break;case"de-DE":i=[{emoji:"airplane",skintone:false,line_one:"Jetzt bist du startklar.",line_two:""},{emoji:"art",skintone:false,line_one:"Alles paletti!",line_two:""},{emoji:"bee",skintone:false,line_one:"Geschafft!",line_two:"Ganz schön fleißig."},{emoji:"books",skintone:false,line_one:"Alles gelesen.",line_two:"Wie es im Buche steht."},{emoji:"boom",skintone:false,line_one:"Du bist der Knaller!",line_two:""},{emoji:"bulb",skintone:false,line_one:"Heureka!",line_two:"Du hast ALLES gelesen!"},{emoji:"checkered_flag",skintone:false,line_one:"Du bist am Ziel angelangt!",line_two:"Du hast alles gelesen!"},{emoji:"clap",skintone:true,line_one:"Das war das Tüpfelchen auf dem i.",line_two:""},{emoji:"croissant",skintone:false,line_one:"Voilà!",line_two:"Das war es auch schon."},{emoji:"crystalball",skintone:false,line_one:"Alles klar.",line_two:"Die Zukunft gehört dir!"},{emoji:"footprints",skintone:false,line_one:"Gut gemacht.",line_two:"Jetzt liegt dir die Welt zu Füßen!"},{emoji:"hammer",skintone:false,line_one:"Du bist der Hammer!",line_two:"Alles gelesen!"},{emoji:"high5",skintone:true,line_one:"Geschafft!",line_two:"Das war alles."},{emoji:"metro",skintone:false,line_one:"Hier ist das Licht am Ende des Tunnels!",line_two:""},{emoji:"island",skintone:false,line_one:"Land in Sicht!",line_two:"Du hast alles gelesen!"},{emoji:"person_ball",skintone:true,line_one:"Immer am Ball bleiben!",line_two:""},{emoji:"rocket",skintone:false,line_one:"Du hast ein ganz schönes Lesetempo drauf!",line_two:""},{emoji:"sailboat",skintone:false,line_one:"Alles in Lot auf dem Boot.",line_two:""},{emoji:"sailboat",skintone:false,line_one:"Alles in Butter auf dem Kutter!",line_two:""},{emoji:"ship",skintone:false,line_one:"Klar Schiff!",line_two:""},{emoji:"soccer",skintone:false,line_one:"Volltreffer! ",line_two:"Du hast alles gelesen!"},{emoji:"sun",skintone:false,line_one:"Alles heiter und klar!",line_two:""},{emoji:"sunglasses",skintone:false,line_one:"Alles klar!",line_two:""},{emoji:"tada",skintone:false,line_one:"Ta-da !",line_two:"Du bist jetzt ganz schön belesen."},{emoji:"tea",skintone:false,line_one:"Du hast alles aufgeholt.",line_two:"Zeit für eine kleine Pause."},{emoji:"thumbup",skintone:true,line_one:"Du bist ganz schön auf Zack!",line_two:""},{emoji:"victory",skintone:true,line_one:"Alles erledigt!",line_two:"Das ist das A und O."},{emoji:"wrench",skintone:false,line_one:"Ganz schön fix!",line_two:""}];break;case"ja-JP":i=[{emoji:"blush",skintone:false,line_one:"未読メッセージは以上です。",line_two:"お疲れさまでした。"},{emoji:"bookmark_tabs",skintone:false,line_one:"未読チェック完了！準備万端！",line_two:"さあ、何からやりますか？"},{emoji:"candy",skintone:false,line_one:"全未読メッセージの確認、お疲れさまでした。",line_two:"はい、アメちゃん！"},{emoji:"check_mark",skintone:false,line_one:"全未読メッセージ確認終了！",line_two:"やることリストから1つ消えました！"},{emoji:"cityscape",skintone:false,line_one:"全未読メッセージの確認、お疲れさまでした。",line_two:"遠くを見ると疲れ目にいいらしいですよ？"},{emoji:"coffee",skintone:false,line_one:"すべての未読メッセージを確認しました。",line_two:"ちょっと一息入れませんか？"},{emoji:"confetti_ball",skintone:false,line_one:"未読メッセージ読了を達成しました！",line_two:""},{emoji:"crossed_swords",skintone:false,line_one:"みどく　メッセージを　やっつけた。",line_two:"かしこさが　１ポイント　あがった！"},{emoji:"dog",skintone:false,line_one:"未読チェック完了！",line_two:"ワンだふる！"},{emoji:"doughnut",skintone:false,line_one:"全未読メッセージ確認終了！",line_two:"ちょっと休憩して、疲れた脳に糖分補給"},{emoji:"herb",skintone:false,line_one:"未読スッキリ！気分もスッキリ！",line_two:""},{emoji:"leafs",skintone:false,line_one:"全メッセージが既読になりました。",line_two:"それはそれで、ちょっと寂しい…？"},{emoji:"rocket",skintone:false,line_one:"未読コンプリート！",line_two:"この調子でどんどん行っちゃいましょう！"},{emoji:"sparkles",skintone:false,line_one:"未読メッセージが、ぜんぶキレイに片付きました。",line_two:""},{emoji:"tada",skintone:false,line_one:"すごい！",line_two:"未読コンプリート！"},{emoji:"tea",skintone:false,line_one:"未読チェック完了！",line_two:"お疲れさまでした。"},{emoji:"trophy",skintone:false,line_one:"おめでとうございます！",line_two:"全未読チェック完了です！"},{emoji:"victory",skintone:true,line_one:"未読チェック完了！",line_two:""},{emoji:"sleuth",skintone:true,line_one:"全未読メッセージを",line_two:"漏れなくすべて確認しました。"}];break;case"es-ES":i=[{emoji:"boom",skintone:false,line_one:"Bum.",line_two:"Estás al día."},{emoji:"chick",skintone:false,line_one:"Estás al día.",line_two:"Es hora de salir a hacer algo estupendo."},{emoji:"candy",skintone:false,line_one:"Has leído todo.",line_two:"Aquí tienes un caramelo de regalo."},{emoji:"cityscape",skintone:false,line_one:"Has terminado de leer.",line_two:"Tienes el mundo a tus pies."},{emoji:"checkered_flag",skintone:false,line_one:"Has terminado de leer.",line_two:"¿Y ahora qué sigue?"},{emoji:"flex",skintone:true,line_one:"Has terminado de leer.",line_two:"¡Lo lograste!"},{emoji:"high5",skintone:true,line_one:"¡Eso es todo!",line_two:""},{emoji:"hourglass",skintone:false,line_one:"Has terminado de leer.",line_two:"El futuro es tuyo."},{emoji:"leafs",skintone:false,line_one:"Punto y aparte.",line_two:""},{emoji:"newspaper",skintone:false,line_one:"Ya estás al día con tu lectura.",line_two:"Ahora puedes tomarte un descanso."},{emoji:"rocket",skintone:false,line_one:"¡Listo! Estás al tanto de todo.",line_two:"Ahora puedes proponerte algo nuevo."},{emoji:"sunglasses",skintone:false,line_one:"El pronóstico se ve despejado.",line_two:""},{emoji:"sleuth",skintone:true,line_one:"Estás al tanto de todo.",line_two:"¿Y ahora qué?"},{emoji:"sleuth",skintone:true,line_one:"Listo.",line_two:"Ya estás al tanto de todo."},{emoji:"tada",skintone:false,line_one:"¡Enhorabuena!",line_two:"Has leído todo lo que había que leer."},{emoji:"trophy",skintone:false,line_one:"¡Al fin!",line_two:"Ya has terminado."}];break;default:i=[{emoji:"apple",skintone:false,line_one:"You’ve read all you needed.",line_two:"Take a moment."},{emoji:"balloon",skintone:false,line_one:"There! Caught up.",line_two:"Set your mind to something new."},{emoji:"bee",skintone:false,line_one:"You’re up to date.",line_two:"Go forth and do great things."},{emoji:"boom",skintone:false,line_one:"Boom.",line_two:"You’re up to date."},{emoji:"clap",skintone:true,line_one:"Everything unread is now read.",line_two:"You’ve done it."},{emoji:"growth",skintone:false,line_one:"Everything’s sorted!",line_two:"Let’s start something new."},{emoji:"crystalball",skintone:false,line_one:"All that was unread is now read.",line_two:"What’s next?"},{emoji:"high5",skintone:true,line_one:"That’s everything!",line_two:""},{emoji:"leafs",skintone:false,line_one:"Done and done.",line_two:""},{emoji:"octopus",skintone:false,line_one:"All done.",line_two:"The world is your oyster."},{emoji:"pony",skintone:false,line_one:"You’re all read.",line_two:"Here’s a pony."},{emoji:"racecar",skintone:false,line_one:"There.",line_two:"All caught up."},{emoji:"rocket",skintone:false,line_one:"All done.",line_two:"The future is yours."},{emoji:"sun",skintone:false,line_one:"You’re all caught up!",line_two:"Clear screens ahead."},{emoji:"sunglasses",skintone:false,line_one:"All clear.",line_two:""},{emoji:"sweetpotato",skintone:false,line_one:"Sweet potato!",line_two:"You’re all done."},{emoji:"tada",skintone:false,line_one:"Ta-da!",line_two:"You’ve read everything there is to read."},{emoji:"tada",skintone:false,line_one:"Ta-da!",line_two:"You’re up to date."},{emoji:"thumbup",skintone:true,line_one:"That’s that.",line_two:"You’re good to go."},{emoji:"tractor",skintone:false,line_one:"You’re all read.",line_two:"Here’s a tractor."},{emoji:"victory",skintone:true,line_one:"All caught up.",line_two:"What’s next?"}]}var t={default:{tada:cdn_url+"/5ced7/img/unread/empty/default/tada.png",victory:{1:cdn_url+"/5ced7/img/unread/empty/default/victory_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/victory_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/victory_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/victory_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/victory_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/victory_6.png"},racecar:cdn_url+"/5ced7/img/unread/empty/default/racecar.png",rocket:cdn_url+"/5ced7/img/unread/empty/default/rocket.png",octopus:cdn_url+"/5ced7/img/unread/empty/default/octopus.png",high5:{1:cdn_url+"/5ced7/img/unread/empty/default/high5_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/high5_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/high5_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/high5_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/high5_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/high5_6.png"},apple:cdn_url+"/5ced7/img/unread/empty/default/apple.png",sunglasses:cdn_url+"/5ced7/img/unread/empty/default/sunglasses.png",thumbup:{1:cdn_url+"/5ced7/img/unread/empty/default/thumbup_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/thumbup_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/thumbup_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/thumbup_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/thumbup_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/thumbup_6.png"},boom:cdn_url+"/5ced7/img/unread/empty/default/boom.png",bee:cdn_url+"/5ced7/img/unread/empty/default/bee.png",clap:{1:cdn_url+"/5ced7/img/unread/empty/default/clap_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/clap_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/clap_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/clap_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/clap_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/clap_6.png"},crystalball:cdn_url+"/5ced7/img/unread/empty/default/crystalball.png",tractor:cdn_url+"/5ced7/img/unread/empty/default/tractor.png",pony:cdn_url+"/5ced7/img/unread/empty/default/pony.png",chick:cdn_url+"/5ced7/img/unread/empty/default/chick.png",growth:cdn_url+"/5ced7/img/unread/empty/default/growth.png",sun:cdn_url+"/5ced7/img/unread/empty/default/sun.png",balloon:cdn_url+"/5ced7/img/unread/empty/default/balloon.png",sweetpotato:cdn_url+"/5ced7/img/unread/empty/default/sweetpotato.png",leafs:cdn_url+"/5ced7/img/unread/empty/default/leafs.png",owl:cdn_url+"/5ced7/img/unread/empty/default/owl.png",books:cdn_url+"/5ced7/img/unread/empty/default/books.png",island:cdn_url+"/5ced7/img/unread/empty/default/island.png",coffee:cdn_url+"/5ced7/img/unread/empty/default/coffee.png",footprints:cdn_url+"/5ced7/img/unread/empty/default/footprints.png",tea:cdn_url+"/5ced7/img/unread/empty/default/tea.png",croissant:cdn_url+"/5ced7/img/unread/empty/default/croissant.png",art:cdn_url+"/5ced7/img/unread/empty/default/art.png",person_ball:{1:cdn_url+"/5ced7/img/unread/empty/default/person_ball_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/person_ball_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/person_ball_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/person_ball_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/person_ball_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/person_ball_6.png"},airplane:cdn_url+"/5ced7/img/unread/empty/default/airplane.png",sailboat:cdn_url+"/5ced7/img/unread/empty/default/sailboat.png",ship:cdn_url+"/5ced7/img/unread/empty/default/ship.png",bulb:cdn_url+"/5ced7/img/unread/empty/default/bulb.png",hammer:cdn_url+"/5ced7/img/unread/empty/default/hammer.png",checkered_flag:cdn_url+"/5ced7/img/unread/empty/default/checkered_flag.png",wrench:cdn_url+"/5ced7/img/unread/empty/default/wrench.png",metro:cdn_url+"/5ced7/img/unread/empty/default/metro.png",soccer:cdn_url+"/5ced7/img/unread/empty/default/soccer.png",trophy:cdn_url+"/5ced7/img/unread/empty/default/trophy.png",cityscape:cdn_url+"/5ced7/img/unread/empty/default/cityscape.png",dog:cdn_url+"/5ced7/img/unread/empty/default/dog.png",crossed_swords:cdn_url+"/5ced7/img/unread/empty/default/crossed_swords.png",blush:cdn_url+"/5ced7/img/unread/empty/default/blush.png",candy:cdn_url+"/5ced7/img/unread/empty/default/candy.png",herb:cdn_url+"/5ced7/img/unread/empty/default/herb.png",sparkles:cdn_url+"/5ced7/img/unread/empty/default/sparkles.png",check_mark:cdn_url+"/5ced7/img/unread/empty/default/check_mark.png",confetti_ball:cdn_url+"/5ced7/img/unread/empty/default/confetti_ball.png",doughnut:cdn_url+"/5ced7/img/unread/empty/default/doughnut.png",bookmark_tabs:cdn_url+"/5ced7/img/unread/empty/default/bookmark_tabs.png",sleuth:{1:cdn_url+"/5ced7/img/unread/empty/default/sleuth_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/sleuth_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/sleuth_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/sleuth_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/sleuth_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/sleuth_6.png"},hourglass:cdn_url+"/5ced7/img/unread/empty/default/hourglass.png",newspaper:cdn_url+"/5ced7/img/unread/empty/default/newspaper.png",flex:{1:cdn_url+"/5ced7/img/unread/empty/default/flex_1.png",2:cdn_url+"/5ced7/img/unread/empty/default/flex_2.png",3:cdn_url+"/5ced7/img/unread/empty/default/flex_3.png",4:cdn_url+"/5ced7/img/unread/empty/default/flex_4.png",5:cdn_url+"/5ced7/img/unread/empty/default/flex_5.png",6:cdn_url+"/5ced7/img/unread/empty/default/flex_6.png"}},google:{tada:cdn_url+"/5ced7/img/unread/empty/google/tada.png",victory:{1:cdn_url+"/5ced7/img/unread/empty/google/victory_1.png",2:cdn_url+"/5ced7/img/unread/empty/google/victory_2.png",3:cdn_url+"/5ced7/img/unread/empty/google/victory_3.png",4:cdn_url+"/5ced7/img/unread/empty/google/victory_4.png",5:cdn_url+"/5ced7/img/unread/empty/google/victory_5.png",6:cdn_url+"/5ced7/img/unread/empty/google/victory_6.png"},racecar:cdn_url+"/5ced7/img/unread/empty/google/racecar.png",rocket:cdn_url+"/5ced7/img/unread/empty/google/rocket.png",octopus:cdn_url+"/5ced7/img/unread/empty/google/octopus.png",high5:{1:cdn_url+"/5ced7/img/unread/empty/google/high5_1.png",2:cdn_url+"/5ced7/img/unread/empty/google/high5_2.png",3:cdn_url+"/5ced7/img/unread/empty/google/high5_3.png",4:cdn_url+"/5ced7/img/unread/empty/google/high5_4.png",5:cdn_url+"/5ced7/img/unread/empty/google/high5_5.png",6:cdn_url+"/5ced7/img/unread/empty/google/high5_6.png"},apple:cdn_url+"/5ced7/img/unread/empty/google/apple.png",sunglasses:cdn_url+"/5ced7/img/unread/empty/google/sunglasses.png",thumbup:{1:cdn_url+"/5ced7/img/unread/empty/google/thumbup_1.png",2:cdn_url+"/5ced7/img/unread/empty/google/thumbup_2.png",3:cdn_url+"/5ced7/img/unread/empty/google/thumbup_3.png",4:cdn_url+"/5ced7/img/unread/empty/google/thumbup_4.png",5:cdn_url+"/5ced7/img/unread/empty/google/thumbup_5.png",6:cdn_url+"/5ced7/img/unread/empty/google/thumbup_6.png"},boom:cdn_url+"/5ced7/img/unread/empty/google/boom.png",bee:cdn_url+"/5ced7/img/unread/empty/google/bee.png",clap:{1:cdn_url+"/5ced7/img/unread/empty/google/clap_1.png",2:cdn_url+"/5ced7/img/unread/empty/google/clap_2.png",3:cdn_url+"/5ced7/img/unread/empty/google/clap_3.png",4:cdn_url+"/5ced7/img/unread/empty/google/clap_4.png",5:cdn_url+"/5ced7/img/unread/empty/google/clap_5.png",6:cdn_url+"/5ced7/img/unread/empty/google/clap_6.png"},crystalball:cdn_url+"/5ced7/img/unread/empty/google/crystalball.png",tractor:cdn_url+"/5ced7/img/unread/empty/google/tractor.png",pony:cdn_url+"/5ced7/img/unread/empty/google/pony.png",chick:cdn_url+"/5ced7/img/unread/empty/google/chick.png",growth:cdn_url+"/5ced7/img/unread/empty/google/growth.png",sun:cdn_url+"/5ced7/img/unread/empty/google/sun.png",balloon:cdn_url+"/5ced7/img/unread/empty/google/balloon.png",sweetpotato:cdn_url+"/5ced7/img/unread/empty/google/sweetpotato.png",leafs:cdn_url+"/5ced7/img/unread/empty/google/leafs.png",owl:cdn_url+"/5ced7/img/unread/empty/google/owl.png",books:cdn_url+"/5ced7/img/unread/empty/google/books.png",island:cdn_url+"/5ced7/img/unread/empty/google/island.png",coffee:cdn_url+"/5ced7/img/unread/empty/google/coffee.png",footprints:cdn_url+"/5ced7/img/unread/empty/google/footprints.png",tea:cdn_url+"/5ced7/img/unread/empty/google/tea.png",croissant:cdn_url+"/5ced7/img/unread/empty/google/croissant.png",art:cdn_url+"/5ced7/img/unread/empty/google/art.png",person_ball:{1:cdn_url+"/5ced7/img/unread/empty/google/person_ball_1.png",2:cdn_url+"/5ced7/img/unread/empty/google/person_ball_2.png",3:cdn_url+"/5ced7/img/unread/empty/google/person_ball_3.png",4:cdn_url+"/5ced7/img/unread/empty/google/person_ball_4.png",5:cdn_url+"/5ced7/img/unread/empty/google/person_ball_5.png",6:cdn_url+"/5ced7/img/unread/empty/google/person_ball_6.png"},airplane:cdn_url+"/5ced7/img/unread/empty/google/airplane.png",sailboat:cdn_url+"/5ced7/img/unread/empty/google/sailboat.png",ship:cdn_url+"/5ced7/img/unread/empty/google/ship.png",bulb:cdn_url+"/5ced7/img/unread/empty/google/bulb.png",checkered_flag:cdn_url+"/5ced7/img/unread/empty/google/checkered_flag.png",wrench:cdn_url+"/5ced7/img/unread/empty/google/wrench.png",metro:cdn_url+"/5ced7/img/unread/empty/google/metro.png",soccer:cdn_url+"/5ced7/img/unread/empty/google/soccer.png",trophy:cdn_url+"/5ced7/img/unread/empty/google/trophy.png",cityscape:cdn_url+"/5ced7/img/unread/empty/google/cityscape.png",dog:cdn_url+"/5ced7/img/unread/empty/google/dog.png",crossed_swords:cdn_url+"/5ced7/img/unread/empty/google/crossed_swords.png",blush:cdn_url+"/5ced7/img/unread/empty/google/blush.png",candy:cdn_url+"/5ced7/img/unread/empty/google/candy.png",herb:cdn_url+"/5ced7/img/unread/empty/google/herb.png",sparkles:cdn_url+"/5ced7/img/unread/empty/google/sparkles.png",check_mark:cdn_url+"/5ced7/img/unread/empty/google/check_mark.png",confetti_ball:cdn_url+"/5ced7/img/unread/empty/google/confetti_ball.png",doughnut:cdn_url+"/5ced7/img/unread/empty/google/doughnut.png",bookmark_tabs:cdn_url+"/5ced7/img/unread/empty/google/bookmark_tabs.png",sleuth:{1:cdn_url+"/5ced7/img/unread/empty/google/sleuth_1.png",2:cdn_url+"/5ced7/img/unread/empty/google/sleuth_2.png",3:cdn_url+"/5ced7/img/unread/empty/google/sleuth_3.png",4:cdn_url+"/5ced7/img/unread/empty/google/sleuth_4.png",5:cdn_url+"/5ced7/img/unread/empty/google/sleuth_5.png",6:cdn_url+"/5ced7/img/unread/empty/google/sleuth_6.png"}},twitter:{tada:cdn_url+"/5ced7/img/unread/empty/twitter/tada.png",victory:{1:cdn_url+"/5ced7/img/unread/empty/twitter/victory_1.png",2:cdn_url+"/5ced7/img/unread/empty/twitter/victory_2.png",3:cdn_url+"/5ced7/img/unread/empty/twitter/victory_3.png",4:cdn_url+"/5ced7/img/unread/empty/twitter/victory_4.png",5:cdn_url+"/5ced7/img/unread/empty/twitter/victory_5.png",6:cdn_url+"/5ced7/img/unread/empty/twitter/victory_6.png"},racecar:cdn_url+"/5ced7/img/unread/empty/twitter/racecar.png",rocket:cdn_url+"/5ced7/img/unread/empty/twitter/rocket.png",octopus:cdn_url+"/5ced7/img/unread/empty/twitter/octopus.png",high5:{1:cdn_url+"/5ced7/img/unread/empty/twitter/high5_1.png",2:cdn_url+"/5ced7/img/unread/empty/twitter/high5_2.png",3:cdn_url+"/5ced7/img/unread/empty/twitter/high5_3.png",4:cdn_url+"/5ced7/img/unread/empty/twitter/high5_4.png",5:cdn_url+"/5ced7/img/unread/empty/twitter/high5_5.png",6:cdn_url+"/5ced7/img/unread/empty/twitter/high5_6.png"},apple:cdn_url+"/5ced7/img/unread/empty/twitter/apple.png",sunglasses:cdn_url+"/5ced7/img/unread/empty/twitter/sunglasses.png",thumbup:{1:cdn_url+"/5ced7/img/unread/empty/twitter/thumbup_1.png",2:cdn_url+"/5ced7/img/unread/empty/twitter/thumbup_2.png",3:cdn_url+"/5ced7/img/unread/empty/twitter/thumbup_3.png",4:cdn_url+"/5ced7/img/unread/empty/twitter/thumbup_4.png",5:cdn_url+"/5ced7/img/unread/empty/twitter/thumbup_5.png",6:cdn_url+"/5ced7/img/unread/empty/twitter/thumbup_6.png"},boom:cdn_url+"/5ced7/img/unread/empty/twitter/boom.png",bee:cdn_url+"/5ced7/img/unread/empty/twitter/bee.png",clap:{1:cdn_url+"/5ced7/img/unread/empty/twitter/clap_1.png",2:cdn_url+"/5ced7/img/unread/empty/twitter/clap_2.png",3:cdn_url+"/5ced7/img/unread/empty/twitter/clap_3.png",4:cdn_url+"/5ced7/img/unread/empty/twitter/clap_4.png",5:cdn_url+"/5ced7/img/unread/empty/twitter/clap_5.png",6:cdn_url+"/5ced7/img/unread/empty/twitter/clap_6.png"},crystalball:cdn_url+"/5ced7/img/unread/empty/twitter/crystalball.png",tractor:cdn_url+"/5ced7/img/unread/empty/twitter/tractor.png",pony:cdn_url+"/5ced7/img/unread/empty/twitter/pony.png",chick:cdn_url+"/5ced7/img/unread/empty/twitter/chick.png",growth:cdn_url+"/5ced7/img/unread/empty/twitter/growth.png",sun:cdn_url+"/5ced7/img/unread/empty/twitter/sun.png",balloon:cdn_url+"/5ced7/img/unread/empty/twitter/balloon.png",sweetpotato:cdn_url+"/5ced7/img/unread/empty/twitter/sweetpotato.png",leafs:cdn_url+"/5ced7/img/unread/empty/twitter/leafs.png",owl:cdn_url+"/5ced7/img/unread/empty/twitter/owl.png",books:cdn_url+"/5ced7/img/unread/empty/twitter/books.png",island:cdn_url+"/5ced7/img/unread/empty/twitter/island.png",coffee:cdn_url+"/5ced7/img/unread/empty/twitter/coffee.png",footprints:cdn_url+"/5ced7/img/unread/empty/twitter/footprints.png",tea:cdn_url+"/5ced7/img/unread/empty/twitter/tea.png",croissant:cdn_url+"/5ced7/img/unread/empty/twitter/croissant.png",art:cdn_url+"/5ced7/img/unread/empty/twitter/art.png",person_ball:{1:cdn_url+"/5ced7/img/unread/empty/twitter/person_ball_1.png",2:cdn_url+"/5ced7/img/unread/empty/twitter/person_ball_2.png",3:cdn_url+"/5ced7/img/unread/empty/twitter/person_ball_3.png",4:cdn_url+"/5ced7/img/unread/empty/twitter/person_ball_4.png",5:cdn_url+"/5ced7/img/unread/empty/twitter/person_ball_5.png",6:cdn_url+"/5ced7/img/unread/empty/twitter/person_ball_6.png"},airplane:cdn_url+"/5ced7/img/unread/empty/twitter/airplane.png",sailboat:cdn_url+"/5ced7/img/unread/empty/twitter/sailboat.png",ship:cdn_url+"/5ced7/img/unread/empty/twitter/ship.png",bulb:cdn_url+"/5ced7/img/unread/empty/twitter/bulb.png",checkered_flag:cdn_url+"/5ced7/img/unread/empty/twitter/checkered_flag.png",wrench:cdn_url+"/5ced7/img/unread/empty/twitter/wrench.png",metro:cdn_url+"/5ced7/img/unread/empty/twitter/metro.png",soccer:cdn_url+"/5ced7/img/unread/empty/twitter/soccer.png",trophy:cdn_url+"/5ced7/img/unread/empty/twitter/trophy.png",cityscape:cdn_url+"/5ced7/img/unread/empty/twitter/cityscape.png",dog:cdn_url+"/5ced7/img/unread/empty/twitter/dog.png",crossed_swords:cdn_url+"/5ced7/img/unread/empty/twitter/crossed_swords.png",blush:cdn_url+"/5ced7/img/unread/empty/twitter/blush.png",candy:cdn_url+"/5ced7/img/unread/empty/twitter/candy.png",herb:cdn_url+"/5ced7/img/unread/empty/twitter/herb.png",sparkles:cdn_url+"/5ced7/img/unread/empty/twitter/sparkles.png",check_mark:cdn_url+"/5ced7/img/unread/empty/twitter/check_mark.png",confetti_ball:cdn_url+"/5ced7/img/unread/empty/twitter/confetti_ball.png",doughnut:cdn_url+"/5ced7/img/unread/empty/twitter/doughnut.png",bookmark_tabs:cdn_url+"/5ced7/img/unread/empty/twitter/bookmark_tabs.png",sleuth:{1:cdn_url+"/5ced7/img/unread/empty/twitter/sleuth_1.png",2:cdn_url+"/5ced7/img/unread/empty/twitter/sleuth_2.png",3:cdn_url+"/5ced7/img/unread/empty/twitter/sleuth_3.png",4:cdn_url+"/5ced7/img/unread/empty/twitter/sleuth_4.png",5:cdn_url+"/5ced7/img/unread/empty/twitter/sleuth_5.png",6:cdn_url+"/5ced7/img/unread/empty/twitter/sleuth_6.png"}},emojione:{tada:cdn_url+"/5ced7/img/unread/empty/emojione/tada.png",victory:{1:cdn_url+"/5ced7/img/unread/empty/emojione/victory_1.png",2:cdn_url+"/5ced7/img/unread/empty/emojione/victory_2.png",3:cdn_url+"/5ced7/img/unread/empty/emojione/victory_3.png",4:cdn_url+"/5ced7/img/unread/empty/emojione/victory_4.png",5:cdn_url+"/5ced7/img/unread/empty/emojione/victory_5.png",6:cdn_url+"/5ced7/img/unread/empty/emojione/victory_6.png"},racecar:cdn_url+"/5ced7/img/unread/empty/emojione/racecar.png",rocket:cdn_url+"/5ced7/img/unread/empty/emojione/rocket.png",octopus:cdn_url+"/5ced7/img/unread/empty/emojione/octopus.png",high5:{1:cdn_url+"/5ced7/img/unread/empty/emojione/high5_1.png",2:cdn_url+"/5ced7/img/unread/empty/emojione/high5_2.png",3:cdn_url+"/5ced7/img/unread/empty/emojione/high5_3.png",4:cdn_url+"/5ced7/img/unread/empty/emojione/high5_4.png",5:cdn_url+"/5ced7/img/unread/empty/emojione/high5_5.png",6:cdn_url+"/5ced7/img/unread/empty/emojione/high5_6.png"},apple:cdn_url+"/5ced7/img/unread/empty/emojione/apple.png",sunglasses:cdn_url+"/5ced7/img/unread/empty/emojione/sunglasses.png",thumbup:{1:cdn_url+"/5ced7/img/unread/empty/emojione/thumbup_1.png",2:cdn_url+"/5ced7/img/unread/empty/emojione/thumbup_2.png",3:cdn_url+"/5ced7/img/unread/empty/emojione/thumbup_3.png",4:cdn_url+"/5ced7/img/unread/empty/emojione/thumbup_4.png",5:cdn_url+"/5ced7/img/unread/empty/emojione/thumbup_5.png",6:cdn_url+"/5ced7/img/unread/empty/emojione/thumbup_6.png"},boom:cdn_url+"/5ced7/img/unread/empty/emojione/boom.png",bee:cdn_url+"/5ced7/img/unread/empty/emojione/bee.png",clap:{1:cdn_url+"/5ced7/img/unread/empty/emojione/clap_1.png",2:cdn_url+"/5ced7/img/unread/empty/emojione/clap_2.png",3:cdn_url+"/5ced7/img/unread/empty/emojione/clap_3.png",4:cdn_url+"/5ced7/img/unread/empty/emojione/clap_4.png",5:cdn_url+"/5ced7/img/unread/empty/emojione/clap_5.png",6:cdn_url+"/5ced7/img/unread/empty/emojione/clap_6.png"},crystalball:cdn_url+"/5ced7/img/unread/empty/emojione/crystalball.png",tractor:cdn_url+"/5ced7/img/unread/empty/emojione/tractor.png",pony:cdn_url+"/5ced7/img/unread/empty/emojione/pony.png",chick:cdn_url+"/5ced7/img/unread/empty/emojione/chick.png",growth:cdn_url+"/5ced7/img/unread/empty/emojione/growth.png",sun:cdn_url+"/5ced7/img/unread/empty/emojione/sun.png",balloon:cdn_url+"/5ced7/img/unread/empty/emojione/balloon.png",sweetpotato:cdn_url+"/5ced7/img/unread/empty/emojione/sweetpotato.png",leafs:cdn_url+"/5ced7/img/unread/empty/emojione/sweetpotato.png",owl:cdn_url+"/5ced7/img/unread/empty/emojione/owl.png",books:cdn_url+"/5ced7/img/unread/empty/emojione/books.png",island:cdn_url+"/5ced7/img/unread/empty/emojione/island.png",coffee:cdn_url+"/5ced7/img/unread/empty/emojione/coffee.png",footprints:cdn_url+"/5ced7/img/unread/empty/emojione/footprints.png",tea:cdn_url+"/5ced7/img/unread/empty/emojione/tea.png",croissant:cdn_url+"/5ced7/img/unread/empty/emojione/croissant.png",art:cdn_url+"/5ced7/img/unread/empty/emojione/art.png",person_ball:{1:cdn_url+"/5ced7/img/unread/empty/emojione/person_ball_1.png",2:cdn_url+"/5ced7/img/unread/empty/emojione/person_ball_2.png",3:cdn_url+"/5ced7/img/unread/empty/emojione/person_ball_3.png",4:cdn_url+"/5ced7/img/unread/empty/emojione/person_ball_4.png",5:cdn_url+"/5ced7/img/unread/empty/emojione/person_ball_5.png",6:cdn_url+"/5ced7/img/unread/empty/emojione/person_ball_6.png"},airplane:cdn_url+"/5ced7/img/unread/empty/emojione/airplane.png",sailboat:cdn_url+"/5ced7/img/unread/empty/emojione/sailboat.png",ship:cdn_url+"/5ced7/img/unread/empty/emojione/ship.png",bulb:cdn_url+"/5ced7/img/unread/empty/emojione/bulb.png",checkered_flag:cdn_url+"/5ced7/img/unread/empty/emojione/checkered_flag.png",wrench:cdn_url+"/5ced7/img/unread/empty/emojione/wrench.png",metro:cdn_url+"/5ced7/img/unread/empty/emojione/metro.png",soccer:cdn_url+"/5ced7/img/unread/empty/emojione/soccer.png",trophy:cdn_url+"/5ced7/img/unread/empty/emojione/trophy.png",cityscape:cdn_url+"/5ced7/img/unread/empty/emojione/cityscape.png",dog:cdn_url+"/5ced7/img/unread/empty/emojione/dog.png",crossed_swords:cdn_url+"/5ced7/img/unread/empty/emojione/crossed_swords.png",blush:cdn_url+"/5ced7/img/unread/empty/emojione/blush.png",candy:cdn_url+"/5ced7/img/unread/empty/emojione/candy.png",herb:cdn_url+"/5ced7/img/unread/empty/emojione/herb.png",sparkles:cdn_url+"/5ced7/img/unread/empty/emojione/sparkles.png",check_mark:cdn_url+"/5ced7/img/unread/empty/emojione/check_mark.png",confetti_ball:cdn_url+"/5ced7/img/unread/empty/emojione/confetti_ball.png",doughnut:cdn_url+"/5ced7/img/unread/empty/emojione/doughnut.png",bookmark_tabs:cdn_url+"/5ced7/img/unread/empty/emojione/bookmark_tabs.png",sleuth:{1:cdn_url+"/5ced7/img/unread/empty/emojione/sleuth_1.png",2:cdn_url+"/5ced7/img/unread/empty/emojione/sleuth_2.png",3:cdn_url+"/5ced7/img/unread/empty/emojione/sleuth_3.png",4:cdn_url+"/5ced7/img/unread/empty/emojione/sleuth_4.png",5:cdn_url+"/5ced7/img/unread/empty/emojione/sleuth_5.png",6:cdn_url+"/5ced7/img/unread/empty/emojione/sleuth_6.png"}}};var n=i[Math.floor(Math.random()*i.length)];var a=TS.prefs.getPref("emoji_mode");if("as_text"===a)a="default";var s=TS.prefs.getPref("preferred_skin_tone")||"1";var o=n.skintone?t[a][n.emoji][s]:t[a][n.emoji];n.emoji_url=o;var l=new Image;l.src=n.emoji_url;r=n};var p=function e(){if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.unread.$scroller);if(!TS.environment.supports_sticky_position){k();A();y()}};var S=function e(i){var t=TS.client.unread.getGroup(i.id);if(t)TS.client.ui.unread.updateHeader(t)};var T=function e(i){var t;if(TS.ui.react_emoji_menu.is_showing)return;var n=i.keyCode;var a=[TS.utility.keymap.space,TS.utility.keymap.pageup,TS.utility.keymap.pagedown,TS.utility.keymap.end,TS.utility.keymap.home];var r=a.concat([TS.utility.keymap.left,TS.utility.keymap.right,82]);if(-1===r.indexOf(n))return;var d=i.target;var c=$("#col_flex")[0].contains(d);var u=$(".client_channels_list_container")[0].contains(d);var m=TS.client.ui.unread.$scroller[0];var g=TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!c&&!u&&!m.contains(d);if(-1!==a.indexOf(n)&&g)m.focus();if(i.metaKey||i.ctrlKey||i.shiftKey)return;if(s&&s.isPending())return;if(!o&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!$("#messages_container .unread_empty_state").length&&!h&&!TS.client.ui.unread.$scroller.hasClass("transitioning")&&!TS.client.ui.unread.$unread_msgs_div.find(".collapsing").length){var p=TS.client.unread.getActiveGroup();if(n===TS.utility.keymap.right||n===TS.utility.keymap.left){f=true;i.preventDefault();var S=n===TS.utility.keymap.left;t=TS.client.unread.moveActiveMarker(S);if(t)v(t,p,{collapse_current_group:!S});else if(!TS.client.unread.areAllMessagesFetched()&&!S){var T=_.last(TS.client.unread.getAllGroups());if(T.id===p.id){l=true;var b=w(p);var y=b.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(p,y)}}}else if(82===n){f=true;if(p)if(p.marked_as_read)TS.client.ui.unread.markGroupAsUnread(p.id);else{o=true;TS.client.ui.unread.markGroupAsRead(p.id).then(function(){if(p.marked_as_read){t=TS.client.unread.moveActiveMarker();v(t,p)}else o=false})}}}};var v=function e(i,t,n){n=_.defaults(n,{collapse_current_group:false,scroll_and_expand:true});var a=function e(){var a=w(i);a.toggleClass("active",i.active&&f);TS.client.ui.unread.updateHeader(i);if(!i.marked_as_read)if(n.scroll_and_expand)TS.client.ui.unread.expandGroup(i);if(n.scroll_and_expand){var s=a.prev();if(t&&s.length&&s.data("model-id")===t.id){d=true;b(r)}else b(a)}o=false;return null};if(i){l=false;o=true;if(t){var r=w(t);if(n.collapse_current_group){var s=r.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(t,s,{scroll_group:false}).then(function(){r.toggleClass("active",t.active&&f);TS.client.ui.unread.updateHeader(t);a()})}else{r.toggleClass("active",t.active&&f);TS.client.ui.unread.updateHeader(t);a()}}else a()}else o=false;return null};var b=function e(i){if(!i.length)return;var t=i.closest(".monkey_scroller");if(!t.length)t=i.closest(":scrollable(vertical)");if(t.is("html"))t=$("body");t.scrollTop(Math.round(i[0].offsetTop-8))};var w=function e(i){return TS.client.ui.unread.$unread_msgs_div.find("[data-model-id="+i.model_ob.id+"]")};var y=function e(){var i=TS.client.ui.unread.$scroller.scrollTop();var n=TS.client.ui.unread.unread_groups.toArray();if(!n.length)return;var r=n.reduce(function(e,t){if(i+TS.client.ui.CLIENT_HEADER_OVERHANG>=t.y)return t;return e});if(TS.boot_data.feature_sli_briefing)if(n.length&&TS.client.ui.CLIENT_HEADER_OVERHANG<n[0].y&&i<n[0].y){if(t){t.find(".unread_group_header").css({top:"0",right:"auto"});t.removeClass("currently_sticky");t=null;if(TS.highlights_briefing.$briefing_header){TS.highlights_briefing.$briefing_header.addClass("sticky");TS.highlights_briefing.$briefing_view.addClass("sticky")}}return}else if(!t&&TS.highlights_briefing.$briefing_header&&TS.highlights_briefing.$briefing_view){TS.highlights_briefing.$briefing_header.removeClass("sticky");TS.highlights_briefing.$briefing_view.removeClass("sticky")}if(!r)return;var s=a-1;if(!t){t=r.$node;t.find(".unread_group_header").css({top:s,right:$("#col_flex").outerWidth()});t.addClass("currently_sticky")}if(t!==r.$node){t.find(".unread_group_header").css({top:"0",right:"auto"});t.removeClass("currently_sticky");t=r.$node;t.find(".unread_group_header").css({top:s,right:$("#col_flex").outerWidth()});t.addClass("currently_sticky")}if(!o&&!d){var l=TS.client.unread.getActiveGroup();if(l)if(t.data("model-id")!=l.id){var c=TS.client.unread.getGroup(t.data("model-id"));c=TS.client.unread.setActiveGroup(c);v(c,l,{collapse_current_group:false,scroll_and_expand:false})}}d=false};var A=function e(){var i=TS.client.ui.unread.$scroller.find(".unread_group");TS.client.ui.unread.unread_groups=i.map(function(e,i){return{$node:$(i),y:i.offsetTop}})};var k=function e(){a=$("#banner").height()};var C=function e(i){return{model_ob:i.model_ob,model_ob_id:i.model_ob.id,has_new_unreads:i.new_unread_cnt>0,unread_cnt:i.total_unreads||0,new_unread_cnt:i.new_unread_cnt,marked_as_read_cnt:i.marked_as_read_cnt||0,show_footer:i.new_unread_cnt>0,im_member:i.model_ob.is_im?TS.members.getMemberById(i.model_ob.user):{},marked_as_read:i.marked_as_read,collapsed:i.collapsed,active:f&&i.active,is_channel:i.model_ob.is_channel,is_group:i.model_ob.is_group,is_mpim:i.model_ob.is_mpim,is_im:i.model_ob.is_im,im_user:i.model_ob.user?TS.members.getMemberById(i.model_ob.user):null,supports_sticky_position:TS.environment.supports_sticky_position}};var M=function e(){if(!TS.client.unread.areAllMessagesFetched())return;var i=TS.client.unread.getAllGroups();var t=true;if(i.length)t=_.reduce(i,function(e,i){return e&&i.marked_as_read},i[0].marked_as_read);if(t)TS.client.ui.unread.displayEmptyState()};var I=function e(){h=false;TS.client.ui.unread.hideLoadingMessage();TS.client.ui.unread.$scroller.addClass("transitioning");TS.client.ui.unread.updateChannelHeader();TS.client.ui.unread.updateMsgs();TS.client.ui.unread.$scroller.removeClass("transitioning")};var x=function e(i,t,n){var a=TS.client.unread.getGroup(t);var r=a.model_ob;var s=TS.utility.msgs.getMarkMsgTSForUnreadPoint(i,a.msgs,r);var o=_.findIndex(a.msgs,{ts:s});var l=n.closest(".unread_group");l.find(".unread_divider").remove();l.find(".unread_day_container").removeClass("unread_day_container");if(!s)return false;a.manually_marked_unread_msg=i;TS.shared.markReadMsg(a.model_ob.id,s,TS.model.marked_reasons.back);TS.client.markLastReadsWithAPI();if(i===parseFloat(a.msgs[a.msgs.length-1].ts))return;var d=TS.templates.messages_unread_divider({label:TS.i18n.t("unread messages","all_unreads")()});var c=TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+a.msgs[o].ts+'"]');c.after(d);var u=n.closest(".unread_group").find(".unread_divider");if(u.next(".day_divider").length||u.is(":last-child")){u.addClass("adjacent_to_date");u.closest(".day_container").next(".day_container").addClass("unread_day_container")}return true};var E=function i(t){if(TS.model.unread_view_is_showing){var n=t.batch?t.batch:[t];_.each(n,function(i){TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(i,e)})})}}})()},4978:function(e,i){(function(){TS.registerModule("ui.message_container",{register:function e(i){if(!i.container){TS.error("TS.ui.message_container.register requires a container!");return}if(!i.updateCallback)i.updateCallback=_.noop;if(!i.msg_order)i.msg_order="asc";C(i);var t=M(i);var n=$(i.container);n.data("message-container-config",i);n.addClass("message_container");f(i,t);TS.attachment_actions.select.decorateNewElements(n);i._state=t;S(i);r(i);if(TS.client&&i.name)TS.client.ui.checkInlineImgsAndIframes(i.name)},cleanup:function e(i){var t=$(i.container);var n=t;if(i.scroller)n=$(i.scroller);n.off("scroll.message_container");if(i._pending_op)i._pending_op.cancel()},update:function i(t,n){e={added:[],removed:[],replaced:[]};var a=$(t.container);t._known_edits=n;if(t._range)C(t,t._range.start);else C(t);var r=M(t);var s=t._state;var o=T(s,r);var l;w(o,function(e){var i=e.item;if("continue"===e.action){l=a.children('[data-section-id="'+i.id+'"]');c(t,i)}else if("delete"===e.action)a.children('[data-section-id="'+i.id+'"]').remove();else if("insert"===e.action){var n=h(t,i);if(l&&l.length)l.after(n);else a.prepend(n);l=n}else if("append"===e.action){var r=h(t,i);a.append(r);l=r}});t._state=r;S(t);if(TS.client&&t.name)TS.client.ui.checkInlineImgsAndIframes(t.name);TS.attachment_actions.select.decorateNewElements(a);var d=a;if(t.scroller)d=$(t.scroller);TS.ui.utility.updateClosestMonkeyScroller(d);if(t.updated_sig)t.updated_sig.dispatch(e);if(t.page_size){var u=_.reduce(r,function(e,i){var t=i.msgs.length||1;return e+t},0);if(!t._pending_op&&u<2*t.page_size){var m;if(t.has_more_end&&t.promiseToLoadMoreAtEnd)m=t.promiseToLoadMoreAtEnd;else if(t.has_more_beginning&&t.promiseToLoadMoreAtBeginning)m=t.promiseToLoadMoreAtBeginning;if(m)t._pending_op=m().then(function(){TS.ui.message_container.updateWithFocus(t,a.find(".message_container_item").first());return null}).finally(function(){t._pending_op=null})}}var f=e;t.updateCallback(f);e=null;t._known_edits=null;return f},updateWithFocus:function e(i,t){if(!t||!t.length)return TS.ui.message_container.update(i);var n=$(t);var a;if(t.is("ts-message")){var r=t.find(".message_body");if(r.length)n=r}if(t.is("ts-thread")){var s=t.find("ts-message:first");if(s.length)n=s}TS.ui.utility.preventElementFromScrolling(n,function(){a=TS.ui.message_container.update(i);return null},function(){var e=$(i.container);if($.contains(e[0],n[0]))return n;var a=t.attr("id");t=e.find("#"+a);if(t.is("ts-message")){r=t.find(".message_body");if(r.length)return r}if(t.is("ts-thread")){s=t.find("ts-message:first");if(s.length)return s}return t});return a},maybeUpdateMessages:function e(i,t){var n=$(i.container);var a=i._state;_.forEach(a,function(e){var a=n.children('[data-section-id="'+e.id+'"]');var r=D(i,e.msgs);var s=a.find(".day_container");_.forEach(r,function(n){var a=n.length>0?n[0].ts:null;if(!a)return;var r=s.filter(function(){var e=$(this).attr("data-ts");var t=TS.interop.datetime.toDateObject(a);var n=TS.interop.datetime.toDateObject(e);return i.skip_day_groupings||TS.interop.datetime.isSameDay(t,n)});if(!r.length)return;var o=b(n,n,i.msg_order,t);m(i,e,r,n,o)})})},jumpToTop:function e(i){delete i._range;var t=$(i.container).find(".message_container_item").first();var n=TS.ui.message_container.updateWithFocus(i,t);t=$(i.container).find(".message_container_item").first();t.scrollintoview({offset:"top",px_offset:50});return n},jumpToEnd:function e(i){var t=P(i);C(i,t);var n=TS.ui.message_container.update(i);var a=$(i.container);if(i.scroller)a=$(i.scroller);a.scrollTop(a.prop("scrollHeight"));return n},jumpToTS:function e(i,t,n){var a=B(i);var r=t;if(n){var s=_.findIndex(a,{msg_ts:r});if(s>0){s=Math.max(0,s-n);r=a[s].msg_ts}}var o=_.find(a,{msg_ts:r});C(i,o);return TS.ui.message_container.update(i)},scrollintoview:function e(i,t,n){if(i._scrolling_into_view)return;i._scrolling_into_view=true;n=n||{};var a=n.complete;var r=function e(){i._scrolling_into_view=false;if(a)a.call(this)};n.complete=r;$("#"+t).scrollintoview(n)},getRange:function e(i){return i._range},pageUp:function e(i,t){if(!i._range||!i.page_size)return;I(i);TS.ui.message_container.updateWithFocus(i,t);if(i.afterPageUp){var n=Q(i);_.invoke(i,"afterPageUp",n)}},pageDown:function e(i,t){if(!i._range||!i.page_size)return;x(i);TS.ui.message_container.updateWithFocus(i,t);if(i.afterPageDown){var n=Q(i);_.invoke(i,"afterPageDown",n)}},test:function e(){return{resolveOrderedLists:y}}});var e;var i=false;var t=function i(t){if(!e)return;e.removed.push(t)};var n=function i(t){if(!e)return;e.added.push(t)};var a=function i(t){if(!e)return;e.replaced.push(t)};var r=function e(i){if(!i.page_size)return;var t=$(i.container);var n=H(i);var a=n.parent();var r=_.debounce(function(e){if(i._scrolling_into_view)return;var n=e.scrollTop;var r=e.scrollHeight;var d=a.height();var c=n+d;var _=r>3*d?.9:1;var u=c>.25*r;var m=0===n;var f=c>r*_;if(u)o(i);if(f)l(i,t);else if(m)s(i,t);if(TS.client)TS.client.ui.checkInlineImgsAndIframes(i.name)},250);n.on("scroll.message_container",function(){r(this)})};var s=function e(i,t){var n=B(i);if(!n.length)return;var a=t.find(".message_container_item").first();var r=_.first(n);var s=_.get(i,"_range.start");if(_.isEqual(r,s)){if(i.has_more_beginning&&i.promiseToLoadMoreAtBeginning){i._pending_op=i.promiseToLoadMoreAtBeginning().then(function(){TS.ui.message_container.pageUp(i,a)}).finally(function(){i._pending_op=null});return i._pending_op}}else TS.ui.message_container.pageUp(i,a)};var o=function e(t){if(!t._pending_op&&true!==i)if(t.has_more_end&&t.promiseToLoadMoreAtEnd){L("Start pre-emptive load of more messages",t);t._pending_op=t.promiseToLoadMoreAtEnd().then(function(){L("End pre-emptive load of more messages",t);t._pending_op=null;i=true});return t._pending_op}};var l=function e(t,n){var a=n.find(".message_container_item").last();if(i){L("Start appending loaded but not shown messages",t);i=false;d(t,a);L("End appending loaded but not shown messages",t)}else{if(!t._pending_op&&t.has_more_end&&t.promiseToLoadMoreAtEnd){L("Start load of more messages at append point",t);t._pending_op=t.promiseToLoadMoreAtEnd().then(function(){L("End load of more messages at append point",t);L("Start appending loaded messages at append point",t);t._pending_op=null;i=false;d(t,a);L("End appending loaded messages at append point",t)});return t._pending_op}if(t._pending_op)return t._pending_op.then(function(){if(i){L("Start appending loaded but not shown messages after pending",t);t._pending_op=null;i=false;d(t,a);L("End appending loaded but not shown messages after pending",t)}});L("Appending loaded and shown messages hidden by message_container at append point",t);d(t,a)}};var d=function e(i,t){TS.ui.message_container.pageDown(i,t);var n=Q(i);if(n)return;var a=H(i);if(0===a.scrollTop()){a.scrollTop(80);i.page_size*=2}};var c=function e(i,t){var n=$(i.container);var a=_.find(i._state,{id:t.id});if(!t){TS.error("TS.ui.message_container.update could not find section "+t.id+" to update.");return}if(!a){TS.error("TS.ui.message_container.update could not find section_state for "+t.id+" to update.");return}var r=n.children('[data-section-id="'+t.id+'"]');if(!r.length){TS.error("TS.ui.message_container.updateSection could not find section "+t.id);return}if(t.completeness){r.removeClass("complete partial_start partial_end");if(t.completeness.start&&t.completeness.end)r.addClass("complete");else{if(!t.completeness.start)r.addClass("partial_start");if(!t.completeness.end)r.addClass("partial_end")}}var s=D(i,t.msgs);var o=D(i,a.msgs);var l=v(o,s,i.msg_order,i.skip_day_groupings);u(i,t,r,s,o,l)};var u=function e(i,t,n,a,r,s){var o;var l=n.find(".msgs_holder");if(!l.length)l=n;var d=l.find(".day_container");var c=function e(t){return d.filter(function(){var e=$(this).attr("data-ts");var n=TS.interop.datetime.toDateObject(t);var a=TS.interop.datetime.toDateObject(e);return i.skip_day_groupings||TS.interop.datetime.isSameDay(n,a)})};var u=function e(t,n){return _.find(t,function(e){var t=e[0];return i.skip_day_groupings||TS.utility.msgs.areMsgsSameDay(t,n)})};var f=function e(t){if(i._known_edits)if(_.includes(i._known_edits,t.ts))return true};w(s,function(e){var n=e.item;var s=u(a,n);if("continue"===e.action){o=c(n.ts);var _=b(u(r,n),s,i.msg_order,f);m(i,t,o,s,_)}else if("delete"===e.action)c(n.ts).remove();else if("insert"===e.action){var h=g(i,t,u(a,n));if(o&&o.length)o.after(h);else if(d.length)d.first().before(h);else l.append(h);o=h}else if("append"===e.action){var p=g(i,t,u(a,n));l.append(p);o=p}})};var m=function e(i,r,s,o,l){var d;var c=s.find(".message_container_item");var _={};c.each(function(){var e=$(this).attr("data-ts");_[e]=this});var u={};var m={};var f;o.forEach(function(e){u[e.ts]=e;m[e.ts]=f;f=e});var h;w(l,function(e){var o=e.item;var l=o.ts;var f=e.action;if("edited"===f)f="replace";if("continue"===f&&("insert"===h||"delete"===h))f="replace";if("continue"===f)d=$(_[l]);else if("replace"===f){var g=$(_[l]);var S=p(i,u[l],m[l],r);g.replaceWith(S);a(S);d=S}else if("delete"===f){var T=$(_[l]);t(T);T.remove()}else if("insert"===f){var v=p(i,u[l],m[l],r);if(d&&d.length)d.after(v);else if(c.length)c.first().before(v);else s.append(v);n(v);d=v}else if("append"===f){var b=p(i,u[l],m[l],r);s.append(b);n(b);d=b}h=e.action})};var f=function e(i,t){var n=$(i.container);_.forEach(t,function(e){var t=h(i,e);n.append(t)})};var h=function e(i,t){var n=i.buildSection(t);var a=$(n);a.attr("data-section-id",t.id);if(t.completeness)if(t.completeness.start&&t.completeness.end)a.addClass("complete");else{if(!t.completeness.start)a.addClass("partial_start");if(!t.completeness.end)a.addClass("partial_end")}var r=a.find(".msgs_holder");if(!r.length)r=a;var s=D(i,t.msgs);_.forEach(s,function(e){var n=g(i,t,e);r.append(n)});return a};var g=function e(i,t,a){var r=a[0];var s=$('<div class="day_container" data-ts="'+r.ts+'"></div>');if(!i.skip_day_groupings){var o=$(i.buildDayDivider(t,r));s.append(o);n(o)}var l;var d=_.map(a,function(e){var n=p(i,e,l,t);l=e;return n});d.forEach(function(e){s.append(e);n(e)});return s};var p=function e(i,t,n,a){var r=i.buildMsgHTML(t,n,a);var s=$(r);s.addClass("message_container_item");return s};var S=function e(i){var t=$(i.container);var n=B(i);var a=_.first(n);var r=_.last(n);var s=i._range&&i._range.start;var o=i._range&&i._range.end;var l=i.has_more_beginning;if(!l)if(a&&s&&!_.isEqual(a,s))l=true;var d=i.has_more_end;if(!d)if(r&&o&&!_.isEqual(r,o))d=true;var c=TS.i18n.t("Loading more messages...","unread")();var u=t.find(".and_more_beginning");u.remove();if(l)t.prepend('<div class="and_more_beginning italic align_center large_top_margin large_bottom_margin">'+c+"</div>");var m=t.find(".and_more_end");m.remove();if(d)t.append('<div class="and_more_end italic align_center large_top_margin large_bottom_margin">'+c+"</div>");else t.find(".unread_group:last").addClass("at_bottom")};var T=function e(i,t){return y(i,t,function(e,i){var t=e.order||0;var n=i.order||0;return t-n})};var v=function e(i,t,n,a){var r=_.map(i,function(e){return e[0]});var s=_.map(t,function(e){return e[0]});return y(r,s,function(e,i){if(a||TS.utility.msgs.areMsgsSameDay(e,i))return 0;return F(n,e.ts,i.ts)})};var b=function e(i,t,n,a){return y(i,t,function(e,i){if(e.ts===i.ts)return 0;return F(n,e.ts,i.ts)},function(e,i){if(a){var t=a(e,i);if(!_.isUndefined(t))return t}return N(e,i)})};var w=function e(i,t){while(i){t(i);i=i.next}};var y=function e(i,t,n,a){var r=k(i,0);var s=k(t,0);return A(r,s,n,a)};var A=function e(i,t,n,a){if(!i&&!t)return null;if(!i)return{action:"append",item:t.item,next:e(i,t.next,n,a)};if(!t)return{action:"delete",item:i.item,next:e(i.next,t,n,a)};var r=n(i.item,t.item);if(0===r){if(a&&a(i.item,t.item))return{action:"edited",item:t.item,next:e(i.next,t.next,n,a)};return{action:"continue",item:t.item,next:e(i.next,t.next,n,a)}}if(r<0)return{action:"delete",item:i.item,next:e(i.next,t,n,a)};if(r>0)return{action:"insert",item:t.item,next:e(i,t.next,n,a)}};var k=function e(i,t,n){if(t>=i.length)return null;var a={item:i[t],prev:n};a.next=e(i,t+1,a);return a};var C=function e(i,t){if(!i.page_size)return;var n=B(i);if(!n.length)return;var a=2*i.page_size;var r={};var s=0;var o=i.msg_order;if(t){var l=false;s=_.findIndex(n,function(e){if(e.section_id===t.section_id){if(-1==e.msg_ts)return true;if(!l)l=true;return O(o,e.msg_ts,t.msg_ts)}if(l&&e.section_id!==t.section_id)return true;return false});if(s<0)s=0}var d=Math.min(a+s,n.length);r.start=n[s];r.end=n[d-1];if(s>0&&d-s<a){var c=a-(d-s);s=Math.max(0,s-c);r.start=n[s]}i._range=r};var M=function e(i){if(!i._range)return _.map(i.sections,function(e){var i=_.create(e);i.msgs=_.map(e.msgs,_.clone);i.completeness={start:true,end:true};return i});var t=[];var n=i._range.start;var a=i._range.end;_.forEach(i.sections,function(e){if(!E(e,i))return;var r=_.create(e);var s=U(i,e.msgs);r.msgs=_.filter(s,function(t){var r=i.msg_order;if(n.section_id===a.section_id)return O(r,t.ts,n.msg_ts)&&R(r,t.ts,a.msg_ts);if(e.id===n.section_id)return O(r,t.ts,n.msg_ts);else if(e.id===a.section_id)return R(r,t.ts,a.msg_ts);return true});if("desc"===i.msg_order)r.completeness={start:_.first(r.msgs)===_.first(s),end:_.last(r.msgs)===_.last(s)};else r.completeness={start:_.last(r.msgs)===_.last(s),end:_.first(r.msgs)===_.first(s)};if(e===_.first(i.sections)&&i.has_more_beginning)r.completeness.start=false;if(e===_.last(i.sections)&&i.has_more_end)r.completeness.end=false;r.msgs=_.map(r.msgs,_.clone);t.push(r)});return t};var I=function e(i){var t=B(i);var n=i._range;var a=i.msg_order;var r=_.takeWhile(t,function(e){return!(e.section_id===n.start.section_id&&O(a,e.msg_ts,n.start.msg_ts))});if(!r.length)return;var s=_.drop(t,r.length);var o=false;s=_.takeWhile(s,function(e){if(o)return false;var i=e.section_id===n.end.section_id&&O(a,e.msg_ts,n.end.msg_ts);if(i)o=true;return true});var l=_.takeRight(r,i.page_size);var d=_.take(s,s.length-l.length);n.start=_.first(l);n.end=_.last(d)};var x=function e(i){var t=B(i);var n=i._range;var a=i.msg_order;t=_.dropWhile(t,function(e){return!(e.section_id===n.start.section_id&&O(a,e.msg_ts,n.start.msg_ts))});var r=false;var s=_.takeWhile(t,function(e){if(r)return false;var i=e.section_id===n.end.section_id&&O(a,e.msg_ts,n.end.msg_ts);if(i)r=true;return true});var o=_.drop(t,s.length);if(!o.length)return;var l=_.take(o,i.page_size);var d=_.drop(s,l.length);n.start=_.first(d);n.end=_.last(l)};var E=function e(i,t){if(!t._range)return true;var n=false;var a;for(var r=0;r<t.sections.length;r+=1){a=t.sections[r];if(!n&&a.id===t._range.start.section_id)n=true;if(n&&a.id===i.id)return true;if(a.id===t._range.end.section_id)break}return false};var B=function e(i){var t=[];var n=i.msg_order;var a="asc"===n?_.forEachRight:_.forEach;_.forEach(i.sections,function(e){if(!e.msgs.length)t.push({section_id:e.id,msg_ts:"-1"});else{var n=U(i,e.msgs);a(n,function(i){t.push({section_id:e.id,msg_ts:i.ts})})}});return t};var P=function e(i){var t;_.findLast(i.sections,function(e){if(!e.msgs||!e.msgs.length)return false;var n;var a;if("asc"===i.msg_order){n=_.first(e.msgs);a=n?n.ts:null;t={section_id:e.id,msg_ts:a}}else{n=_.last(e.msgs);a=n?n.ts:null;t={section_id:e.id,msg_ts:a}}return true});return t};var D=function e(i,t){if(!t)return[];var n=i.msg_order;var a="asc"===n?_.forEachRight:_.forEach;var r;var s=[];var o=[];a(t,function(e){if(!i.skip_day_groupings&&(!r||!TS.utility.msgs.areMsgsSameDay(e,r))){if(o.length)s.push(o);o=[e]}else o.push(e);r=e});if(o.length)s.push(o);return s};var U=function e(i,t){if("desc"===i.msg_order)return t;var n=[];var a=[];var r;var s;var o;for(r=t.length-1;r>-1;r-=1){o=t[r];if(o.no_display)continue;if(o._hidden_reply&&!i.show_hidden_replies)continue;s=TS.utility.msgs.msgRollUpWorker(r,o,t,a);if("continue"===s)continue;else if("swap"===s){o=a[0];a.length=0}n.unshift(o)}return n};var F=function e(i,t,n){if("asc"===i){if(t<n)return-1;if(t>n)return 1}else{if(t>n)return-1;if(t<n)return 1}return 0};var O=function e(i,t,n){if("asc"===i)return t>=n;return t<=n};var R=function e(i,t,n){if("asc"===i)return t<=n;return t>=n};var N=function e(i,t){if(t.ts in TS.model.display_unsent_msgs)return true;var n=i.edited;var a=t.edited;if(i.is_ephemeral&&i.text!==t.text)return true;return!_.isEqual(n,a)||!_.isEqual(i.reply_count,t.reply_count)};var H=function e(i){var t=$(i.container);var n=t;if(i.scroller)n=$(i.scroller);return n};var Q=function e(i){var t=B(i);var n=_.first(t);var a=_.get(i,"_range.start");var r=_.isEqual(n,a);return r};var L=function e(i,t){var n=102;if(!TS.shouldLog(n))return;var a=B(t);var r=a.length;var s=t.sections.length;var o=t._range?_.findIndex(a,{msg_ts:t._range.start.msg_ts}):null;var l=t._range?_.findIndex(a,{msg_ts:t._range.end.msg_ts}):null;var d=t.has_more_end;TS.log(n,"[msg_container] "+i,{sections:s,messages:r,range_start:o,range_end:l,has_more_end:d})}})()},4979:function(e,i){(function(){TS.registerModule("client.ui.app_profile",{onStart:function e(){$('[data-js="app_profile_tab"]').on("click",'[data-js="app_profile_btn"]',TS.client.ui.app_profile.onButtonClick)},active_app:null,openWithApp:function t(a,r,s,o){if(!a)return;if(void 0==o)o=true;TS.client.ui.app_profile.active_app=a;e=TS.apps.constructTemplateArgsForCardAndProfile(a,r,null,s,o);TS.client.ui.flex.openAppProfileFlex(r||a.id);$('[data-js="app_profile_header"]').html(TS.templates.app_profile_title(e));i=$('[data-js="app_profile_scroller"]');i.html(TS.templates.app_profile(e));n();var l=i.find('[data-js="app_auth_settings"]');if(o&&!_.get(a,"is_slack_integration"))TS.apps.promiseToGetFullAppProfile(r,s,a.id,true).then(function(i){if(i.auth_summary_list){var t={name:e.name,auth_summary_list:i.auth_summary_list};l.html(TS.templates.app_profile_settings(t))}else l.hide()});else l.hide();TS.clog.track("APP_PROFILE_OPEN",{app_id:a.id,bot_id:r,contexts:{core:{app_id:a.id,bot_id:r}}})},onButtonClick:function e(i){var n=$(this);var a=n.data("action");if("open_overflow_menu"===a)TS.client.ui.app_profile.openOverflowMenu(i);else if("desc_expand"===a){t.removeClass("app_desc_expand_showing");setTimeout(function(){t.addClass("app_desc_collapse_showing")},300)}else if("desc_collapse"===a){t.removeClass("app_desc_collapse_showing");t.addClass("app_desc_expand_showing")}},openOverflowMenu:function i(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_items.html(TS.templates.menu_app_profile_items(e));TS.menu.start(t,true);var n=$(t.target);TS.menu.positionAt(n,n.width()-TS.menu.$menu.width(),n.height()+8);TS.menu.$menu_items.on("click.menu","li",TS.client.ui.app_profile.onOverflowMenuClick);TS.menu.keepInBounds()},onOverflowMenuClick:function e(){var i=$(this);var t=i.data("action");var n=TS.client.ui.app_profile.active_app;if("app_support"===t)TS.help_modal.start();var a=n.id;var r=n.bot_user?n.bot_user.id:"";TS.clog.track("USER_PROFILE_CLICK",{app_id:a,bot_id:r});TS.menu.end()}});var e;var i;var t;var n=function e(){t=i.find('[data-js="app_profile_desc"]');if(t.find('[data-js="app_profile_desc_inner"]').height()<=1.2*t.height())t.removeClass("app_desc_expand_showing");else t.css("max-height",t.find('[data-js="app_profile_desc_inner"]').height());i.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)})}})()},4980:function(e,i){(function(){TS.registerModule("channels_suggestions",{onStart:function e(){if(!TS.client)return;TS.client.login_sig.addOnce(function(){window.setTimeout(function(){TS.api.call("channels.suggestions",{}).then(_.noop)},3e4)})}})})()},4981:function(e,i){(function(){TS.registerModule("ui.replies",{$scroller:$("#convo_scroller"),onStart:function e(){if(!TS.client){TS.warn("TS.ui.replies only works in the client");return}TS.prefs.team_perms_pref_changed_sig.add(P);TS.client.flexpane_display_switched_sig.add(k);TS.ui.window_focus_changed_sig.add(q);TS.replies.sanity_check_failed_sig.add(H);TS.replies.reply_changed_sig.add(W);TS.replies.reply_deleted_sig.add(V);TS.channels.joined_sig.add(Q);TS.channels.left_sig.add(L);TS.groups.left_sig.add(G);TS.channels.archived_sig.add(j);TS.groups.archived_sig.add(j);TS.channels.unarchived_sig.add(j);TS.groups.unarchived_sig.add(j);TS.channels.history_fetched_sig.add(K);TS.groups.history_fetched_sig.add(K);TS.ims.history_fetched_sig.add(K);TS.mpims.history_fetched_sig.add(K);TS.view.members.unknown_resolution_rebuild_sig.add(z);TS.redux.socket.connectedSig.add(f);TS.channels.read_only.list_updated_sig.add(TS.ui.replies.refreshConversation);R=TS.utility.throttleFunc(R,250,true);h()},refreshConversation:function e(){var i=TS.ui.replies.activeConvoModelId();var t=TS.ui.replies.activeConvoThreadTs();if(!i||!t)return;var n=TS.shared.getModelObById(i);var a=TS.replies.getMessage(n,t);if(!a)return;r=TS.permissions.members.canPostInModelOb(TS.model.user,n)&&!n.is_archived;if(TS.boot_data.feature_default_shared_channels&&!r)r=TS.permissions.members.canThread(n);I(n,a)},openConversationFromMessagePane:function e(i,t,n,a,r){if(_.isString(t))t=TS.shared.getModelObById(t);var s=TS.client.ui.areMsgsScrolledToBottom();if(s){TS.ui.replies.openConversation(t,n,a,r);TS.client.ui.instaScrollMsgsToBottom()}else TS.ui.utility.preventElementFromScrolling(i,function(){TS.ui.replies.openConversation(t,n,a,r)})},openConversation:function e(i,t,n,r){try{if(!t){TS.error("openConversation called with bogus data; this is a programming error.");C();return}if(!TS.client){var s=TS.utility.msgs.constructConversationPermalink(i,t);window.location=s;return}if(_.isNumber(t)){TS.warn("Thread flexpane opened with non-string thread_ts");t+=""}TS.info("Opening conversation "+t+" in "+i.id);var o=!!a;y();A=true;TS.client.ui.flex.openConversationFlex(i,t);TS.ui.replies.maybeRenderReplies(i,t,n,r);TS.utility.msgs.startUpdatingRelativeTimestamps("#convo_container");if(o){D();d=true}else{$("#reply_container .message_input").addClass("hidden");d=false;TS.view.resize_sig.addOnce(function(){$("#reply_container .message_input").removeClass("hidden");D();d=true;c.dispatch()})}}catch(e){TS.error("Something went wrong when trying to open conversation "+t+" in "+_.get(i,"id")+": "+e);C()}finally{A=false}},maybeRenderReplies:function i(t,d,c,u){var m=TS.replies.getMessage(t,d);var f=$("ts-conversation");if(f.length){if(f.find("ts-message.selected").attr("data-ts")!=d){TS.warn("maybeRenderReplies called when same convo is already open");return Promise.resolve()}return Promise.reject(new Error("There is already a conversation open; only one can be open at a time"))}f=$(TS.templates.message_conversation({model_ob_id:t.id,thread_ts:d}));n=t.id;a=d;r=TS.permissions.members.canPostInModelOb(TS.model.user,t)&&!t.is_archived;if(TS.boot_data.feature_default_shared_channels&&!r)r=TS.permissions.members.canThread(t);s=[];if(u&&_.includes(l,u))o=u;else o=null;w(t,d,f);O(true);Z(m,t,d,f);TS.ui.message_container.register(e);M(f);if(m)I(t,m);var h=!!o;TS.ui.replies.toggleBackButton(h);var g;if(c)g=TS.replies.getThreadAround(t.id,d,c);else{var p=false;g=TS.replies.getThreadLazy(t.id,d,p)}return g.then(function(e){TS.ui.replies.finishRenderingReplies(t,d,m,e,c);return null}).catch(function(e){TS.console.logError(e,"replies_ui_error","threads");TS.error("Unable to get conversation around message thread_ts="+d+" with error: "+e);if(n!==t.id||a!==d)return;C()}).finally(function(){if(n!==t.id||a!==d)return;if(0===f.closest(".monkey_scroller").width())TS.ui.utility.updateClosestMonkeyScroller(TS.ui.replies.$scroller,true);O(false)})},finishRenderingReplies:function i(t,r,o,l,d){var c=l.messages;var _=!!l.has_more_beginning||!!l.has_more_end;if(n!=t.id)return;if(a!=r)return;TS.info("Rendering thread "+r+", "+c.length+" messages (has_more: "+_+")");s=c;if(S()){TS.client.ui.flex.hideFlex();return}if(!o){o=TS.utility.msgs.getMsg(r,c);o=l.root_msg;I(t,o)}Y(c,l.has_more_beginning,l.has_more_end);if(d)TS.ui.message_container.jumpToTS(e,d,m);else if(l.has_more_beginning)TS.ui.message_container.jumpToEnd(e);o=b(o,c);E(o);TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",t.id,r);if(d){var u=TS.templates.makeMsgDomIdInConversation(d);TS.ui.message_container.scrollintoview(e,u,{offset:"bottom",px_offset:-50,complete:function e(){U(u)}});$("#"+u).highlight(2500,"msg_highlighter")}else U();TS.replies.promiseToGetSubscriptionState(t.id,r).then(function(e){if(n!=t.id)return;if(a!=r)return;if(!e)return;TS.ui.replies.checkUnreads();return null});return null},maybeRemoveMessageFromConversation:function e(i,r){if(i.id!==n)return;if(r.thread_ts!=a&&r.ts!=a)return;var o=s&&_.find(s,{ts:r.ts});if(o)o.subtype="tombstone";if(S()){TS.client.ui.flex.hideFlex();return}var l=g();if(l.length&&r.ts==a){TS.ui.replies.maybeUpdateConversationWithMessage(i,r);return}var d=$('ts-conversation[data-thread-ts="'+r.thread_ts+'"]');if(!d.length)return;var c=d.find('ts-relatives ts-message[data-ts="'+r.ts+'"]');_.remove(s,{ts:r.ts});if(TS.utility.msgs.isMsgReply(r))_.remove(t.msgs,{ts:r.ts});if(r.is_pending)J();else if(c.length)c.addClass("delete_mode").slideUp(200,function(){J()});else J();E(_.find(s,{ts:r.thread_ts||r.ts}))},maybeUpdateConversationWithMessage:function r(o,l){if(o.id!==n)return;if(l.thread_ts!=a&&l.ts!=a)return;var d=s&&_.findIndex(s,{ts:l.ts});if(-1!==d)s[d]=l;else s.push(l);var c=false;if(TS.utility.msgs.isMsgReply(l)){var u=_.findIndex(t.msgs,{ts:l.ts});if(-1!==u)t.msgs[u]=l;else{c=true;var m=_.findIndex(t.msgs,function(e){return e.ts<l.ts});if(-1===m)t.msgs.push(l);else t.msgs.splice(m,0,l)}}else if(i.msgs.length)i.msgs[0]=l;else i.msgs.push(l);if(S()){TS.client.ui.flex.hideFlex();return}var f=TS.ui.replies.$scroller[0];var h=Math.abs(f.scrollHeight-f.offsetHeight-f.scrollTop);var g=50;var p=TS.ui.replies.$scroller.find("#reply_container");if(p.length)g=p.outerHeight(true);var T=h<g;var v=$('ts-conversation[data-thread-ts="'+(l.thread_ts||l.ts)+'"]');if(!v.length)return;var b=v.find('ts-message[data-ts="'+l.ts+'"]');var w;J([l.ts]);if(c&&T)TS.ui.message_container.jumpToEnd(e);w=v.find('ts-message[data-ts="'+l.ts+'"]');if(b.length)if(b.hasClass("hidden"))w.addClass("hidden");E(_.find(s,{ts:l.thread_ts||l.ts}));if(!b.length)TS.ui.replies.checkUnreads();if(T)f.scrollTop=f.scrollHeight-f.offsetHeight},updateMessageActions:function e(i,t){if(!TS.replies.canReplyToMsg(i,t)){if(i.is_channel&&!i.is_member)N(i,t);return}var n=t.thread_ts||t.ts;var a=$("#reply_container");a.empty();a.append(TS.ui.replies.getReplyInputAvatarHTML());TS.ui.inline_msg_input.make(a,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:TS.boot_data.feature_threads_api_stop_fe?false:["BKhere"],complete_cmds:true,in_thread:true,model_ob:i,jumbomoji:TS.prefs.getPref("jumbomoji"),onSubmit:function e(a,r){if(!TS.redux.socket.isConnected())return;if(i.is_archived){TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());return}var o=_.reject(s,p);if(!o.length)return;var l=_.maxBy(o,"ts");var d=TS.client.ui.maybeHandleReactionCmd(l,r,function(){TS.ui.replies.clearReplyInput(i,n)});if(d)return;if(TS.utility.msgs.shouldSendSlashCommand(r)){TS.ui.replies.clearReplyInput(i,n);TS.client.ui.sendSlashCommand(i,r,t)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",i.id,n);var c=$("#reply_container .reply_broadcast_toggle").prop("checked");if(TS.boot_data.feature_default_shared_channels&&c)c=TS.permissions.members.canPostInChannel(i);TS.ui.replies.clearReplyInput(i,n);var u=c?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY";var m=_.get(t,".reply_count",0)+1;TS.ui.thread.trackEvent(i.id,t.ts,"convo",u,{num_msg_in_thread:m});if(c)TS.log(2004,"Submitting broadcast from flexpane for "+i.id+"-"+t.ts);TS.utility.contenteditable.clogMentionCounts(r);TS.client.ui.sendMessage(i,r,t,c)}},getMsgDivForEditing:function e(){if(!s)return null;var i=_.reject(s,p);_.reverse(i);var t=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,i);if(!t)return null;return $('#convo_container ts-message[data-ts="'+t.ts+'"]')},onTextChange:function e(t){var a=TS.ui.replies.getReplyInputValueForStorage(t);TS.storage.storeReplyInput(i.id,n,a);var r=TS.ui.replies.$scroller[0];TS.ui.replies.maybeScrollReplyInputToBottomOfScroller(r)}});TS.ui.replies.bindReplyInputFocusEvents(a);x(i,n,a);var r=TS.storage.fetchReplyInput(i.id,n);if(r)TS.ui.replies.populateReplyInput(r)},getReplyInputAvatarHTML:function e(){var i=36;var t=false;var n=true;return TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,i,t,n)},bindReplyInputFocusEvents:function e(i){var t=i.find(".message_input");t.on("focusin",function(){i.addClass("has_focus")}).on("focusout",function(){var e=TS.utility.contenteditable.isEmpty(t,true);var n=document.activeElement===this||TS.utility.contenteditable.isActiveElement(this);if(e&&!n)i.removeClass("has_focus")})},maybeScrollReplyInputToBottomOfScroller:function e(i){var t=Math.abs(i.scrollHeight-i.offsetHeight-i.scrollTop);var n=t<50;if(n)i.scrollTop=i.scrollHeight-i.offsetHeight},getReplyInputValueForStorage:function e(i){var t=TS.utility.contenteditable.value(i);var n=!t.trim();var a=n?"":t;return a},checkReplyInputLengthAndUpdate:function e(i){var t=i.find(".message_input");var n=TS.msg_edit.isMessageTooLong(t);if(TS.boot_data.feature_message_input_byte_limit)i.find(".reply_container_info").toggleClass("no_opacity",n>0);else i.find(".reply_container_info").toggleClass("no_opacity",n)},submitReply:function e(i,t){if(!t||0===t.length)return;var n=t.closest("#reply_container, #file_reply_container").find("form");if(0===n.length)return;n.submit()},updateFlexpaneThreadDivider:function e(i,t){if(!i||!i.length)return;if(t){i.removeClass("hidden");var n=i.find(".reply_count");n.text(TS.i18n.t("{count, plural, =1 {# reply} other {# replies}}","threads")({count:t}))}else i.addClass("hidden")},activeConvoModelId:function e(){return n},activeConvoThreadTs:function e(){return a},activeConvoOrigin:function e(){return o},populateReplyInput:function e(i){var t=$("#reply_container .message_input");TS.utility.populateInput(t,i,i.length)},clearReplyInput:function e(i,t){TS.ui.replies.populateReplyInput("");TS.utility.contenteditable.clearHistory($("#reply_container .message_input"));TS.storage.storeReplyInput(i.id,t,"");$("#reply_container .reply_broadcast_toggle").attr("checked",false)},focusReplyInput:function e(i,t){var n=!i||F();if(n){TS.utility.contenteditable.focus($("#reply_container .message_input"));return}var a=t?document.getElementById(t):$("#convo_container")[0];var r=TS.interop.utility.firstFocusableChild(a);if(r)r.focus()},getActiveMessage:function e(i,t){if(i.id!=n)return null;return TS.utility.msgs.getMsg(t,s)},getActiveMessages:function e(){return s},toggleBackButton:function e(i){$("#convo_tab_back_container").toggleClass("hidden",!i)},joinChannelFromThread:function e(){if(!n||!a)return;var i=TS.shared.getModelObById(n);if(!i)return;var t=_.find(s,function(e){return e.ts===a});if(!t)return;TS.channels.joinById(i.id,function(){I(i,t)},{in_background:true});$("#reply_container .join_channel_from_thread").addClass("disabled")},checkUnreads:function e(){if(!TS.client.ui.isUserAttentionOnChat())return;if(!n||!a)return;if(!s||s.length<2)return;var i=TS.replies.getSubscriptionState(n,a);if(!i||!i.subscribed)return;var t=_.chain(s).filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)&&!p(e)}).map("ts").max().value();if(!t)return;if(!i.last_read||t>i.last_read)TS.replies.markThread(n,a,t);return null},rebuildMsgsIncludingMember:function i(t){if(!n||!a||!e)return;var r=TS.shared.getModelObById(n);if(!r)return;TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(t,e)})},maybeOpenConversationLink:function e(i,t){if(!i||!i.length)return false;var n=i.prop("hostname");var a=i.prop("pathname");if(!n||!a)return false;if(0!==a.indexOf("/conversation/"))return false;if(TS.utility.normalizeDevHost(n)!==TS.utility.normalizeDevHost(document.location.hostname))return false;var r=a.split("/");r=_.drop(r,1);if(3!==r.length)return false;var s=r[1];if(!s)return false;var o=TS.shared.getModelObById(s)||TS.channels.getChannelByName(s)||TS.groups.getGroupByName(s)||TS.mpims.getMpimByName(s);if(!o)return false;if(!(o.is_channel||o.is_group||o.is_im))return false;if(o.is_im&&TS.ims.isImWithDeletedMember(o))return false;var l=r[2];if(!l)return false;if(0!==l.indexOf("p"))return false;if(17!==l.length)return false;l=l.replace("p","");if(isNaN(l))return false;var d=l.substr(0,10)+"."+l.substr(10);TS.ui.replies.openConversation(o,d,null,t);return true},rebuildMsgCurrentStatusIncludingMember:function i(t){if(!n||!a)return;var r=TS.shared.getModelObById(n);if(!r)return;var s={member:t,for_message:true};var o=e._state;_.each(o,function(e){if(!e)return;_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){var i=$('ts-conversation[data-thread-ts="'+(e.thread_ts||e.ts)+'"]');if(!i.length)return;var n=i.find('ts-message[data-ts="'+e.ts+'"] .message_current_status');n.replaceWith(TS.templates.current_status(s))}})})}});var e;var i;var t;var n;var a;var r;var s;var o;var l=["mentions","search_results","starred_items","channel_page","group_page","im_page"];var d;var c=new signals.Signal;var u=false;var m=50;var f=function r(o){if(!u){u=true;return}if(o)return;if(!n||!a)return;var l=TS.shared.getModelObById(n);if(!l)return;var d=a;var c=_.maxBy(s,"ts");var m=_.get(c,"ts");if(!m)return;TS.replies.getThreadAfter(l.id,d,m).then(function(r){if(n!==l.id)return;if(a!==d)return;if(!r.messages.length)return;if(!i||!t)return;if(r.has_more)e.has_more_end=true;ee(t.msgs,r.messages,d);X();J()})};var h=function e(){TS.ui.replies.$scroller.scroll(function(){R()});TS.ui.replies.$scroller.click(function(){TS.ui.replies.checkUnreads()});var i=function e(i,t){TS.ui.messages.updateMessageHoverContainer(t);var n=i.shiftKey&&TS.interop.utility.lastFocusableChild(t[0]);if(n)$(n).focus().addClass("focus-ring")};var t=false;TS.ui.replies.$scroller.on("keyup",".message",function(e){if(e.keyCode!=TS.utility.keymap.tab)return;var n=$(e.currentTarget);if(n.hasClass("dirty_hover_container"))i(e,n);var a=e.target;var r=TS.ui.replies.$scroller.find(".message--focus").get(0);if(r&&r.contains(a)||n.hasClass("message--focus"))return;$(r).removeClass("message--focus");n.addClass("message--focus");t=true});$(document).on("focusin",function(e){var i=document.getElementById("convo_scroller");var n=i.querySelector(".message--focus");if(n&&!i.contains(e.target)){$(n).removeClass("message--focus");t=false}});$(document).on("mousemove",function(){if(t){$("#convo_scroller .message--focus").removeClass("message--focus");t=false}});$("#convo_tab").on("click","#convo_tab_back",function(){if("mentions"===o)TS.client.ui.flex.openFlexTab("mentions");else if("search_results"===o){TS.search.view.showResults();TS.search.view.maybeRebuildResults()}else if("starred_items"===o)TS.client.ui.flex.openFlexTab("stars");else if("channel_page"===o||"group_page"===o||"im_page"===o)TS.client.ui.flex.openFlexTab("details")})};var g=function e(){return $("ts-conversation ts-message.selected")};var p=function e(i){return"tombstone"===i.subtype};var S=function e(){var i=_.reject(s,p);return 0===i.length};var T=function e(i,t,n,a){if(p(t))return;return TS.templates.builders.msgs.buildHTML({msg:t,prev_msg:n,model_ob:i,is_in_conversation:true,highlight_as_new:a,relative_ts:true,enable_slack_action_links:true})};var v=function e(i,t){return TS.templates.builders.msgs.buildHTML({model_ob:i,msg:t,is_root_msg:true,is_in_conversation:true,full_date:true,enable_slack_action_links:true})};var b=function e(i,t){if(!i.replies)return i;for(var n=0;n<i.replies.length;n+=1){var a=i.replies[n];if(a&&"U00"===a.user){var r=_.find(t,{ts:a.ts});if(r&&r.bot_id)a.bot_id=r.bot_id;i.replies[n]=a}}return i};var w=function e(i,t,n){var a=$("#convo_tab");y();a.find("#convo_container").append(n)};var y=function n(){if(e){TS.ui.message_container.cleanup(e);e=null;i=null;t=null}$("#convo_tab #convo_container, #convo_tab #reply_container").empty();$("#thread_load_error_wrapper").remove();$("#convo_tab .thread_participants").empty()};var A=false;var k=function e(i,t){if(A)return;if(!TS.model.ui_state){TS.warn("TS.model.ui_state not available; ignoring this flexpane switch");return}var l=TS.model.ui_state.flex_name;var d=TS.model.ui_state.flex_extra;if("convo"===l&&"convo"===i&&d==t){var c=!$("#flex_contents #convo_container").is(":empty");if(c)return}if("convo"===i){y();n=void 0;a=void 0;r=void 0;s=void 0;o=void 0;TS.utility.msgs.stopUpdatingRelativeTimestamps("#convo_container")}if("convo"!==l)return;var _;var u;var m=(d||"").split("-");if(1==m.length){_=TS.shared.getActiveModelOb().id;u=m[0]}else{_=m[0];u=m[1]}if(!_||!u){TS.error("convo flex pane opened without thread_ts; ignoring");try{A=true;TS.client.ui.flex.hideFlex()}catch(e){}finally{A=false}return}var f=TS.shared.getModelObById(_);if(!f&&TS._incremental_boot){TS.redux.socket.connectedSig.addOnce(function(){f=TS.shared.getModelObById(_);TS.ui.replies.openConversation(f,u)});return}return TS.ui.replies.openConversation(f,u)};var C=function e(){if("convo"!==TS.model.ui_state.flex_name)return;y();B();$("#reply_container").addClass("hidden");var i={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f50d.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f50d.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f50d.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f50d.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f50d.png"};TS.ui.replies.$scroller.prepend(TS.templates.thread_flexpane_error({emoji:i[TS.prefs.getPref("emoji_mode")]}))};var M=function i(n){var r=_.find(s,{ts:a});if(!r)return;var o=_.get(t,"msgs.length",0);o=Math.max(r.reply_count||0,o);var l=o>0;n.find("ts-relatives.descendants").toggleClass("empty",!l);n.toggleClass("has_replies",l);var d=n.find(".convo_flexpane_divider");TS.ui.replies.updateFlexpaneThreadDivider(d,o);var c=true;if(e.has_more_end)c=false;else{var u=_(t.msgs).map("ts").max();if(u){var m=TS.ui.message_container.getRange(e);var f=_.get(m,"end.msg_ts");if(u>f)c=false}}var h=$("#reply_container");h.toggleClass("hidden",!c)};var I=function e(i,t){var n=true;if(!TS.replies.canReplyToMsg(i,t,n))return;if(r)TS.ui.replies.updateMessageActions(i,t);else $("#reply_container").html(TS.templates.reply_limited({channel_name:TS.shared.getDisplayNameForModelOb(i),is_archived:i.is_archived}));$("#reply_container").removeClass("hidden")};var x=function e(i,t,n){if(!i||!n||0===n.length)return;var a=TS.permissions.members.canPostInChannel(i);n.append(TS.templates.reply_broadcast_buttons({model_ob:i,label_id:t,view:"convo",can_post_back_to_channel:a}));var r=n.find(".reply_broadcast_label_container, .reply_send");r.mousedown(function(e){e.preventDefault();TS.ui.replies.focusReplyInput()}).click(TS.ui.replies.focusReplyInput);if(TS.console.shouldLog(2004)){var s=n.find(".reply_broadcast_toggle");s.change(function(){var e=$(this).prop("checked");if(e)TS.log(2004,"Broadcast toggle checked");else TS.log(2004,"Broadcast toggle un-checked")});s.closest("label").mousedown(function(){TS.log(2004,"mousedown on broadcast toggle")}).keydown(function(){TS.log(2004,"keydown on broadcast toggle")})}};var E=function e(i){if(!i)return;$("#convo_tab .thread_participants").html(TS.templates.builders.buildThreadParticipantListHTML(i))};var B=function e(){$("#convo_tab .thread_participants").text("")};var P=function e(){if(!n)return;var i=TS.shared.getModelObById(n);if(!i)return;var t=TS.permissions.members.canPostInModelOb(TS.model.user,i)&&!i.is_archived;if(TS.boot_data.feature_default_shared_channels&&!t)t=TS.permissions.members.canThread(i);if(t!==r){var s=TS.replies.getMessage(i,a);r=t;$("#reply_container").empty();I(i,s)}};var D=function e(){$("#reply_container .message_input").trigger("autosize-resize")};var U=function e(i){var t=$("#reply_container .message_input");if(TS.utility.isFocusOnInput()&&!TS.utility.contenteditable.isActiveElement(t[0]))return;var n=true;if(d)TS.ui.replies.focusReplyInput(n,i);else c.addOnce(function(){TS.ui.replies.focusReplyInput(n,i)})};var F=function e(){var i=$("#reply_container .message_input");return TS.client.ui.isElInView(i,0,TS.ui.replies.$scroller.dimensions_rect())};var O=function e(i){$("#convo_loading_indicator").toggleClass("hidden",!i)};var R=function e(){TS.ui.replies.checkUnreads()};var N=function e(i,t){var n=$("#reply_container");n.html(TS.templates.join_channel_from_thread({model_ob_name:i.name,is_convo:true,has_replies:!!t.reply_count}))};var H=function e(i,t,r,s,o){if(n!=i.id)return;if(a!=t.ts)return;Y(r,s,o)};var Q=function e(i){if(n!==i.id)return;TS.ui.replies.openConversation(i,a)};var L=function e(i){if(n!==i.id)return;TS.ui.replies.openConversation(i,a)};var G=function e(i){if(n!==i.id)return;TS.client.ui.flex.hideFlex()};var j=function e(i){if(n!==i.id)return;TS.ui.replies.openConversation(i,a)};var K=function e(t){if(t.id!==n)return;if(!s||!s.length)return;var a={};_.forEach(s,function(e,i){a[e.ts]=i});_.forEach(t.msgs,function(e){if(a.hasOwnProperty(e.ts)){var t=a[e.ts];s[t]=e}if(_.get(i,"msgs.length"))if(i.msgs[0].ts===e.ts)i.msgs[0]=e})};var W=function e(i,t){TS.ui.replies.maybeUpdateConversationWithMessage(i,t)};var V=function e(i,t){TS.ui.replies.maybeRemoveMessageFromConversation(i,t)};var q=function e(){TS.ui.replies.checkUnreads()};var z=function e(i){var t=i.batch?i.batch:[i];_.each(t,TS.ui.replies.rebuildMsgsIncludingMember)};var Y=function n(r,s,o){var l=_.find(r,{ts:a});var d=_.without(r,l);i.msgs.length=0;t.msgs.length=0;if(l)i.msgs.push(l);_.forEach(d,function(e){t.msgs.unshift(e)});e.sections.length=0;if(i.msgs.length)e.sections.push(i);e.sections.push(t);e.has_more_beginning=!!s;e.has_more_end=!!o;TS.utility.msgs.sortMsgs(t.msgs);X();J()};var J=function i(t){TS.ui.message_container.update(e,t)};var Z=function n(a,r,s,o){i={id:"root",order:0,msgs:[]};if(a)i.msgs.push(a);t={id:"replies",order:1,msgs:[]};e={name:"replies",container:o,scroller:TS.ui.replies.$scroller,page_size:m,sections:[i,t],has_more_beginning:false,has_more_end:false,skip_day_groupings:true,show_hidden_replies:true,buildSection:function e(i){if("root"===i.id)return TS.templates.message_conversation_root();return TS.templates.message_conversation_descendants()},buildMsgHTML:function e(i,t,n){if("root"===n.id)return v(r,i);return T(r,i)},updateCallback:function e(){M(o)},promiseToLoadMoreAtBeginning:function n(){var a=t.msgs;var o=_.minBy(a,"ts");var l=_.get(o,"ts");if(!l)return Promise.reject();return TS.replies.getThreadBefore(r.id,s,l).then(function(n){var a=n.root_msg;ee(t.msgs,n.messages,s);if(!n.has_more){e.has_more_beginning=false;i.msgs[0]=a;if(e.sections[0]!==i)e.sections.unshift(i)}X()})},promiseToLoadMoreAtEnd:function i(){var n=t.msgs;var a=_.maxBy(n,"ts");var o=_.get(a,"ts");if(!o)return Promise.reject();return TS.replies.getThreadAfter(r.id,s,o).then(function(i){ee(t.msgs,i.messages,s);if(!i.has_more)e.has_more_end=false;X()})}}};var X=function e(){s=_.flatten([i.msgs,t.msgs]);s=_.sortBy(s,"ts")};var ee=function e(i,t,n){var a=_.groupBy(i,"ts");_.forEach(t,function(e){if(e.ts===n)return;if(a[e.ts])return;i.push(e)});TS.utility.msgs.sortMsgs(i)}})()},4982:function(e,i){(function(){TS.registerModule("client.threads",{switched_sig:new signals.Signal,reply_count_changed:new signals.Signal,new_thread_reply_count_changed:new signals.Signal,threads_unread_changed:new signals.Signal,onStart:function i(){TS.redux.socket.connectedSig.add(h);TS.channels.message_received_sig.add(M);TS.groups.message_received_sig.add(M);TS.ims.message_received_sig.add(M);TS.mpims.message_received_sig.add(M);TS.channels.message_removed_sig.add(C);TS.groups.message_removed_sig.add(C);TS.ims.message_removed_sig.add(C);TS.mpims.message_removed_sig.add(C);TS.channels.message_changed_sig.add(k);TS.groups.message_changed_sig.add(k);TS.ims.message_changed_sig.add(k);TS.mpims.message_changed_sig.add(k);TS.replies.sanity_check_failed_sig.add(Q);TS.replies.thread_subscription_changed_sig.add(U);TS.channels.joined_sig.add(K);TS.groups.joined_sig.add(K);TS.groups.left_sig.add(j);c=TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1);e=new TS.PromiseQueue},showThreadsView:function i(s,o){s=!!s;o=!!o;var l=o?false:s;var d=TS.client.threadsViewActivated(o,l);if(d)TS.client.threads.switched_sig.dispatch();else return false;if(TS.msg_edit.editing_in_msg_pane)TS.msg_edit.resetEditUI();TS.client.ui.threads.showThreadsView();if(TS.boot_data.feature_threads_api_stop_fe&&t){TS.console.logError("Starting All Threads with potentially stale data, force clearing cache",null,"threads");g()}if(t){TS.interop.console.info("ALL THREADS","Starting threads view with local threads data");r=W();y();TS.client.ui.threads.startWithData(t,n);R(a);p(r)}else{TS.interop.console.info("ALL THREADS","Starting threads view from the api");e.addToQ(S)}return true},destroyThreadsView:function e(){if(!$("#client-ui").hasClass("threads_view_is_showing"))return;TS.client.ui.threads.destroyThreadsView();if(i&&i.isPending())i.cancel();i=null;a=0;r=null;clearTimeout(m);if(u||!t||!t.length){u=false;g()}if(TS.boot_data.feature_threads_api_stop_fe){TS.interop.console.info("ALL THREADS","destroying threads view, clearing threads data");g()}},maybeReloadThreadsView:function i(){if(!TS.model.threads_view_is_showing)return;TS.client.ui.threads.resetUI();e.addToQ(S)},getMessage:function e(i,n){if(!t)return null;var a=null;_.find(t,function(e){if(e.model_ob.id!=i.id)return false;if(n==e.root_msg.ts){a=e.root_msg;return true}a=_.find(e.replies,{ts:n.toString()});return!!a});return a},getThread:function e(i,n){if(!t)return;return _.find(t,function(e){return e.model_ob.id===i.id&&e.root_msg.ts===n})},getCurrentReplyCount:function e(){return a||0},getNewThreadReplyCount:function e(){var i=_.takeWhile(t,function(e){return H(e)});if(!i||!i.length)return 0;var n=_.reduce(i,function(e,i){var t=_.reduce(i.replies,function(e,i){return i.ts>=r?e+1:e},0);return e+t},0);return n},updateThreadState:function e(i,t,n,a){var r=G();TS.client.threads.setThreadsUnreadData(i,t+r,n,a);TS.client.threads.logThreadState("update_thread_state: "+!!i+" "+(t+r)+" "+n)},setThreadsUnreadData:function e(i,t,n,a){TS.model.threads_mention_counts=_.reduce(a,function(e,i,t){if(TS.shared.getModelObById(t))e[t]=i;return e},{});TS.model.threads_has_unreads=i;if(TS.boot_data.feature_less_light_up)TS.model.threads_mention_count=_.sum(_.values(a));else TS.model.threads_mention_count=t||0;if(!TS.model.threads_has_unreads&&TS.model.threads_mention_count){TS.warn("Ignoring positive threads_mention_count because threads_has_unreads == false");TS.model.threads_mention_count=0}TS.utility.msgs.countAllUnreads();if(n)l=n;if(!TS.client.threads.hasUnreadThreads()&&TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRemoveNewRepliesBanner();TS.client.threads.threads_unread_changed.dispatch()},setThreadsUnreadDataFromUsersCounts:function e(i,t,n){TS.client.threads.setThreadsUnreadData(i,t,null,n);TS.client.threads.logThreadState("users.counts: "+!!i+" "+t)},markAllNewThreads:function e(){_.forEach(t,function(e){var i=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(!i||!i.subscribed)return;var t=i.last_read;if(!t||t<e.ts)TS.replies.markThread(e.model_ob.id,e.root_msg.thread_ts,e.ts)});if(!TS.client.threads.hasUnreadThreads()&&TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRemoveNewRepliesBanner()},hasUnreadThreads:function e(){return _.some(t,function(e){var i=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(!i||!i.subscribed)return;var t=i.last_read;if(!t||t<e.ts)return true})},showNewRepliesAndMarkThread:function i(n,a){if(!t)return;var r=TS.shared.getModelObById(n);if(!r)return;var s=TS.client.threads.getThread(r,a);if(!s)return;e.addToQ(function(){if(!TS.model.threads_view_is_showing)return;s.max_visible_ts=_.last(s.replies).ts;TS.client.ui.threads.revealNewReplies(s);var e=_.maxBy(s.replies,"ts").ts;TS.replies.markThread(n,a,e);return null})},showPreviousReplies:function i(n,a){if(!t)return;var r=TS.shared.getModelObById(n);if(!r)return;var s=TS.client.threads.getThread(r,a);if(!s)return;var o;var l=_.get(s,"replies.length")&&_.first(s.replies).ts;var d=_.get(s,"root_msg.reply_count",0);if(l&&d>TS.replies.DEFAULT_HISTORY_API_LIMIT)o=TS.replies.getThreadBefore(n,a,l);else{var c=true;o=TS.replies.getThreadLazy(n,a,c)}return e.addToQ(function(){if(!TS.model.threads_view_is_showing)return;o.then(function(e){if(!TS.model.threads_view_is_showing)return;var i=e.messages;var t=Infinity;if(s.replies&&s.replies.length)t=_.first(s.replies).ts;s.min_visible_ts=t;s.replies=s.replies.concat(_.reject(i,{ts:s.root_msg.ts}));s.replies=_.uniqBy(s.replies,"ts");s.replies=_.sortBy(s.replies,"ts")});TS.client.ui.threads.revealPreviousReplies(s,o);return o})},loadMoreThreads:function i(){return e.addToQ(T)},threadCompare:function e(i,t){if("new"===i.grouping&&"old"===t.grouping)return-1;if("old"===i.grouping&&"new"===t.grouping)return 1;if(i.ts<t.ts)return 1;if(i.ts>t.ts)return-1;return 0},maybeRerenderMessage:function i(t,n){if(!TS.model.threads_view_is_showing)return;if(!t||!n.thread_ts)return;e.addToQ(function(){var e=TS.client.threads.getThread(t,n.thread_ts);if(!e)return;P(e,n)})},debugUnthreads:function e(){var i="\n"+f.join("\n");TS.info(i)},logThreadState:function e(i){if(TS.has_pri[V])TS.log(V,"unread thread state change: "+i);var t=TS.interop.datetime.toTime(Date.now()/1e3,{includeMeridiem:false,includeSeconds:true});f.unshift(t+" "+i);f=_.take(f,15)},getThreadsLoadedCount:function e(){return t?t.length:0}});var e;var i;var t;var n=false;var a=0;var r;var s;var o=8;var l="0000000000.000000";var d=[];var c;var u=false;var m;var f=[];var h=function e(i){if(i)return;g();TS.client.threads.maybeReloadThreadsView()};var g=function i(){e.clear();t=null};var p=function e(i){if(TS.client.threads.hasUnreadThreads()){TS.replies.markAllThreads(i);if(!TS.model.threads_has_unreads)TS.metrics.count("threads_unread_inconsistency_no_local_unreads")}else if(TS.model.threads_has_unreads){TS.metrics.count("threads_unread_inconsistency_has_local_unreads");TS.warn("Correcting threads_has_unreads: was true but threads view has no new replies");TS.client.threads.setThreadsUnreadData(false,0);TS.client.threads.logThreadState("_markAllThreadsAfterLoading: false 0")}};var S=function e(){if(c)TS.metrics.mark("threads_view_time_to_fetch_and_display");r=W();clearTimeout(m);m=setTimeout(function(){TS.client.ui.threads.displaySlowLoadingMessage()},5e3);i=TS.api.call("subscriptions.thread.getView",{current_ts:r,limit:o});return i.then(v).then(function(e){var i=e.total_unread_replies;var n=e.has_more;if(TS.model.threads_view_is_showing)TS.client.ui.threads.startWithData(t,n);R(i);if(TS.model.threads_view_is_showing)p(r);if(c)TS.metrics.measureAndClear("threads_view_time_to_fetch_and_display","threads_view_time_to_fetch_and_display");return e}).catch(b)};var T=function e(){if(i&&i.isPending())i.cancel();var n=_.last(t).ts;clearTimeout(m);m=setTimeout(function(){TS.client.ui.threads.displaySlowLoadingMessage()},5e3);i=TS.api.call("subscriptions.thread.getView",{current_ts:n,limit:o});return i.then(v).catch(b)};var v=function e(i){TS.interop.console.info("ALL THREADS","Processing subscriptions.thread.getView response");clearTimeout(m);var a=i.data;var r=a.threads;var s=a.total_unread_replies||0;var l=a.has_more;n=l;if(l&&r.length<o)TS.error("subscriptions.thread.getView returned fewer threads than the limit but has_more is true");r=_.filter(r,function(e){if(!e.root_msg){TS.error("Missing root_msg in subscriptions.thread.getView response");return false}if(!e.root_msg.thread_ts){TS.error("root_msg has no thread_ts in subscriptions.thread.getView response");return false}var i=e.root_msg.channel;if(!i){TS.error("No c_id in subscriptions.thread.getView response");return false}e.model_ob=TS.shared.getModelObById(i);if(!e.model_ob){TS.error("No channel with c_id "+i+" in subscriptions.thread.getView response");return false}e.root_msg=TS.utility.msgs.processImsg(e.root_msg,i);if(false===e.root_msg._subscribed){TS.error("Got a thread that is not subscribed to in subscriptions.thread.getView response: "+e.root_msg.thread_ts);return false}e.replies=[];if(e.latest_replies){e.latest_replies=_.map(e.latest_replies,function(e){return TS.utility.msgs.processImsg(e,i)});e.latest_replies=_.sortBy(e.latest_replies,"ts");e.replies=e.replies.concat(e.latest_replies)}if(e.unread_replies){e.unread_replies=_.map(e.unread_replies,function(e){return TS.utility.msgs.processImsg(e,i)});e.unread_replies=_.sortBy(e.unread_replies,"ts");e.replies=e.replies.concat(e.unread_replies)}if(e.replies.length){e.ts=_.last(e.replies).ts;if(e.unread_replies)e.grouping="new";else{e.ts=e.ts;e.grouping="old"}var t=_.uniqBy(e.replies,"ts");if(t.length!==e.replies.length){TS.error("Removing duplicate replies in subscriptions.thread.getView response for "+e.ts);e.replies=t}}else{e.ts=e.root_msg.ts;e.grouping="old"}e.initial_last_read=e.root_msg._last_read||0;TS.replies.maybeSlurpSubscriptionState(e.model_ob.id,[e.root_msg]);return true});if(!t)t=[];t=t.concat(r);var d=_.uniqBy(t,function(e){return e.model_ob.id+e.root_msg.ts});if(d.length!==t.length){TS.error("Removing duplicate threads in subscriptions.thread.getView response");t=d}A(t);return{total_unread_replies:s,has_more:l,threads:t}};var b=function e(i){TS.error("Threads view error during loading:");TS.error(i);var t=_.get(i,"data.error");if(!t)t=_.get(i,"message");if(!t)t=i;if(!_.isString(t))t=JSON.stringify(t);TS.error(t);var n=_.get(i,"stack");if(n)TS.error(JSON.stringify(n));TS.console.logError(i,"threads_view_fatal_error");clearTimeout(m);g();TS.client.ui.threads.displayFatalError()};var w=function e(i,t,n){var a=TS.replies.getSubscriptionState(i.id,t.ts);var r=_.filter(n,function(e){return!a.last_read||e.ts>a.last_read});var s=_.filter(n,function(e){return a.last_read&&e.ts<=a.last_read});var o={model_ob:i,root_msg:t,replies:[]};if(s.length&&!r.length){o.replies=_.takeRight(s,2);s=_.dropRight(s,2)}else if(s.length){o.replies.push(_.last(s));s=_.dropRight(s,1)}if(s.length){var l=t.reply_count-o.replies.length;if(l>0&&l<3&&s.length===l)o.replies=s.concat(o.replies)}if(r.length)o.replies=o.replies.concat(r);if(o.replies.length){o.ts=_.last(o.replies).ts;if(r.length)o.grouping="new";else o.grouping="old"}else{o.ts=t.ts;o.grouping="old"}o.initial_last_read=a.last_read||0;return o};var y=function e(){if(!t)return;t=_(t).map(function(e){var i=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(!i||!i.subscribed)return null;if(e.model_ob.is_channel&&!e.model_ob.is_member)return null;var t=w(e.model_ob,e.root_msg,e.replies);return t}).compact().value();t.sort(TS.client.threads.threadCompare);var i=t.length;t=_.take(t,o);if(i>t.length)n=true;O()};var A=function e(i){var t=_.map(i,"ts");i.sort(TS.client.threads.threadCompare);if(!_.isEqual(t,_.map(i,"ts")))TS.warn("Threads out of order; fixed in client")};var k=function i(n,a){if(!t||!n||!a)return;if(!a.thread_ts)return;e.addToQ(function(){var e=TS.client.threads.getThread(n,a.thread_ts);if(!e)return;return P(e,a)})};var C=function i(n,a){if(!t||!n||!a)return;if(!a.thread_ts)return;e.addToQ(function(){var e=x(n,a);if(TS.model.threads_view_is_showing&&e)TS.client.ui.threads.maybeRemoveMessageFromThread(n,a)})};var M=function i(t,n){if(!t||!n)return;if(!n.is_ephemeral&&!TS.utility.msgs.isTempMsg(n))if(!s||n.ts>s)s=n.ts;if(TS.boot_data.feature_threads_api_stop_fe&&!TS.model.threads_view_is_showing)return;if(!n.thread_ts)return;if(!TS.utility.msgs.isMsgReply(n))return;e.addToQ(function(){return TS.replies.promiseToGetSubscriptionState(t.id,n.thread_ts).then(function(e){if(!e||!e.subscribed)return;if(!TS.boot_data.feature_threads_api_stop_fe)I(t,n,e);var i=TS.client.threads.getThread(t,n.thread_ts);if(i)return B(i,n);return D(t,n.thread_ts)})})};var I=function e(i,t){if(t.ts<=l)return;var n=i.id===TS.ui.replies.activeConvoModelId()&&t.thread_ts===TS.ui.replies.activeConvoThreadTs()&&TS.client.ui.isUserAttentionOnChat();if(n)return;if(!F(t))return;var a=true;var r=1e3*parseFloat(t.ts);var s="away"===TS.model.user.presence;var o=s||r<TS.model.user._presence_last_changed;var d=TS.model.here_regex.test(t.text)&&!o;var c=TS.utility.msgs.getMsgMentionData(t).non_channel_mentions;var _=c||d?TS.model.threads_mention_count+1:TS.model.threads_mention_count;if(TS.model.threads_has_unreads===a&&TS.model.threads_mention_count===_)return;var u=TS.model.threads_mention_counts;u[i.id]=u[i.id]||0;if(c||d)u[i.id]+=1;TS.client.threads.setThreadsUnreadData(a,_,null,u);if(d&&!c)L(i.id,t.thread_ts,t.ts);TS.client.threads.logThreadState("message_received: "+!!a+" "+_+" "+i.id+" "+t.thread_ts+" "+t.ts)};var x=function e(i,n){if(!t||!i||!n)return;var s=TS.client.threads.getThread(i,n.thread_ts);if(!s)return false;if(n.ts===n.thread_ts){TS.error("Attempting to remove remove root msg from thread instead of converting it to tombstone");return false}var o=false;var l=_.findIndex(s.replies,{ts:n.ts});if(-1!==l){s.replies.splice(l,1);o=true}var d=_.findIndex(s.root_msg.replies,{ts:n.ts});if(-1!==d){s.root_msg.replies.splice(l,1);o=true}if(parseFloat(n.ts)>r){R(a-1);N()}if(!s.replies.length&&!_.get(s.root_msg,"replies.length")){E(i,s);return o}var c=_.findIndex(s.unread_replies,{ts:n.ts});if(-1!==c)s.unread_replies.splice(c,1);var u=_.findIndex(s.latest_replies,{ts:n.ts});if(-1!==u)s.latest_replies.splice(u,1);return o};var E=function e(i,n){if(!t||!n)return;t=_.without(t,n);if(TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRemoveThread(i,n)};var B=function e(i,n){if(!t||!i||!n)return;var r=_.findIndex(i.replies,{ts:n.ts});if(-1!==r)return;if(!i.max_visible_ts&&F(n))i.max_visible_ts=i.replies.length?_.last(i.replies).ts:i.root_msg.ts;i.replies.push(n);i.replies=_.sortBy(i.replies,"ts");var s=false;if(!F(n)){s=true;i.max_visible_ts=_.last(i.replies).ts}if(TS.model.threads_view_is_showing)TS.client.ui.threads.maybeUpdateThreadWithMessage(i,n,s);if("old"===i.grouping)TS.client.ui.threads.hideCaughtUpDivider();R(a+1);N();return null};var P=function e(i,n){if(!t||!i||!n)return;var a=false;if(n.ts===n.thread_ts){i.root_msg=n;a=true}var r=_.findIndex(i.replies,{ts:n.ts});if(-1!==r){i.replies.splice(r,1,n);a=true}if(TS.model.threads_view_is_showing&&a)TS.client.ui.threads.maybeUpdateThreadWithMessage(i,n)};var D=function e(i,n){if(!t||!i||!n)return;var r=TS.client.threads.getThread(i,n);if(r)return;var s=true;var o=TS.replies.getThreadLazy(i.id,n,s);return o.then(function(e){var n=e.root_msg;var r=_.filter(e.messages,TS.utility.msgs.isMsgReply);var s=w(i,n,r);var o=TS.replies.getSubscriptionState(i.id,n.ts);var l=s.replies.filter(function(e){return!o.last_read||e.ts>o.last_read}).length;t.unshift(s);t.sort(TS.client.threads.threadCompare);if(TS.model.threads_view_is_showing)TS.client.ui.threads.insertNewThread(s);R(a+l);N();return null})};var U=function i(n,a,r){if(!t||!n||!a)return;if(!r.subscribed)return;var s=TS.shared.getModelObById(n);if(!s)return;e.addToQ(function(){var e=TS.client.threads.getThread(s,a);if(e)return;D(s,a)})};var F=function e(i){return!(i.user===TS.model.user.id||i.is_ephemeral)};var O=function e(){a=0;_.each(t,function(e){var i=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.ts);var t=_.filter(e.replies,function(e){return!i.last_read||e.ts>i.last_read});a+=t.length});R(a)};var R=function e(i){a=i;TS.client.threads.reply_count_changed.dispatch(a)};var N=function e(){if(!TS.model.threads_view_is_showing)return;var i=TS.client.threads.getNewThreadReplyCount();if(i)TS.client.threads.new_thread_reply_count_changed.dispatch(i)};var H=function e(i){var t=TS.replies.getSubscriptionState(i.model_ob.id,i.root_msg.thread_ts);if(!t)return true;return!t.last_read||i.ts>t.last_read};var Q=function i(t,n,a,r,s){if(s)return;e.addToQ(function(){var e=TS.client.threads.getThread(t,n.ts);if(!e)return;e.replies=_.reject(a,{ts:e.root_msg.ts});if(TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRedrawThread(e)})};var L=function e(i,t,n){var a=TS.replies.getSubscriptionState(i,t);if(!a||!a.subscribed)return;if(a.last_read&&a.last_read>=n)return;d.push({model_ob_id:i,thread_ts:t,msg_ts:n})};var G=function e(){_.remove(d,function(e){var i=TS.shared.getModelObById(e.model_ob_id);if(!i)return true;if(i.is_channel&&!i.is_member)return true;var t=TS.replies.getSubscriptionState(e.model_ob_id,e.thread_ts);if(!t||!t.subscribed)return true;if(t.last_read&&t.last_read>=e.msg_ts)return true;return false});return d.length};var j=function e(i){if(!t)return;var n=_.filter(t,function(e){return e.model_ob.id===i.id});_.forEach(n,function(e){E(i,e)})};var K=function e(){if(!t)return;if(TS.model.threads_view_is_showing)u=true;else g()};var W=function e(){var i;if(s)i=parseFloat(s);var t=Math.floor(Date.now()/1e3);if(!i){if(TS.has_pri[V])TS.log(V,"Starting threads view with current time because !_max_ts");return t}if(t>s){if(TS.has_pri[V])TS.log(V,"Starting threads view with current time because it is greater than _max_ts");return t}i+=1;if(TS.has_pri[V])TS.log(V,"Starting threads view with "+i+" because it is greater than the current time");return i};var V=2004})()},4983:function(e,i){(function(){TS.registerModule("client.ui.threads",{$scroller:$("#threads_msgs_scroller_div"),$container:null,started_sig:new signals.Signal,ended_sig:new signals.Signal,onStart:function e(){TS.prefs.team_perms_pref_changed_sig.add(w);TS.prefs.emoji_mode_changed_sig.add(S);TS.channels.joined_sig.add(b);TS.channels.left_sig.add(b);TS.groups.left_sig.add(b);TS.channels.archived_sig.add(b);TS.groups.archived_sig.add(b);TS.channels.unarchived_sig.add(b);TS.groups.unarchived_sig.add(b);TS.client.threads.new_thread_reply_count_changed.add(g);TS.channels.read_only.list_updated_sig.add(u);t=new TS.PromiseQueue},showThreadsView:function e(){$("#client-ui").addClass("threads_view_is_showing");TS.client.ui.threads.$scroller.addClass("loading");TS.client.ui.threads.$scroller.addClass("emojimode_"+TS.prefs.getPref("emoji_mode"));$("#footer").addClass("hidden");TS.client.archives.cancel(true);TS.client.ui.threads.$scroller.attr("tabindex","-1");TS.client.ui.rebuildAllButMsgs();TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vall_threads"));if("details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(true);var i=true;TS.client.msg_pane.hideNewMsgsBar(i);TS.client.ui.threads.$container=$('<div id="threads_msgs"></div>');TS.client.ui.threads.$container.appendTo(TS.client.ui.threads.$scroller);TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback");if(!TS.environment.supports_custom_scrollbar)TS.client.ui.threads.$scroller.monkeyScroll();$("#threads_view_banner").removeClass("hidden");TS.utility.msgs.startUpdatingRelativeTimestamps("#threads_msgs");k();TS.clog.track("THREADS_VIEW_OPEN",{view_session_index:a});TS.client.ui.threads.incrementTrackingSeqId();TS.client.ui.threads.started_sig.dispatch()},isThreadsViewDOMShowing:function e(){return $("#client-ui").hasClass("threads_view_is_showing")},destroyThreadsView:function e(){TS.client.ui.threads.resetUI();TS.client.ui.threads.$scroller.off("scroll.threads_view_scroll");TS.client.ui.threads.$scroller.empty();$("#client-ui").removeClass("threads_view_is_showing");T();$("#footer").removeClass("hidden");TS.client.ui.threads.$container=null;TS.utility.msgs.stopUpdatingRelativeTimestamps("#threads_msgs");if(!r)TS.client.ui.threads.trackThreadsViewClosed("OTHER");$(window).off("keydown.threads");TS.client.ui.threads.ended_sig.dispatch()},resetUI:function i(){t.clear();p();if(e){TS.ui.message_container.cleanup(e);e=null}TS.client.ui.threads.$container.empty();$(".threads_alternative_view_wrapper").remove();TS.client.ui.threads.$scroller.addClass("loading")},displayEmptyState:function e(){if(!TS.model.threads_view_is_showing)return;var i={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f331.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f331.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f331.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f331.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f331.png"};var t={emoji:i[TS.prefs.getPref("emoji_mode")],is_empty:true};TS.client.ui.threads.displayAlternativeThreadsView(t)},displayFatalError:function e(){if(!TS.model.threads_view_is_showing)return;var i={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f420.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f420.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f420.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f420.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f420.png"};var t={emoji:i[TS.prefs.getPref("emoji_mode")],is_error:true};TS.client.ui.threads.displayAlternativeThreadsView(t)},displayAlternativeThreadsView:function e(i){TS.client.ui.threads.$scroller.find(".threads_alternative_view_wrapper").remove();TS.client.ui.threads.$scroller.removeClass("loading");TS.client.ui.threads.$scroller.removeClass("slow_loading");TS.client.ui.threads.$scroller.find("#threads_msgs").empty();TS.client.ui.threads.$scroller.append(TS.templates.threads_alternative_view(i))},isAlternativeThreadsViewShowing:function e(){return TS.client.ui.threads.$scroller.find(".threads_alternative_view_wrapper").length>0},displaySlowLoadingMessage:function e(){if(TS.client.ui.threads.$scroller.hasClass("loading"))TS.client.ui.threads.$scroller.addClass("slow_loading");var i=$("#threads_msgs .and_more_end, #threads_msgs .and_more_beginning");if(i.length){var t=TS.i18n.t("Still loading... sorry for the long wait!","threads")();i.text(t)}},startWithData:function i(t,n){TS.client.ui.threads.$scroller.removeClass("loading");TS.client.ui.threads.$scroller.removeClass("slow_loading");if(t.length<1){TS.client.ui.threads.displayEmptyState();return}TS.client.ui.threads.$scroller.scrollTop(0);e={name:"threads",container:TS.client.ui.threads.$container,scroller:TS.client.ui.threads.$scroller,page_size:8,msg_order:"desc",skip_day_groupings:true,has_more_beginning:false,has_more_end:!!n,buildSection:function e(i){return TS.templates.thread_view_section({is_old_section:"old_threads"===i.id,show_threads_notification_banner:A(i,t)})},buildMsgHTML:function e(i,t){return d(i,t)},updateCallback:function e(){c()},promiseToLoadMoreAtEnd:function e(){return TS.client.threads.loadMoreThreads().then(l)}};e.sections=[];var a=_.filter(t,{grouping:"new"});var r=_.filter(t,{grouping:"old"});if(a.length){var u=s();u.msgs=a}if(r.length){var m=o();m.msgs=r}if(!TS.environment.supports_custom_scrollbar){var f=TS.client.ui.threads.$scroller.data("monkeyScroll");if(f)f.updateFunc()}TS.ui.message_container.register(e);c();h();$(document).on("keydown.threads",y)},buildThreadMsgHTML:function e(i,t,n){return TS.templates.builders.buildThreadMsgHTML(i,t,n)},maybeUpdateThreadWithMessage:function e(i,n,a){t.addToQ(function(){var e=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+(n.thread_ts||n.ts)+'"]');if(!e.length)return;TS.ui.thread.updateThreadWithMessage(e,i,n,a)})},maybeRemoveNewRepliesBanner:function e(){t.addToQ(function(){if(i)p()})},maybeRemoveMessageFromThread:function e(i,n){if(!i||!n)return;if(n.ts===n.thread_ts){TS.error("Attempting to remove remove root msg from DOM instead of converting it to tombstone or deleting entire <ts-thread>");return}var a=TS.client.threads.getThread(i,n.thread_ts);if(!a)return;t.addToQ(function(){var e=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+(n.thread_ts||n.ts)+'"]');if(!e.length)return;var i=TS.ui.thread.removeMessageFromThread(e,a,n);return i})},maybeRemoveThread:function i(n,a){if(!n||!a)return;t.addToQ(function(){_.forEach(e.sections,function(e){e.msgs=_.without(e.msgs,_.find(e.msgs,function(e){return n.id===e.model_ob.id&&a.root_msg.thread_ts===e.root_msg.thread_ts}))});TS.ui.message_container.update(e)})},insertNewThread:function i(n){t.addToQ(function(){TS.client.ui.threads.$scroller.removeClass("loading");TS.client.ui.threads.$scroller.removeClass("slow_loading");var i=_.get(e,"sections");if(!i)return;var t;if("new"===n.grouping)t=s();else t=o();t.msgs.push(n);t.msgs.sort(TS.client.threads.threadCompare);var a=TS.client.ui.threads.$container.find("ts-thread:first");TS.ui.message_container.updateWithFocus(e,a)})},jumpToTop:function i(){if(!TS.model.threads_view_is_showing)return;TS.ui.message_container.jumpToTop(e)},revealNewReplies:function e(i){t.addToQ(function(){var e=v(i);if(!e.length)return;return TS.ui.thread.revealNewReplies(e,i)})},revealPreviousReplies:function e(i,n){var a=v(i);if(n.isPending())TS.ui.thread.showThreadLoadingSpinner(a);return t.addToQ(function(){if(!a.length)return;return TS.ui.thread.revealPreviousReplies(a,i,n)})},maybeRedrawThread:function i(n){t.addToQ(function(){n.edited=Date.now();TS.ui.message_container.update(e)})},hideCaughtUpDivider:function e(){if(!TS.model.threads_view_is_showing)return;$("#threads_msgs .threads_caught_up_divider").addClass("hide_divider")},getThreadFromEl:function e(i){if(!i||!i.length)return;var t=i.closest("ts-thread");var n=t.attr("data-model-ob-id");var a=t.attr("data-thread-ts");if(!n||!a)return;var r=TS.shared.getModelObById(n);return TS.client.threads.getThread(r,a)},incrementTrackingSeqId:function e(){a+=1},trackThreadsViewClosed:function e(i){var t=_.merge(TS.client.ui.threads.getTrackingData(),{num_threads_loaded:TS.client.threads.getThreadsLoadedCount(),view_exit_event:i});TS.clog.track("THREADS_VIEW_CLOSE",t);r=true},getTrackingData:function e(){return{view_session_elapsed_time:Date.now()-n,view_session_index:a}},rebuildMsgsIncludingMember:function i(t){if(!TS.model.threads_view_is_showing)return;var n=_.get(e,"sections");if(!n)return;_.each(n,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.messageIncludesMember(t,e.root_msg))TS.client.ui.threads.maybeUpdateThreadWithMessage(e,e.root_msg);_.each(e.replies,function(i){if(TS.utility.msgs.messageIncludesMember(t,i))TS.client.ui.threads.maybeUpdateThreadWithMessage(e,i)})})})},rebuildMsgCurrentStatusIncludingMember:function i(t){if(!TS.model.threads_view_is_showing)return;var n=_.get(e,"sections");if(!n)return;var a={member:t,for_message:true};_.each(n,function(e){if(!e)return;_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e.root_msg)){var i=TS.client.ui.threads.$container.find('ts-message[data-ts="'+e.root_msg.ts+'"] .message_current_status');i.replaceWith(TS.templates.current_status(a))}_.each(e.replies,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){var i=TS.client.ui.threads.$container.find('ts-message[data-ts="'+e.ts+'"] .message_current_status');i.replaceWith(TS.templates.current_status(a))}})})})}});var e;var i=false;var t;var n;var a;var r;var s=function i(){if(!e||!e.sections)return;var t=_.find(e.sections,{id:"new_threads"});if(!t){t={id:"new_threads",order:0,msgs:[]};e.sections.unshift(t)}return t};var o=function i(){if(!e||!e.sections)return;var t=_.find(e.sections,{id:"old_threads"});if(!t){t={id:"old_threads",order:1,msgs:[]};e.sections.push(t)}return t};var l=function i(t){var n=t.has_more;var a=t.threads;var r=_.get(e,"sections");if(!r)return;var l=_.filter(a,{grouping:"new"});var d=_.filter(a,{grouping:"old"});if(l.length){var c=s();c.msgs=l}if(d.length){var u=o();u.msgs=d}e.has_more_end=!!n};var d=function e(i){return TS.ui.thread.buildThreadHTML(i)};var c=function e(i){var t=TS.client.ui.threads.$container;if(!t)return;var n=t.find("ts-thread");_.forEach(n,function(e){if(i)$(e).data("input_rendered",false);f($(e))})};var u=function e(){var i=true;c(i)};var m=function e(i){var t=TS.client.ui.threads.$container.find("ts-thread[data-model-ob-id="+i.id+"]");t.data("input_rendered",false);_.forEach(t,function(e){f($(e))})};var f=function e(i){if(!i||!i.length)return;if(i.data("input_rendered"))return;var t=i.attr("data-model-ob-id");var n=i.attr("data-thread-ts");if(!t||!n)return;var a=TS.shared.getModelObById(t);if(!a)return;var r=TS.client.threads.getThread(a,n);if(!r){TS.error("Thread not found in TS.client.threads _thread_data");return}TS.ui.thread.renderReplyInput(i,r);i.data("input_rendered",true)};var h=function t(){var n=TS.client.ui.threads.$scroller;n.on("scroll.threads_view_scroll",_.debounce(function(){if(!TS.model.threads_view_is_showing)return;if(i&&0===n.scrollTop()){var t=TS.ui.message_container.getRange(e);var a=_.get(t,"start");if(!a)return;if(-1===a.msg_ts){TS.client.threads.markAllNewThreads();return}var r=e.sections[0].msgs[0];if(!r||a.msg_ts===r.ts)TS.client.threads.markAllNewThreads()}},150))};var g=function e(t){var n=$("#threads_view_banner");var a=TS.i18n.t("{new_thread_reply_count,plural,=1{{new_thread_reply_count} new reply}other{{new_thread_reply_count} new replies}}","threads")({new_thread_reply_count:t});n.find("#new_replies_info").text(a);n.removeClass("no_opacity");TS.client.ui.threads.$container.addClass("new_banner_is_showing");i=true};var p=function e(t){i=false;if(t)$("#threads_view_banner").addClass("hidden");$("#threads_view_banner").addClass("no_opacity");TS.client.ui.threads.$container.removeClass("new_banner_is_showing")};var S=function e(){if(!TS.model.threads_view_is_showing)return;T();TS.client.ui.threads.$scroller.addClass("emojimode_"+TS.prefs.getPref("emoji_mode"))};var T=function e(){TS.client.ui.threads.$scroller.removeClass(function(e,i){return(i.match(/(^|\s)emojimode_\S+/g)||[]).join(" ")})};var v=function e(i){var t=i.root_msg.ts;var n=i.model_ob.id;var a=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+t+'"][data-model-ob-id="'+n+'"]');return a};var b=function e(i){if(!TS.model.threads_view_is_showing)return;t.addToQ(function(){m(i)})};var w=function e(i){if(!TS.model.threads_view_is_showing)return;if(!i)return;if("who_can_post_general"===i)t.addToQ(function(){var e=TS.channels.getGeneralChannel();m(e)})};var y=function e(i){if(TS.ui.react_emoji_menu.is_showing)return;var t=[TS.utility.keymap.space,TS.utility.keymap.pageup,TS.utility.keymap.pagedown,TS.utility.keymap.end,TS.utility.keymap.home];var n=i.target;var a=$("#col_flex")[0].contains(n);var r=$(".client_channels_list_container")[0].contains(n);var s=TS.client.ui.threads.$scroller[0];var o=TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!a&&!r&&!s.contains(n);if(-1!==t.indexOf(i.keyCode)&&o)s.focus()};var A=function e(i,t){return!TS.prefs.getPref("seen_threads_notification_banner")&&"mentions"===TS.notifs.getGlobalNotificationSetting()&&!TS.prefs.getPref("threads_everything")&&"new_threads"===i.id&&t.length>3};var k=function e(){n=Date.now();a=0;r=false}})()},4984:function(e,i){(function(){TS.registerModule("client.deprecation",{supported:{chrome:51,firefox:47,safari:9,msie:11,msedge:14,electron:"0.0.0"},onStart:function e(){TS.client.login_sig.addOnce(function(){if(TS.qs_args.deprecate_modal)t();else if(TS.qs_args.deprecate_modal_unsupported)n();else if(TS.qs_args.deprecate_modal_install)a();else if(TS.qs_args.deprecate_modal_install_unsupported)r();else if(TS.qs_args.deprecate_modal_ssb)s();else if(TS.qs_args.deprecate_modal_cert)o();if(TS.client.deprecation.isDeprecatedSSB())s();else if(TS.client.deprecation.isDeprecatedWindowsCert())o();else if(!TS.client.deprecation.isBrowserSupported())if(TS.client.deprecation.canInstallSSB())if(TS.client.deprecation.isBrowserFamilySupported())a();else r();else if(TS.client.deprecation.isBrowserFamilySupported())t();else n()})},isBrowserSupported:function e(){if(TS.model.is_electron&&TS.model.desktop_app_version){var i=TS.model.desktop_app_version;var t=i.major+"."+i.minor+"."+i.patch;if(TS.utility.compareSemanticVersions(t,TS.client.deprecation.supported.electron)>=0)return true;TS.info(i," electron app is deprecated!");return false}if(!window.bowser){TS.warn("no bowser???");return true}if(bowser.mobile)return false;if(_.some(TS.client.deprecation.supported,function(e,i){return bowser[i]&&bowser.version>=e}))return true;if(bowser.firefox&&45===Math.floor(bowser.version))return true;TS.warn(bowser,navigator.userAgent,"is deprecated!");return false},isBrowserFamilySupported:function e(){if(!window.bowser)return false;return _.some(TS.client.deprecation.supported,function(e,i){return bowser[i]})},isDeprecatedSSB:function e(){return!TS.client.deprecation.isBrowserSupported()&&TS.model.is_our_app},isDeprecatedWindowsCert:function e(){return TS.boot_data.feature_deprecate_window_cert&&TS.model.is_win&&TS.model.desktop_app_version&&-1===TS.utility.compareVersions(TS.model.desktop_app_version,{major:2,minor:6,patch:5})},canInstallSSB:function e(){if(TS.model.is_win_7_plus)return true;if(TS.model.is_mac&&1===TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8"))return true;if(TS.model.is_lin)return true;return false}})})();var t=function e(){TS.metrics.count("deprecation_modal");var i=TS.i18n.t("This browser is out of date","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:true}).replace("emoji-sizer","");i=new Handlebars.SafeString(i);TS.ui.fs_modal.start({title:i,body:TS.i18n.t("<p>We know it's a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Learn More","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button");TS.utility.openInNewTab("https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/articles/201746897","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var n=function e(){TS.metrics.count("deprecation_modal_unsupported");var i=TS.i18n.t("This browser is no longer supported","deprecation")()+" "+TS.emoji.graphicReplace(":construction:",{jumbomoji:true}).replace("emoji-sizer","");i=new Handlebars.SafeString(i);TS.ui.fs_modal.start({title:i,body:TS.i18n.t("<p>We know it's a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Learn More","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_unsupported");TS.utility.openInNewTab("https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/articles/201746897","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var a=function e(){TS.metrics.count("deprecation_modal_install");var i=TS.i18n.t("This browser is out of date","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:true}).replace("emoji-sizer","");i=new Handlebars.SafeString(i);TS.ui.fs_modal.start({title:i,body:TS.i18n.t("<p>We know it’s a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend downloading our desktop app: you’ll get greater control over your notifications, easy switching between workspaces, and — handily — automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Use the Slack app","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_install");TS.utility.openInNewTab("/ssb/redirect","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var r=function e(){TS.metrics.count("deprecation_modal_install_unsupported");var i=TS.i18n.t("This browser is no longer supported","deprecation")()+" "+TS.emoji.graphicReplace(":construction:",{jumbomoji:true}).replace("emoji-sizer","");i=new Handlebars.SafeString(i);TS.ui.fs_modal.start({title:i,body:TS.i18n.t("<p>We know it’s a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend <a href='https://slack.com/downloads'>downloading our desktop app</a>: you’ll get greater control over your notifications, easy switching between workspaces, and — handily — automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Use the Slack app","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_install_unsupported");TS.utility.openInNewTab("/ssb/redirect","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var s=function e(){TS.metrics.count("deprecation_modal_ssb");var i=TS.i18n.t("This is an out-of-date version of Slack","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:true}).replace("emoji-sizer","");i=new Handlebars.SafeString(i);TS.ui.fs_modal.start({title:i,body:TS.i18n.t("<p>We've made some great improvements to our desktop app — it now runs faster, uses far less memory, and updates automatically.</p><p><strong>To continue using Slack, please <a href='https://slack.com/downloads'>manually download our new desktop app</a> soon.</strong> We want your experience of Slack to be fast, secure, and the best it can possibly be. As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")(),show_secondary_go_button:true,go_button_text:TS.i18n.t("Update the App","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_ssb");TS.utility.openInNewTab(l(),"_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var o=function e(){if(!TS.boot_data.feature_deprecate_window_cert)return;TS.metrics.count("deprecation_modal_cert");var i=TS.i18n.t("This is an out-of-date version of Slack","deprecation")();var t=TS.i18n.t("<p>We’ve released a new version of Slack with an assortment of bug fixes, an update to our certificate, and an all-around smoother experience.</p><p><strong>To continue using Slack, please update your version of the app by September 12th.</strong> Feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have any questions.</p>","deprecation")();TS.generic_dialog.start({title:i,body:t,go_button_text:TS.i18n.t("Update the App","deprecation")(),cancel_button_text:TS.i18n.t("Skip for Now","deprecation")(),onGo:function e(){TS.metrics.count("deprecation_button_cert");TS.utility.openInNewTab(l(),"_blank")}})};var l=function e(){var i=false;var t="";if(TS.model.is_mac)i="osx";else if(TS.model.is_win){i="windows";t=TS.model.is_win_64?"windows_64":"windows"}else if(TS.model.is_lin)i="linux";if(i)return"https://slack.com/downloads/instructions/"+i+"?os="+i+"&build_architecture="+t;return"https://slack.com/downloads"}},4985:function(e,i){(function(){TS.registerModule("client.ui.app_space",{$scroller:$("#app_space_scroller_div"),$loading_msg_container:null,$container:null,valid_sub_views:["messages","about","permissions"],active_view:"messages",screenshots_templates:[],onStart:function e(){if(!TS.apps.isAppSpaceEnabled())return;TS.redux.socket.connectedSig.add(u);TS.ims.switched_sig.add(TS.client.ui.app_space.prepareAppSpace,TS.client.ui.app_space)},prepareAppSpace:function e(){var i=TS.shared.getActiveModelOb();var t=TS.members.getMemberById(i.user);var n=_.get(t,"profile.bot_id");var r=_.get(t,"profile.team");if(n)a(n,r)},toggleView:function i(t){if(TS.client.ui.app_space.valid_sub_views.indexOf(t)<0)return;if(!e)return TS.client.ui.app_space.resetView();TS.client.channel_header.setActiveTab(t);TS.client.ui.app_space.active_view=t;if("messages"===t)TS.client.ui.app_space.resetView();else if("about"===t)d();else if("permissions"===t)if(TS.boot_data.feature_app_space_permissions_tab)c()},resetView:function e(){TS.client.msg_pane.hideCenterWorkspace();TS.client.msg_pane.showMessageContainer()},renderAppInformation:function i(t,n,a){if(!t)return m();TS.client.ui.app_space.active_app=t;TS.client.ui.app_space.app_bot_id=n;TS.client.ui.app_space.app_team_id=a;e=TS.apps.constructTemplateArgsForCardAndProfile(t,n,null,a);if(!e)return m();var r;if(t.permissions)r=TS.apps.promiseToParsePermissionsForApp(t.permissions);else r=Promise.resolve();r.then(function(i){e.permissions=i;l();if(!TS.environment.supports_custom_scrollbar)TS.client.ui.app_space.$scroller.monkeyScroll();if(TS.client.ui.app_space.active_view)TS.client.ui.app_space.toggleView(TS.client.ui.app_space.active_view)})},onButtonClick:function e(i){i.preventDefault();var t=$(this);var a=t.data("action");if("desc_expand"===a){n.removeClass("--collapsed");n.addClass("--expanded")}else if("desc_collapse"===a){n.addClass("--collapsed");n.removeClass("--expanded")}},resetUI:function e(){i.empty();if("messages"!==TS.client.ui.app_space.active_view){TS.client.ui.app_space.resetView();TS.client.ui.app_space.active_view="messages"}TS.client.ui.app_space.active_app=null;TS.client.ui.app_space.app_bot_id=null;TS.client.ui.app_space.app_team_id=null;TS.client.ui.app_space.screenshots_templates=[]},openScreenshotModal:function i(t){var n=$(t.target);var a=n.data("app-space-screenshot");if(e.youtube_id)if("youtube"===a)a=0;else a+=1;TS.ui.fs_modal.start({body_template_html:TS.templates.fs_modal_simple_gallery({items:TS.client.ui.app_space.screenshots_templates,modal_gallery_index:a}),header_html:TS.templates.fs_modal_app_header(e),modal_bg_class:"off_white_bg",modal_gallery:{index:a,total_items:TS.client.ui.app_space.screenshots_templates.length-1},modal_class:"fs_modal_header fs_modal_footer",modal_contents_container_class:"c-modal_gallery",show_go_button:false,show_cancel_button:false})},verifyTabs:function e(){l()}});var e;var i=$('[data-js="app_space"]');var t;var n;var a=function e(i,t){TS.apps.promiseToGetFullAppProfile(i,t,null,true).then(function(e){TS.client.ui.app_space.renderAppInformation(e,i,t)})};var r=function e(){t=$('[data-js="app_space_profile"]');t.on("click","[data-app-space-screenshot]",TS.client.ui.app_space.openScreenshotModal);t.on("click",'[data-js="app_profile_btn"]',TS.client.ui.app_space.onButtonClick);t.on("click","[data-member-profile-link]",function(e){e.preventDefault();TS.client.ui.previewMember($(this).data("member-profile-link"))})};var s=function i(){if(e.youtube_id)TS.client.ui.app_space.screenshots_templates.push(TS.templates.app_youtube_video({youtube_id:e.youtube_id,disable_autoplay:true}));if(e.screenshots)_.each(e.screenshots,function(e){TS.client.ui.app_space.screenshots_templates.push(TS.templates.app_space_screenshot({image_url:e.image_1600}))})};var o=function e(){n=$('[data-js="app_profile_desc"]');i.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)})};var l=function i(){if(!TS.boot_data.feature_app_space_permissions_tab||!e)return;var t=$('[data-js="channel_header_tabs"]');var n=t.find('[data-target="permissions"]');if(e.show_settings_section&&void 0!==e.permissions)n.removeClass("hidden");else n.addClass("hidden")};var d=function t(){i.html(TS.templates.app_space_profile(e));o();s();r();TS.client.msg_pane.hideMessageContainer();TS.client.msg_pane.showCenterWorkspace();TS.clog.track("APP_SPACE_ABOUT_OPEN",{app_id:TS.client.ui.app_space.active_app.id,bot_id:TS.client.ui.app_space.app_bot_id,contexts:{core:{app_id:TS.client.ui.app_space.active_app.id,bot_id:TS.client.ui.app_space.app_bot_id}}})};var c=function t(){TS.client.msg_pane.hideMessageContainer();TS.client.msg_pane.showCenterWorkspace();var n=_.get(e.auth,"created_by");if(n){var a=TS.members.getMemberById(n);var r;var s;if(a){r=TS.members.getPrefCompliantMemberName(a);s=new Handlebars.SafeString(_.escape(r))}e=_.assign({},e,{permissions:{member_username:_.get(a,"name"),member_id:_.get(a,"id"),member_name:s}})}i.html(TS.templates.app_space_permissions(e))};var u=function e(){TS.client.ui.app_space.resetUI();TS.client.ui.app_space.prepareAppSpace()};var m=function e(){TS.client.ui.app_space.resetUI();TS.client.channel_header.hideTab("about");TS.client.channel_header.hideTab("permissions")}})()},4986:function(e,i){(function(){TS.registerModule("ui.shared_invites_modal",{onStart:function e(){$("body").on("click",'[data-action="admin_shared_invites_modal"]',TS.ui.shared_invites_modal.showModal);if(!TS.boot_data.show_shared_invites_modal)return;return s()},showModal:function e(i,t){if(TS.isPartiallyBooted())return;if(!r())return TS.ui.admin_invites.start();if("channel_list_invites_link"===i.target.id||t){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"invite_people",action:"click",ui_element:"invite_people_button"}}});TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"impression",ui_element:"share_invite_link_modal"},referring_ui_context:{step:"invite_people",ui_element:"invite_people_button"}},referring_event_id:"INAPP_INVITES"})}d(i)},start:function e(i){return u(i)},updateCode:function e(){return s()},userCanViewSharedInvitesModal:function e(){return r()}});var e;var i;var t;var n;var a=function e(){return!TS.model.team.plan&&TS.model.user.is_admin};var r=function e(){if(!TS.boot_data.show_shared_invites_modal)return false;if(TS.model.team.plan)return false;return a()||TS.ui.admin_invites.canInvite()&&t};var s=function e(){return TS.api.call("users.admin.listSharedInvites",{mode:"last_active"}).then(function(e){if(e.data.invites&&e.data.invites.length)o(e.data.invites[0]);else o(null)},function(e){TS.error("could not create shared invite link: "+e)})};var o=function e(i){t=i;clearTimeout(n);if(!t)return;var a=1e3*t.date_expire;var r=a-new Date;if(r<0){t=null;return}if(r>2147483647)r=2147483647;n=setTimeout(s,r)};var l=function e(){return s().then(function(){if(!t)return;return TS.api.call("users.admin.revokeSharedInvite",{code:t.code}).then(function(){o(null);return Promise.resolve()})})};var d=function e(i){if(TS.menu.isRedundantClick(i))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_items.html(TS.templates.shared_invites_modal());TS.menu.start(i);TS.menu.menu_closed_sig.addOnce(function(){$("#shared_invite_link_modal_warning").remove()});u(i)};var c=function i(t,n){n=n||{};var a=k[t];if(!a){TS.error("no shared invite modal view");return Promise.reject()}if(n.warning){var r=e.closest(".menu");r.prepend(TS.templates.shared_invites_modal_warning({warning:n.warning}))}else $("#shared_invite_link_modal_warning").remove();return a(n)};var u=function n(){e=$("#shared_invite_link_modal");i=$("#shared_invite_link_modal_body");var r;if(t)if(a())r="admin_share_link";else r="nonadmin_share_link";else r="admin_create_link";m();return c(r)};var m=function e(){h();p();v();b();f();S()};var f=function i(){var t=e.find("#shared_invite_link_url");t.on("click",function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"invite_link"}}})})};var h=function i(){e.on("click",'[data-action="shared_invite_open_email_invites"]',function(){TS.ui.admin_invites.start();if(TS.menu)TS.menu.end();TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"email_invite_link"}}})})};var g=function e(){i.html(TS.templates.shared_invites_modal_admin_create_link_body());return Promise.resolve()};var p=function i(){var t;e.on("click",'[data-action="shared_invite_create_link"]',function(){t=$(this);var i=e.find("#select_shared_invite_expiration");TS.ui.startButtonSpinner(t.get(0));i.attr("disabled","disabled");var n=_.toInteger(i.val());TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"create_invite_link_button"}}});var a=function e(n,a){if(n){o(a);return c("admin_share_link")}i.removeAttr("disabled");TS.ui.stopButtonSpinner(t.get(0),false);return c("admin_create_link",{warning:"ratelimited"})};return TS.api.call("users.admin.createSharedInvite",{expiration:n,max_signups:1e3,disable_email:true}).then(function(e){var i=e.data,t=e.args,n=e.request_id;var r=true;a(r,i,t,n);return{data:i,args:t,request_id:n}}).catch(function(e){var i=e.data,t=e.args,n=e.request_id;var r=false;a(r,i,t,n);return{data:i,args:t,request_id:n}})})};var S=function i(){e.on("click","#select_shared_invite_expiration",function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"expiration_period_menu"}}})})};var T=function e(){var n=t.date_expire;var a=y(n);var r={shared_invite_url:t.url,is_admin:true};if(a){r.time_until_expiration_string=new Handlebars.SafeString(a);r.expiration_date=TS.interop.datetime.toCalendarDate(n);r.expiration_time=TS.interop.datetime.toTime(n,{do24hrTime:TS.utility.date.do24hrTime()})}i.html(TS.templates.shared_invites_modal_share_link_body(r));return Promise.resolve()};var v=function i(){e.on("click",'[data-action="disable_shared_link"]',function(){var e=$(".menu");e.addClass("hide_behind_dialog");TS.menu.needs_to_remain_open=function(){return true};TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"disable_link"}}});return new Promise(function(i){TS.generic_dialog.start({title:TS.i18n.t("Deactivate your invite link?","pages_admin")(),body:TS.i18n.t("<p>The invite link for <b>{team_name}</b> will stop working. Please note that if you sent the link to anyone, they may not be able to join your workspace.</p>","pages_admin")({team_name:_.escape(TS.model.team.name)}),go_button_class:"btn_danger ladda-button",go_button_text:TS.i18n.t("Deactivate Link","pages_admin")(),onGo:function e(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"deactivate_link",action:"click",ui_element:"deactivate_link_button"}}});i()},onCancel:function e(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"deactivate_link",action:"click",ui_element:"cancel_button"}}})},onEnd:function i(){TS.menu.needs_to_remain_open=void 0;e.removeClass("hide_behind_dialog")}})}).then(function(){return l().then(function(){return c("admin_create_link",{warning:"link_disabled"})},function(){TS.error("disable share invites link failed")})})})};var b=function i(){e.on("click",'[data-action="copy_shared_link"]',function(){var e=$(this);w(e);TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"copy_button"}}})})};var w=function e(i){var t=i.parent().find("input");var n=t.attr("data-invite-url");TS.clipboard.writeText(n);t.select();i.removeClass("hide_copy_btn_ts_tip");window.setTimeout(function(){i.addClass("hide_copy_btn_ts_tip")},2e3)};var y=function e(i){var t;var n=TS.interop.datetime.toDateObject(Date.now()/1e3);var a=TS.interop.datetime.distanceInDays(TS.interop.datetime.toDateObject(i),n);var r=a/7;if(a>30)return"";if(_.isInteger(r))t=TS.i18n.t("in {num_weeks, plural, =1{one week}other{{num_weeks} weeks}}","shared_invites_modal")({num_weeks:r});else t=TS.i18n.t("in {num_days, plural, =1{one day}other{{num_days} days}}","shared_invites_modal")({num_days:a});return TS.interop.datetime.prettifyDateString(i,{fallbackString:t,uncapitalized:true})};var A=function e(){var n=t.date_expire;var a=y(n);var r={shared_invite_url:t.url,is_admin:false};if(a){r.time_until_expiration_string=new Handlebars.SafeString(a);r.expiration_date=TS.interop.datetime.toCalendarDate(n);r.expiration_time=TS.interop.datetime.toTime(n,{do24hrTime:TS.utility.date.do24hrTime()})}i.html(TS.templates.shared_invites_modal_share_link_body(r));return Promise.resolve()};var k={admin_create_link:g,admin_share_link:T,nonadmin_share_link:A}})()},4987:function(e,i){(function(){TS.registerModule("ui.shared_channels_open_beta_modal",{onStart:function e(){if(TS.client)TS.redux.socket.connectedSig.addOnce(n)},showModal:function i(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!TS.permissions.members.canManageParticipationInSharedChannelsOpenBeta())return;var a=TS.templates.shared_channels_help_content();var r=TS.templates.shared_channels_open_beta_modal();var s;var o;var l;var d;var c;if(1===TS.prefs.getTeamPref("enable_shared_channels")&&n.show_create_button_only){s=TS.i18n.t("Create a Shared Channel","shared")();o="btn_info"}else if(1===TS.prefs.getTeamPref("enable_shared_channels")){s=TS.i18n.t("Create a Shared Channel","shared")();o="btn_info";l=true;d=TS.i18n.t("Leave the Beta","shared")();c="btn_outline"}else{s=TS.i18n.t("Join the Beta","shared")();o="btn_info"}TS.ui.fs_modal.start({modal_class:"fs_modal_footer",body:r,go_button_text:s,go_button_class:o,show_secondary_go_button:l,secondary_go_button_text:d,secondary_go_button_class:c,show_cancel_button:false,footer_html:a,onGo:function i(){if(1===TS.prefs.getTeamPref("enable_shared_channels")){TS.ui.fs_modal.close();setTimeout(function(){TS.ui.share_channel_dialog.start({element:"shared_channels_open_beta_modal_create_btn"})},0)}else{TS.ui.fs_modal.close();TS.prefs.setTeamPrefByAPI({enable_shared_channels:1});setTimeout(e,500)}},onSecondaryGo:t})},test:function a(){var r={};Object.defineProperty(r,"_showSharedChannelsCreateCoachmark",{get:function i(){return e},set:function i(t){e=t}});Object.defineProperty(r,"_showSharedChannelsGetStartedCoachmark",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(r,"_maybeShowSharedChannelsGetStartedCoachmark",{get:function e(){return n},set:function e(i){n=i}});Object.defineProperty(r,"_showConfirmLeaveBetaDialog",{get:function e(){return t},set:function e(i){t=i}});return r}});var e=function e(){TS.prefs.setPrefByAPI({name:"seen_shared_channels_coachmark",value:true});TS.coachmark.start(TS.coachmarks.coachmarks.shared_channels_create,false,{reject_on_off_target_click:true})};var i=function e(){TS.prefs.setPrefByAPI({name:"seen_shared_channels_coachmark",value:true});TS.coachmark.start(TS.coachmarks.coachmarks.shared_channels_get_started,false,{reject_on_off_target_click:true})};var t=function e(){var i=TS.i18n.t("Remove {team_name} from the beta?","shared")({team_name:TS.model.team.name});var t=TS.templates.shared_channels_leave_open_beta_dialog();var n=TS.i18n.t("Leave Beta","shared")();TS.generic_dialog.start({title:i,body:t,go_button_text:n,go_button_class:"btn_danger",onGo:function e(){TS.prefs.setTeamPrefByAPI({enable_shared_channels:0});TS.utility.rAF(TS.ui.fs_modal.close)}})};var n=function e(){if(!TS.permissions.members.canManageParticipationInSharedChannelsOpenBeta())return;if(1===!TS.prefs.getTeamPref("enable_shared_channels"))return;if(TS.onboarding.inOnboarding())return;if(TS.coachmark.is_showing)return;if(TS.prefs.getPref("seen_shared_channels_coachmark"))return;setTimeout(i,1e3)}})()},4988:function(e,i){(function(){TS.registerModule("ui.apps_browser",{onStart:function e(){t()},start:function i(t){if(!TS.apps.isAppSpaceEnabled())return;if(TS.client.ui.checkForEditing())return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=TS.templates.apps_browser({showTutorial:TS.prefs.getPref("seen_app_space_tutorial")});TS.ui.fs_modal.start({body_template_html:n,onShow:a,onEnd:r,disable_esc:true,modal_class:"fs_modal_internal_scroll p-apps_browser_modal"});var s=!!TS.redux.enterprise.getEnterpriseId();var o=!TS.model.team.plan&&!s;var l=TS.model.is_IE;var d=TS.model.is_FF&&TS.model.is_win;var c=TS.model.is_FF&&TS.model.is_mac;var _=!!navigator.userAgent.match("MacAppStore");e=document.getElementById("apps_browser_container");TS.interop.mountAppsBrowser(TS.boot_data.team_id,e,{addAppsVariant:t,isUnpaid:o,isInternetExplorer:l,isFirefoxAndWindows:d,isFirefoxAndMac:c,isMacSsbBuild:_});TS.clog.track("APP_INDEX_OPEN");$("[data-manage_apps_link]").click(function(){TS.clog.track("APP_INDEX_MANAGE_CLICK")})},startAddApps:function e(){if(TS.apps.permissions.areXoxaAppsInstalled()){n=TS.shared.getActiveModelOb();TS.apps.permissions.ensureAppAndBotResourceMembershipIsKnown(n.id).then(function(){TS.ui.apps_browser.start(true)})}else TS.ui.apps_browser.start()},canAppBeAdded:function e(i){return TS.apps.permissions.canAppOrBotBeAddedToResource(i,n)},buildAddAppsTitle:function e(){return TS.apps.permissions.buildAddAppsTitle(n)},routeAppOpen:function e(i){TS.ui.fs_modal.close();if(i.bot_user_id)TS.ims.startImByMemberId(i.bot_user_id);else if(i.bot_id)TS.apps.startFlexPaneByBotId(TS.model.team.id,i.bot_id,true);else TS.apps.startFlexPaneByAppId(TS.model.team.id,i.app_id,false)},addAppToChannel:function e(i){TS.ui.fs_modal.close();var t=TS.members.getMemberById(i.bot_user_id);TS.apps.permissions.addAppOrBotToActiveResource(t)},showAppTutorial:function e(){TS.clog.track("APP_TUTORIAL_VIEW");TS.ui.card_carousel.start({cards:i,onShow:s,onEnd:o});if(!TS.prefs.getPref("seen_app_space_tutorial"))TS.prefs.setPrefByAPI({name:"seen_app_space_tutorial",value:true},function(){TS.prefs.setPrefLocal("seen_app_space_tutorial",true);$("[data-view_tutorial_link]").removeClass("display_none")})}});var e;var i=[];var t=function e(){i=[{image:cdn_url+"/436da/img/app_space_tutorial_illustration_01.jpg",animation:"",title:TS.i18n.t("Common tasks, done in a jiffy","apps_browser")(),text:TS.i18n.t("Approve requests, schedule meetings, share documents, and more — all inside Slack.","apps_browser")()},{image:cdn_url+"/436da/img/app_space_tutorial_illustration_02.jpg",animation:"",title:TS.i18n.t("Connect the tools you already use","apps_browser")(),text:TS.i18n.t("Slack works with the systems you use, for everything from accounting to customer support.","apps_browser")()},{image:cdn_url+"/436da/img/app_space_tutorial_illustration_03.jpg",animation:"",title:TS.i18n.t("Discover new ways to work","apps_browser")(),text:TS.i18n.t("Poll your workspace, send kudos, and automate the coffee run. Have a better workday with apps.","apps_browser")()}]};var n=null;var a=function e(){$("[data-view_tutorial_link]").click(function(){TS.ui.apps_browser.showAppTutorial()});$(window.document).on("keydown",l)};var r=function i(){TS.interop.unmountAppsBrowser(e);n=null;$(window.document).off("keydown",l)};var s=function e(){$(window.document).off("keydown",l)};var o=function e(){$(window.document).on("keydown",l)};var l=function e(i){if(i.which==TS.utility.keymap.esc)TS.ui.fs_modal.close()}})()},4989:function(e,i){(function(){TS.registerModule("ui.messages_utils",{onStart:function e(){if(TS.useReactMessages()){TS.client.ui.unread.started_sig.add(TS.ui.messages_utils.setup);TS.client.ui.unread.ended_sig.add(TS.ui.messages_utils.tearDown);TS.client.ui.threads.started_sig.add(TS.ui.messages_utils.setup);TS.client.ui.threads.ended_sig.add(TS.ui.messages_utils.tearDown)}else TS.ui.messages_utils.setup()},setup:function e(){$("#messages_container").prepend('<div class="first_hidden_tab_stop" tabindex="0" style="position:absolute;"></div>').append('<div class="last_hidden_tab_stop" tabindex="0" style="position:absolute;"></div>').on("keydown",f).on("focus",".message,.unread_group_header,.bottom_mark_all_read",M).on("mousedown",".message,.unread_group_header,.bottom_mark_all_read",C).on("mousemove",B);$(document).on("keyup",I).on("keydown",x);TS.ui.messages_utils.debouncedIdentifyFirstAndLastTabStopInView=_.debounce(TS.ui.messages_utils.identifyFirstAndLastTabStopInView,50);$(".message_pane_scroller").on("scroll",TS.ui.messages_utils.debouncedIdentifyFirstAndLastTabStopInView);TS.view.resize_sig.add(TS.ui.messages_utils.debouncedIdentifyFirstAndLastTabStopInView);TS.channels.history_being_fetched_sig.add(E);TS.groups.history_being_fetched_sig.add(E);TS.ims.history_being_fetched_sig.add(E);TS.mpims.history_being_fetched_sig.add(E)},tearDown:function e(){var i=$("#messages_container");i.find(".first_hidden_tab_stop,.last_hidden_tab_stop").remove();i.off("keydown",f).off("focus",".message,.unread_group_header,.bottom_mark_all_read",M).off("mousedown",".message,.unread_group_header,.bottom_mark_all_read",C).off("mousemove",B);$(".message_pane_scroller").off("scroll",TS.ui.messages_utils.debouncedIdentifyFirstAndLastTabStopInView);$(document).off("keyup",I).off("keydown",x);TS.view.resize_sig.remove(TS.ui.messages_utils.debouncedIdentifyFirstAndLastTabStopInView);TS.channels.history_being_fetched_sig.remove(E);TS.groups.history_being_fetched_sig.remove(E);TS.ims.history_being_fetched_sig.remove(E);TS.mpims.history_being_fetched_sig.remove(E)},is_navigating_via_keyboard:false,getLastTabStopInView:function e(i){var t=n("reduceRight");return i.reduce(t,null)||$()},getFirstTabStopInView:function e(i){var t=n("reduce");var a=D()?i.concat($("#end_div")):i;return a.reduceRight(t,null)||$()},isAllContentInView:function e(){var i=TS.ui.messages_utils.scrollerForCurrentView();if(!i.length)return;return i.outerHeight()==i[0].scrollHeight},identifyFirstAndLastTabStopInView:function e(){if(!TS.ui.messages_utils.is_navigating_via_keyboard)return;c();var i=$("#messages_container").find(".first_hidden_tab_stop,.last_hidden_tab_stop");i.attr("tabindex","-1");if(TS.ui.messages_utils.isAllContentInView())return;var t=TS.ui.messages_utils.getMessagesInView();if(!t||t&&!t.length)return;t.forEach(function(e){if(e.hasClass("dirty_hover_container"))TS.ui.messages.updateMessageHoverContainer(e)});var n=TS.ui.messages_utils.getFirstTabStopInView(t);var a=TS.ui.messages_utils.getLastTabStopInView(t);n.addClass("first_tab_stop_in_view");a.addClass("last_tab_stop_in_view");i.attr("tabindex","0")},nextChannelViewMessage:function e(i){var t=TS.ui.utility.nextWithClass(i,"message");return t.length?t:o(i,".day_container")},prevChannelViewMessage:function e(i){var t=TS.ui.utility.prevWithClass(i,"message");return t.length?t:s(i,".day_container")},nextUnreadViewItem:function e(i){if(i.is(".unread_group_header")&&i.closest(".unread_group.collapsed").length)return i.closest(".unread_group").next(".unread_group").find(".unread_group_header");if(i.is(".unread_group_header"))return i.closest(".unread_group").find(".day_container").first().find("ts-message:first-of-type");var t=i.is(".message")&&TS.ui.messages_utils.nextChannelViewMessage(i);if(t.length)return t;var n=i.closest(".unread_group").next(".unread_group");if(n.length)return n.find(".unread_group_header");return i.closest(".unread_group").find(".bottom_mark_all_read")},prevUnreadViewItem:function e(i){if(i.is(".bottom_mark_all_read"))return i.closest(".unread_group").find(".day_container").last().find("ts-message:last-of-type");var t=i.is(".message")&&TS.ui.messages_utils.prevChannelViewMessage(i);if(t.length)return t;if(i.is(".message"))return i.closest(".msgs_holder").prev(".unread_group_header");var n=i.closest(".unread_group").prev(".unread_group");if(n.hasClass("collapsed"))return n.find(".unread_group_header");return n.find(".day_container").last().find("ts-message:last-of-type")},nextThreadsViewMessage:function e(i){var t=TS.ui.utility.nextWithClass(i,"message");if(t.length)return t;var n=TS.ui.utility.nextWithClass(i,"thread_replies_container").find("ts-message:first-of-type");if(n.length)return n;var a=o(i,"ts-thread",".thread_messages > ts-message:first-of-type");if(a.length)return a;var r="ts-thread:first-of-type .thread_messages > ts-message:first-of-type";return o(i,".threads_section",r)},prevThreadsViewMessage:function e(i){var t=TS.ui.utility.prevWithClass(i,"message");if(t.length)return t;var n=TS.ui.utility.prevWithClass(i.closest(".thread_replies_container"),"message");if(n.length)return n;var a=s(i,"ts-thread",".thread_replies_container > ts-message:last-of-type");if(a.length)return a;var r="ts-thread:last-of-type .thread_replies_container > ts-message:last-of-type";return s(i,".threads_section",r)},getMessagesInView:function e(){var t=TS.ui.messages_utils.scrollerForCurrentView();if(!t.length)return[];if(t.outerHeight()==t[0].scrollHeight)return t.find(".message,.unread_group_header,.bottom_mark_all_read").toArray().reverse().map(function(e){return $(e)});var n=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var a=n.left+n.width/2;var r=n.bottom-10;var s=n.left;var o=n.bottom/2;var l=i();var d=function e(i){var t=i[i.length-1];var n=t[0].getBoundingClientRect().top;if(n>=0&&n<=10)return i;if(n<0)return i;var a=l(t);if(!a.length)return i;return e(i.concat(a))};var c=TS.ui.utility.findNodeInRegion(".message,.unread_group_header,.bottom_mark_all_read",a,r,s,o);if(!c)return;return d([c])},scrollerForCurrentView:function e(){var i={unread_view_is_showing:"#unread_msgs_scroller_div",threads_view_is_showing:"#threads_msgs_scroller_div",archive_view_is_showing:"#archive_msgs_scroller_div",app_space_view_is_showing:"#app_space_scroller_div"};var t=Object.keys(i).reduce(function(e,t){return TS.model[t]?i[t]:e},"#msgs_scroller_div");var n=$(t);if(!n.length)TS.warn("Could not find a scroller for the current view");return n},getFirstMessageInDom:function e(i){var t={unread_view_is_showing:"first",threads_view_is_showing:"first"};var n=Object.keys(t).reduce(function(e,i){return TS.model[i]?t[i]:e},"last");var a=i.find(".message,.unread_group_header,.bottom_mark_all_read");return a[n]()},getFirstMessageInView:function e(i){var t={unread_view_is_showing:".first_tab_stop_in_view",threads_view_is_showing:".first_tab_stop_in_view"};var n=Object.keys(t).reduce(function(e,i){return TS.model[i]?t[i]:e},".last_tab_stop_in_view");TS.ui.messages_utils.identifyFirstAndLastTabStopInView();return i.find(n).closest(".message,.unread_group_header,.bottom_mark_all_read")},establishInitialFocus:function e(i,t){P(t.find(".message--focus"));var n=TS.ui.messages_utils.isAllContentInView()?TS.ui.messages_utils.getFirstMessageInDom(t):TS.ui.messages_utils.getFirstMessageInView(t);l(n);if(TS.ui.messages_utils.isAllContentInView())return;var a=38==i.keyCode;d(a,n,t)},visibleMsgsScrollAreaRect:function e(){var i=document.getElementById("messages_container").getBoundingClientRect();var t=8;var n=i.top+t;return{top:n,left:i.left,bottom:i.bottom,right:i.right,width:i.width,height:i.bottom-n}}});var e=function e(i){var t="prev"==i?"prev":"next";var n={unread_view_is_showing:"UnreadViewItem",threads_view_is_showing:"ThreadsViewMessage"};return function(){var e=Object.keys(n).reduce(function(e,i){return TS.model[i]?n[i]:e},"ChannelViewMessage");return TS.ui.messages_utils[t+e]}};var i=e("prev");var t=e("next");var n=function e(i){return function(e,t){if(e)return e;var n=t.hasClass("message--focus");if(!n)t.addClass("message--focus");var a=r(t,i);if(!n)t.removeClass("message--focus");if(a)return $(a)}};var a=function e(){var i=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var t=i.top;var n=i.bottom;return function(e){var i=e.getBoundingClientRect().top;return i>=t&&i<=n}};var r=function e(i,t){var n=a();var r="reduceRight"==t?"lastFocusableChild":"firstFocusableChild";return TS.interop.utility[r](i[0],n)};var s=function e(i,t,n){var a=n||"ts-message:last-of-type";return i.closest(t).prev(t).find(a)};var o=function e(i,t,n){var a=n||"ts-message:first-of-type";return i.closest(t).next(t).find(a)};var l=function e(i){if(!i.length)return;if(i.is(".message"))TS.ui.messages.updateMessageHoverContainer(i);i.attr("tabindex",-1).focus()};var d=function e(i,t,n){if(!t.length)return;var a=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var r=t[0].getBoundingClientRect();var s=r.top;var o=r.height;var l=t.find(".action_hover_container");var d=function(){if(!l.length)return 0;var e=l[0].getBoundingClientRect().top;var i=parseInt(l.css("right"),10);return e-i}();var c=a.top+(s-d);var _=n.scrollTop();if(i&&s>=c)return;if(i||o>=a.height)n.scrollTop(_-(c-s))};var c=function e(){var i=TS.ui.messages_utils.scrollerForCurrentView();if(!i.length)return;i.find(".first_tab_stop_in_view").removeClass("first_tab_stop_in_view");i.find(".last_tab_stop_in_view").removeClass("last_tab_stop_in_view")};var u=function e(){var i=TS.ui.messages_utils.scrollerForCurrentView();if(!i.length)return;P(i.find(".message--focus"));TS.ui.messages_utils.identifyFirstAndLastTabStopInView();i.find(".first_tab_stop_in_view").focus().addClass("focus-ring")};var m=function e(){var i=TS.ui.messages_utils.scrollerForCurrentView();if(!i.length)return;P(i.find(".message--focus"));TS.ui.messages_utils.identifyFirstAndLastTabStopInView();i.find(".last_tab_stop_in_view").focus().addClass("focus-ring")};var f=function e(i){var t=i.keyCode;var n=$(i.target);if(t==TS.utility.keymap.esc&&n.hasClass("message--focus")){n.blur();return}if(t==TS.utility.keymap.tab&&TS.client.ui.isUserAttentionOnChat()){w(i);return}if(!n.is("#messages_container")&&h(i))b(i)};var h=function e(i){var t=i.keyCode;var n=TS.utility.keymap;var a=t==n.up||t==n.down;var r=i.metaKey||i.ctrlKey||i.altKey||i.shiftKey;return a&&!TS.utility.isFocusOnInput()&&!r&&TS.client.ui.isUserAttentionOnChat()};var g=0;var p=0;var S=0;var T=function e(i){if(!i)return false;var t=a();var n=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var r=i.getBoundingClientRect();var s=r.bottom;return t(i)||s>n.top&&s<=n.bottom||r.height>=n.height};var v=function e(n,a,r){var s=n.keyCode;var o={38:i,40:t}[s]();var c=o(a);if(!c.length)return;n.preventDefault();l(c);var _=38==s;d(_,c,r);g=Date.now()};var b=function e(i,t){var n=TS.ui.messages_utils.scrollerForCurrentView();if(!n.length)return;TS.ui.messages_utils.is_navigating_via_keyboard=true;var a=n.find(".message--focus");var r=t||!t&&!T(a[0]);if(r){TS.ui.messages_utils.establishInitialFocus(i,n);return}v(i,a,n);var s=TS.prefs.getPref("seen_keyboard_shortcuts_coachmark");var o=TS.prefs.getPref("seen_keyboard_shortcuts_flexpane");TS.clog.track("KBSHORTCUTS_MESSAGE_NAV",{seen_coach_mark:s,seen_flexpane:o})};var w=function e(i){p=Date.now();var t=i.target;var n=$(t);if(n.is(".message .ql-editor"))return;var r=n.closest(".message");if(r.hasClass("dirty_hover_container"))TS.ui.messages.updateMessageHoverContainer(r);var s=i.shiftKey;var o=a();var l=function e(i){var t=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var n=i.getBoundingClientRect();var a=n.bottom;return o(i)||a>t.top&&a<=t.bottom};TS.ui.messages_utils.is_navigating_via_keyboard=true;if(!s&&n.is(".last_tab_stop_in_view")){i.preventDefault();if($("#client-ui").hasClass("flex_pane_showing")){y();return}if(window.winssb){TS.utility.contenteditable.focus(TS.client.msg_input.$input);return}$("#messages_container .last_hidden_tab_stop").focus();return}if(s&&n.is(".first_tab_stop_in_view")){i.preventDefault();A("#client_header .flex_header");return}if(!l(t)){i.preventDefault();u()}};var y=function e(){var i=$("#col_flex .panel.active")[0];var t=TS.interop.utility.firstFocusableChild(i);$(t).addClass("focus-ring").focus()};var A=function e(i){var t=$(i)[0];var n=TS.interop.utility.lastFocusableChild(t);$(n).addClass("focus-ring").focus()};var k=false;var C=function e(){k=true};var M=function e(i){if(k){k=false;return}var t=i.target;var n=$(t);var a=$(".message--focus");var r=a.get(0);if(r&&r.contains(t)||n.is(".message--focus"))return;P(a);n.closest(".message,.unread_group_header,.bottom_mark_all_read").addClass("message--focus").append('<div class="messagefocusindicator"></div>')};var I=function e(i){if(i.target==document)return;var t=i.target;var n=$(t);if(9!=i.keyCode)return;var a=TS.ui.messages_utils.scrollerForCurrentView();if(!a.length)return;var r=!i.shiftKey&&n.is("#messages_container .first_hidden_tab_stop");var s=i.shiftKey&&n.is("#messages_container .last_hidden_tab_stop");TS.ui.messages_utils.is_navigating_via_keyboard=a[0].contains(t)||r||s;if(r){TS.ui.messages_utils.identifyFirstAndLastTabStopInView();if(a.find(".first_tab_stop_in_view").length){u();return}if($("#client-ui").hasClass("flex_pane_showing")){y();return}if(window.winssb){TS.utility.contenteditable.focus(TS.client.msg_input.$input);return}$("#messages_container .last_hidden_tab_stop").focus();return}if(s){TS.ui.messages_utils.identifyFirstAndLastTabStopInView();if(a.find(".last_tab_stop_in_view").length){m();return}A("#client_header .flex_header");return}var o=a.find(".message--focus");var l=o.get(0);if(l&&!l.contains(t))P(o)};var x=function e(i){if(i.target==document)return;var t=i.keyCode;var n=i.target;var a=$(n);var r=$("#messages_container");var s=a.is(r);var o=TS.utility.keymap;var l=t==o.tab;if(TS.utility.isPageKey(i)||t==o.space)S=Date.now();if(l&&!i.shiftKey&&a.is("#col_flex")){y();i.preventDefault();return}if(!h(i))return;var d=!s&&r[0].contains(n);var c=$("#col_flex")[0].contains(n);var _=$(".client_channels_list_container")[0].contains(n);if(d||c||_)return;i.preventDefault();if(s)r.blur();b(i,true)};var E=function e(){if(!TS.ui.messages_utils.is_navigating_via_keyboard)return;if(U())return;var i=TS.ui.messages_utils.scrollerForCurrentView();if(!i.length)return;var t=i.find(".message--focus");if(!t.length)return;var n=TS.model.archive_view_is_showing?TS.client.archives.msgs_scrolled_sig:TS.client.ui.msgs_scrolled_sig;n.addOnce(function(){var e=$("#"+t.attr("id"));l(e)})};var B=function e(){if(!TS.ui.messages_utils.is_navigating_via_keyboard)return;if(U())return;$("#messages_container").attr("tabindex",-1).focus();var i=TS.ui.messages_utils.scrollerForCurrentView();var t=i.find(".message--focus");t.removeAttr("tabindex");P(t);TS.ui.messages_utils.is_navigating_via_keyboard=false};var P=function e(i){i.removeClass("message--focus");i.find(".messagefocusindicator").remove()};var D=function e(){var i=document.getElementById("end_div");if(!i)return false;var t=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var n=i.getBoundingClientRect();var a=n.bottom;return a>t.top&&a<=t.bottom};var U=function e(){var i=Date.now();var t=[g,p,S];return t.reduce(function(e,t){if(true===e)return true;return i-t<=1e3})}})()},4990:function(e,i){(function(){TS.registerModule("ui.macro_keyboard_nav",{onStart:function t(){$(document).on("keydown",i).on("blur",".focusablesection",e).on("mousemove",".focusablesection",TS.ui.macro_keyboard_nav.blurSection)},blurSection:function e(i){$(i.currentTarget).blur()},focusSection:function e(i){if("p-message_pane"==i)$(i).attr("tabindex",-1).focus();else{$(i).append('<div class="sectionfocusindicator"></div>');$(i).addClass("focusablesection").attr("tabindex",-1).focus()}document.body.scrollTop=0;var t=TS.prefs.getPref("seen_keyboard_shortcuts_coachmark");var n=TS.prefs.getPref("seen_keyboard_shortcuts_flexpane");TS.clog.track("KBSHORTCUTS_SECTION_NAV",{seen_coach_mark:t,seen_flexpane:n})},moveNext:function e(i){if(i.altKey||i.metaKey)return;var t=i.which===TS.i18n.keyCodeEquivalent(192)&&!i.shiftKey||"ja"===TS.i18n.keyboard()&&219===i.which;var s=i.which===TS.i18n.keyCodeEquivalent(192)&&i.shiftKey;if(!((t||s)&&i.ctrlKey&&TS.client.ui.isUserAttentionOnChat()))return;var o=$(i.target);var l=r();var d=o.is(l.join(","));if(!d){TS.ui.macro_keyboard_nav.focusSection(l[0]);return}var c=s?"prev":"next";var _=function e(i,t,n){return o.is(t)?n+1:i};var u=function e(i,t,n){return o.is(t)?n-1:i};var m="next"==c?_:u;var f=l.reduce(m,0);var h="next"==c?n(f):a(f);TS.ui.macro_keyboard_nav.focusSection(h)}});var e=function e(i){var t=$(i.currentTarget);if(t.hasClass("p-message_pane"))return;t.removeClass("focusablesection").removeAttr("tabindex").find(".sectionfocusindicator").remove()};var i=function e(i){var n=i.target;var a=$(n);var r=i.keyCode;if(r==TS.utility.keymap.esc&&a.hasClass("focusablesection")){a.blur();return}var s=TS.utility.isPageKey(r)||TS.utility.isArrowKey(r)||r==TS.utility.keymap.space;var o=i.ctrlKey||i.altKey||i.metaKey;if(s&&!o){t(n);return}TS.ui.macro_keyboard_nav.moveNext(i)};var t=function e(i){var t=$(i);var n=$("#col_flex")[0].contains(i);var a=$(".client_channels_list_container")[0].contains(i);var r=TS.utility.contenteditable.isActiveElement(i);if(!((n||a)&&!r))return;if(t.is("#col_flex")){$("#col_flex .panel.active .flex_content_scroller").attr("tabindex",-1).focus();return}var s=".c-scrollbar__hider";if(t.is(".client_channels_list_container"))$(s).attr("tabindex",-1).focus()};var n=function e(i){var t=r()[i];if(!t)return e(0);var n=$(t)[0];if(TS.interop.utility.isVisible(n))return t;return e(i+1)};var a=function e(i){var t=r();var n=t[i];if(!n)return e(t.length-1);var a=$(n)[0];if(TS.interop.utility.isVisible(a))return n;return e(i-1)};var r=function e(){var i=TS.useReactMessages()&&!TS.client.activeChannelIsHidden();var t=i?".p-message_pane":"#messages_container";return[t,"#footer","#col_flex",".client_channels_list_container","#banner","#client_header"]}})()},4991:function(e,i){(function(){TS.registerModule("client.quick_promo",{onStart:function e(){TS.onboarding.no_longer_in_onboarding_sig.addOnce(a)},test:function e(){var i={_showModal:s};Object.defineProperty(i,"_showModal",{get:function e(){return s},set:function e(i){s=i}});return i}})})();var t;var n;var a=function e(){TS.api.call("promo.show",{team_id:TS.model.team.id,user_id:TS.model.user.id,previous_login:TS.boot_data.last_login_timestamp}).then(function(e){if(!e.data||!e.data.ok||!e.data.show_modal)return;t=e.data.invite_count||0;r();var i=new Image;i.onload=s;i.src=cdn_url+"/436da/img/quick_promo/ill_team@2x.png"})};var r=function e(){if(t>0)n="contextual";else n="contextual_no_invites"};var s=function e(){TS.generic_dialog.start({type:"quick_promo",body:TS.templates.quick_promo_invite_nudge({copy_is_contextual_with_invites:"contextual"===n,invite_count:t}),dialog_class:"quick_promo",force_small:true,show_close_button:true,show_cancel_button:true,cancel_button_text:TS.i18n.t("Remind Me Later","quick_promo")(),fullscreen:false,show_go_button:true,onGo:o,go_button_text:TS.i18n.t("Invite People","quick_promo")(),onCancel:l});d()};var o=function e(){TS.prefs.setPrefByAPI({name:"promo_dismissed",value:true});m("invite_people_button")};var l=function e(){TS.prefs.setPrefByAPI({name:"promo_snoozed",value:Date.now()/1e3});m("remind_me_later_button")};var d=function e(){c();_();u()};var c=function e(){var i=$(".c-modal_footer__go--quick_promo");i.attr("data-action","admin_invites_modal")};var _=function e(){var i=$(".c-modal_close--quick_promo");i.one("click",function(){TS.prefs.setPrefByAPI({name:"promo_dismissed",value:true});m("exit_button")})};var u=function e(){var i=$(".modal-backdrop");i.on("click",function(){m("outside_click")})};var m=function e(i){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"invite_nudge",action:"click",ui_element:i},growth:{trigger:n}}})}},4992:function(e,i){(function(){TS.registerModule("ui.card_carousel",{onStart:function e(){},start:function a(s){if(!s.cards){TS.warn("Card carousel requires cards to show.");return}e=s;i=s.cards;t=0;n=i.length;r();if(e.onShow)e.onShow()}});var e;var i;var t;var n;var a=function e(t){var n=new Image;n.onload=function(){if(0===t){d(t);var e=setTimeout(function(){if(!TS.generic_dialog.is_showing)return;$(window.document).bind("keydown",s);clearTimeout(e)},100)}n.onload=null;n.src=null;n=null};n.src=i[t].image};var r=function e(){for(var i=0;i<n;i++)a(i)};var s=function e(i){if(i.which==TS.utility.keymap.enter||i.which==TS.utility.keymap.right)l();else if(i.which==TS.utility.keymap.esc)_();else if(i.which==TS.utility.keymap.left&&0!==t)o()};var o=function e(){TS.generic_dialog.end();t-=1;if(t<0||t>=n){_();return}d(t)};var l=function e(){TS.generic_dialog.end();t+=1;if(t<0||t>=n){_();return}d(t)};var d=function e(a){var r=false;var s=false;if(0===a)r=true;if(t+1===n)s=true;var d={display_card_index:t+1,number_of_cards:n,first_card:r,last_card:s};var u={card:i[t],allow_animations:TS.prefs.getPref("a11y_animations")};TS.generic_dialog.start({body:TS.templates.card_carousel(u),body_cls:"c-card_carousel__body",show_go_button:false,show_cancel_button:false,dialog_class:"c-card_carousel",backdrop_click_to_dismiss:true,onCancel:c});var m=$(".c-card_carousel");m.append(TS.templates.card_carousel_buttons(d));m.find(".c-card_carousel__body").click(l);m.find("[data-card_left_button]").click(o);m.find("[data-card_right_button]").click(l);m.find("[data-card_close_button]").click(_)};var c=function i(){$(window.document).unbind("keydown",s);if(e.onEnd)e.onEnd()};var _=function e(){c();TS.generic_dialog.cancel()}})()},4993:function(e,i){(function(){TS.registerModule("highlights_briefing",{sli_recaps_debug_group:null,updated_sig:new signals.Signal,$briefing_header:null,$briefing_view:null,last_request_id:null,last_cached_request_id:void 0,onStart:function e(){if(!TS.client)return;TS.client.ui.unread.started_sig.add(l);TS.client.unread.switched_away_sig.add(T);TS.channels.switched_sig.add(C);TS.groups.switched_sig.add(C);TS.mpims.switched_sig.add(C);TS.ims.switched_sig.add(C);TS.client.threads.switched_sig.add(M);TS.channels.marked_sig.add(G);TS.groups.marked_sig.add(G);TS.channels.message_changed_sig.add(K);TS.groups.message_changed_sig.add(K);TS.channels.message_removed_sig.add(W);TS.groups.message_removed_sig.add(W);TS.pins.pinned_status_changed_sig.add(j);TS.client.highlights.feedback_submitted_sig.add(B);TS.experiment.loadUserAssignments().then(function(){TS.highlights_briefing.sli_recaps_debug_group=TS.experiment.getGroup("sli_recaps_debug")})},showBriefing:function i(){if(!TS.model.team.plan||!e||!n)return;e.removeClass("hidden");n.toggleClass("hidden",!r.expanded)},hideBriefing:function i(){if(!TS.model.team.plan||!e||!n)return;e.addClass("hidden");n.addClass("hidden")},clogBackButton:function e(){var i=_.get(r,["last_jump","model_ob_id"]);var t=_.get(r,["last_jump","ts"]);var n={channel_id:i,channel_type:i[0]||"",message_timestamp:t};var a;var s=TS.client.highlights.getHighlight(i,t);if(s){n.request_id=s.request_id;a=s.cached_request_id}if(a)n.cached_request_id=a;TS.clog.track("BRIEFING_BACK_TO_BRIEFING",n)},jumpToMessageInChannel:function e(i,t){O(i,t)},setUnreadPointOnMessage:function e(i){if(!TS.model.team.plan)return;i=String(i);var t=$('.sli_briefing__message ts-message[data-ts="'+i+'"]');if(t.length){var n=t.data("model-ob-id");TS.shared.markReadMsg(n,i,TS.model.marked_reasons.back);TS.client.markLastReadsWithAPI();G(TS.shared.getModelObById(n))}},getMessageFromCache:function e(i,t){return _.get(a,[i,t],null)},promiseToGetBriefing:function e(){if(""===TS.model.team.plan)return Promise.resolve(null);return TS.api.call("highlights.briefing").then(function(e){if(!TS.boot_data.feature_store_highlights_in_redux)return e;var i={};_.each(e.data.messages,function(t){if(!i[t.channel_id])i[t.channel_id]={};i[t.channel_id][t.ts]={sliHighlight:{loading:false,isHighlight:t.score&&t.score.show_recap,feedbackOptions:t.feedback_options,justification:t.justification,request_id:e.request_id}}});TS.redux.dispatch(TS.interop.redux.models.messagesMeta.setHighlightsForMessages(i));return e}).catch(function(){return Promise.resolve(null)})},showBriefingWithResponse:function e(i){d(i)},handleFeedback:function e(i){B(i)}});var e=null;var i=null;var t=null;var n=null;var a={};var r={expanded:false,scroll_top:0,last_jump:{ts:null,model_ob_id:null},show_briefing_back_button:false,last_open_ts:null,loading:true};var s={};var o=3;var l=function e(){if(!TS.model.team.plan)return;if(r.show_briefing_back_button||_.get(r,["last_jump","model_ob_id"]))x();r.briefing_opens_count=TS.storage.fetchBriefingOpensCount();r.loading=true;u()};var d=function e(i){Promise.resolve(i).then(c).then(m).catch(function(e){TS.error("A call to highlights.briefing failed:");TS.logError(e,"Highlights in All Unreads either failed to render or got an error from the API");g(null,0,false,true)});E()};var c=function e(i){var t={};if(_.get(i,"data.messages.length")){i.data.messages=_.map(i.data.messages,function(e){var i=e.channel_id;var n=TS.utility.msgs.processImsg(e,i);n.channel_id=i;n.cached_request_id=e.cached_request_id;if(!TS.boot_data.feature_store_highlights_in_redux){var a={};a.show_recap=true;a.score=e.score;a.feedback_options=e.feedback_options;a.request_id=e.request_id;a.cached_request_id=e.cached_request_id;a.justification=e.justification;t[i]=t[i]||{};t[i][e.ts]=a}return n});if(!TS.boot_data.feature_store_highlights_in_redux)TS.client.highlights.addHighlights(t)}return i};var u=function e(){$("#unread_msgs_div").before(TS.templates.sli_briefing({show_onboarding:r.briefing_opens_count<o}));$("#unread_msgs_scroller_div").prepend(TS.templates.sli_briefing_header())};var m=function t(n){var o=_.get(n,"data.messages[0].cached_request_id");var l=!_.isUndefined(o)&&(o===TS.highlights_briefing.last_request_id||o===TS.highlights_briefing.last_cached_request_id);TS.highlights_briefing.last_cached_request_id=o;TS.highlights_briefing.last_request_id=n.request_id;r.loading=false;if(null!==r.last_open_ts&&r.last_open_ts<Date.now()-6e5||!l)r.expanded=false;if(_.get(n,"data.messages.length")){var d=_.groupBy(n.data.messages,"channel_id");var c=_(d).map(function(e,i){var t=TS.shared.getModelObById(i);var n=TS.shared.getTypeForModelOb(t);var a=TS.templates.builders.buildStarWithTip(n,t);var r={channel:t,star:new Handlebars.SafeString(a),messages:_(e).map(h).compact().value()};if(!r.messages.length)return null;return r}).compact().value();if(c.length){S(n.data.messages);i.find(".sli_briefing_view__messages").html(TS.templates.sli_briefing_message_view({groups:c}))}}else a={};if(n.data.headline){s={header:TS.format.formatWithOptions(n.data.headline.header||"","",{no_linking:true}),subheader:TS.format.formatWithOptions(n.data.headline.subheader||"","",{no_linking:true})};p(n.data.headline.users)}else s={header:"",subheader:""};var u=v();if(!u)e.hide();else if(r.expanded&&u)D(false);else{var m=A();g(m,v())}var f=_.get(r,["last_jump","model_ob_id"]);var T=_.get(r,["last_jump","ts"]);if(_.get(a,[f,T])){r.scroll_top=0;r.last_jump.ts=null;r.last_jump.model_ob_id=null}if(u){r.briefing_opens_count+=1;TS.storage.storeBriefingOpensCount(r.briefing_opens_count)}TS.highlights_briefing.updated_sig.dispatch()};var f=function e(i){var t=TS.shared.getModelObById(i.channel_id);var n=$(TS.templates.builders.msgs.buildHTML({msg:i,model_ob:t,enable_slack_action_links:true,container_id:"sli_briefing",prev_msg:null,briefing:true}));if(i.pinned_to&&i.pinned_to.length||_.get(i,"file.pinned_to.length"))n.removeClass("is_pinned");n.addClass("is_sli_briefing");return n[0].outerHTML};var h=function e(i){var t=TS.client.highlights.getHighlight(i.channel_id,i.ts);if(t.feedback&&"positive"!==t.feedback)return null;var n=k(t.feedback);var a=TS.boot_data.feature_store_highlights_in_redux?t.feedbackOptions:t.feedback_options;var r=_.map(a.negative,function(e){return _.assign({},e,{text:new Handlebars.SafeString(TS.format.formatWithOptions(e.text,null,{no_linking:true}))})});var s=t.justification;if(TS.boot_data.feature_store_highlights_in_redux)s=TS.format.formatWithOptions(s||"",void 0,{no_linking:true});return{message_markup:f(i),message:i,justification:s,feedback_class:n,negative_feedback_options:r}};var g=function e(i,n,a,s){if(i&&n){t.removeClass("sli_briefing_preview--loading").addClass("sli_briefing_preview--has_briefings");t.find('[data-js="sli_briefing_preview_title"]').html(i.header);if(r.briefing_opens_count>=o)t.find('[data-js="sli_briefing_preview_description"]').html(i.subheader);t.find('[data-js="sli_briefing_preview_action"]').removeClass("hidden");if(r.briefing_opens_count>=o)t.find('[data-js="sli_briefing_preview_facepile"]').removeClass("hidden")}else if(a){t.removeClass("sli_briefing_preview--loading sli_briefing_preview--has_briefings").addClass("sli_briefing_preview--empty");t.find('[data-js="sli_briefing_preview_title"]').text(TS.i18n.t("Done and done","highlights")());t.find('[data-js="sli_briefing_preview_description"]').text(TS.i18n.t("That’s it for the highlights! The rest of your unreads are below.","highlights")());t.find('[data-js="sli_briefing_preview_action"]').addClass("hidden");t.find('[data-js="sli_briefing_preview_facepile"]').addClass("hidden")}else if(!s){t.removeClass("sli_briefing_preview--loading sli_briefing_preview--has_briefings").addClass("sli_briefing_preview--empty");t.find('[data-js="sli_briefing_preview_title"]').text(TS.i18n.t("No new highlights","highlights")());t.find('[data-js="sli_briefing_preview_description"]').text(TS.i18n.t("But we’ll keep an ear to the ground.","highlights")());t.find('[data-js="sli_briefing_preview_action"]').addClass("hidden")}else{t.removeClass("sli_briefing_preview--loading sli_briefing_preview--has_briefings").addClass("sli_briefing_preview--empty");t.find('[data-js="sli_briefing_preview_title"]').removeClass("small_bottom_margin").addClass("error no_bottom_margin").text(TS.i18n.t("Couldn’t load highlights","highlights")());t.find('[data-js="sli_briefing_preview_description"]').addClass("hidden");t.find('[data-js="sli_briefing_preview_action"]').addClass("hidden")}TS.highlights_briefing.updated_sig.dispatch()};var p=function e(i){var n=_.map(i,function(e){var i=TS.members.getMemberById(e);return TS.templates.builders.makeMemberPreviewLinkImage(i,32,false,false,false,false)}).join("");t.find('[data-js="sli_briefing_preview_facepile"]').html(n)};var S=function e(i){a={};_.forEach(i,function(e){a[e.channel_id]=a[e.channel_id]||{};a[e.channel_id][e.ts]=e})};var T=function a(){if(!TS.model.team.plan)return;F();e=null;i=null;t=null;n=null;TS.highlights_briefing.$briefing_header=null;TS.highlights_briefing.$briefing_view=null;TS.highlights_briefing.last_request_id=null;s=null;r.last_open_ts=Date.now()};var v=function e(){return _.reduce(a,function(e,i,t){return e+b(t)},0)};var b=function e(i){return _.reduce(a[i],function(e,i){if(!y(i))return e;return e+1},0)};var w=function e(){return _(a).flatMap(function(e){return _.map(e,function(e){if(!y(e))return null;return e})}).compact().value()};var y=function e(i){var t=TS.client.highlights.getHighlight(i.channel_id,i.ts)||{};return!(i._removed||"dismiss"===t.feedback||t.left_feedback)};var A=function e(){return s};var k=function e(i){if("negative"===i)return"gave_negative_feedback";if("positive"===i)return"gave_positive_feedback";if("dismiss"===i)return"sli_briefing__feedback--dismiss";return""};var C=function e(){if(TS.model.active_cid===_.get(r,["last_jump","model_ob_id"])&&r.show_briefing_back_button)I();else if(r.last_jump&&r.show_briefing_back_button)x()};var M=function e(){if(!TS.model.team.plan)return;if(r.last_jump&&r.show_briefing_back_button)x()};var I=function e(){if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.setHighlightsBackButtonVisible(true));else{$(".sli_briefing__channel_back_button").removeClass("hidden");$("#messages_unread_status").addClass("sli_briefing--has_back_button")}};var x=function e(){if(!TS.useReactMessages()){$(".sli_briefing__channel_back_button").addClass("hidden");$("#messages_unread_status").removeClass("sli_briefing--has_back_button")}r.show_briefing_back_button=false};var E=function s(){e=$("#sli_briefing");i=$("[data-js=sli_briefing_view]");t=$('[data-js="sli_briefing_preview_container"]');n=$('[data-js="sli_briefing_header"]');TS.highlights_briefing.$briefing_header=n;TS.highlights_briefing.$briefing_view=i;e.on("click",".sli_briefing__message ts-message, .sli_briefing_target",function(e){if(!$(e.target).is("ts-message, .message_content, .message_body, .message_content_header_left, .sli_briefing_target, .comment, .rxn_panel")&&!$(e.target).parents(".message_body").length||$(e.target).parents(".msg_inline_file_preview_toggler").length||$(e.target).is("a")&&$(e.target).closest(".message_body").length||$(e.target).closest(".attachment_media").length)return;var i=$(this).is("ts-message")?$(this):$(this).parents("ts-message");var t=""+i.data("ts");var n=""+i.data("model-ob-id");O(n,t)});e.on("click",".sli_briefing__channel_link .channel_link",function(e){var i=$(e.target).closest("[data-channel-id]").data("channel-id");if("G"===i[0])TS.groups.displayGroup({id:i})});e.on("click",'[data-js="sli_briefing_preview"]',function(){if(r.loading)return;r.expanded=true;D(true);var e={request_id:TS.highlights_briefing.last_request_id};var i=_.keys(a)[0];var t=_.keys(_.get(a,[i]))[0];var n=TS.client.highlights.getHighlight(i,t);var s=n.cached_request_id;if(s)e.cached_request_id=s;TS.clog.track("BRIEFING_REVEAL",e);TS.highlights_briefing.updated_sig.dispatch()});n.off("click").on("click",'[data-js="sli_briefing_header_dismiss_all"]',function(){r.expanded=false;U();var e=w();var i=_.map(e,function(e){return{channel_id:e.channel_id,ts:e.ts}});TS.api.call("highlights.dismissAll",{request_id:TS.highlights_briefing.last_request_id,source:"briefing",messages:JSON.stringify(i)}).catch(function(e){TS.error(e)})});e.on("click",'[data-js="sli_briefing_feedback_item"] a',function(e){e.preventDefault();var i=($(e.target).closest(".sli_briefing__feedback_leavebehind").data("feedback-for-cache-id")||"").split("-");var t=Number($(e.target).closest("li").data("index"));var n=i[0];var a=i[1];TS.client.highlights.setNegativeFeedbackForHighlight(n,a,t,"briefing")});e.on("click","[data-feedback]",function(e){e.preventDefault();var i=$(e.target).data("feedback");var t=$(e.target).closest(".sli_briefing__message");var n=(t.data("cache-id")||"").split("-");var a=n[0];var r=n[1];TS.client.highlights.setDefaultFeedbackForHighlight(a,r,{feedback:i},"briefing");$("#ts_tip_float_floater .ts_tip_tip").text(TS.i18n.t("Thank you!","highlights")())})};var B=function e(i){if(!TS.model.unread_view_is_showing)return;if(TS.boot_data.feature_store_highlights_in_redux){if(a[i.channelId]&&a[i.channelId][i.ts]){var t=$('[data-cache-id="'+i.channelId+"-"+i.ts+'"]');if(t.length)P(t,i.channelId,i.ts,i)}return}_.each(i,function(e,i){_.each(e,function(e,t){if(a[i]&&a[i][t]){var n=$('[data-cache-id="'+i+"-"+t+'"]');if(n.length)P(n,i,t,e)}})})};var P=function e(i,t,n,a){var r=a.is_leaving_feedback||a.isLeavingFeedback;var s=a.left_feedback||a.leftFeedback;if("dismiss"===a.feedback||!r&&s)R(i,t,function(){if(Q())L()});else if(("negative"===a.feedback||"default_negative"===a.feedback)&&r){i.find("ts-message").addClass("hidden");i.addClass("gave_negative_feedback");i.find('[data-feedback="negative"]').addClass("sli_briefing__feedback_control--pulse");$('[data-feedback-for-cache-id="'+t+"-"+n+'"]').removeClass("hidden")}else if("positive"===a.feedback||"default_positive"===a.feedback){i.addClass("gave_positive_feedback");i.find('[data-feedback="positive"]').addClass("sli_briefing__feedback_control--pulse")}};var D=function t(a){var r=e.outerHeight();var s=$('[data-js="sli_briefing_preview_container"]');var o=61;i.removeClass("hidden");n.removeClass("hidden");TS.client.ui.checkInlineImgsAndIframes("unread");if(a){s.css({height:0,"margin-top":(TS.environment.supports_sticky_position?-o:0)+"px"});var l=e.outerHeight();e.css({height:r,"padding-top":o+20+"px","margin-top":-o+"px"});e.animate({height:l+o},300,function(){e.css({height:"auto","margin-top":"","padding-top":TS.environment.supports_sticky_position?o+20+"px":""});i.find(".sli_briefing__channel, .sli_briefing_view__footer").each(function(e,i){setTimeout(function(){$(i).css("opacity",1)},100*e+200)});if(!TS.prefs.getPref("seen_highlights_warm_welcome")){setTimeout(function(){TS.coachmark.start(TS.coachmarks.coachmarks.highlights_feedback,true)},800);TS.prefs.setPrefLocal("seen_highlights_warm_welcome",true);TS.prefs.setPrefByAPI({name:"seen_highlights_warm_welcome",value:true});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{seen_highlights_warm_welcome:"true"}})}TS.highlights_briefing.updated_sig.dispatch()})}else{s.css({transition:"none",height:0,"margin-top":(TS.environment.supports_sticky_position?-o:0)+"px"});n.css("transition","none");i.find(".sli_briefing__channel, .sli_briefing_view__footer").css("opacity",1);e.css({height:"auto","margin-top":"","padding-top":TS.environment.supports_sticky_position?o+20+"px":""})}s.addClass("go-away");n.addClass("expand");if(!a)setTimeout(function(){n.css("transition","");s.css("transition","")},0)};var U=function t(){var a=$('[data-js="sli_briefing_preview_container"]');n.removeClass("expand").addClass("go-away");var r=e.outerHeight();i.css({opacity:0,"pointer-events":"none"});g(null,0,true);var s=166;e.css({height:r,"margin-top":TS.environment.supports_sticky_position?"-61px":""});e.animate({height:s},300,function(){TS.highlights_briefing.updated_sig.dispatch()});a.css({transition:"none",transform:"translateY(118px)"});setTimeout(function(){a.css({transition:"",transform:"translateY(0)",opacity:1,"pointer-events":""})},0)};var F=function i(){if(e)e.off("click");if(n)n.off("click")};var O=function e(i,t){var n;var a;var s=TS.client.highlights.getHighlight(i,t);n=s.request_id;a=s.cached_request_id;r.scroll_top=TS.client.ui.unread.$scroller.scrollTop();r.last_jump={ts:t,model_ob_id:i};r.show_briefing_back_button=true;TS.client.ui.tryToJump(i,t);var o={channel_id:i,channel_type:i[0]||"",message_timestamp:t,request_id:n};if(a)o.cached_request_id=a;TS.clog.track("BRIEFING_JUMP_TO_CHANNEL",o)};var R=function e(i,t,n){var a=0===b(t);if(a)N(i.closest(".sli_briefing__channel"),n);else{i.addClass(k("dismiss"));setTimeout(function(){i.css({transition:"margin-bottom 0.3s","margin-bottom":0});i.animate({height:0},300,function(){var e=i.parents('.sli_briefing__channel[data-channel-id="'+t+'"]');i.remove();if(H(t)){e.css({transition:"opacity 0.2s",opacity:.5});e.find(".sli_briefing__channel_link .star").css("pointer-events","none")}if(n)n()})},300)}};var N=function e(i,t){i.addClass("dismiss");setTimeout(function(){i.css({transition:"margin-bottom 0.3s","margin-bottom":0});i.animate({height:0},300,function(){i.remove();if(t)t()});if(!v())$(".sli_briefing_view__footer").css("opacity",0)},300)};var H=function e(i){return _.every(a[i],function(e,t){var n=TS.client.highlights.getHighlight(i,t);return!n||"dismiss"===n.feedback})};var Q=function e(){return _.every(a,function(e,i){return _.every(a[i],function(e,t){var n=TS.client.highlights.getHighlight(i,t);if(!n)return true;return"dismiss"===n.feedback||true===n.left_feedback})})};var L=function i(){e.replaceWith(TS.templates.sli_briefing());n.addClass("hidden");E();g(null,0,true);r.expanded=false};var G=function e(i){if(!TS.model.team.plan)return;if(!TS.model.unread_view_is_showing)return;if(!i||!a||_.isEmpty(a)||!a[i.id])return;_.each(a[i.id],function(e,t){if(t<i.last_read&&!e._removed)TS.client.highlights.setDefaultFeedbackForHighlight(i.id,t,{feedback:"dismiss"},"briefing-mark-as-read")})};var j=function e(i){if(!TS.model.team.plan)return;if(!TS.model.unread_view_is_showing)return;if(!i||!a||_.isEmpty(a)||!a[i.id])return;_.each(a[i.id],function(e,t){var n=$('.sli_briefing__message[data-cache-id="'+i.id+"-"+t+'"]');if(n.length){var a=n.find("ts-message");if(a.hasClass("is_pinned"))a.removeClass("is_pinned")}})};var K=function e(i,t,n){if(!TS.model.unread_view_is_showing)return;if(!TS.model.team.plan)return;if(!a||_.isEmpty(a)||!a[i.id]||!a[i.id][t.ts]||!(_.includes(n,"text")||_.includes(n,"reply_count")))return;var r=_.assign({},t,{channel_id:i.id});a[i.id][t.ts]=r;var s=$('.sli_briefing__message[data-cache-id="'+i.id+"-"+t.ts+'"]');if(!s.length)return;var o=s.find("ts-message");o.replaceWith(f(r))};var W=function e(i,t){if(!TS.model.unread_view_is_showing)return;if(!TS.model.team.plan)return;if(!a||_.isEmpty(a)||!a[i.id]||!a[i.id][t.ts])return;TS.client.highlights.setDefaultFeedbackForHighlight(i.id,t.ts,{feedback:"dismiss"})}})()},4994:function(e,i){(function(){TS.registerModule("client.ui.channel_insights",{experiment_group:_.get(TS,"boot_data.experiment_assignments.sli_channel_insights.group"),onStart:function e(){if(!TS.boot_data.feature_sli_channel_insights||!TS.client)return;TS.experiment.loadUserAssignments().then(function(){TS.client.ui.channel_insights.experiment_group=TS.experiment.getGroup("sli_channel_insights")})},isEnabled:function e(){return"sli_channel_insights"===TS.client.ui.channel_insights.experiment_group},ensureChannelMemberCounts:function e(i){if(!i.data||!i.data.similar_channels)return i;return Promise.all(i.data.similar_channels.channels.map(function(e){return TS.membership.promiseToGetMembershipCounts(TS.shared.getModelObById(e))})).then(function(e){i.data.similar_channels.channels=_.map(i.data.similar_channels.channels,function(i,t){return{id:i,counts:e[t]}});return i})},renderLoadingState:function e(){return TS.templates.infinite_spinner({color:"white",size:"medium"})},renderInsightsSection:function e(i){return TS.client.ui.channel_insights.maybeRenderMostActiveMembers(i)+"\n\t\t\t"+TS.client.ui.channel_insights.maybeRenderRelatedChannels(i)},buildDebugTooltip:function e(i){var t="c-channel_insights__"+i+"-debug";return'<button type="button" class="ts_icon ts_icon_info_circle btn_unstyle ts_tip ts_tip_top '+t+'">\n\t\t\t\t<span class="ts_tip_tip">View in SLI Debugger</span>\n\t\t\t</button>'},maybeRenderMostActiveMembers:function e(i){if(!_.get(i,"data.top_contributors.users.length"))return"";if(TS.boot_data.feature_sli_channel_insights){var t=!!_.get(i,"data.top_contributors.debug");return'<div class="c-channel_insights__drawer_section">\n\t\t\t\t\t<h4 class="c-channel_insights__drawer_title">\n\t\t\t\t\t\t'+TS.i18n.t("Most active members","highlights")()+"\n\t\t\t\t\t\t"+(t?TS.client.ui.channel_insights.buildDebugTooltip("top-contributors"):"")+"\n\t\t\t\t\t</h4>\n\t\t\t\t\t"+i.data.top_contributors.users.map(function(e){var i=TS.members.getMemberById(e);return TS.templates.channel_insights_user({member:i})}).join("")+"\n\t\t\t\t</div>"}},maybeRenderRelatedChannels:function e(i){if(!_.get(i,"data.similar_channels.channels.length"))return"";var t=!!_.get(i,"data.similar_channels.debug");return'<div class="c-channel_insights__drawer_section">\n\t\t\t\t<h4 class="c-channel_insights__drawer_title">\n\t\t\t\t\t'+TS.i18n.t("Related channels","highlights")()+"\n\t\t\t\t\t"+(t?TS.client.ui.channel_insights.buildDebugTooltip("similar-channels"):"")+"\n\t\t\t\t</h4>\n\t\t\t\t"+i.data.similar_channels.channels.map(function(e){return'<div class="c-channel_insights__channel">\n\t\t\t\t\t\t'+TS.templates.builders.makeChannelLink(TS.shared.getModelObById(e.id))+'\n\t\t\t\t\t\t<div class="c-channel_insights__member_count">\n\t\t\t\t\t\t\t<ts-icon class="ts_icon_user"></ts-icon> '+e.counts.member_count+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"}).join("")+"\n\t\t\t</div>"}})})()},4995:function(e,i){(function(){TS.registerModule("client.ui.teams",{onStart:function e(){TS.teams.rename_sig.add(TS.client.ui.teams.updateSharedChannelIcons);TS.teams.added_sig.add(TS.client.ui.teams.updateSharedChannelIcons)},updateSharedChannelIcons:function e(i){if(i.id===TS.model.team.id)return;$(".ts_icon_shared_channels[data-shared-team-ids]").each(function(e,t){var n=$(t);var a=n.data("shared-team-ids");a=a&&TS.utility.parseJSONOrElse(a,a);if(!a.length||-1===a.indexOf(i.id))return;var r=n.data("tooltip-position");n.replaceWith(TS.templates.shared_channels_icon({shared_team_ids:a,tooltip:true,tooltip_position:r}))})}})})()},4996:function(e,i){(function(){TS.registerModule("ui.react_keyboard_shortcuts",{onStart:function t(){if($("#shortcuts_tab").length)TS.client.login_sig.addOnce(i);TS.prefs.enable_unread_view_changed_sig.add(function(){$("#shortcuts_tab").html("");i()});TS.i18n.keyboard_changed_sig.add(e)},executeShortcut:function e(i){if("quick_switcher"===i)TS.key_triggers.getFromCode(75).func();else if("browse_dms"===i)TS.ui.im_browser.start();else if("section_nav_next"===i||"section_nav_prev"===i){var t=jQuery.Event("keydown",{which:96,key:"`",ctrlKey:true,shiftKey:"section_nav_prev"===i});$("#client_header").trigger(t)}else if("open_preferences"===i)TS.ui.prefs_dialog.start("a11y");else if("file_upload"===i)TS.key_triggers.getFromCode(85).func();else if("open_all_unreads"===i)TS.key_triggers.getFromCode(65).func();else if("open_all_threads"===i)TS.client.threads.showThreadsView()},prefLink:function e(){TS.ui.fs_modal.close();TS.ui.react_keyboard_shortcuts.showShortcutsFlexpane()},showShortcutsFlexpane:function e(){i();TS.client.ui.flex.openFlexTab("shortcuts");var t=TS.prefs.getPref("seen_keyboard_shortcuts_coachmark");var n=TS.prefs.getPref("seen_keyboard_shortcuts_flexpane");TS.clog.track("FLEXPANE_KBSHORTCUTS_OPEN",{seen_coach_mark:t,seen_flexpane:n});if(!n){TS.prefs.setPrefLocal("seen_keyboard_shortcuts_flexpane",true);TS.prefs.setPrefByAPI({name:"seen_keyboard_shortcuts_flexpane",value:true})}},toggleShortcutsFlexpane:function e(){if("shortcuts"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(false,"shortcuts");else TS.ui.react_keyboard_shortcuts.showShortcutsFlexpane()}});var e=function e(){if($("#shortcuts_tab").length)i()};var i=function e(){var i={is_mac:"mac",is_win:"windows",is_lin:"linux"};var t=Object.keys(i).reduce(function(e,t){if(e)return e;return TS.model[t]?i[t]:null},null);var n={is_IE:"ie",is_FF:"ff",is_chrome_desktop:"chrome_desktop",is_chrome_mobile:"chrome_mobile",is_edge:"edge",is_our_app:"ssb"};var a=Object.keys(n).reduce(function(e,i){if(e)return e;return TS.model[i]?n[i]:null},null);var r={os:t,browser:a,keyboardLocale:TS.i18n.keyboard()};var s=document.getElementById("shortcuts_tab");TS.interop.mountKeyboardShortcuts(TS.boot_data.team_id,s,r)}})()},4997:function(e,i){(function(){TS.registerModule("ui.keyboard_shortcuts_prompt",{showing:false,onStart:function e(){if(!TS.boot_data.feature_shortcuts_prompt)return;$(document).on("keydown",i)},show:function i(){TS.generic_dialog.start({title:a,body:TS.templates.keyboard_shortcuts_prompt(),show_close_button:true,show_cancel_button:false,onGo:n,onCancel:n,enter_always_gos:true,esc_for_ok:true,backdrop_click_to_dismiss:true,onShow:e,onEnd:function e(){TS.ui.keyboard_shortcuts_prompt.showing=false},show_go_button:true,go_button_class:"p-shortcuts_prompt__open_button",go_button_text:r,show_secondary_go_button:true,secondary_go_button_class:"btn_outline p-shortcuts_prompt__dismiss_button",secondary_go_button_text:s,onSecondaryGo:function e(){TS.ui.react_keyboard_shortcuts.showShortcutsFlexpane();TS.metrics.count("opened_keyboard_shortcuts_fp_from_coachmark")}});TS.prefs.setPrefLocal("seen_keyboard_shortcuts_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_keyboard_shortcuts_coachmark",value:true})}});var e=function e(){TS.ui.keyboard_shortcuts_prompt.showing=true;$(document).off("keydown",i);TS.metrics.count("displayed_keyboard_shortcuts_coachmark")};var i=function e(i){if(i.which===TS.utility.keymap.tab&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isTabCompleteShowing()){t(i);return}o=false};var t=function e(i){clearTimeout(d);if(l>0&&!o)l=0;l+=1;o=true;if(5==l&&!TS.prefs.getPref("seen_keyboard_shortcuts_coachmark")){i.preventDefault();TS.ui.keyboard_shortcuts_prompt.show();return}d=setTimeout(function(){l=0},1e3)};var n=function e(){TS.metrics.count("dismissed_keyboard_shortcuts_coachmark")};var a=TS.boot_data.feature_shortcuts_prompt?TS.i18n.t("Navigating Slack with a keyboard?","keyboard_shortcuts")():"";var r=TS.boot_data.feature_shortcuts_prompt?TS.i18n.t("Got it","keyboard_shortcuts")():"";var s=TS.boot_data.feature_shortcuts_prompt?TS.i18n.t("View More","keyboard_shortcuts")():"";var o=false;var l=0;var d})()},4998:function(e,i){(function(){TS.registerModule("ui.onboarding_dialog",{onStart:function e(){},start:function e(i){if(TS.generic_dialog.is_showing)return;if(!TS.lessons.model)return;t=TS.lessons.model.TASKS.length;if("pending"===i||"completed"===i){a=false;if("pending"===i)n=TS.lessons.model.WELCOME;else n=TS.lessons.model.COMPLETION;M(n.modal_media_url).then(function(){var e={image_src:n.modal_media_url,greeting:n.modal_title,description:new Handlebars.SafeString(n.modal_description),go_button_text:n.modal_button_text};if("completed"===i)e.second_go_button_text=n.modal_second_button_text;l(TS.templates.onboarding_dialog_welcome_and_completion(e));if("pending"===i)m();else f()})}else{a=true;l(C());S();$(".c-modal_body--onboarding_dialog").on("click",".c-modal__media--onboarding_dialog",T)}},closeDialog:function e(){I()}})})();var t;var n;var a=true;var r=false;var s;var o;var l=function e(i){TS.generic_dialog.start({type:"onboarding_dialog",dialog_class:"c-modal--onboarding_dialog",force_small:true,hide_footer:true,body:i,esc_for_ok:false,show_cancel_button:false,show_go_button:false});c();$(".modal-backdrop").on("click",d);o=$(".c-modal_body--onboarding_dialog")};var d=function e(){$(".c-modal__close--onboarding_dialog").trigger("click",{trigger:"backdrop_click"})};var c=function e(){$(".c-modal_body--onboarding_dialog").on("click",".c-modal__close--onboarding_dialog",u)};var u=function e(i,t){if(n!==TS.lessons.model.COMPLETION){if(TS.boot_data.feature_lesson_onboarding){if(!i.isTrigger||false===r){$(".c-modal--onboarding_dialog").addClass("below_menu");r=true}TS.menu.startWithGeneric(i,[{value:"remind",label:TS.i18n.t("Remind me next time","prefs")()},{value:"skip",label:TS.i18n.t("Skip completely","prefs")()}],function(e){if("remind"==e){TS.lessons.postponeOnboardingAndRemindLater();TS.lessons.lessonOnboardingClog({step:"close_menu",action:"click",ui_element:"remind_me",ui_properties:{element_type:"tile",element_name:"remind_me"}})}else{TS.lessons.cancelOnboarding();TS.lessons.lessonOnboardingClog({step:"close_menu",action:"click",ui_element:"skip",ui_properties:{element_type:"tile",element_name:"skip"}})}I()},{header_text:TS.i18n.t("Close the tutorial","onboarding")(),menu_class:"onboarding_close_menu"})}}else I();if("backdrop_click"===_.get(t,"trigger"))TS.lessons.lessonOnboardingClog({step:x(),action:"click",ui_element:"outside_click"});else TS.lessons.lessonOnboardingClog({step:x(),action:"click",ui_element:"exit",ui_properties:{element_type:"button",element_name:"exit"}});TS.menu.menu_closed_sig.add(function(){$(".c-modal--onboarding_dialog").removeClass("below_menu");r=true;clearTimeout(s);s=setTimeout(function(){r=false},250)})};var m=function e(){$("#onboarding_go_button").one("click",p);$(window.document).keydown(k)};var f=function e(){$("#onboarding_go_button").on("click",h);$("#onboarding_secondary_go_button").on("click",g)};var h=function e(){TS.lessons.loadSlackbot();TS.lessons.lessonOnboardingClog({step:"finished",action:"click",ui_element:"ask_slackbot",ui_properties:{element_type:"button",element_name:"ask_slackbot"}})};var g=function e(){I();TS.lessons.lessonOnboardingClog({step:"finished",action:"click",ui_element:"im_done",ui_properties:{element_type:"button",element_name:"im_done"}})};var p=function e(){a=true;o.html(C());S();$(".c-modal_body--onboarding_dialog").on("click",".c-modal__media--onboarding_dialog",T);TS.lessons.onboardingInProgress();TS.lessons.lessonOnboardingClog({step:"welcome",action:"click",ui_element:"lets_go",ui_properties:{element_type:"button",element_name:"lets_go"}})};var S=function e(){$(".c-modal_body--onboarding_dialog").on("click",".c-modal__left_navigation--onboarding_dialog",v);$(".c-modal_body--onboarding_dialog").on("click",".c-modal__right_navigation--onboarding_dialog",b);$(".c-modal_body--onboarding_dialog").on("click",".c-modal__lesson_circle_button",w);$(".c-modal_body--onboarding_dialog").on("click",".c-modal__button--onboarding",TS.lessons.initiateTask);$(window.document).keydown(y);$(window.document).keydown(A)};var T=function e(){var i=$(this);var t=i.attr("src");if(bowser.msie){var n=t.length;if("?"===t[n-1])i.attr("src",t.slice(0,-1));else i.attr("src",t+"?")}else if(bowser.msedge){i.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");setTimeout(function(){i.attr("src",t)},100)}else{i.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");i.attr("src",t)}};var v=function e(){TS.lessons.model.current_task_index-=1;if(-1===TS.lessons.model.current_task_index)TS.lessons.model.current_task_index=t-1;o.html(C());TS.lessons.lessonOnboardingClog({step:"task"+(TS.lessons.model.current_task_index+1)+"_1",action:"carousel_back",ui_element:"back",ui_properties:{element_type:"button",element_name:"back"}})};var b=function e(){TS.lessons.model.current_task_index+=1;if(TS.lessons.model.current_task_index===t)TS.lessons.model.current_task_index=0;o.html(C());TS.lessons.lessonOnboardingClog({step:"task"+(TS.lessons.model.current_task_index+1)+"_1",action:"carousel_next",ui_element:"forward",ui_properties:{element_type:"button",element_name:"forward"}})};var w=function e(){var i=$(this).index();if(i!==TS.lessons.model.current_task_index){TS.lessons.model.current_task_index=i;o.html(C())}TS.lessons.lessonOnboardingClog({step:"task"+(TS.lessons.model.current_task_index+1)+"_1",action:"click",ui_element:"center_menu",ui_properties:{element_type:"menu",element_name:"step"+(i+1)}})};var y=function e(i){if(i.keyCode===TS.utility.keymap.left)v()};var A=function e(i){if(i.keyCode===TS.utility.keymap.right)b()};var k=function e(i){if(i.keyCode===TS.utility.keymap.esc)if(n===TS.lessons.model.COMPLETION)I();else $(".c-modal__close--onboarding_dialog").trigger("click")};var C=function e(){var i=_.get(TS.lessons.model,"TASKS["+TS.lessons.model.current_task_index+"]");if(!i){TS.info("Something went wrong! Could not get TS.lessons.model.TASKS[TS.lessons.model.current_task_index]");return}var t=i.modal_color_class;var n=true;var a=_.map(TS.lessons.model.TASKS,function(e,i){var a;if(i===TS.lessons.model.current_task_index&&e.task_completed){a="ts_icon_check_circle_o_large c-modal__lesson_circle--"+t;n=false}else if(e.task_completed)a="ts_icon_check_circle_o_large";else if(i===TS.lessons.model.current_task_index)a="ts_icon_circle_fill c-modal__lesson_circle--"+t;else a="ts_icon_circle_fill";return"c-modal__lesson_circle "+a});M(i.modal_media_url).then(function(){var e=$('<img class="c-modal__media--onboarding_dialog full_max_width position_relative cursor_pointer" src="'+i.modal_media_url+'" />');$("#onboarding_media_infinite_spinner").addClass("hidden");$(".c-modal__media_container--onboarding_dialog").append(e)});return TS.templates.onboarding_dialog_lesson({modal_color_class:"c-modal__media_container--onboarding_dialog_"+t,modal_title:i.modal_title,lesson_circle_classes:a,modal_description:i.modal_description,modal_button_show:n,modal_button_text:i.modal_button_text})};var M=function e(i){return new Promise(function(e,t){var n=new Image;n.onload=function(){e()};n.onerror=function(){t(new Error("failed to load image"))};n.src=i})};var I=function e(){$(".c-modal_body--onboarding_dialog").off("click",".c-modal__left_navigation--onboarding_dialog",v);$(".c-modal_body--onboarding_dialog").off("click",".c-modal__right_navigation--onboarding_dialog",b);$(".c-modal_body--onboarding_dialog").off("click",".c-modal__lesson_circle_button",w);$(".c-modal_body--onboarding_dialog").off("click",".c-modal__close--onboarding_dialog",u);$(".c-modal_body--onboarding_dialog").off("click",".c-modal__button--onboarding",TS.lessons.initiateTask);$(".modal-backdrop").off("click",d);$(".c-modal_body--onboarding_dialog").off("click",".c-modal__media--onboarding_dialog",T);$("#start_lesson_onboarding").off("click",p);$("#onboarding_go_button").off("click",h);$("#onboarding_secondary_go_button").off("click",g);$(window.document).off("keydown",y);$(window.document).off("keydown",A);TS.generic_dialog.cancel();$("c-modal--onboarding_dialog").removeClass("c-modal--onboarding_dialog");if(n===TS.lessons.model.COMPLETION)TS.onboarding.no_longer_in_onboarding_sig.dispatch()};var x=function e(){if(a)return"task"+(TS.lessons.model.current_task_index+1)+"_1";else if(n===TS.lessons.model.WELCOME)return"welcome";return"finished"}},4999:function(e,i){(function(){TS.registerModule("client.ui.home_screen",{start:function i(t,n){t=!!t;n=!!n;var a=n?false:t;if(!TS.client.homeScreenViewActivated(t,a))return;TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vhome_screen"));$("#client-ui").addClass("home_screen_view_is_showing");if("details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(true);TS.client.msg_pane.hideNewMsgsBar(true);$("#footer").addClass("hidden");TS.client.channel_header.start();if(TS.client.unread.isEnabled()){TS.client.unread.destroyUnreadView();TS.model.unread_view_is_showing=false}if(TS.model.threads_view_is_showing){TS.client.threads.destroyThreadsView();TS.model.threads_view_is_showing=false}if(TS.client.ui.apps_dashboard.isEnabled()&&TS.client.ui.apps_dashboard.isShowing())TS.client.ui.apps_dashboard.stop();e=document.getElementById("home_screen_mount_point");TS.interop.mountHomeScreen(TS.boot_data.team_id,e,{});TS.model.home_screen_view_is_showing=true},stop:function i(){$("#client-ui").removeClass("home_screen_view_is_showing");$("#footer").removeClass("hidden");TS.interop.unmountHomeScreen(e);TS.model.home_screen_view_is_showing=false},isEnabled:function e(){var i=TS.redux.getState(),t=i.prefs;return TS.boot_data.feature_sli_home&&TS.boot_data.feature_react_messages&&!_.get(t,"user.opt_out_react_messages")&&TS.boot_data.experiment_assignments&&TS.boot_data.experiment_assignments.sli_home_screen&&"sli_home_screen"===TS.boot_data.experiment_assignments.sli_home_screen.group},isShowing:function e(){return TS.model.home_screen_view_is_showing},showTabs:function e(){return TS.boot_data.feature_sli_home&&TS.boot_data.experiment_assignments&&TS.boot_data.experiment_assignments.sli_recaps_debug&&"sli_debug_info"===TS.boot_data.experiment_assignments.sli_recaps_debug.group}});var e=null})()},5e3:function(e,i){(function(){TS.registerModule("client.ui.search_in_react",{onStart:function i(){if(!TS.boot_data.feature_react_search)return;e=$("#search_popover_container")[0];$("#search_container").detach().appendTo(document.body).css({position:"fixed",top:"0.8rem",right:"6.5rem",width:"250px","z-index":1e4}).find("#header_search_form").css({"background-color":"white"});$("#client_header .flex_header").prepend($("<div></div>").css({flex:"1",position:"relative","z-index":0,margin:"0 7px 0 0","min-width":0}))},open:function i(t,n){if(!TS.boot_data.feature_react_search)return;TS.redux.dispatch(TS.interop.redux.features.searchUi.setVisible({visible:true}));if(t&&!n){TS.redux.dispatch(TS.interop.redux.features.searchUi.setLastQuery({lastQuery:t}));TS.redux.dispatch(TS.interop.redux.features.searchResults.fetchAllSearchResults({query:t}))}TS.interop.mountSearch(TS.redux.getState().teamId,e)},close:function i(){if(!TS.boot_data.feature_react_search)return;TS.redux.dispatch(TS.interop.redux.features.searchUi.setVisible({visible:false}));var t=$("#search_terms");var n=TS.utility.contenteditable.value(t);TS.utility.contenteditable.blur(t);t.autocomplete("preventMenuOnNextFocus");if(n)$("#search_container").addClass("c-search__button").one("click",function(e){e.preventDefault();e.stopPropagation();$(this).removeClass("c-search__button");TS.utility.contenteditable.blur(t);TS.client.ui.search_in_react.open(n,true);t.autocomplete("preventMenuOnNextFocus")});TS.interop.unmountSearch(e)},isEnabled:function e(){return TS.boot_data.feature_react_search},getPopoverPosition:function i(){return e&&e.getBoundingClientRect()}});var e=null})()},5001:function(e,i){(function(){TS.registerModule("client.ui.canvases_flexpane",{start:function i(t){if(!TS.client.ui.canvases_flexpane.isEnabled())return;e=document.getElementById("canvases_flexpane_mount_point");TS.interop.mountCanvasesFlexpane(TS.boot_data.team_id,e,{channelId:t})},stop:function i(){if(e)TS.interop.unmountCanvasesFlexpane(e)},isEnabled:function e(){return TS.boot_data.feature_app_canvases&&TS.boot_data.experiment_assignments&&TS.boot_data.experiment_assignments.app_canvas_flexpane&&"in_experiment"===TS.boot_data.experiment_assignments.app_canvas_flexpane.group}});var e})()},5002:function(e,i){(function(){TS.registerModule("client.ui.apps_dashboard",{start:function i(t,n){t=!!t;n=!!n;var a=n?false:t;if(!TS.client.appsDashboardViewActivated(t,a))return;TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vapps_dashboard"));$("#client-ui").addClass("apps_dashboard_view_is_showing");if("details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(true);TS.client.msg_pane.hideNewMsgsBar(true);$("#footer").addClass("hidden");TS.client.channel_header.start();if(TS.client.unread.isEnabled()){TS.client.unread.destroyUnreadView();TS.model.unread_view_is_showing=false}if(TS.model.threads_view_is_showing){TS.client.threads.destroyThreadsView();TS.model.threads_view_is_showing=false}if(TS.client.ui.home_screen.isEnabled()&&TS.client.ui.home_screen.isShowing())TS.client.ui.home_screen.stop();e=document.getElementById("apps_dashboard_mount_point");TS.interop.mountAppsDashboard(TS.boot_data.team_id,e);TS.model.apps_dashboard_view_is_showing=true},stop:function i(){$("#client-ui").removeClass("apps_dashboard_view_is_showing");$("#footer").removeClass("hidden");if(e)TS.interop.unmountAppsDashboard(e);TS.model.apps_dashboard_view_is_showing=false},isShowing:function e(){return TS.model.apps_dashboard_view_is_showing},isEnabled:function e(){return TS.boot_data.feature_app_canvases&&TS.boot_data.experiment_assignments&&TS.boot_data.experiment_assignments.canvases_dashboard&&"in_experiment"===TS.boot_data.experiment_assignments.canvases_dashboard.group}});var e=null})()},5003:function(e,i){(function(){TS.registerModule("generic_notification_banner",{banner_to_show_sig:new signals.Signal,is_showing:false,current_settings:null,banner_to_show:null,data:null,onStart:function e(){TS.api.call("promo.banner").then(function(e){if(e.data.message_pane){TS.generic_notification_banner.banner_to_show=e.data.message_pane.name;if(e.data.message_pane.data)TS.generic_notification_banner.data=e.data.message_pane.data;TS.generic_notification_banner.banner_to_show_sig.dispatch()}}).catch(function(){TS.warn("A call to promo.banner failed")})},start:function e(i){if(TS.generic_notification_banner.is_showing){TS.warn('"'+i.h1_copy+'" banner was not shown because another banner is already being shown.');return}else if(TS.onboarding.inOnboarding()){TS.warn('"'+i.h1_copy+'" banner was not shown because the user is in onboarding.');return}TS.generic_notification_banner.current_settings=_.defaults({},i,d);l=TS.generic_notification_banner.current_settings;c();u(l.emoji_src,l.emoji_alt);m(l.h1_copy);f(l.h2_copy);h(l);g(l);p(l);S(l);TS.generic_notification_banner.show()},show:function i(){e.removeClass("hidden");TS.generic_notification_banner.is_showing=true},close:function i(){if(e)e.addClass("hidden");TS.generic_notification_banner.is_showing=false;TS.generic_notification_banner.banner_to_show=null},getNotifBannerPref:function e(i){var t=TS.prefs.getPref("growth_all_banners_prefs");t=JSON.parse(t);return t[i]},setNotifBannerPrefs:function e(i){var t=TS.prefs.getPref("growth_all_banners_prefs");t=JSON.parse(t);$.each(i,function(e,i){t[e]=i});t=JSON.stringify(t);return TS.prefs.setPrefByAPI({name:"growth_all_banners_prefs",value:t})}});var e;var i;var t;var n;var a;var r;var s;var o;var l=null;var d={emoji_src:"",emoji_alt:"",h1_copy:"",h2_copy:"",show_go_button:false,go_button_text:TS.i18n.t("Show Me","notification_banner")(),go_button_class:"",onGo:null,show_go_link_button:true,go_link_button_text:TS.i18n.t("Learn More","notification_banner")(),go_link_button_url:"",go_link_button_class:"",onLinkGo:null,show_close_button:true,close_button_text:TS.i18n.t("Skip for Now","notification_banner")(),close_button_class:"",onClose:null,show_close_x_icon:false,onXClose:null};var c=function l(){e=$("#notification_banner");i=$("#notification_banner ts-icon");t=$("#notification_banner img");n=$("#notification_banner_h1");a=$("#notification_banner_h2");r=$("#notification_banner_go_link_button");s=$("#notification_banner_go_button");o=$("#notification_banner_close_button")};var u=function e(i,n){if(!i){t.addClass("hidden");return}var a={src:i,alt:n};t.attr(a);t.removeClass("hidden")};var m=function e(i){if(!i){n.addClass("hidden");return}n.removeClass("hidden");n.text(i)};var f=function e(i){if(!i){a.addClass("hidden");return}a.removeClass("hidden");a.html(i)};var h=function e(i){if(i.show_go_link_button){r.removeClass("hidden");r.text(i.go_link_button_text);if(i.go_link_button_url)r.attr("href",i.go_link_button_url);if(i.go_link_button_class)r.addClass(i.go_link_button_class);if(i.onLinkGo)r.on("click",i.onLinkGo);r.on("click",function(){TS.generic_notification_banner.close()})}else r.addClass("hidden")};var g=function e(i){if(i.show_go_button){s.removeClass("hidden");s.text(i.go_button_text);if(i.go_button_class)s.addClass(i.go_button_class);if(i.onGo)s.on("click",i.onGo);s.on("click",function(){TS.generic_notification_banner.close()})}else s.addClass("hidden")};var p=function e(i){if(i.show_close_button){o.removeClass("hidden");if(i.close_button_class)o.addClass(i.close_button_class);if(i.onClose)o.on("click",i.onClose);o.text(i.close_button_text);o.on("click",function(){TS.generic_notification_banner.close()})}else o.addClass("hidden")};var S=function e(t){if(t.show_close_x_icon){i.removeClass("hidden");if(t.onXClose)i.on("click",t.onXClose);i.on("click",function(){TS.generic_notification_banner.close()});i.keydown(function(e){var i=e.keyCode||e.which;if(i===TS.utility.keymap.enter)TS.generic_notification_banner.close()})}else i.addClass("hidden")}})()},5004:function(e,i){(function(){TS.registerModule("client.trial_expiration_banners",{onStart:function e(){if(!TS.boot_data.feature_shared_channel_free_trial_flow)return;TS.generic_notification_banner.banner_to_show_sig.add(d);TS.channels.switched_sig.add(d);TS.groups.switched_sig.add(_);TS.ims.switched_sig.add(_);TS.mpims.switched_sig.add(_);TS.client.threads.switched_sig.add(_);TS.client.unread.switched_sig.add(_)}})})();var t;var n;var a;var r;var s;var o;var l=function e(){if("two_weeks_left_esc_trial_banner"===t&&r)s=TS.teams.getTeamNameByMemberId(r.creator);n=TS.generic_notification_banner.data.no_of_days_left;a=TS.generic_notification_banner.data.pay_date_next;if(TS.boot_data.feature_shared_channel_free_trial_flow)o={two_weeks_left_esc_trial_banner:{h1_copy:TS.i18n.t("Heads up: you have {num_of_days} more days on your free trial","trial_expiration_banners")({num_of_days:n}),h2_copy:TS.i18n.t("When the trial ends, this channel will <b>no longer be shared</b> with {shared_team_name}. Upgrade by {expiration_date} to keep all the features of the Standard plan.","trial_expiration_banners")({expiration_date:a,shared_team_name:s}),step:63},one_week_left_esc_trial_banner:{h1_copy:TS.i18n.t("Only {num_of_days} days left on your free trial","trial_expiration_banners")({num_of_days:n}),h2_copy:TS.i18n.t("When your free trial’s over, this channel will no longer be shared, and you won’t be able to reshare it in the future. Upgrade before {expiration_date} to keep all the features of the Standard plan.","trial_expiration_banners")({expiration_date:a}),step:64}}};var d=function e(){if(!TS.boot_data.feature_shared_channel_free_trial_flow)return;_();t=TS.generic_notification_banner.banner_to_show;if("two_weeks_left_esc_trial_banner"!==t&&"one_week_left_esc_trial_banner"!==t)return;if(!TS.generic_notification_banner.data)return;if(TS.model.threads_view_is_showing)return;if(TS.model.unread_view_is_showing)return;r=TS.shared.getActiveModelOb();if(!TS.shared.isModelObShared(r))return;if(TS.onboarding.inOnboarding())return;if("treatment"!==TS.experiment.getGroup("shared_channels_trial_flow"))return;l();c(o[t])};var c=function e(i){TS.generic_notification_banner.start({h1_copy:i.h1_copy,h2_copy:i.h2_copy,show_close_x_icon:true,onXClose:u,show_go_link_button:true,go_link_button_text:TS.i18n.t("See Plans","trial_expiration_banners")(),go_link_button_url:"/pricing?ui_element=11&ui_step="+i.step,onLinkGo:m,show_close_button:false,show_go_button:false});var t={step:i.step,action:"impression",days:"",date:"",num_sc:""};h("UPGRDEXP_SC_TRIAL_FLOW",t)};var _=function e(){$("#notification_banner").addClass("hidden");TS.generic_notification_banner.is_showing=false};var u=function e(){f();var i={step:o[t].step,action:"close",element:"btn_close",days:"",date:"",num_sc:""};h("UPGRDEXP_SC_TRIAL_FLOW",i)};var m=function e(){f();var i={step:o[t].step,action:"click",element:"pricing_link",days:"",date:"",num_sc:""};h("UPGRDEXP_SC_TRIAL_FLOW",i)};var f=function e(){var i={};var n=Math.floor(Date.now()/1e3);var a={one_week_left_esc_trial_banner:{num_times_seen:"one_week_left_esc_trial_cta_count",timestamp:"one_week_left_esc_trial_cta_last_ts"},two_weeks_left_esc_trial_banner:{num_times_seen:"two_weeks_left_esc_trial_cta_count",timestamp:"two_weeks_left_esc_trial_cta_last_ts"}};var r=a[t];var s=TS.generic_notification_banner.getNotifBannerPref(a[t].num_times_seen);if(!s)s=0;s+=1;i[r.num_times_seen]=s;i[r.timestamp]=n;TS.generic_notification_banner.setNotifBannerPrefs(i)};var h=function e(i,t){TS.clog.track(i,{num_days_before_expire:t.days,date_of_trial_expiration:t.date,num_of_shared_channels:t.num_sc,contexts:{ui_context:{step:t.step,action:t.action,ui_element:t.element}}})}},681:function(e,i){/**
 * @package		PickMeUp - jQuery datepicker plugin
 * @author		Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @author		Stefan Petre <www.eyecon.ro>
 * @copyright	Copyright (c) 2013-2014, Nazar Mokrynskyi
 * @copyright	Copyright (c) 2008-2009, Stefan Petre
 * @license		MIT License, see license.txt
 */
(function(e){function i(){var e=new Date(this.toString()),i=28,t=e.getMonth();while(e.getMonth()==t){++i;e.setDate(i)}return i-1}e.addDays=function(e){this.setDate(this.getDate()+e)};e.addMonths=function(e){var t=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+e);this.setDate(Math.min(t,i.apply(this)))};e.addYears=function(e){var t=this.getDate();this.setDate(1);this.setFullYear(this.getFullYear()+e);this.setDate(Math.min(t,i.apply(this)))};e.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var i=new Date(this.getFullYear(),0,0,0,0,0);var t=e-i;return Math.floor(t/24*60*60*1e3)}})(Date.prototype);(function(e){var i=0;e.pickmeup=e.extend(e.pickmeup||{},{date:new Date,flat:false,first_day:1,default_date:true,prev:"&#9664;",next:"&#9654;",mode:"single",select_year:true,select_month:true,select_day:true,view:"days",calendars:1,format:"d-m-Y",position:"bottom",trigger_event:"click touchstart",class_name:"",separator:" - ",hide_on_select:false,min:null,max:null,render:function(){},change:function(){return true},before_show:function(){return true},show:function(){return true},hide:function(){return true},fill:function(){return true},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}});var t={years:"pmu-view-years",months:"pmu-view-months",days:"pmu-view-days"},n={wrapper:'<div class="pickmeup" />',head:function(e){var i="";for(var t=0;t<7;++t)i+="<div>"+e.day[t]+"</div>";return'<div class="pmu-instance"><nav><div class="pmu-prev pmu-button">'+e.prev+'</div><div class="pmu-month pmu-button" /><div class="pmu-next pmu-button">'+e.next+'</div></nav><nav class="pmu-day-of-week">'+i+"</nav></div>"},body:function(e,i){var t="";for(var n=0;n<e.length;++n){t+='<div class="'+e[n].class_name+' pmu-button">';if(-1!=e[n].class_name.indexOf("pmu-today"))t+='<span class="pmu-today-border">'+e[n].text+"</span>";else t+=e[n].text;t+="</div>"}return'<div class="'+i+'">'+t+"</div>"}};function a(){var i=e(this).data("pickmeup-options"),t=this.pickmeup,a=Math.floor(i.calendars/2),r=i.date,o=i.current,l,d,c,_,u=(new Date).setHours(0,0,0,0).valueOf(),m,f,h,g;t.find(".pmu-instance > :not(nav)").remove();for(var p=0;p<i.calendars;p++){l=new Date(o);_=t.find(".pmu-instance").eq(p);if(t.hasClass("pmu-view-years")){l.addYears(12*(p-a));d=l.getFullYear()-6+" - "+(l.getFullYear()+5)}else if(t.hasClass("pmu-view-months")){l.addYears(p-a);d=l.getFullYear()}else if(t.hasClass("pmu-view-days")){l.addMonths(p-a);g=i.title_format||"B Y";d=s(l,g,i.locale)}if(!f)if(i.max){h=new Date(l);if(i.select_day)h.addMonths(i.calendars-1);else if(i.select_month)h.addYears(i.calendars-1);else h.addYears(12*(i.calendars-1));if(h>i.max){--p;o.addMonths(-1);f=void 0;continue}}f=new Date(l);if(!m){m=new Date(l);m.setDate(1);m.addMonths(1);m.addDays(-1);if(i.min&&i.min>m){--p;o.addMonths(1);m=void 0;continue}}_.find(".pmu-month").text(d);c="";var S=function(e){return"range"==i.mode&&e>=new Date(r[0]).getFullYear()&&e<=new Date(r[1]).getFullYear()||"multiple"==i.mode&&-1!==r.reduce(function(e,i){e.push(new Date(i).getFullYear());return e},[]).indexOf(e)||new Date(r).getFullYear()==e};var T=function(e,t){var n=new Date(r[0]).getFullYear(),a=new Date(r[1]).getFullYear(),s=new Date(r[0]).getMonth(),o=new Date(r[1]).getMonth();return"range"==i.mode&&e>n&&e<a||"range"==i.mode&&e==n&&e<a&&t>=s||"range"==i.mode&&e>n&&e==a&&t<=o||"range"==i.mode&&e==n&&e==a&&t>=s&&t<=o||"multiple"==i.mode&&-1!==r.reduce(function(e,i){i=new Date(i);e.push(i.getFullYear()+"-"+i.getMonth());return e},[]).indexOf(e+"-"+t)||new Date(r).getFullYear()==e&&new Date(r).getMonth()==t};(function(){var e=[],t=l.getFullYear()-6,a=new Date(i.min).getFullYear(),r=new Date(i.max).getFullYear(),s;for(var o=0;o<12;++o){s={text:t+o,class_name:[]};if(i.min&&s.text<a||i.max&&s.text>r)s.class_name.push("pmu-disabled");else if(S(s.text))s.class_name.push("pmu-selected");s.class_name=s.class_name.join(" ");e.push(s)}c+=n.body(e,"pmu-years")})();(function(){var e=[],t=l.getFullYear(),a=new Date(i.min).getFullYear(),r=new Date(i.min).getMonth(),s=new Date(i.max).getFullYear(),o=new Date(i.max).getMonth(),d;for(var _=0;_<12;++_){d={text:i.locale.monthsShort[_],class_name:[]};if(i.min&&(t<a||_<r&&t==a)||i.max&&(t>s||_>o&&t>=s))d.class_name.push("pmu-disabled");else if(T(t,_))d.class_name.push("pmu-selected");d.class_name=d.class_name.join(" ");e.push(d)}c+=n.body(e,"pmu-months")})();(function(){var t=[],a=l.getMonth(),r;(function(){l.setDate(1);var e=(l.getDay()-i.first_day)%7;l.addDays(-(e+(e<0?7:0)))})();for(var s=0;s<42;++s){r={text:l.getDate(),class_name:[]};if(a!=l.getMonth())r.class_name.push("pmu-not-in-month");if(0==l.getDay())r.class_name.push("pmu-sunday");else if(6==l.getDay())r.class_name.push("pmu-saturday");var o=i.render(l)||{},d=l.valueOf(),_=i.min&&i.min>l||i.max&&i.max<l;if(o.disabled||_)r.class_name.push("pmu-disabled");else if(o.selected||i.date==d||-1!==e.inArray(d,i.date)||"range"==i.mode&&d>=i.date[0]&&d<=i.date[1])r.class_name.push("pmu-selected");if(d==u)r.class_name.push("pmu-today");if(o.class_name)r.class_name.push(o.class_name);r.class_name=r.class_name.join(" ");t.push(r);l.addDays(1)}c+=n.body(t,"pmu-days")})();_.append(c)}m.setDate(1);f.setDate(1);f.addMonths(1);f.addDays(-1);t.find(".pmu-prev").css("visibility",i.min&&i.min>=m?"hidden":"visible");t.find(".pmu-next").css("visibility",i.max&&i.max<=f?"hidden":"visible");i.fill.apply(this)}function r(i,t,n,a){if(i.constructor==Date)return i;else if(!i)return new Date;var s=i.split(n);if(s.length>1){s.forEach(function(i,s,o){o[s]=r(e.trim(i),t,n,a)});return s}var o=a.monthsShort.join(")(")+")("+a.months.join(")("),n=new RegExp("[^0-9a-zA-Z("+o+")]+"),l=i.split(n),d=t.split(n),c,_,u,m,f,h=new Date;for(var g=0;g<l.length;g++)switch(d[g]){case"b":_=a.monthsShort.indexOf(l[g]);break;case"B":_=a.months.indexOf(l[g]);break;case"d":case"e":c=parseInt(l[g],10);break;case"m":_=parseInt(l[g],10)-1;break;case"Y":case"y":u=parseInt(l[g],10);u+=u>100?0:u<29?2e3:1900;break;case"H":case"I":case"k":case"l":m=parseInt(l[g],10);break;case"P":case"p":if(/pm/i.test(l[g])&&m<12)m+=12;else if(/am/i.test(l[g])&&m>=12)m-=12;break;case"M":f=parseInt(l[g],10)}var p=new Date(void 0===u?h.getFullYear():u,void 0===_?h.getMonth():_,void 0===c?h.getDate():c,void 0===m?h.getHours():m,void 0===f?h.getMinutes():f,0);if(isNaN(1*p))p=new Date;return p}function s(e,i,t){var n=e.getMonth();var a=e.getDate();var r=e.getFullYear();var s=e.getDay();var o={};var l=e.getHours();var d=l>=12;var c=d?l-12:l;var _=e.getDayOfYear();if(0==c)c=12;var u=e.getMinutes();var m=e.getSeconds();var f=i.split(""),h;for(var g=0;g<f.length;g++){h=f[g];switch(h){case"a":h=t.daysShort[s];break;case"A":h=t.days[s];break;case"b":h=t.monthsShort[n];break;case"B":h=t.months[n];break;case"C":h=1+Math.floor(r/100);break;case"d":h=a<10?"0"+a:a;break;case"e":h=a;break;case"H":h=l<10?"0"+l:l;break;case"I":h=c<10?"0"+c:c;break;case"j":h=_<100?_<10?"00"+_:"0"+_:_;break;case"k":h=l;break;case"l":h=c;break;case"m":h=n<9?"0"+(1+n):1+n;break;case"M":h=u<10?"0"+u:u;break;case"p":case"P":h=d?"PM":"AM";break;case"s":h=Math.floor(e.getTime()/1e3);break;case"S":h=m<10?"0"+m:m;break;case"u":h=s+1;break;case"w":h=s;break;case"y":h=(""+r).substr(2,2);break;case"Y":h=r}f[g]=h}return f.join("")}function o(){var i=e(this),t=i.data("pickmeup-options"),n=t.current,a;switch(t.mode){case"multiple":a=n.setHours(0,0,0,0).valueOf();if(-1!==e.inArray(a,t.date))e.each(t.date,function(e,i){if(i==a){t.date.splice(e,1);return false}return true});else t.date.push(a);break;case"range":if(!t.lastSel)t.date[0]=n.setHours(0,0,0,0).valueOf();a=n.setHours(0,0,0,0).valueOf();if(a<=t.date[0]){t.date[1]=t.date[0];t.date[0]=a}else t.date[1]=a;t.lastSel=!t.lastSel;break;default:t.date=n.valueOf()}var r=d(t);if(i.is("input"))i.val("single"==t.mode?r[0]:r[0].join(t.separator));t.change.apply(this,r);if(t.hide_on_select&&("range"!=t.mode||!t.lastSel)){t.binded.hide();return false}}function l(i){var t=e(i.target);if(!t.hasClass("pmu-button"))t=t.closest(".pmu-button");if(t.length){if(t.hasClass("pmu-disabled"))return false;var n=e(this),a=n.data("pickmeup-options"),r=t.parents(".pmu-instance").eq(0),s=r.parent(),o=e(".pmu-instance",s).index(r);if(t.parent().is("nav"))if(t.hasClass("pmu-month")){a.current.addMonths(o-Math.floor(a.calendars/2));if(s.hasClass("pmu-view-years")){if("single"!=a.mode)a.current=new Date(a.date[a.date.length-1]);else a.current=new Date(a.date);if(a.select_day)s.removeClass("pmu-view-years").addClass("pmu-view-days");else if(a.select_month)s.removeClass("pmu-view-years").addClass("pmu-view-months")}else if(s.hasClass("pmu-view-months")){if(a.select_year)s.removeClass("pmu-view-months").addClass("pmu-view-years");else if(a.select_day)s.removeClass("pmu-view-months").addClass("pmu-view-days")}else if(s.hasClass("pmu-view-days"))if(a.select_month)s.removeClass("pmu-view-days").addClass("pmu-view-months");else if(a.select_year)s.removeClass("pmu-view-days").addClass("pmu-view-years")}else if(t.hasClass("pmu-prev"))a.binded.prev(false);else a.binded.next(false);else if(!t.hasClass("pmu-disabled"))if(s.hasClass("pmu-view-years")){a.current.setFullYear(parseInt(t.text(),10));if(a.select_month)s.removeClass("pmu-view-years").addClass("pmu-view-months");else if(a.select_day)s.removeClass("pmu-view-years").addClass("pmu-view-days");else a.binded.update_date()}else if(s.hasClass("pmu-view-months")){a.current.setMonth(r.find(".pmu-months .pmu-button").index(t));a.current.setFullYear(parseInt(r.find(".pmu-month").text(),10));if(a.select_day)s.removeClass("pmu-view-months").addClass("pmu-view-days");else a.binded.update_date();a.current.addMonths(Math.floor(a.calendars/2)-o)}else{var l=parseInt(t.text(),10);a.current.addMonths(o-Math.floor(a.calendars/2));if(t.hasClass("pmu-not-in-month"))a.current.addMonths(l>15?-1:1);a.current.setDate(l);a.binded.update_date()}a.binded.fill()}return false}function d(i){var t;if("single"==i.mode){t=new Date(i.date);return[s(t,i.format,i.locale),t]}else{t=[[],[]];e.each(i.date,function(e,n){var a=new Date(n);t[0].push(s(a,i.format,i.locale));t[1].push(a)});return t}}function c(i){var t=this.pickmeup;if(i||!t.is(":visible")){var n=e(this),a=n.data("pickmeup-options"),s=n.offset(),o={l:document.documentElement.scrollLeft,t:document.documentElement.scrollTop,w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},l=s.top,d=s.left;a.binded.fill();if(n.is("input"))n.pickmeup("set_date",r(n.val(),a.format,a.separator,a.locale)).keydown(function(e){if(9==e.which)n.pickmeup("hide")});a.before_show();switch(a.position){case"top":l-=t.outerHeight();break;case"left":d-=t.outerWidth();break;case"right":d+=this.offsetWidth;break;case"bottom":l+=this.offsetHeight}if(l+t.offsetHeight>o.t+o.h)l=s.top-t.offsetHeight;if(l<o.t)l=s.top+this.offsetHeight+t.offsetHeight;if(d+t.offsetWidth>o.l+o.w)d=s.left-t.offsetWidth;if(d<o.l)d=s.left+this.offsetWidth;if(false==a.show())return;t.css({display:"inline-block",top:l+"px",left:d+"px"});e(document).on("mousedown"+a.events_namespace,a.binded.hide).on("resize"+a.events_namespace,[true],a.binded.forced_show)}}function _(){c.call(this,true)}function u(i){if(!i||!i.target||i.target!=this&&!(16&this.pickmeup.get(0).compareDocumentPosition(i.target))){var t=this.pickmeup,n=e(this).data("pickmeup-options");if(false!=n.hide()){t.hide();e(document).off("mousedown",n.binded.hide).off("resize",n.binded.forced_show);n.date[1]=n.date[0];n.lastSel=false}}}function m(){var i=e(this).data("pickmeup-options");e(document).off("mousedown",i.binded.hide).off("resize",i.binded.forced_show);i.binded.forced_show()}function f(){var i=e(this).data("pickmeup-options");if("single"!=i.mode){i.date=[];i.lastSel=false;i.binded.fill()}}function h(i){if("undefined"==typeof i)i=true;var t=this.pickmeup;var n=e(this).data("pickmeup-options");if(t.hasClass("pmu-view-years"))n.current.addYears(-12);else if(t.hasClass("pmu-view-months"))n.current.addYears(-1);else if(t.hasClass("pmu-view-days"))n.current.addMonths(-1);if(i)n.binded.fill()}function g(i){if("undefined"==typeof i)i=true;var t=this.pickmeup;var n=e(this).data("pickmeup-options");if(t.hasClass("pmu-view-years"))n.current.addYears(12);else if(t.hasClass("pmu-view-months"))n.current.addYears(1);else if(t.hasClass("pmu-view-days"))n.current.addMonths(1);if(i)n.binded.fill()}function p(i){var t=e(this).data("pickmeup-options"),n=d(t);if("string"===typeof i){var a=n[1];if(a.constructor==Date)return s(a,i,t.locale);else return a.map(function(e){return s(e,i,t.locale)})}else return n[i?0:1]}function S(i){var t=e(this).data("pickmeup-options");t.date=i;if("string"===typeof t.date)t.date=r(t.date,t.format,t.separator,t.locale).setHours(0,0,0,0);else if(t.date.constructor==Date)t.date.setHours(0,0,0,0);if(!t.date){t.date=new Date;t.date.setHours(0,0,0,0)}if("single"!=t.mode)if(t.date.constructor!=Array){t.date=[t.date.valueOf()];if("range"==t.mode&&t.default_date)t.date.push(new Date(t.date[0]).setHours(0,0,0,0).valueOf())}else{for(var n=0;n<t.date.length;n++)t.date[n]=r(t.date[n],t.format,t.separator,t.locale).setHours(0,0,0,0).valueOf();if("range"==t.mode)t.date[1]=new Date(t.date[1]).setHours(0,0,0,0).valueOf()}else t.date=t.date.constructor==Array?t.date[0].valueOf():t.date.valueOf();t.current=new Date("single"!=t.mode?t.date[0]:t.date);t.binded.fill()}function T(){var i=e(this),t=i.data("pickmeup-options");i.removeData("pickmeup-options");i.off(t.events_namespace);e(document).off(t.events_namespace);e(this.pickmeup).remove()}e.fn.pickmeup=function(s){if("string"===typeof s){var d,v=Array.prototype.slice.call(arguments,1);switch(s){case"hide":case"show":case"clear":case"update":case"prev":case"next":case"destroy":this.each(function(){d=e(this).data("pickmeup-options");if(d)d.binded[s]()});break;case"get_date":d=this.data("pickmeup-options");if(d)return d.binded.get_date(v[0]);else return null;case"set_date":this.each(function(){d=e(this).data("pickmeup-options");if(d)d.binded[s].apply(this,v)})}return this}return this.each(function(){var d=e(this);if(d.data("pickmeup-options"))return;var v,b,w=e.extend({},e.pickmeup,s||{});for(v in w){b=d.data("pmu-"+v);if("undefined"!==typeof b)w[v]=b}if("days"==w.view&&!w.select_day)w.view="months";if("months"==w.view&&!w.select_month)w.view="years";if("years"==w.view&&!w.select_year)w.view="days";if("days"==w.view&&!w.select_day)w.view="months";w.calendars=Math.max(1,parseInt(w.calendars,10)||1);w.mode=/single|multiple|range/.test(w.mode)?w.mode:"single";if("string"===typeof w.min)w.min=r(w.min,w.format,w.separator,w.locale).setHours(0,0,0,0);else if(w.min&&w.min.constructor==Date)w.min.setHours(0,0,0,0);if("string"===typeof w.max)w.max=r(w.max,w.format,w.separator,w.locale).setHours(0,0,0,0);else if(w.max&&w.max.constructor==Date)w.max.setHours(0,0,0,0);if(!w.select_day){if(w.min){w.min=new Date(w.min);w.min=w.min.valueOf()}if(w.max){w.max=new Date(w.max);w.max=w.max.valueOf()}}if("string"===typeof w.date)w.date=r(w.date,w.format,w.separator,w.locale).setHours(0,0,0,0);else if(w.date.constructor==Date)w.date.setHours(0,0,0,0);if(!w.date){w.date=new Date;w.date.setHours(0,0,0,0)}if("single"!=w.mode){if(w.date.constructor!=Array){w.date=[w.date.valueOf()];if("range"==w.mode&&w.default_date)w.date.push(new Date(w.date[0]).setHours(0,0,0,0).valueOf())}else{for(v=0;v<w.date.length;v++)w.date[v]=r(w.date[v],w.format,w.separator,w.locale).setHours(0,0,0,0).valueOf();if("range"==w.mode)w.date[1]=new Date(w.date[1]).setHours(0,0,0,0).valueOf()}w.current=new Date(w.date[0]);if(!w.select_day)for(v=0;v<w.date.length;++v){w.date[v]=new Date(w.date[v]);w.date[v].setDate(1);w.date[v]=w.date[v].valueOf();if("range"!=w.mode&&w.date.indexOf(w.date[v])!==v){w.date.splice(v,1);--v}}}else{w.date=w.date.valueOf();w.current=new Date(w.date);if(!w.select_day){w.date=new Date(w.date);w.date.setDate(1);w.date=w.date.valueOf()}}w.current.setDate(1);w.current.setHours(0,0,0,0);var y,A=e(n.wrapper);this.pickmeup=A;if(w.class_name)A.addClass(w.class_name);var k="";for(v=0;v<w.calendars;v++){y=w.first_day;k+=n.head({prev:w.prev,next:w.next,day:[w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7]]})}d.data("pickmeup-options",w);for(v in w)if(-1!=["render","change","before_show","show","hide"].indexOf(v))w[v]=w[v].bind(this);w.binded={fill:a.bind(this),update_date:o.bind(this),click:l.bind(this),show:c.bind(this),forced_show:_.bind(this),hide:u.bind(this),update:m.bind(this),clear:f.bind(this),prev:h.bind(this),next:g.bind(this),get_date:p.bind(this),set_date:S.bind(this),destroy:T.bind(this)};w.events_namespace=".pickmeup-"+ ++i;A.on("click touchstart",w.binded.click).addClass(t[w.view]).append(k).on(e.support.selectstart?"selectstart":"mousedown",function(e){e.preventDefault()});w.binded.fill();if(w.flat)A.appendTo(this).css({position:"relative",display:"inline-block"});else{A.appendTo(document.body);var C=w.trigger_event.split(" ");for(v=0;v<C.length;++v)C[v]+=w.events_namespace;C=C.join(" ");d.on(C,w.binded.show)}})}})(jQuery)},7:function(e,i){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){if("object"===typeof window)t=window}e.exports=t}},[4911]);